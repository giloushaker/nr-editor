{"version":3,"file":"_id_.2a99f35d.js","sources":["../../../../pages/search/[id].vue"],"sourcesContent":["<template>\n  <div class=\"ml-20px mt-10px h-full overflow-y-auto\">\n    <!-- Params:\n    {{ $route.params }} -->\n    <div>\n      <input type=\"search\" v-model=\"filter\" @keydown.enter=\"search\" />\n      <button class=\"inputstyle\" @click=\"search\"> Search </button>\n      <span v-if=\"searching\"> Searching...</span>\n      <template v-else-if=\"count !== null\">\n        <span>Found {{ count }}<template v-if=\"more\">+</template> results</span>\n        <span>, Displaying {{ displayed_count }} results</span>\n      </template>\n    </div>\n    <button class=\"inputstyle w-28px\" @click=\"page = Math.max(0, page - 1)\"> &lt; </button>\n    <button class=\"inputstyle w-28px\" @click=\"page = Math.min(last_page, page + 1)\"> &gt; </button>\n    Page {{ page + 1 }} / {{ last_page + 1 }} <input type=\"checkbox\" id=\"show-fullpath\" v-model=\"showFullPath\" /><label\n      for=\"show-fullpath\"\n      >Show Full Path</label\n    >\n    <div></div>\n    <!-- Results -->\n    <div v-if=\"results\" class=\"pb-50px\">\n      <div v-for=\"(items, catalogue) in displayed_results\">\n        <span class=\"bold\">{{ catalogue }}</span>\n        <div class=\"ml-8px\">\n          <div class=\"hover-darken cursor-pointer\" v-for=\"item in items\" @click=\"store.goto(item)\">\n            <template v-if=\"showFullPath && path(item).length\">\n              <NodePath\n                :path=\"path(item)\"\n                @click=\"store.goto(item)\"\n                class=\"inline hover-darken cursor-pointer p-1px\"\n                end-arrow\n              />\n            </template>\n\n            <span>\n              <span class=\"typeIcon-wrapper\">\n                <img class=\"typeIcon mr-4px\" :src=\"`/assets/bsicons/${item.editorTypeName}.png`\" />\n              </span>\n              <!-- <span v-if=\"primary\" class=\"text-orange\">{{ primary }}</span> -->\n              <span>\n                {{ getName(item) }}\n              </span>\n              <span v-if=\"getNameExtra(item)\" class=\"gray\">&nbsp;{{ getNameExtra(item) }} </span>\n              <span class=\"ml-10px\" v-if=\"costs(item)\" v-html=\"costs(item)\" />\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { getEntryPathInfo, getName, getNameExtra } from \"~/assets/shared/battlescribe/bs_editor\";\nimport { sortByDescending } from \"~/assets/shared/battlescribe/bs_helpers\";\nimport { EditorBase } from \"~/assets/shared/battlescribe/bs_main_catalogue\";\nimport NodePath from \"~/components/util/NodePath.vue\";\nimport { useEditorStore } from \"~/stores/editorStore\";\n\nexport interface ICost {\n  name: string;\n  value: number;\n  typeId: string;\n}\nfunction round(num: number): number {\n  return Math.round(num * 100) / 100;\n}\nexport function formatCosts(costs: ICost[]): string {\n  let res = \"\";\n  costs = sortByDescending(costs, (c) => c.name);\n  for (const cost of costs) {\n    if (cost.value != 0) {\n      let name = \"\";\n      if (cost.name.length != 0) {\n        name = \" \" + cost.name;\n      }\n      res = `${res}<span class='cost'>${round(cost.value)}${name}</span>`;\n    }\n  }\n  if (res.length == 0) {\n    return res;\n  }\n  return `<span class=\"costList\">${res}</span>`;\n}\nexport default defineComponent({\n  setup() {\n    return { store: useEditorStore() };\n  },\n  data() {\n    return {\n      filter: \"\",\n      results: null as Record<string, EditorBase[]> | null,\n      count: null as number | null,\n      searching: false,\n      more: false,\n      page: 0,\n      max_display: 30,\n      max_results: 1000,\n      showFullPath: false,\n    };\n  },\n  computed: {\n    async system() {\n      return await this.store.get_or_load_system(\n        (\n          this.$route.params as {\n            id: string;\n          }\n        ).id\n      );\n    },\n    data() {\n      return { filter: this.filter };\n    },\n    from() {\n      if (this.count === null) return 0;\n      return Math.min(this.page * this.max_display, this.count);\n    },\n    to() {\n      if (this.count === null) return 0;\n      return Math.min(this.page * this.max_display + this.max_display, this.count);\n    },\n    last_page() {\n      if (this.count === null) return 0;\n      return Math.ceil(this.count / this.max_display) - 1;\n    },\n    displayed_results() {\n      let n = 0;\n      const from = this.from;\n      const to = this.to;\n      const result = {} as Record<string, EditorBase[]>;\n      for (const key in this.results) {\n        const items = this.results[key];\n        const count = items.length;\n        let end = count;\n        if (n + count > to) {\n          const total = n + count;\n          const extra = Math.max(total - to, 0);\n          end = count - extra;\n        }\n        if (n + count >= from) {\n          const diff = Math.max(from - n, 0);\n          if (count && end > diff) result[key] = items.slice(diff, end);\n        }\n        n += count;\n        if (n > to) {\n          break;\n        }\n      }\n      return result;\n    },\n    displayed_count() {\n      let n = 0;\n      for (const key in this.displayed_results) {\n        n += this.displayed_results[key].length;\n      }\n      return n;\n    },\n  },\n  methods: {\n    getName,\n    getNameExtra,\n    path(link: EditorBase) {\n      const path = getEntryPathInfo(link);\n      path.pop();\n      path.shift();\n      return path;\n    },\n    async search() {\n      try {\n        this.searching = true;\n        await this.$nextTick(() => this.$forceUpdate());\n        await new Promise((resolve) => setTimeout(resolve, 5));\n        const found = await this.store.system_search(await this.system, this.data, this.max_results);\n        if (!found) {\n          this.results = null;\n          this.count = null;\n          this.more = false;\n          return;\n        }\n        this.more = found.more;\n        this.results = found.grouped;\n        this.count = found.all.length;\n      } catch (e) {\n        console.error(e);\n      } finally {\n        this.page = 0;\n        this.searching = false;\n      }\n    },\n    costs(item: EditorBase) {\n      const result = [] as ICost[];\n      const catalogue = item.getCatalogue();\n      const costs = item.getCosts();\n      for (const cost of costs) {\n        const name = catalogue.findOptionById(cost.typeId)?.name || cost.name || cost.typeId;\n        if (name) {\n          result.push({\n            name: name,\n            value: cost.value,\n            typeId: cost.typeId,\n          });\n        }\n      }\n      return formatCosts(result);\n    },\n  },\n  components: { NodePath },\n});\n</script>\n"],"names":["round","num","formatCosts","costs","res","sortByDescending","c","cost","name","_sfc_main","useEditorStore","n","from","to","result","key","items","count","end","total","extra","diff","getName","getNameExtra","link","path","getEntryPathInfo","resolve","found","e","item","catalogue","_a","NodePath","_hoisted_1","_hoisted_5","_hoisted_11","_component_NodePath","_resolveComponent","_createElementBlock","_createElementVNode","_withDirectives","_cache","$event","_ctx","_withKeys","args","_vModelText","_openBlock","_hoisted_2","_Fragment","_createTextVNode","_toDisplayString","_createCommentVNode","_vModelCheckbox","_hoisted_3","_hoisted_6","_hoisted_7","_renderList","_createBlock","_hoisted_9","_hoisted_10"],"mappings":"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"}