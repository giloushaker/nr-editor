import{a as w,o as s,b as n,E as $,B as _,l as y,p as V,w as M,P as q,e as F,aK as T,Z as C,r as k,i,t as m,s as c,F as g,D as v,c as A,q as b,m as Q,J as B,aL as R,a4 as N,h as E}from"./entry.070238af.js";import{E as O,a as D,_ as j}from"./catalogue.3789ceff.js";import{N as J}from"./NodePath.473fafaa.js";import{_ as W}from"./right2.91afc9dd.js";const P={props:{collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},noboxindent:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},vertical:{type:Boolean,default:!1},titleCollapse:{type:Boolean,default:!0},id:{type:String,required:!1},icon:{type:Boolean,default:!0}},mounted(){this.id&&this.$route.hash&&this.$route.hash.substring(1)===this.id&&this.collapsed&&this.$nextTick(()=>{var e;this.collapseSwitch(),(e=this.$el)==null||e.scrollIntoView({block:"center"})})},data(){return{collapsed:!0,initiated:!1}},created(){(!this.collapsible||this.defcollapsed==!1)&&this.collapseSwitch()},computed:{dropdownSrc(){var p,r,u;let e=2;(u=(r=(p=this.$optionStore)==null?void 0:p.options)==null?void 0:r.appearence)!=null&&u.dropdownStyle&&(e=this.$optionStore.options.appearence.dropdownStyle);let l=[`/assets/icons/right${e}.png`,`/assets/icons/down${e}.png`],o=this.collapsed?0:1;return this.vertical&&(o=1-o),l[o]}},methods:{collapseSwitch(){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?(this.$emit("open"),this.$emit("change")):(this.$emit("close"),this.$emit("change"))},titleSwitch(){this.titleCollapse?this.collapseSwitch():this.$emit("titleClick")}},watch:{collapsible(){this.initiated=!0}}};const U=["id"],Y=["src"],L={key:1,class:"boxContent"};function X(e,l,o,p,r,u){return s(),n("div",{class:$([{box:!o.nobox&&!o.noboxindent,nobox:o.nobox,nocollapse:!o.collapsible,noboxindent:o.noboxindent,verticalbox:r.collapsed&&o.vertical},"collapsibleBox"]),id:o.id},[o.notitle?y("",!0):(s(),n("h3",{key:0,class:$([{arrowTitle:o.collapsible,normalTitle:!o.collapsible,collapsed:o.collapsible&&r.collapsed,titleClickCollapsible:o.collapsible&&!r.collapsed&&o.titleCollapse,titleClickEffect:r.collapsed||o.collapsible},o.title]),onClick:l[1]||(l[1]=(...d)=>u.titleSwitch&&u.titleSwitch(...d))},[o.collapsible&&o.icon?(s(),n("img",{key:0,src:u.dropdownSrc,class:"icon arrow",onClick:l[0]||(l[0]=_((...d)=>u.collapseSwitch&&u.collapseSwitch(...d),["stop"]))},null,8,Y)):y("",!0),V(e.$slots,"title",{class:"title"},void 0,!0)],2)),r.initiated?M((s(),n("div",L,[V(e.$slots,"content",{},void 0,!0)],512)),[[q,!r.collapsed||!o.collapsible]]):y("",!0)],10,U)}const I=w(P,[["render",X],["__scopeId","data-v-d3008f2d"]]),Z=F({components:{EditableDiv:O},props:{arg:{type:Object,required:!0},args:{type:Array,required:!0},system:{type:T,required:!0},index:{type:Number,required:!0}},data(){return{value:this.getDefaultValue(Array.isArray(this.arg.type)?this.arg.type[0]:this.arg.type)}},methods:{catalogueName(e){return C(e).name},async getArgument(){const e=this.types[0],l=this.value;switch(e){case"catalogue[]":if(l==="All Catalogues"){await this.system.loadAll();const r=this.system.getAllLoadedCatalogues();return r.map(u=>u.processForEditor()),r}else{const r=this.system.getAllCatalogueFiles().map(d=>C(d)).find(d=>d.name===l),u=await this.system.loadCatalogue({targetId:r.id});return u.processForEditor(),u.imports.map(d=>d.processForEditor()),[u]}case"catalogue":const o=this.system.getAllCatalogueFiles().map(r=>C(r)).find(r=>r.name===l),p=await this.system.loadCatalogue({targetId:o.id});return p.processForEditor(),p.imports.map(r=>r.processForEditor()),p;default:return l}},async updateArgument(){const e=await this.getArgument();return this.args[this.index]=e,e},getDefaultValue(e){if(this.arg.default!==void 0)return this.arg.default;if(e==="catalogue[]")return"All Catalogues"},onFileSelected(e){var o;const l=[...((o=e.target)==null?void 0:o.files)||[]];for(const p of l)this.value=p.text()}},computed:{types(){return Array.isArray(this.arg.type)?this.arg.type:[this.arg.type]}}}),K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=";const x={class:"bold p-2px"},H={key:0},G={key:1,class:"gray"},z={style:{"white-space":"nowrap"}},ee=i("img",{class:"mr-1 align-middle",src:K},null,-1),te=i("img",{class:"mr-1 align-middle",src:D},null,-1),se={style:{"white-space":"nowrap"}},le=i("img",{class:"mr-1 align-middle",src:D},null,-1);function oe(e,l,o,p,r,u){const d=j,f=k("EditableDiv");return s(),n("div",null,[i("span",x,m(e.arg.name??e.arg.type),1),e.arg.optional?y("",!0):(s(),n("span",H,"*")),c(),e.arg.description?(s(),n("span",G,m(e.arg.description),1)):y("",!0),(s(!0),n(g,null,v(e.types,(h,a)=>(s(),n("div",null,[h==="catalogue[]"?(s(),A(d,{key:0,modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value=t),options:[{label:"All Catalogues"},...e.system.getAllCatalogueFiles()],valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",z,[t.label?(s(),n(g,{key:0},[ee,c(m(t.label),1)],64)):(s(),n(g,{key:1},[te,c(" "+m(e.catalogueName(t)),1)],64))])]),_:1},8,["modelValue","options","valueField","filterField"])):h==="catalogue"?(s(),A(d,{key:1,modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value=t),options:e.system.getAllCatalogueFiles(),valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",se,[le,c(" "+m(t.name),1)])]),_:1},8,["modelValue","options","valueField","filterField"])):h==="string"?(s(),A(f,{key:2,modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value=t),spellcheck:"false",style:{"font-family":"monospace"}},null,8,["modelValue"])):h==="boolean"||h==="toggle"?(s(),n(g,{key:3},[M(i("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=t=>e.value=t)},null,512),[[Q,e.value]]),i("label",null,m(e.arg.name),1)],64)):h==="file"?(s(),n("input",{key:4,type:"file",onInput:l[4]||(l[4]=(...t)=>e.onFileSelected&&e.onFileSelected(...t))},null,32)):y("",!0)]))),256))])}const ne=w(Z,[["render",oe]]),re=F({components:{ScriptArgument:ne,NodePath:J},props:{script:{type:Object,required:!0},system:{type:T,required:!0}},setup(){return{store:B()}},data(){return{result:null,args:[],running:!1}},methods:{debug(...e){console.log(...e)},isEntry(e){return e instanceof R},isError(e){return e instanceof Error},isEntryWithDesc(e){return Array.isArray(e)&&e.length===2&&this.isEntry(e[0])},isEntryList(e){return e.find(l=>!this.isEntry(l)&&!this.isEntryWithDesc(l))?!1:e.length>0},async run(){this.result=null,this.running=!0,await new Promise(e=>setTimeout(e,1));try{const e=this.$refs.args?await Promise.all(this.$refs.args.map(l=>l.getArgument())):[];this.store.scripts.add_script_hooks(this.script),typeof this.script.run=="function"?this.result=await this.script.run(...e):this.script.hooks?this.result=`Added hooks: ${Object.keys(this.script.hooks)}`:this.result=null,console.log(this.script.name,this.result)}catch(e){console.error(e),console.log(typeof e,e instanceof Error),this.result=e}finally{globalThis.$result=this.result,this.running=!1}},path(e){return N(e)},other_path(e){return N(e)}},computed:{outputArray(){return(Array.isArray(this.result)&&!this.isEntryList(this.result)?this.result:[this.result]).filter(e=>!(Array.isArray(e)&&e.length===0||e===null||e===void 0))}}});const ie={key:0},ae={class:"gray"},ue=["disabled"],de={key:0,class:"gray"},ce=i("img",{class:"icon",src:W},null,-1),pe=i("div",{class:"bold"},"Output:",-1),he={class:"output-element"},me=["innerHTML"],ge={class:"node"},ye={key:3,class:"error"},fe={key:4},Ae={key:0},be=i("span",{class:"gray"},"None",-1),ve=[be];function _e(e,l,o,p,r,u){const d=k("ScriptArgument"),f=k("NodePath"),h=I;return s(),A(h,{class:"script mx-4px"},{title:b(()=>[c(m(e.script.name),1)]),content:b(()=>[e.script.description?(s(),n("span",ie,"Description:")):y("",!0),i("span",ae,m(e.script.description),1),(s(!0),n(g,null,v(e.script.arguments||[],(a,t)=>(s(),n("div",null,[E(d,{arg:a,args:e.args,system:e.system,index:t,ref_for:!0,ref:"args"},null,8,["arg","args","system","index"])]))),256)),i("div",null,[i("button",{class:"bouton my-10px",onClick:l[0]||(l[0]=(...a)=>e.run&&e.run(...a)),disabled:e.running},[e.running?(s(),n("span",de,"...")):(s(),n(g,{key:1},[ce,c(" Run Script ")],64))],8,ue)]),e.result?(s(),n(g,{key:1},[pe,(s(!0),n(g,null,v(e.outputArray,a=>(s(),n("div",he,[["string","number"].includes(typeof a)?(s(),n("span",{key:0,class:"output-html",innerHTML:a},null,8,me)):Array.isArray(a)&&e.isEntryList(a)?(s(!0),n(g,{key:1},v(a,t=>(s(),n("div",ge,[Array.isArray(t)?(s(),A(f,{key:0,path:e.path(t[0]),onClick:S=>e.store.goto(t[0]),class:"hover-darken cursor-pointer p-1px",text:t[1],onMouseup:_(S=>e.debug(t[0].editorTypeName,t[0]),["middle"])},null,8,["path","onClick","text","onMouseup"])):(s(),A(f,{key:1,path:e.path(t),onClick:S=>e.store.goto(t),class:"hover-darken cursor-pointer p-1px",onMouseup:_(S=>e.debug(t.editorTypeName,t),["middle"])},null,8,["path","onClick","onMouseup"]))]))),256)):e.isEntry(a)?(s(),A(f,{key:2,path:e.path(a),onClick:t=>e.store.goto(a),class:"hover-darken cursor-pointer p-1px",onMouseup:_(t=>e.debug(a.editorTypeName,a),["middle"])},null,8,["path","onClick","onMouseup"])):e.isError(a)?(s(),n("div",ye,m(a),1)):(s(),n("pre",fe,"              "+m(JSON.stringify(a,null,2))+`
            `,1))]))),256)),e.outputArray.length==0?(s(),n("div",Ae,ve)):y("",!0)],64)):y("",!0)]),_:1})}const ke=w(re,[["render",_e]]),we=F({components:{RunScript:ke},setup(){return{store:B()}},data(){return{system:null,scripts:[...B().scripts.get_default_scripts()]}},async mounted(){this.system=null,this.system=await this.store.get_or_load_system(this.$route.params.id),this.scripts.push(...await this.store.scripts.get_scripts(this.system))},methods:{}}),Se={class:"h-full overflow-y-auto"},Ce=i("div",{class:"info"},[i("pre",{style:{margin:"10px"}},[c("Note: this feature is not finished To add a new script: Create a folder named `scripts` in your data folder and\nadd a .js file with content like this:\n"),i("code",null,`
export default {
  name: "Display Selected",
  description: "Returns the currently selected node(s)",
  arguments: [
    {
      name: "catalogues",
      type: "catalogue[]"
    },
    {
      name: "query",
      type: "string"
      optional: true,
    },
  ],
  run(catalogues, query) {
    return [\`<span style="font-weight: bold">Selected nodes:</span>\`,$store.get_selections()]
  }
}
`),c(`
`),i("span",{class:"bold"},"Output:"),c(`
return one of or an array of: number | error | string | node[] | [node, string][]
Will render html

`),i("span",{class:"bold"},"Running scripts:"),c(`
Currently only supports running scripts manually, but may support running hooks in the future such as on paste, on change, on load, etc
You may interact with the editor using the store (global variable \`$store\`, also available in the console)
Available actions are in `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"},"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"),c(`
Example scripts (in typescript but only js is supported for non-default scripts): `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"},"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"),c(`
If you want to use imports you have to bundle them into one js file with rollup/webpack
If you want to read/write local files you can use the functions in the global \`$node\`
          `)])],-1);function Be(e,l,o,p,r,u){const d=k("RunScript"),f=I;return s(),n("div",Se,[e.system?(s(!0),n(g,{key:0},v(e.scripts,h=>(s(),n("div",null,[E(d,{script:h,system:e.system},null,8,["script","system"])]))),256)):y("",!0),E(f,null,{title:b(()=>[c("Info")]),content:b(()=>[Ce]),_:1})])}const Ne=w(we,[["render",Be]]);export{Ne as default};
//# sourceMappingURL=_id_.8037ae85.js.map
