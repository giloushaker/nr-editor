import{a as E,o as l,b as o,E as w,B as v,l as p,p as T,h as k,q as b,aK as I,e as V,aL as M,Z as B,r as S,i,t as m,s as c,F as y,D as _,c as A,w as q,m as R,J as F,aM as Q,a4 as N}from"./entry.e0132845.js";import{E as O,a as L,_ as j}from"./catalogue.b93a5360.js";import{N as J}from"./NodePath.9b314f6c.js";import{_ as W}from"./right2.91afc9dd.js";const U={props:{collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},noboxindent:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},vertical:{type:Boolean,default:!1},titleCollapse:{type:Boolean,default:!0},id:{type:String,required:!1},icon:{type:Boolean,default:!0},iconLocation:{type:String,default:"left"},locked:{type:Boolean,default:!1}},mounted(){this.id&&this.$route.hash&&this.$route.hash.substring(1)===this.id&&this.collapsed&&this.$nextTick(()=>{var e;this.collapseSwitch(),(e=this.$el)==null||e.scrollIntoView({block:"center"})})},data(){return{collapsed:!0,initiated:!1}},created(){(!this.collapsible||this.defcollapsed==!1)&&this.collapseSwitch()},computed:{dropdownSrc(){var s,r,h;return`/assets/icons/right${((h=(r=(s=this.$optionStore)==null?void 0:s.options)==null?void 0:r.appearence)==null?void 0:h.dropdownStyle)||2}.png`},left(){return this.vertical?!1:this.iconLocation==="right"?this.collapsed:!1},right(){return this.vertical?this.collapsed:this.iconLocation==="left"?this.collapsed:!1},down(){return!this.collapsed}},methods:{collapseSwitch(){this.locked||(this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?(this.$emit("open"),this.$emit("change")):(this.$emit("close"),this.$emit("change")))},titleSwitch(){this.titleCollapse?this.collapseSwitch():this.$emit("titleClick")},beforeEnter(e){e.style.height="0",e.style.overflow="hidden"},enter(e,s){e.style.height="auto";const r=getComputedStyle(e).height;e.style.height="0",e.offsetHeight,e.style.transition="height 0.12s ease-out",e.style.height=r,setTimeout(()=>{e.style.height="auto",s()},200)},afterEnter(e){e.style.height="",e.style.transition="",e.style.overflow=""},beforeLeave(e){e.style.height=getComputedStyle(e).height,e.style.overflow="hidden",e.offsetHeight},leave(e,s){e.style.transition="height 0.12s ease-out",e.style.height="0",setTimeout(s,200)}},watch:{collapsible(){this.initiated=!0}}};const Y=["id"],P=["src"],X=["src"],Z={key:0,class:"boxContent",ref:"boxContent"};function K(e,s,r,h,a,n){return l(),o("div",{class:w([{box:!r.nobox&&!r.noboxindent,nobox:r.nobox,nocollapse:!r.collapsible,noboxindent:r.noboxindent,verticalbox:a.collapsed&&r.vertical},"collapsibleBox"]),id:r.id},[r.notitle?p("",!0):(l(),o("h3",{key:0,class:w([{arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&a.collapsed,titleClickCollapsible:r.collapsible&&!a.collapsed&&r.titleCollapse,titleClickEffect:a.collapsed||r.collapsible},r.title]),onClick:s[2]||(s[2]=(...u)=>n.titleSwitch&&n.titleSwitch(...u))},[r.collapsible&&r.icon&&r.iconLocation==="left"?(l(),o("img",{key:0,src:n.dropdownSrc,class:w(["icon arrow",{right:n.right,left:n.left,down:n.down}]),onClick:s[0]||(s[0]=v((...u)=>n.collapseSwitch&&n.collapseSwitch(...u),["stop"]))},null,10,P)):p("",!0),T(e.$slots,"title",{class:"title"},void 0,!0),r.collapsible&&r.icon&&r.iconLocation==="right"?(l(),o("img",{key:1,src:n.dropdownSrc,class:w(["icon arrow arrowRight",{right:n.right,left:n.left,down:n.down}]),onClick:s[1]||(s[1]=v((...u)=>n.collapseSwitch&&n.collapseSwitch(...u),["stop"]))},null,10,X)):p("",!0)],2)),k(I,{name:"slide",onBeforeEnter:n.beforeEnter,onEnter:n.enter,onAfterEnter:n.afterEnter,onBeforeLeave:n.beforeLeave,onLeave:n.leave},{default:b(()=>[a.initiated&&(!a.collapsed||!r.collapsible)?(l(),o("div",Z,[T(e.$slots,"content",{},void 0,!0)],512)):p("",!0)]),_:3},8,["onBeforeEnter","onEnter","onAfterEnter","onBeforeLeave","onLeave"])],10,Y)}const D=E(U,[["render",K],["__scopeId","data-v-66dd3f5b"]]),H=V({components:{EditableDiv:O},props:{arg:{type:Object,required:!0},args:{type:Array,required:!0},system:{type:M,required:!0},index:{type:Number,required:!0}},data(){return{value:this.getDefaultValue(Array.isArray(this.arg.type)?this.arg.type[0]:this.arg.type)}},methods:{catalogueName(e){return B(e).name},async getArgument(){const e=this.types[0],s=this.value;switch(e){case"catalogue[]":if(s==="All Catalogues"){await this.system.loadAll();const a=this.system.getAllLoadedCatalogues();return a.map(n=>n.processForEditor()),a}else{const a=this.system.getAllCatalogueFiles().map(u=>B(u)).find(u=>u.name===s),n=await this.system.loadCatalogue({targetId:a.id});return n.processForEditor(),n.imports.map(u=>u.processForEditor()),[n]}case"catalogue":const r=this.system.getAllCatalogueFiles().map(a=>B(a)).find(a=>a.name===s),h=await this.system.loadCatalogue({targetId:r.id});return h.processForEditor(),h.imports.map(a=>a.processForEditor()),h;default:return s}},async updateArgument(){const e=await this.getArgument();return this.args[this.index]=e,e},getDefaultValue(e){if(this.arg.default!==void 0)return this.arg.default;if(e==="catalogue[]")return"All Catalogues"},onFileSelected(e){var r;const s=[...((r=e.target)==null?void 0:r.files)||[]];for(const h of s)this.value=h.text()}},computed:{types(){return Array.isArray(this.arg.type)?this.arg.type:[this.arg.type]}}}),$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=";const x={class:"bold p-2px"},G={key:0},z={key:1,class:"gray"},ee={style:{"white-space":"nowrap"}},te=i("img",{class:"mr-1 align-middle",src:$},null,-1),se=i("img",{class:"mr-1 align-middle",src:L},null,-1),le={style:{"white-space":"nowrap"}},re=i("img",{class:"mr-1 align-middle",src:L},null,-1);function oe(e,s,r,h,a,n){const u=j,f=S("EditableDiv");return l(),o("div",null,[i("span",x,m(e.arg.name??e.arg.type),1),e.arg.optional?p("",!0):(l(),o("span",G,"*")),c(),e.arg.description?(l(),o("span",z,m(e.arg.description),1)):p("",!0),(l(!0),o(y,null,_(e.types,(g,d)=>(l(),o("div",null,[g==="catalogue[]"?(l(),A(u,{key:0,modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=t=>e.value=t),options:[{label:"All Catalogues"},...e.system.getAllCatalogueFiles()],valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",ee,[t.label?(l(),o(y,{key:0},[te,c(m(t.label),1)],64)):(l(),o(y,{key:1},[se,c(" "+m(e.catalogueName(t)),1)],64))])]),_:1},8,["modelValue","options","valueField","filterField"])):g==="catalogue"?(l(),A(u,{key:1,modelValue:e.value,"onUpdate:modelValue":s[1]||(s[1]=t=>e.value=t),options:e.system.getAllCatalogueFiles(),valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",le,[re,c(" "+m(t.name),1)])]),_:1},8,["modelValue","options","valueField","filterField"])):g==="string"?(l(),A(f,{key:2,modelValue:e.value,"onUpdate:modelValue":s[2]||(s[2]=t=>e.value=t),spellcheck:"false",style:{"font-family":"monospace"}},null,8,["modelValue"])):g==="boolean"||g==="toggle"?(l(),o(y,{key:3},[q(i("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=t=>e.value=t)},null,512),[[R,e.value]]),i("label",null,m(e.arg.name),1)],64)):g==="file"?(l(),o("input",{key:4,type:"file",onInput:s[4]||(s[4]=(...t)=>e.onFileSelected&&e.onFileSelected(...t))},null,32)):p("",!0)]))),256))])}const ne=E(H,[["render",oe]]),ie=V({components:{ScriptArgument:ne,NodePath:J},props:{script:{type:Object,required:!0},system:{type:M,required:!0}},setup(){return{store:F()}},data(){return{result:null,args:[],running:!1}},methods:{debug(...e){console.log(...e)},isEntry(e){return e instanceof Q},isError(e){return e instanceof Error},isEntryWithDesc(e){return Array.isArray(e)&&e.length===2&&this.isEntry(e[0])},isEntryList(e){return e.find(s=>!this.isEntry(s)&&!this.isEntryWithDesc(s))?!1:e.length>0},async run(){this.result=null,this.running=!0,await new Promise(e=>setTimeout(e,1));try{const e=this.$refs.args?await Promise.all(this.$refs.args.map(s=>s.getArgument())):[];this.store.scripts.add_script_hooks(this.script),typeof this.script.run=="function"?this.result=await this.script.run(...e):this.script.hooks?this.result=`Added hooks: ${Object.keys(this.script.hooks)}`:this.result=null,console.log(this.script.name,this.result)}catch(e){console.error(e),console.log(typeof e,e instanceof Error),this.result=e}finally{globalThis.$result=this.result,this.running=!1}},path(e){return N(e)},other_path(e){return N(e)}},computed:{outputArray(){return(Array.isArray(this.result)&&!this.isEntryList(this.result)?this.result:[this.result]).filter(e=>!(Array.isArray(e)&&e.length===0||e===null||e===void 0))}}});const ae={key:0},ue={class:"gray"},de=["disabled"],ce={key:0,class:"gray"},he=i("img",{class:"icon",src:W},null,-1),pe=i("div",{class:"bold"},"Output:",-1),ge={class:"output-element"},me=["innerHTML"],ye={class:"node"},fe={key:3,class:"error"},Ae={key:4},be={key:0},ve=i("span",{class:"gray"},"None",-1),_e=[ve];function we(e,s,r,h,a,n){const u=S("ScriptArgument"),f=S("NodePath"),g=D;return l(),A(g,{class:"script mx-4px"},{title:b(()=>[c(m(e.script.name),1)]),content:b(()=>[e.script.description?(l(),o("span",ae,"Description:")):p("",!0),i("span",ue,m(e.script.description),1),(l(!0),o(y,null,_(e.script.arguments||[],(d,t)=>(l(),o("div",null,[k(u,{arg:d,args:e.args,system:e.system,index:t,ref_for:!0,ref:"args"},null,8,["arg","args","system","index"])]))),256)),i("div",null,[i("button",{class:"bouton my-10px",onClick:s[0]||(s[0]=(...d)=>e.run&&e.run(...d)),disabled:e.running},[e.running?(l(),o("span",ce,"...")):(l(),o(y,{key:1},[he,c(" Run Script ")],64))],8,de)]),e.result?(l(),o(y,{key:1},[pe,(l(!0),o(y,null,_(e.outputArray,d=>(l(),o("div",ge,[["string","number"].includes(typeof d)?(l(),o("span",{key:0,class:"output-html",innerHTML:d},null,8,me)):Array.isArray(d)&&e.isEntryList(d)?(l(!0),o(y,{key:1},_(d,t=>(l(),o("div",ye,[Array.isArray(t)?(l(),A(f,{key:0,path:e.path(t[0]),onClick:C=>e.store.goto(t[0]),class:"hover-darken cursor-pointer p-1px",text:t[1],onMouseup:v(C=>e.debug(t[0].editorTypeName,t[0]),["middle"])},null,8,["path","onClick","text","onMouseup"])):(l(),A(f,{key:1,path:e.path(t),onClick:C=>e.store.goto(t),class:"hover-darken cursor-pointer p-1px",onMouseup:v(C=>e.debug(t.editorTypeName,t),["middle"])},null,8,["path","onClick","onMouseup"]))]))),256)):e.isEntry(d)?(l(),A(f,{key:2,path:e.path(d),onClick:t=>e.store.goto(d),class:"hover-darken cursor-pointer p-1px",onMouseup:v(t=>e.debug(d.editorTypeName,d),["middle"])},null,8,["path","onClick","onMouseup"])):e.isError(d)?(l(),o("div",fe,m(d),1)):(l(),o("pre",Ae,"              "+m(JSON.stringify(d,null,2))+`
            `,1))]))),256)),e.outputArray.length==0?(l(),o("div",be,_e)):p("",!0)],64)):p("",!0)]),_:1})}const ke=E(ie,[["render",we]]),Se=V({components:{RunScript:ke},setup(){return{store:F()}},data(){return{system:null,scripts:[...F().scripts.get_default_scripts()]}},async mounted(){this.system=null,this.system=await this.store.get_or_load_system(this.$route.params.id),this.scripts.push(...await this.store.scripts.get_scripts(this.system))},methods:{}}),Ee={class:"h-full overflow-y-auto"},Ce=i("div",{class:"info"},[i("pre",{style:{margin:"10px"}},[c("Note: this feature is not finished To add a new script: Create a folder named `scripts` in your data folder and\nadd a .js file with content like this:\n"),i("code",null,`
export default {
  name: "Display Selected",
  description: "Returns the currently selected node(s)",
  arguments: [
    {
      name: "catalogues",
      type: "catalogue[]"
    },
    {
      name: "query",
      type: "string"
      optional: true,
    },
  ],
  run(catalogues, query) {
    return [\`<span style="font-weight: bold">Selected nodes:</span>\`,$store.get_selections()]
  }
}
`),c(`
`),i("span",{class:"bold"},"Output:"),c(`
return one of or an array of: number | error | string | node[] | [node, string][]
Will render html

`),i("span",{class:"bold"},"Running scripts:"),c(`
Currently only supports running scripts manually, but may support running hooks in the future such as on paste, on change, on load, etc
You may interact with the editor using the store (global variable \`$store\`, also available in the console)
Available actions are in `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"},"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"),c(`
Example scripts (in typescript but only js is supported for non-default scripts): `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"},"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"),c(`
If you want to use imports you have to bundle them into one js file with rollup/webpack
If you want to read/write local files you can use the functions in the global \`$node\`
          `)])],-1);function Be(e,s,r,h,a,n){const u=S("RunScript"),f=D;return l(),o("div",Ee,[e.system?(l(!0),o(y,{key:0},_(e.scripts,g=>(l(),o("div",null,[k(u,{script:g,system:e.system},null,8,["script","system"])]))),256)):p("",!0),k(f,null,{title:b(()=>[c("Info")]),content:b(()=>[Ce]),_:1})])}const Me=E(Se,[["render",Be]]);export{Me as default};
//# sourceMappingURL=_id_.8e8fb3a0.js.map
