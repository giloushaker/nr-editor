import{a as S,_ as w}from"./CreateSystem.0b8e1d4a.js";import{aK as C,a as b,o as l,b as d,F as u,s as g,e as I,aj as x,J as B,z as E,aC as p,aE as _,aL as y,aM as h,x as D,i,t as f,h as m,D as L,c as A,E as N,H as P,I as R}from"./entry.9c262331.js";import{_ as F}from"./Loading.85c1bf39.js";const T={emits:["selected"],data(){return{uploading:!1}},computed:{electron(){return!!globalThis.electron}},methods:{async popFileInput(){var e;if(!globalThis.electron)throw new Error("SelectFile is for use in electron app only");try{this.uploading=!0;const t=await C({properties:["openDirectory"]});(e=t==null?void 0:t.filePaths)!=null&&e.length&&this.$emit("selected",t.filePaths)}catch(t){console.error(t)}finally{this.uploading=!1}}}};const U=["disabled"],j={key:1};function V(e,t,o,n,s,a){return a.electron?(l(),d("button",{key:0,onClick:t[0]||(t[0]=(...r)=>a.popFileInput&&a.popFileInput(...r)),class:"bouton",disabled:s.uploading},[s.uploading?(l(),d(u,{key:1},[g(" ... ")],64)):(l(),d(u,{key:0},[g("Set Working Folder")],64))],8,U)):(l(),d("span",j,"<SelectFolder> is only available in electron app"))}const z=b(T,[["render",V],["__scopeId","data-v-e706e417"]]),W=I({components:{CreateSystem:S,Loading:F},head(){return{title:"NR-Editor"}},data(){return{loading:!0,systems:[],progress:0,progress_max:0,progress_msg:"",error_msg:""}},setup(){return{cataloguesStore:x(),store:B(),settings:E()}},methods:{async selectedFolder(e){this.settings.systemsFolder=Array.isArray(e)?e[0]:e,this.update()},async selected(e){if(electron){this.loading=!0,this.progress_msg="";const t=await this.store.load_systems_from_folder(e.path,async(o,n,s)=>(this.progress=o,this.progress_max=n,this.progress_msg=s?s.replaceAll("\\","/").split("/").slice(-1)[0]:"",new Promise(r=>setTimeout(r,1))));this.loading=!1,t!=null&&t.length&&this.$router.push(`/?id=${t.join(",")}`)}},async uploaded(e){console.log("Uploaded",e.length,"files",e);const t=e.filter(s=>s.gameSystem),o=[];for(const s of t){const a=s.gameSystem.id;o.push(a);const r=p(s);this.store.get_system(a).setSystem(s),electron||_.systems.put({content:s,id:r}),this.cataloguesStore.updateCatalogue(s.gameSystem),this.cataloguesStore.setEdited(r,!1)}const n=e.filter(s=>s.catalogue);for(const s of n){const a=s.catalogue.gameSystemId;this.store.get_system(a).setCatalogue(s),electron||_.catalogues.put({content:s,id:p(s)}),this.cataloguesStore.updateCatalogue(s.catalogue),this.cataloguesStore.setEdited(p(s),!1)}for(const s of t){const a=this.store.get_system(s.gameSystem.id);this.store.load_system(a)}this.$router.push(`/?id=${o.join(",")}`)},onBeforeRouteUpdate(){console.log("update"),this.update()},onBeforeRouteEnter(){console.log("update")},async update(e){try{const t=[];if(electron)if(this.settings.systemsFolder){const o=await y(this.settings.systemsFolder);o&&t.push(...o)}else{const o=await h("home"),n=await y(`${o}/BattleScribe/data`);n&&t.push(...n)}this.systems=D(t,o=>o.name),this.systems.forEach(o=>{var n,s;o.highlight=o.name===((s=(n=e==null?void 0:e.gameSystem)==null?void 0:n.gameSystem)==null?void 0:s.name)})}finally{this.loading=!1}}},async mounted(){if(!this.settings.systemsFolder){const e=await h("home");this.settings.systemsFolder=`${e}/BattleScribe/data`}await this.update()}});const H=e=>(P("data-v-5fbd0b5f"),e=e(),R(),e),J={key:0,class:"scrollable"},K={class:"mt-10px p-10px"},M={class:"workdir"},O={class:"boutons"},Y=H(()=>i("p",null,"You can open a system by clicking any of the systems in your working folder, listed below, or click Load System to load a system outside this folder.",-1)),q={class:"p-10px"},G=["onClick"];function Q(e,t,o,n,s,a){const r=w,k=z,v=S,$=F;return e.loading?(l(),A($,{key:1,progress_msg:e.progress_msg,progress_max:e.progress_max,progress:e.progress},null,8,["progress_msg","progress_max","progress"])):(l(),d("div",J,[i("div",K,[i("div",null,[g("Working Folder: "),i("span",M,f(e.settings.systemsFolder),1)]),i("div",O,[m(r,{onUploaded:e.uploaded},null,8,["onUploaded"]),m(k,{onSelected:e.selectedFolder},null,8,["onSelected"]),m(v,{onCreated:e.update},null,8,["onCreated"]),i("button",{class:"bouton",onClick:t[0]||(t[0]=c=>e.update())}," Refresh ")]),Y]),i("div",q,[(l(!0),d(u,null,L(e.systems,c=>(l(),d("div",{class:N(["item p-2px mt-2px cursor-pointer",{highlight:c.highlight}]),onClick:X=>e.selected(c)},f(c.name),11,G))),256))])]))}const te=b(W,[["render",Q],["__scopeId","data-v-5fbd0b5f"]]);export{te as default};
//# sourceMappingURL=system.d331e10b.js.map
