import{a as w,o as s,b as o,E as $,B as v,l as h,p as V,w as M,P as q,e as F,aI as T,Y as C,r as k,i,t as g,s as c,F as y,D as _,c as A,q as b,m as Q,J as B,aJ as R,a1 as N,h as E}from"./entry.4f9e5793.js";import{E as O,a as D,_ as J}from"./catalogue.ea05e6b2.js";import{N as j}from"./NodePath.cccd0ab0.js";import{_ as W}from"./right2.91afc9dd.js";const Y={props:{collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},noboxindent:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},vertical:{type:Boolean,default:!1},titleCollapse:{type:Boolean,default:!0},id:{type:String,required:!1}},mounted(){this.id&&this.$route.hash&&this.$route.hash.substring(1)===this.id&&this.collapsed&&this.$nextTick(()=>{var e;this.collapseSwitch(),(e=this.$el)==null||e.scrollIntoView({block:"center"})})},data(){return{collapsed:!0,initiated:!1}},created(){(!this.collapsible||this.defcollapsed==!1)&&this.collapseSwitch()},computed:{dropdownSrc(){var p,n,u;let e=2;(u=(n=(p=this.$optionStore)==null?void 0:p.options)==null?void 0:n.appearence)!=null&&u.dropdownStyle&&(e=this.$optionStore.options.appearence.dropdownStyle);let l=[`/assets/icons/right${e}.png`,`/assets/icons/down${e}.png`],r=this.collapsed?0:1;return this.vertical&&(r=1-r),l[r]}},methods:{collapseSwitch(){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?(this.$emit("open"),this.$emit("change")):(this.$emit("close"),this.$emit("change"))},titleSwitch(){this.titleCollapse?this.collapseSwitch():this.$emit("titleClick")}},watch:{collapsible(){this.initiated=!0}}};const P=["id"],U=["src"],L={key:1,class:"boxContent"};function X(e,l,r,p,n,u){return s(),o("div",{class:$([{box:!r.nobox&&!r.noboxindent,nobox:r.nobox,nocollapse:!r.collapsible,noboxindent:r.noboxindent,verticalbox:n.collapsed&&r.vertical},"collapsibleBox"]),id:r.id},[r.notitle?h("",!0):(s(),o("h3",{key:0,class:$([{arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&n.collapsed,titleClickCollapsible:r.collapsible&&!n.collapsed&&r.titleCollapse,titleClickEffect:n.collapsed||r.collapsible},r.title]),onClick:l[1]||(l[1]=(...d)=>u.titleSwitch&&u.titleSwitch(...d))},[r.collapsible?(s(),o("img",{key:0,src:u.dropdownSrc,class:"icon arrow",onClick:l[0]||(l[0]=v((...d)=>u.collapseSwitch&&u.collapseSwitch(...d),["stop"]))},null,8,U)):h("",!0),V(e.$slots,"title",{class:"title"},void 0,!0)],2)),n.initiated?M((s(),o("div",L,[V(e.$slots,"content",{},void 0,!0)],512)),[[q,!n.collapsed||!r.collapsible]]):h("",!0)],10,P)}const I=w(Y,[["render",X],["__scopeId","data-v-48fef676"]]),x=F({components:{EditableDiv:O},props:{arg:{type:Object,required:!0},args:{type:Array,required:!0},system:{type:T,required:!0},index:{type:Number,required:!0}},data(){return{value:this.getDefaultValue(Array.isArray(this.arg.type)?this.arg.type[0]:this.arg.type)}},methods:{catalogueName(e){return C(e).name},async getArgument(){const e=this.types[0],l=this.value;switch(e){case"catalogue[]":if(l==="All Catalogues"){await this.system.loadAll();const n=this.system.getAllLoadedCatalogues();return n.map(u=>u.processForEditor()),n}else{const n=this.system.getAllCatalogueFiles().map(d=>C(d)).find(d=>d.name===l),u=await this.system.loadCatalogue({targetId:n.id});return u.processForEditor(),u.imports.map(d=>d.processForEditor()),[u]}case"catalogue":const r=this.system.getAllCatalogueFiles().map(n=>C(n)).find(n=>n.name===l),p=await this.system.loadCatalogue({targetId:r.id});return p.processForEditor(),p.imports.map(n=>n.processForEditor()),p;default:return l}},async updateArgument(){const e=await this.getArgument();return this.args[this.index]=e,e},getDefaultValue(e){if(this.arg.default!==void 0)return this.arg.default;if(e==="catalogue[]")return"All Catalogues"}},computed:{types(){return Array.isArray(this.arg.type)?this.arg.type:[this.arg.type]}}}),Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=";const K={class:"bold p-2px"},H={key:0},G={key:1,class:"gray"},z={style:{"white-space":"nowrap"}},ee=i("img",{class:"mr-1 align-middle",src:Z},null,-1),te=i("img",{class:"mr-1 align-middle",src:D},null,-1),se={style:{"white-space":"nowrap"}},le=i("img",{class:"mr-1 align-middle",src:D},null,-1);function oe(e,l,r,p,n,u){const d=J,f=k("EditableDiv");return s(),o("div",null,[i("span",K,g(e.arg.name??e.arg.type),1),e.arg.optional?h("",!0):(s(),o("span",H,"*")),c(),e.arg.description?(s(),o("span",G,g(e.arg.description),1)):h("",!0),(s(!0),o(y,null,_(e.types,(m,a)=>(s(),o("div",null,[m==="catalogue[]"?(s(),A(d,{key:0,modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value=t),options:[{label:"All Catalogues"},...e.system.getAllCatalogueFiles()],valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",z,[t.label?(s(),o(y,{key:0},[ee,c(g(t.label),1)],64)):(s(),o(y,{key:1},[te,c(" "+g(e.catalogueName(t)),1)],64))])]),_:1},8,["modelValue","options","valueField","filterField"])):m==="catalogue"?(s(),A(d,{key:1,modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value=t),options:e.system.getAllCatalogueFiles(),valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[i("div",se,[le,c(" "+g(t.name),1)])]),_:1},8,["modelValue","options","valueField","filterField"])):m==="string"?(s(),A(f,{key:2,modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value=t),spellcheck:"false",style:{"font-family":"monospace"}},null,8,["modelValue"])):m==="boolean"||m==="toggle"?M((s(),o("input",{key:3,type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=t=>e.value=t)},null,512)),[[Q,e.value]]):h("",!0)]))),256))])}const re=w(x,[["render",oe]]),ne=F({components:{ScriptArgument:re,NodePath:j},props:{script:{type:Object,required:!0},system:{type:T,required:!0}},setup(){return{store:B()}},data(){return{result:null,args:[],running:!1}},methods:{debug(...e){console.log(...e)},isEntry(e){return e instanceof R},isError(e){return e instanceof Error},isEntryWithDesc(e){return Array.isArray(e)&&e.length===2&&this.isEntry(e[0])},isEntryList(e){return e.find(l=>!this.isEntry(l)&&!this.isEntryWithDesc(l))?!1:e.length>0},async run(){this.result=null,this.running=!0,await new Promise(e=>setTimeout(e,1));try{const e=this.$refs.args?await Promise.all(this.$refs.args.map(l=>l.getArgument())):[];this.store.scripts.add_script_hooks(this.script),typeof this.script.run=="function"?this.result=await this.script.run(...e):this.script.hooks?this.result=`Added hooks: ${Object.keys(this.script.hooks)}`:this.result=null,console.log(this.script.name,this.result)}catch(e){console.error(e),console.log(typeof e,e instanceof Error),this.result=e}finally{globalThis.$result=this.result,this.running=!1}},path(e){return N(e)},other_path(e){return N(e)}},computed:{outputArray(){return(Array.isArray(this.result)&&!this.isEntryList(this.result)?this.result:[this.result]).filter(e=>!(Array.isArray(e)&&e.length===0||e===null||e===void 0))}}});const ie={key:0},ae={class:"gray"},ue=["disabled"],de={key:0,class:"gray"},ce=i("img",{src:W},null,-1),pe=i("div",{class:"bold"},"Output:",-1),he={class:"output-element"},me=["innerHTML"],ge={class:"node"},ye={key:3,class:"error"},fe={key:4},Ae={key:0},be=i("span",{class:"gray"},"None",-1),_e=[be];function ve(e,l,r,p,n,u){const d=k("ScriptArgument"),f=k("NodePath"),m=I;return s(),A(m,{class:"script mx-4px"},{title:b(()=>[c(g(e.script.name),1)]),content:b(()=>[e.script.description?(s(),o("span",ie,"Description:")):h("",!0),i("span",ae,g(e.script.description),1),(s(!0),o(y,null,_(e.script.arguments||[],(a,t)=>(s(),o("div",null,[E(d,{arg:a,args:e.args,system:e.system,index:t,ref_for:!0,ref:"args"},null,8,["arg","args","system","index"])]))),256)),i("div",null,[i("button",{class:"bouton my-10px",onClick:l[0]||(l[0]=(...a)=>e.run&&e.run(...a)),disabled:e.running},[e.running?(s(),o("span",de,"...")):(s(),o(y,{key:1},[ce,c(" Run Script ")],64))],8,ue)]),e.result?(s(),o(y,{key:1},[pe,(s(!0),o(y,null,_(e.outputArray,a=>(s(),o("div",he,[["string","number"].includes(typeof a)?(s(),o("span",{key:0,class:"output-html",innerHTML:a},null,8,me)):Array.isArray(a)&&e.isEntryList(a)?(s(!0),o(y,{key:1},_(a,t=>(s(),o("div",ge,[Array.isArray(t)?(s(),A(f,{key:0,path:e.path(t[0]),onClick:S=>e.store.goto(t[0]),class:"hover-darken cursor-pointer p-1px",text:t[1],onMouseup:v(S=>e.debug(t[0].editorTypeName,t[0]),["middle"])},null,8,["path","onClick","text","onMouseup"])):(s(),A(f,{key:1,path:e.path(t),onClick:S=>e.store.goto(t),class:"hover-darken cursor-pointer p-1px",onMouseup:v(S=>e.debug(t.editorTypeName,t),["middle"])},null,8,["path","onClick","onMouseup"]))]))),256)):e.isEntry(a)?(s(),A(f,{key:2,path:e.path(a),onClick:t=>e.store.goto(a),class:"hover-darken cursor-pointer p-1px",onMouseup:v(t=>e.debug(a.editorTypeName,a),["middle"])},null,8,["path","onClick","onMouseup"])):e.isError(a)?(s(),o("div",ye,g(a),1)):(s(),o("pre",fe,"              "+g(JSON.stringify(a,null,2))+`
            `,1))]))),256)),e.outputArray.length==0?(s(),o("div",Ae,_e)):h("",!0)],64)):h("",!0)]),_:1})}const ke=w(ne,[["render",ve]]),we=F({components:{RunScript:ke},setup(){return{store:B()}},data(){return{system:null,scripts:[...B().scripts.get_default_scripts()]}},async mounted(){this.system=null,this.system=await this.store.get_or_load_system(this.$route.params.id),this.scripts.push(...await this.store.scripts.get_scripts(this.system))},methods:{}}),Se={class:"h-full overflow-y-auto"},Ce=i("div",{class:"info"},[i("pre",{style:{margin:"10px"}},[c("Note: this feature is not finished To add a new script: Create a folder named `scripts` in your data folder and\nadd a .js file with content like this:\n"),i("code",null,`
export default {
  name: "Display Selected",
  description: "Returns the currently selected node(s)",
  arguments: [
    {
      name: "catalogues",
      type: "catalogue[]"
    },
    {
      name: "query",
      type: "string"
      optional: true,
    },
  ],
  run(catalogues, query) {
    return [\`<span style="font-weight: bold">Selected nodes:</span>\`,$store.get_selections()]
  }
}
`),c(`
`),i("span",{class:"bold"},"Output:"),c(`
return one of or an array of: number | error | string | node[] | [node, string][]
Will render html

`),i("span",{class:"bold"},"Running scripts:"),c(`
Currently only supports running scripts manually, but may support running hooks in the future such as on paste, on change, on load, etc
You may interact with the editor using the store (global variable \`$store\`, also available in the console)
Available actions are in `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"},"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"),c(`
Example scripts (in typescript but only js is supported for non-default scripts): `),i("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"},"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"),c(`
If you want to use imports you have to bundle them into one js file with rollup/webpack
If you want to read/write local files you can use the functions in the global \`$node\`
          `)])],-1);function Be(e,l,r,p,n,u){const d=k("RunScript"),f=I;return s(),o("div",Se,[e.system?(s(!0),o(y,{key:0},_(e.scripts,m=>(s(),o("div",null,[E(d,{script:m,system:e.system},null,8,["script","system"])]))),256)):h("",!0),E(f,null,{title:b(()=>[c("Info")]),content:b(()=>[Ce]),_:1})])}const Ne=w(we,[["render",Be]]);export{Ne as default};
//# sourceMappingURL=_id_.cdb97249.js.map
