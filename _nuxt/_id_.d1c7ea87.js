import{a as w,o as s,b as o,E as $,B as v,l as h,m as V,w as I,P as q,e as E,aG as T,Y as C,r as k,i as n,t as g,s as c,F as m,D as _,c as A,q as b,J as B,aH as Q,$ as N,h as F}from"./entry.b76efa16.js";import{E as R,a as D,_ as O}from"./catalogue.53e43d9c.js";import{N as j}from"./NodePath.05950838.js";import{_ as J}from"./right2.91afc9dd.js";const W={props:{collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},noboxindent:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},vertical:{type:Boolean,default:!1},titleCollapse:{type:Boolean,default:!0},id:{type:String,required:!1}},mounted(){this.id&&this.$route.hash&&this.$route.hash.substring(1)===this.id&&this.collapsed&&this.$nextTick(()=>{var e;this.collapseSwitch(),(e=this.$el)==null||e.scrollIntoView({block:"center"})})},data(){return{collapsed:!0,initiated:!1}},created(){(!this.collapsible||this.defcollapsed==!1)&&this.collapseSwitch()},computed:{dropdownSrc(){var p,i,a;let e=2;(a=(i=(p=this.$optionStore)==null?void 0:p.options)==null?void 0:i.appearence)!=null&&a.dropdownStyle&&(e=this.$optionStore.options.appearence.dropdownStyle);let l=[`/assets/icons/right${e}.png`,`/assets/icons/down${e}.png`],r=this.collapsed?0:1;return this.vertical&&(r=1-r),l[r]}},methods:{collapseSwitch(){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?(this.$emit("open"),this.$emit("change")):(this.$emit("close"),this.$emit("change"))},titleSwitch(){this.titleCollapse?this.collapseSwitch():this.$emit("titleClick")}},watch:{collapsible(){this.initiated=!0}}};const Y=["id"],P=["src"],U={key:1,class:"boxContent"};function x(e,l,r,p,i,a){return s(),o("div",{class:$([{box:!r.nobox&&!r.noboxindent,nobox:r.nobox,nocollapse:!r.collapsible,noboxindent:r.noboxindent,verticalbox:i.collapsed&&r.vertical},"collapsibleBox"]),id:r.id},[r.notitle?h("",!0):(s(),o("h3",{key:0,class:$([{arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&i.collapsed,titleClickCollapsible:r.collapsible&&!i.collapsed&&r.titleCollapse,titleClickEffect:i.collapsed||r.collapsible},r.title]),onClick:l[1]||(l[1]=(...u)=>a.titleSwitch&&a.titleSwitch(...u))},[r.collapsible?(s(),o("img",{key:0,src:a.dropdownSrc,class:"icon arrow",onClick:l[0]||(l[0]=v((...u)=>a.collapseSwitch&&a.collapseSwitch(...u),["stop"]))},null,8,P)):h("",!0),V(e.$slots,"title",{class:"title"},void 0,!0)],2)),i.initiated?I((s(),o("div",U,[V(e.$slots,"content",{},void 0,!0)],512)),[[q,!i.collapsed||!r.collapsible]]):h("",!0)],10,Y)}const M=w(W,[["render",x],["__scopeId","data-v-c248249e"]]),L=E({components:{EditableDiv:R},props:{arg:{type:Object,required:!0},args:{type:Array,required:!0},system:{type:T,required:!0},index:{type:Number,required:!0}},data(){return{value:this.getDefaultValue(Array.isArray(this.arg.type)?this.arg.type[0]:this.arg.type)}},methods:{catalogueName(e){return C(e).name},async getArgument(){const e=this.types[0],l=this.value;switch(e){case"catalogue[]":if(l==="All Catalogues"){await this.system.loadAll();const i=this.system.getAllLoadedCatalogues();return i.map(a=>a.processForEditor()),i}else{const i=this.system.getAllCatalogueFiles().map(u=>C(u)).find(u=>u.name===l),a=await this.system.loadCatalogue({targetId:i.id});return a.processForEditor(),a.imports.map(u=>u.processForEditor()),[a]}case"catalogue":const r=this.system.getAllCatalogueFiles().map(i=>C(i)).find(i=>i.name===l),p=await this.system.loadCatalogue({targetId:r.id});return p.processForEditor(),p.imports.map(i=>i.processForEditor()),p;default:return l}},async updateArgument(){const e=await this.getArgument();return this.args[this.index]=e,e},getDefaultValue(e){if(this.arg.default!==void 0)return this.arg.default;if(e==="catalogue[]")return"All Catalogues"}},computed:{types(){return Array.isArray(this.arg.type)?this.arg.type:[this.arg.type]}}}),X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=";const Z={class:"bold p-2px"},K={key:0},H={key:1,class:"gray"},G={style:{"white-space":"nowrap"}},z=n("img",{class:"mr-1 align-middle",src:X},null,-1),ee=n("img",{class:"mr-1 align-middle",src:D},null,-1),te={style:{"white-space":"nowrap"}},se=n("img",{class:"mr-1 align-middle",src:D},null,-1);function le(e,l,r,p,i,a){const u=O,y=k("EditableDiv");return s(),o("div",null,[n("span",Z,g(e.arg.name??e.arg.type),1),e.arg.optional?h("",!0):(s(),o("span",K,"*")),c(),e.arg.description?(s(),o("span",H,g(e.arg.description),1)):h("",!0),(s(!0),o(m,null,_(e.types,(f,d)=>(s(),o("div",null,[f==="catalogue[]"?(s(),A(u,{key:0,modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value=t),options:[{label:"All Catalogues"},...e.system.getAllCatalogueFiles()],valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[n("div",G,[t.label?(s(),o(m,{key:0},[z,c(g(t.label),1)],64)):(s(),o(m,{key:1},[ee,c(" "+g(e.catalogueName(t)),1)],64))])]),_:1},8,["modelValue","options","valueField","filterField"])):f==="catalogue"?(s(),A(u,{key:1,modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value=t),options:e.system.getAllCatalogueFiles(),valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[n("div",te,[se,c(" "+g(t.name),1)])]),_:1},8,["modelValue","options","valueField","filterField"])):f==="string"?(s(),A(y,{key:2,modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value=t),spellcheck:"false",style:{"font-family":"monospace"}},null,8,["modelValue"])):h("",!0)]))),256))])}const oe=w(L,[["render",le]]),re=E({components:{ScriptArgument:oe,NodePath:j},props:{script:{type:Object,required:!0},system:{type:T,required:!0}},setup(){return{store:B()}},data(){return{result:null,args:[],running:!1}},methods:{debug(...e){console.log(...e)},isEntry(e){return e instanceof Q},isEntryWithDesc(e){return Array.isArray(e)&&e.length===2&&this.isEntry(e[0])},isEntryList(e){return e.find(l=>!this.isEntry(l)&&!this.isEntryWithDesc(l))?!1:e.length>0},async run(){this.result=null,this.running=!0,await new Promise(e=>setTimeout(e,1));try{const e=this.$refs.args?await Promise.all(this.$refs.args.map(l=>l.getArgument())):[];this.store.scripts.add_script_hooks(this.script),typeof this.script.run=="function"?this.result=await this.script.run(...e):this.script.hooks?this.result=`Added hooks: ${Object.keys(this.script.hooks)}`:this.result=null,console.log(this.script.name,this.result)}catch(e){console.error(e),this.result=e}finally{globalThis.$result=this.result,this.running=!1}},path(e){return N(e)},other_path(e){return N(e)}},computed:{outputArray(){return(Array.isArray(this.result)&&!this.isEntryList(this.result)?this.result:[this.result]).filter(e=>!(Array.isArray(e)&&e.length===0||e===null||e===void 0))}}});const ie={key:0},ne={class:"gray"},ae=["disabled"],ue={key:0,class:"gray"},de=n("img",{src:J},null,-1),ce=n("div",{class:"bold"},"Output:",-1),pe={class:"output-element"},he=["innerHTML"],me={class:"node"},ge={key:3},ye={key:0},fe=n("span",{class:"gray"},"None",-1),Ae=[fe];function be(e,l,r,p,i,a){const u=k("ScriptArgument"),y=k("NodePath"),f=M;return s(),A(f,{class:"script mx-4px"},{title:b(()=>[c(g(e.script.name),1)]),content:b(()=>[e.script.description?(s(),o("span",ie,"Description:")):h("",!0),n("span",ne,g(e.script.description),1),(s(!0),o(m,null,_(e.script.arguments||[],(d,t)=>(s(),o("div",null,[F(u,{arg:d,args:e.args,system:e.system,index:t,ref_for:!0,ref:"args"},null,8,["arg","args","system","index"])]))),256)),n("div",null,[n("button",{class:"bouton my-10px",onClick:l[0]||(l[0]=(...d)=>e.run&&e.run(...d)),disabled:e.running},[e.running?(s(),o("span",ue,"...")):(s(),o(m,{key:1},[de,c(" Run Script ")],64))],8,ae)]),e.result?(s(),o(m,{key:1},[ce,(s(!0),o(m,null,_(e.outputArray,d=>(s(),o("div",pe,[["string","number"].includes(typeof d)?(s(),o("span",{key:0,class:"output-html",innerHTML:d},null,8,he)):Array.isArray(d)&&e.isEntryList(d)?(s(!0),o(m,{key:1},_(d,t=>(s(),o("div",me,[Array.isArray(t)?(s(),A(y,{key:0,path:e.path(t[0]),onClick:S=>e.store.goto(t[0]),class:"hover-darken cursor-pointer p-1px",text:t[1],onMouseup:v(S=>e.debug(t[0].editorTypeName,t[0]),["middle"])},null,8,["path","onClick","text","onMouseup"])):(s(),A(y,{key:1,path:e.path(t),onClick:S=>e.store.goto(t),class:"hover-darken cursor-pointer p-1px",onMouseup:v(S=>e.debug(t.editorTypeName,t),["middle"])},null,8,["path","onClick","onMouseup"]))]))),256)):e.isEntry(d)?(s(),A(y,{key:2,path:e.path(d),onClick:t=>e.store.goto(d),class:"hover-darken cursor-pointer p-1px",onMouseup:v(t=>e.debug(d.editorTypeName,d),["middle"])},null,8,["path","onClick","onMouseup"])):(s(),o("pre",ge,"              "+g(JSON.stringify(d,null,2))+`
            `,1))]))),256)),e.outputArray.length==0?(s(),o("div",ye,Ae)):h("",!0)],64)):h("",!0)]),_:1})}const _e=w(re,[["render",be]]),ve=E({components:{RunScript:_e},setup(){return{store:B()}},data(){return{system:null,scripts:[...B().scripts.get_default_scripts()]}},async mounted(){this.system=null,this.system=await this.store.get_or_load_system(this.$route.params.id),this.scripts.push(...await this.store.scripts.get_scripts(this.system))},methods:{}}),ke={class:"h-full overflow-y-auto"},we=n("div",{class:"info"},[n("pre",{style:{margin:"10px"}},[c("Note: this feature is not finished To add a new script: Create a folder named `scripts` in your data folder and\nadd a .js file with content like this:\n"),n("code",null,`
export default {
  name: "Display Selected",
  description: "Returns the currently selected node(s)",
  arguments: [
    {
      name: "catalogues",
      type: "catalogue[]"
    },
    {
      name: "query",
      type: "string"
      optional: true,
    },
  ],
  run(catalogues, query) {
    return [\`<span style="font-weight: bold">Selected nodes:</span>\`,$store.get_selections()]
  }
}
`),c(`
`),n("span",{class:"bold"},"Output:"),c(`
return one of or an array of: number | error | string | node[] | [node, string][]
Will render html

`),n("span",{class:"bold"},"Running scripts:"),c(`
Currently only supports running scripts manually, but may support running hooks in the future such as on paste, on change, on load, etc
You may interact with the editor using the store (global variable \`$store\`, also available in the console)
Available actions are in `),n("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"},"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"),c(`
Example scripts (in typescript but only js is supported for non-default scripts): `),n("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"},"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"),c(`
If you want to use imports you have to bundle them into one js file with rollup/webpack
If you want to read/write local files you can use the functions in the global \`$node\`
          `)])],-1);function Se(e,l,r,p,i,a){const u=k("RunScript"),y=M;return s(),o("div",ke,[e.system?(s(!0),o(m,{key:0},_(e.scripts,f=>(s(),o("div",null,[F(u,{script:f,system:e.system},null,8,["script","system"])]))),256)):h("",!0),F(y,null,{title:b(()=>[c("Info")]),content:b(()=>[we]),_:1})])}const $e=w(ve,[["render",Se]]);export{$e as default};
//# sourceMappingURL=_id_.d1c7ea87.js.map
