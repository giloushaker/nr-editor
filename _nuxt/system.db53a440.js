import{a as f,_ as w}from"./CreateSystem.d8b9003d.js";import{A as $,h as C,u as I,v as p,B as g,C as h,s as x}from"./editorStore.2485381d.js";import{a as S,o as l,f as i,F as u,l as _,b as B,B as E,i as d,t as y,h as m,p as D,c as A,z as L,s as N,x as P}from"./entry.fa9670ab.js";import{_ as F}from"./Loading.b755df13.js";const T={emits:["selected"],data(){return{uploading:!1}},computed:{electron(){return!!globalThis.electron}},methods:{async popFileInput(){var e;if(!globalThis.electron)throw new Error("SelectFile is for use in electron app only");try{this.uploading=!0;const t=await $({properties:["openDirectory"]});(e=t==null?void 0:t.filePaths)!=null&&e.length&&this.$emit("selected",t.filePaths)}catch(t){console.error(t)}finally{this.uploading=!1}}}};const U=["disabled"],V={key:1};function W(e,t,o,a,s,n){return n.electron?(l(),i("button",{key:0,onClick:t[0]||(t[0]=(...r)=>n.popFileInput&&n.popFileInput(...r)),class:"bouton",disabled:s.uploading},[s.uploading?(l(),i(u,{key:1},[_(" ... ")],64)):(l(),i(u,{key:0},[_("Set Working Folder")],64))],8,U)):(l(),i("span",V,"<SelectFolder> is only available in electron app"))}const j=S(T,[["render",W],["__scopeId","data-v-e706e417"]]),z=B({components:{CreateSystem:f,Loading:F},head(){return{title:"NR-Editor"}},data(){return{loading:!0,systems:[],progress:0,progress_max:0,progress_msg:"",error_msg:""}},setup(){return{cataloguesStore:C(),store:I(),settings:E()}},methods:{async selectedFolder(e){this.settings.systemsFolder=Array.isArray(e)?e[0]:e,this.update()},async selected(e){if(electron){this.loading=!0,this.progress_msg="";const t=await this.store.load_systems_from_folder(e.path,async(o,a,s)=>(this.progress=o,this.progress_max=a,this.progress_msg=s?s.replaceAll("\\","/").split("/").slice(-1)[0]:"",new Promise(r=>setTimeout(r,1))));this.loading=!1,this.$router.push(`/?id=${t.join(",")}`)}},async uploaded(e){console.log("Uploaded",e.length,"files",e);const t=e.filter(s=>s.gameSystem),o=[];for(const s of t){const n=s.gameSystem.id;o.push(n);const r=p(s);this.store.get_system(n).setSystem(s),electron||db.systems.put({content:s,id:r}),this.cataloguesStore.updateCatalogue(s.gameSystem),this.cataloguesStore.setEdited(r,!1)}const a=e.filter(s=>s.catalogue);for(const s of a){const n=s.catalogue.gameSystemId;this.store.get_system(n).setCatalogue(s),electron||db.catalogues.put({content:s,id:p(s)}),this.cataloguesStore.updateCatalogue(s.catalogue),this.cataloguesStore.setEdited(p(s),!1)}this.$router.push(`/?id=${o.join(",")}`)},async update(e){try{const t=[];if(electron)if(this.settings.systemsFolder){const o=await g(this.settings.systemsFolder);o&&t.push(...o)}else{const o=await h("home"),a=await g(`${o}/BattleScribe/data`);a&&t.push(...a)}else for(let o=0;o<100;o++)t.push({name:"Warhammer 40k",path:"BSData/wh40k"});this.systems=x(t,o=>o.name),this.systems.forEach(o=>{var a,s;o.highlight=o.name===((s=(a=e==null?void 0:e.gameSystem)==null?void 0:a.gameSystem)==null?void 0:s.name)})}finally{this.loading=!1}}},async mounted(){if(!this.settings.systemsFolder){const e=await h("home");this.settings.systemsFolder=`${e}/BattleScribe/data`}await this.update()}});const O=e=>(N("data-v-4f2caada"),e=e(),P(),e),R={key:0,class:"scrollable"},Y={class:"mt-10px p-10px"},q={class:"workdir"},G={class:"boutons"},H=O(()=>d("p",null,"You can open a system by clicking any of the systems in your working folder, listed below, or click Load System to load a system outside this folder.",-1)),J={class:"p-10px"},K=["onClick"];function M(e,t,o,a,s,n){const r=w,k=j,b=f,v=F;return e.loading?(l(),A(v,{key:1,progress_msg:e.progress_msg,progress_max:e.progress_max,progress:e.progress},null,8,["progress_msg","progress_max","progress"])):(l(),i("div",R,[d("div",Y,[d("div",null,[_("Working Folder: "),d("span",q,y(e.settings.systemsFolder),1)]),d("div",G,[m(r,{onUploaded:e.uploaded},null,8,["onUploaded"]),m(k,{onSelected:e.selectedFolder},null,8,["onSelected"]),m(b,{onCreated:e.update},null,8,["onCreated"])]),H]),d("div",J,[(l(!0),i(u,null,D(e.systems,c=>(l(),i("div",{class:L(["item p-2px mt-2px cursor-pointer",{highlight:c.highlight}]),onClick:Q=>e.selected(c)},y(c.name),11,K))),256))])]))}const te=S(z,[["render",M],["__scopeId","data-v-4f2caada"]]);export{te as default};
//# sourceMappingURL=system.db53a440.js.map
