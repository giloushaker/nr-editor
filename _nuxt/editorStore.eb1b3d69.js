var il=Object.defineProperty;var sl=(e,t,r)=>t in e?il(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Z=(e,t,r)=>(sl(e,typeof t!="symbol"?t+"":t,r),r);import{K as Jr,L as ol,M as se,I as Ji,a as Zr,o as tt,f as ot,i as ct,t as Dt,q as ut,F as Jt,p as yr,l as mt,w as mi,N as yi,c as Kt,r as wi,J as al,T as ll,A as He,O as Ce,D as Fo,B as Vn,h as $r,k as pe,s as ul,x as cl,b as fl,P as hl,Q as Ns}from"./entry.4ae4bb99.js";function tn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Po={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,i,s){function o(c,f){if(!i[c]){if(!n[c]){var d=typeof tn=="function"&&tn;if(!f&&d)return d(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=i[c]={exports:{}};n[c][0].call(g.exports,function(b){var y=n[c][1][b];return o(y||b)},g,g.exports,r,n,i,s)}return i[c].exports}for(var a=typeof tn=="function"&&tn,l=0;l<s.length;l++)o(s[l]);return o}({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,f,d,p,g,b,y,_=[],w=0,E=l.length,S=E,I=s.getTypeOf(l)!=="string";w<l.length;)S=E-w,d=I?(c=l[w++],f=w<E?l[w++]:0,w<E?l[w++]:0):(c=l.charCodeAt(w++),f=w<E?l.charCodeAt(w++):0,w<E?l.charCodeAt(w++):0),p=c>>2,g=(3&c)<<4|f>>4,b=1<S?(15&f)<<2|d>>6:64,y=2<S?63&d:64,_.push(a.charAt(p)+a.charAt(g)+a.charAt(b)+a.charAt(y));return _.join("")},i.decode=function(l){var c,f,d,p,g,b,y=0,_=0,w="data:";if(l.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var E,S=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&S--,l.charAt(l.length-2)===a.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=o.uint8array?new Uint8Array(0|S):new Array(0|S);y<l.length;)c=a.indexOf(l.charAt(y++))<<2|(p=a.indexOf(l.charAt(y++)))>>4,f=(15&p)<<4|(g=a.indexOf(l.charAt(y++)))>>2,d=(3&g)<<6|(b=a.indexOf(l.charAt(y++))),E[_++]=c,g!==64&&(E[_++]=f),b!==64&&(E[_++]=d);return E}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),l=r("./stream/DataLengthProbe");function c(f,d,p,g,b){this.compressedSize=f,this.uncompressedSize=d,this.crc32=p,this.compression=g,this.compressedContent=b}c.prototype={getContentWorker:function(){var f=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return f.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,d,p){return f.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var f=0;f<8;f++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();n.exports=function(a,l){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(c,f,d,p){var g=o,b=p+d;c^=-1;for(var y=p;y<b;y++)c=c>>>8^g[255&(c^f[y])];return-1^c}(0|l,a,a.length,0):function(c,f,d,p){var g=o,b=p+d;c^=-1;for(var y=p;y<b;y++)c=c>>>8^g[255&(c^f.charCodeAt(y))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),l=r("./stream/GenericWorker"),c=s?"uint8array":"array";function f(d,p){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=p,this.meta={}}i.magic="\b\0",a.inherits(f,l),f.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(p){d.push({data:p,meta:d.meta})}},i.compressWorker=function(d){return new f("Deflate",d)},i.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(g,b){var y,_="";for(y=0;y<b;y++)_+=String.fromCharCode(255&g),g>>>=8;return _}function o(g,b,y,_,w,E){var S,I,C=g.file,O=g.compression,T=E!==c.utf8encode,G=a.transformTo("string",E(C.name)),L=a.transformTo("string",c.utf8encode(C.name)),j=C.comment,Y=a.transformTo("string",E(j)),N=a.transformTo("string",c.utf8encode(j)),z=L.length!==C.name.length,A=N.length!==j.length,K="",et="",M="",rt=C.dir,D=C.date,q={crc32:0,compressedSize:0,uncompressedSize:0};b&&!y||(q.crc32=g.crc32,q.compressedSize=g.compressedSize,q.uncompressedSize=g.uncompressedSize);var P=0;b&&(P|=8),T||!z&&!A||(P|=2048);var U=0,it=0;rt&&(U|=16),w==="UNIX"?(it=798,U|=function(X,At){var It=X;return X||(It=At?16893:33204),(65535&It)<<16}(C.unixPermissions,rt)):(it=20,U|=function(X){return 63&(X||0)}(C.dosPermissions)),S=D.getUTCHours(),S<<=6,S|=D.getUTCMinutes(),S<<=5,S|=D.getUTCSeconds()/2,I=D.getUTCFullYear()-1980,I<<=4,I|=D.getUTCMonth()+1,I<<=5,I|=D.getUTCDate(),z&&(et=s(1,1)+s(f(G),4)+L,K+="up"+s(et.length,2)+et),A&&(M=s(1,1)+s(f(Y),4)+N,K+="uc"+s(M.length,2)+M);var J="";return J+=`
\0`,J+=s(P,2),J+=O.magic,J+=s(S,2),J+=s(I,2),J+=s(q.crc32,4),J+=s(q.compressedSize,4),J+=s(q.uncompressedSize,4),J+=s(G.length,2),J+=s(K.length,2),{fileRecord:d.LOCAL_FILE_HEADER+J+G+K,dirRecord:d.CENTRAL_FILE_HEADER+s(it,2)+J+s(Y.length,2)+"\0\0\0\0"+s(U,4)+s(_,4)+G+K+Y}}var a=r("../utils"),l=r("../stream/GenericWorker"),c=r("../utf8"),f=r("../crc32"),d=r("../signature");function p(g,b,y,_){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=y,this.encodeFileName=_,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(g){var b=g.meta.percent||0,y=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,l.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:y?(b+100*(y-_-1))/y:100}}))},p.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var b=this.streamFiles&&!g.file.dir;if(b){var y=o(g,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:y.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(g){this.accumulate=!1;var b=this.streamFiles&&!g.file.dir,y=o(g,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(y.dirRecord),b)this.push({data:function(_){return d.DATA_DESCRIPTOR+s(_.crc32,4)+s(_.compressedSize,4)+s(_.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:y.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var g=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var y=this.bytesWritten-g,_=function(w,E,S,I,C){var O=a.transformTo("string",C(I));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(E,4)+s(S,4)+s(O.length,2)+O}(this.dirRecords.length,y,g,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(g){this._sources.push(g);var b=this;return g.on("data",function(y){b.processChunk(y)}),g.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),g.on("error",function(y){b.error(y)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(g){var b=this._sources;if(!l.prototype.error.call(this,g))return!1;for(var y=0;y<b.length;y++)try{b[y].error(g)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var g=this._sources,b=0;b<g.length;b++)g[b].lock()},n.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,l,c){var f=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(p,g){d++;var b=function(E,S){var I=E||S,C=s[I];if(!C)throw new Error(I+" is not a valid compression method !");return C}(g.options.compression,l.compression),y=g.options.compressionOptions||l.compressionOptions||{},_=g.dir,w=g.date;g._compressWorker(b,y).withStreamInfo("file",{name:p,dir:_,date:w,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(f)}),f.entriesCount=d}catch(p){f.error(p)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),l=r("./zipEntries"),c=r("./stream/Crc32Probe"),f=r("./nodejsUtils");function d(p){return new o.Promise(function(g,b){var y=p.decompressed.getContentWorker().pipe(new c);y.on("error",function(_){b(_)}).on("end",function(){y.streamInfo.crc32!==p.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}n.exports=function(p,g){var b=this;return g=s.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),f.isNode&&f.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",p,!0,g.optimizedBinaryString,g.base64).then(function(y){var _=new l(g);return _.load(y),_}).then(function(y){var _=[o.Promise.resolve(y)],w=y.files;if(g.checkCRC32)for(var E=0;E<w.length;E++)_.push(d(w[E]));return o.Promise.all(_)}).then(function(y){for(var _=y.shift(),w=_.files,E=0;E<w.length;E++){var S=w[E],I=S.fileNameStr,C=s.resolve(S.fileNameStr);b.file(C,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:g.createFolders}),S.dir||(b.file(C).unsafeOriginalName=I)}return _.zipComment.length&&(b.comment=_.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,l,c){s.call(this,l),this._helper=a;var f=this;a.on("data",function(d,p){f.push(d)||f._helper.pause(),c&&c(p)}).on("error",function(d){f.emit("error",d)}).on("end",function(){f.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(C,O,T){var G,L=a.getTypeOf(O),j=a.extend(T||{},f);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(C=w(C)),j.createFolders&&(G=_(C))&&E.call(this,G,!0);var Y=L==="string"&&j.binary===!1&&j.base64===!1;T&&T.binary!==void 0||(j.binary=!Y),(O instanceof d&&O.uncompressedSize===0||j.dir||!O||O.length===0)&&(j.base64=!1,j.binary=!0,O="",j.compression="STORE",L="string");var N=null;N=O instanceof d||O instanceof l?O:b.isNode&&b.isStream(O)?new y(C,O):a.prepareContent(C,O,j.binary,j.optimizedBinaryString,j.base64);var z=new p(C,N,j);this.files[C]=z}var o=r("./utf8"),a=r("./utils"),l=r("./stream/GenericWorker"),c=r("./stream/StreamHelper"),f=r("./defaults"),d=r("./compressedObject"),p=r("./zipObject"),g=r("./generate"),b=r("./nodejsUtils"),y=r("./nodejs/NodejsStreamInputAdapter"),_=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var O=C.lastIndexOf("/");return 0<O?C.substring(0,O):""},w=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},E=function(C,O){return O=O!==void 0?O:f.createFolders,C=w(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:O}),this.files[C]};function S(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var O,T,G;for(O in this.files)G=this.files[O],(T=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&C(T,G)},filter:function(C){var O=[];return this.forEach(function(T,G){C(T,G)&&O.push(G)}),O},file:function(C,O,T){if(arguments.length!==1)return C=this.root+C,s.call(this,C,O,T),this;if(S(C)){var G=C;return this.filter(function(j,Y){return!Y.dir&&G.test(j)})}var L=this.files[this.root+C];return L&&!L.dir?L:null},folder:function(C){if(!C)return this;if(S(C))return this.filter(function(L,j){return j.dir&&C.test(L)});var O=this.root+C,T=E.call(this,O),G=this.clone();return G.root=T.name,G},remove:function(C){C=this.root+C;var O=this.files[C];if(O||(C.slice(-1)!=="/"&&(C+="/"),O=this.files[C]),O&&!O.dir)delete this.files[C];else for(var T=this.filter(function(L,j){return j.name.slice(0,C.length)===C}),G=0;G<T.length;G++)delete this.files[T[G].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var O,T={};try{if((T=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");a.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var G=T.comment||this.comment||"";O=g.generateWorker(this,T,G)}catch(L){(O=new l("error")).error(L)}return new c(O,T.type||"string",T.mimeType)},generateAsync:function(C,O){return this.generateInternalStream(C).accumulate(O)},generateNodeStream:function(C,O){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(O)}};n.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),f=a.charCodeAt(2),d=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===f&&this.data[p+3]===d)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),f=a.charCodeAt(2),d=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&f===p[2]&&d===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),l=r("./StringReader"),c=r("./NodeBufferReader"),f=r("./Uint8ArrayReader");n.exports=function(d){var p=s.getTypeOf(d);return s.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new c(d):o.uint8array?new f(s.transformTo("uint8array",d)):new a(s.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(l){s.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,s),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=s.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),l=r("../base64"),c=r("../support"),f=r("../external"),d=null;if(c.nodestream)try{d=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(b,y){return new f.Promise(function(_,w){var E=[],S=b._internalType,I=b._outputType,C=b._mimeType;b.on("data",function(O,T){E.push(O),y&&y(T)}).on("error",function(O){E=[],w(O)}).on("end",function(){try{var O=function(T,G,L){switch(T){case"blob":return s.newBlob(s.transformTo("arraybuffer",G),L);case"base64":return l.encode(G);default:return s.transformTo(T,G)}}(I,function(T,G){var L,j=0,Y=null,N=0;for(L=0;L<G.length;L++)N+=G[L].length;switch(T){case"string":return G.join("");case"array":return Array.prototype.concat.apply([],G);case"uint8array":for(Y=new Uint8Array(N),L=0;L<G.length;L++)Y.set(G[L],j),j+=G[L].length;return Y;case"nodebuffer":return Buffer.concat(G);default:throw new Error("concat : unsupported type '"+T+"'")}}(S,E),C);_(O)}catch(T){w(T)}E=[]}).resume()})}function g(b,y,_){var w=y;switch(y){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=y,this._mimeType=_,s.checkSupport(w),this._worker=b.pipe(new o(w)),b.lock()}catch(E){this._worker=new a("error"),this._worker.error(E)}}g.prototype={accumulate:function(b){return p(this,b)},on:function(b,y){var _=this;return b==="data"?this._worker.on(b,function(w){y.call(_,w.data,w.meta)}):this._worker.on(b,function(){s.delay(y,arguments,_)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},b)}},n.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),l=r("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}i.utf8encode=function(g){return o.nodebuffer?a.newBufferFrom(g,"utf-8"):function(b){var y,_,w,E,S,I=b.length,C=0;for(E=0;E<I;E++)(64512&(_=b.charCodeAt(E)))==55296&&E+1<I&&(64512&(w=b.charCodeAt(E+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),E++),C+=_<128?1:_<2048?2:_<65536?3:4;for(y=o.uint8array?new Uint8Array(C):new Array(C),E=S=0;S<C;E++)(64512&(_=b.charCodeAt(E)))==55296&&E+1<I&&(64512&(w=b.charCodeAt(E+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),E++),_<128?y[S++]=_:(_<2048?y[S++]=192|_>>>6:(_<65536?y[S++]=224|_>>>12:(y[S++]=240|_>>>18,y[S++]=128|_>>>12&63),y[S++]=128|_>>>6&63),y[S++]=128|63&_);return y}(g)},i.utf8decode=function(g){return o.nodebuffer?s.transformTo("nodebuffer",g).toString("utf-8"):function(b){var y,_,w,E,S=b.length,I=new Array(2*S);for(y=_=0;y<S;)if((w=b[y++])<128)I[_++]=w;else if(4<(E=c[w]))I[_++]=65533,y+=E-1;else{for(w&=E===2?31:E===3?15:7;1<E&&y<S;)w=w<<6|63&b[y++],E--;1<E?I[_++]=65533:w<65536?I[_++]=w:(w-=65536,I[_++]=55296|w>>10&1023,I[_++]=56320|1023&w)}return I.length!==_&&(I.subarray?I=I.subarray(0,_):I.length=_),s.applyFromCharCode(I)}(g=s.transformTo(o.uint8array?"uint8array":"array",g))},s.inherits(d,l),d.prototype.processChunk=function(g){var b=s.transformTo(o.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var y=b;(b=new Uint8Array(y.length+this.leftOver.length)).set(this.leftOver,0),b.set(y,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var _=function(E,S){var I;for((S=S||E.length)>E.length&&(S=E.length),I=S-1;0<=I&&(192&E[I])==128;)I--;return I<0||I===0?S:I+c[E[I]]>S?I:S}(b),w=b;_!==b.length&&(o.uint8array?(w=b.subarray(0,_),this.leftOver=b.subarray(_,b.length)):(w=b.slice(0,_),this.leftOver=b.slice(_,b.length))),this.push({data:i.utf8decode(w),meta:g.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,s.inherits(p,l),p.prototype.processChunk=function(g){this.push({data:i.utf8encode(g.data),meta:g.meta})},i.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),l=r("./external");function c(y){return y}function f(y,_){for(var w=0;w<y.length;++w)_[w]=255&y.charCodeAt(w);return _}r("setimmediate"),i.newBlob=function(y,_){i.checkSupport("blob");try{return new Blob([y],{type:_})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(y),w.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(y,_,w){var E=[],S=0,I=y.length;if(I<=w)return String.fromCharCode.apply(null,y);for(;S<I;)_==="array"||_==="nodebuffer"?E.push(String.fromCharCode.apply(null,y.slice(S,Math.min(S+w,I)))):E.push(String.fromCharCode.apply(null,y.subarray(S,Math.min(S+w,I)))),S+=w;return E.join("")},stringifyByChar:function(y){for(var _="",w=0;w<y.length;w++)_+=String.fromCharCode(y[w]);return _},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(y){var _=65536,w=i.getTypeOf(y),E=!0;if(w==="uint8array"?E=d.applyCanBeUsed.uint8array:w==="nodebuffer"&&(E=d.applyCanBeUsed.nodebuffer),E)for(;1<_;)try{return d.stringifyByChunk(y,w,_)}catch{_=Math.floor(_/2)}return d.stringifyByChar(y)}function g(y,_){for(var w=0;w<y.length;w++)_[w]=y[w];return _}i.applyFromCharCode=p;var b={};b.string={string:c,array:function(y){return f(y,new Array(y.length))},arraybuffer:function(y){return b.string.uint8array(y).buffer},uint8array:function(y){return f(y,new Uint8Array(y.length))},nodebuffer:function(y){return f(y,a.allocBuffer(y.length))}},b.array={string:p,array:c,arraybuffer:function(y){return new Uint8Array(y).buffer},uint8array:function(y){return new Uint8Array(y)},nodebuffer:function(y){return a.newBufferFrom(y)}},b.arraybuffer={string:function(y){return p(new Uint8Array(y))},array:function(y){return g(new Uint8Array(y),new Array(y.byteLength))},arraybuffer:c,uint8array:function(y){return new Uint8Array(y)},nodebuffer:function(y){return a.newBufferFrom(new Uint8Array(y))}},b.uint8array={string:p,array:function(y){return g(y,new Array(y.length))},arraybuffer:function(y){return y.buffer},uint8array:c,nodebuffer:function(y){return a.newBufferFrom(y)}},b.nodebuffer={string:p,array:function(y){return g(y,new Array(y.length))},arraybuffer:function(y){return b.nodebuffer.uint8array(y).buffer},uint8array:function(y){return g(y,new Uint8Array(y.length))},nodebuffer:c},i.transformTo=function(y,_){if(_=_||"",!y)return _;i.checkSupport(y);var w=i.getTypeOf(_);return b[w][y](_)},i.resolve=function(y){for(var _=y.split("/"),w=[],E=0;E<_.length;E++){var S=_[E];S==="."||S===""&&E!==0&&E!==_.length-1||(S===".."?w.pop():w.push(S))}return w.join("/")},i.getTypeOf=function(y){return typeof y=="string"?"string":Object.prototype.toString.call(y)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(y)?"nodebuffer":s.uint8array&&y instanceof Uint8Array?"uint8array":s.arraybuffer&&y instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(y){if(!s[y.toLowerCase()])throw new Error(y+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(y){var _,w,E="";for(w=0;w<(y||"").length;w++)E+="\\x"+((_=y.charCodeAt(w))<16?"0":"")+_.toString(16).toUpperCase();return E},i.delay=function(y,_,w){setImmediate(function(){y.apply(w||null,_||[])})},i.inherits=function(y,_){function w(){}w.prototype=_.prototype,y.prototype=new w},i.extend=function(){var y,_,w={};for(y=0;y<arguments.length;y++)for(_ in arguments[y])Object.prototype.hasOwnProperty.call(arguments[y],_)&&w[_]===void 0&&(w[_]=arguments[y][_]);return w},i.prepareContent=function(y,_,w,E,S){return l.Promise.resolve(_).then(function(I){return s.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,O){var T=new FileReader;T.onload=function(G){C(G.target.result)},T.onerror=function(G){O(G.target.error)},T.readAsArrayBuffer(I)}):I}).then(function(I){var C=i.getTypeOf(I);return C?(C==="arraybuffer"?I=i.transformTo("uint8array",I):C==="string"&&(S?I=o.decode(I):w&&E!==!0&&(I=function(O){return f(O,s.uint8array?new Uint8Array(O.length):new Array(O.length))}(I))),I):l.Promise.reject(new Error("Can't read the data of '"+y+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),l=r("./zipEntry"),c=r("./support");function f(d){this.files=[],this.loadOptions=d}f.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(d)+")")}},isSignature:function(d,p){var g=this.reader.index;this.reader.setIndex(d);var b=this.reader.readString(4)===p;return this.reader.setIndex(g),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",g=o.transformTo(p,d);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,p,g,b=this.zip64EndOfCentralSize-44;0<b;)d=this.reader.readInt(2),p=this.reader.readInt(4),g=this.reader.readData(p),this.zip64ExtensibleData[d]={id:d,length:p,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,p;for(d=0;d<this.files.length;d++)p=this.files[d],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var p=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var b=p-g;if(0<b)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(d){this.reader=s(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),l=r("./crc32"),c=r("./utf8"),f=r("./compressions"),d=r("./support");function p(g,b){this.options=g,this.loadOptions=b}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var b,y;if(g.skip(22),this.fileNameLength=g.readInt(2),y=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(y),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(_){for(var w in f)if(Object.prototype.hasOwnProperty.call(f,w)&&f[w].magic===_)return f[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var b=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(b),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var b,y,_,w=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<w;)b=g.readInt(2),y=g.readInt(2),_=g.readData(y),this.extraFields[b]={id:b,length:y,value:_};g.setIndex(w)},handleUTF8:function(){var g=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var y=o.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(y)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var w=o.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var b=s(g.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:c.utf8decode(b.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var b=s(g.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:c.utf8decode(b.readData(g.length-5))}return null}},n.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(b,y,_){this.name=b,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=y,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),l=r("./utf8"),c=r("./compressedObject"),f=r("./stream/GenericWorker");s.prototype={internalStream:function(b){var y=null,_="string";try{if(!b)throw new Error("No output type specified.");var w=(_=b.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),y=this._decompressWorker();var E=!this._dataBinary;E&&!w&&(y=y.pipe(new l.Utf8EncodeWorker)),!E&&w&&(y=y.pipe(new l.Utf8DecodeWorker))}catch(S){(y=new f("error")).error(S)}return new o(y,_,"")},async:function(b,y){return this.internalStream(b).accumulate(y)},nodeStream:function(b,y){return this.internalStream(b||"nodebuffer").toNodejsStream(y)},_compressWorker:function(b,y){if(this._data instanceof c&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(_,b,y)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<d.length;g++)s.prototype[d[g]]=p;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,l=s.MutationObserver||s.WebKitMutationObserver;if(l){var c=0,f=new l(b),d=s.document.createTextNode("");f.observe(d,{characterData:!0}),o=function(){d.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var y=s.document.createElement("script");y.onreadystatechange=function(){b(),y.onreadystatechange=null,y.parentNode.removeChild(y),y=null},s.document.documentElement.appendChild(y)}:function(){setTimeout(b,0)};else{var p=new s.MessageChannel;p.port1.onmessage=b,o=function(){p.port2.postMessage(0)}}var g=[];function b(){var y,_;a=!0;for(var w=g.length;w;){for(_=g,g=[],y=-1;++y<w;)_[y]();w=g.length}a=!1}n.exports=function(y){g.push(y)!==1||a||o()}}).call(this,typeof Jr<"u"?Jr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function d(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,w!==o&&y(this,w)}function p(w,E,S){this.promise=w,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function g(w,E,S){s(function(){var I;try{I=E(S)}catch(C){return a.reject(w,C)}I===w?a.reject(w,new TypeError("Cannot resolve promise with itself")):a.resolve(w,I)})}function b(w){var E=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof E=="function")return function(){E.apply(w,arguments)}}function y(w,E){var S=!1;function I(T){S||(S=!0,a.reject(w,T))}function C(T){S||(S=!0,a.resolve(w,T))}var O=_(function(){E(C,I)});O.status==="error"&&I(O.value)}function _(w,E){var S={};try{S.value=w(E),S.status="success"}catch(I){S.status="error",S.value=I}return S}(n.exports=d).prototype.finally=function(w){if(typeof w!="function")return this;var E=this.constructor;return this.then(function(S){return E.resolve(w()).then(function(){return S})},function(S){return E.resolve(w()).then(function(){throw S})})},d.prototype.catch=function(w){return this.then(null,w)},d.prototype.then=function(w,E){if(typeof w!="function"&&this.state===c||typeof E!="function"&&this.state===l)return this;var S=new this.constructor(o);return this.state!==f?g(S,this.state===c?w:E,this.outcome):this.queue.push(new p(S,w,E)),S},p.prototype.callFulfilled=function(w){a.resolve(this.promise,w)},p.prototype.otherCallFulfilled=function(w){g(this.promise,this.onFulfilled,w)},p.prototype.callRejected=function(w){a.reject(this.promise,w)},p.prototype.otherCallRejected=function(w){g(this.promise,this.onRejected,w)},a.resolve=function(w,E){var S=_(b,E);if(S.status==="error")return a.reject(w,S.value);var I=S.value;if(I)y(w,I);else{w.state=c,w.outcome=E;for(var C=-1,O=w.queue.length;++C<O;)w.queue[C].callFulfilled(E)}return w},a.reject=function(w,E){w.state=l,w.outcome=E;for(var S=-1,I=w.queue.length;++S<I;)w.queue[S].callRejected(E);return w},d.resolve=function(w){return w instanceof this?w:a.resolve(new this(o),w)},d.reject=function(w){var E=new this(o);return a.reject(E,w)},d.all=function(w){var E=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=w.length,I=!1;if(!S)return this.resolve([]);for(var C=new Array(S),O=0,T=-1,G=new this(o);++T<S;)L(w[T],T);return G;function L(j,Y){E.resolve(j).then(function(N){C[Y]=N,++O!==S||I||(I=!0,a.resolve(G,C))},function(N){I||(I=!0,a.reject(G,N))})}},d.race=function(w){var E=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=w.length,I=!1;if(!S)return this.resolve([]);for(var C=-1,O=new this(o);++C<S;)T=w[C],E.resolve(T).then(function(G){I||(I=!0,a.resolve(O,G))},function(G){I||(I=!0,a.reject(O,G))});var T;return O}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),l=r("./zlib/messages"),c=r("./zlib/zstream"),f=Object.prototype.toString,d=0,p=-1,g=0,b=8;function y(w){if(!(this instanceof y))return new y(w);this.options=o.assign({level:p,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},w||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var S=s.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(S!==d)throw new Error(l[S]);if(E.header&&s.deflateSetHeader(this.strm,E.header),E.dictionary){var I;if(I=typeof E.dictionary=="string"?a.string2buf(E.dictionary):f.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(S=s.deflateSetDictionary(this.strm,I))!==d)throw new Error(l[S]);this._dict_set=!0}}function _(w,E){var S=new y(E);if(S.push(w,!0),S.err)throw S.msg||l[S.err];return S.result}y.prototype.push=function(w,E){var S,I,C=this.strm,O=this.options.chunkSize;if(this.ended)return!1;I=E===~~E?E:E===!0?4:0,typeof w=="string"?C.input=a.string2buf(w):f.call(w)==="[object ArrayBuffer]"?C.input=new Uint8Array(w):C.input=w,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(O),C.next_out=0,C.avail_out=O),(S=s.deflate(C,I))!==1&&S!==d)return this.onEnd(S),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&S!==1);return I===4?(S=s.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===d):I!==2||(this.onEnd(d),!(C.avail_out=0))},y.prototype.onData=function(w){this.chunks.push(w)},y.prototype.onEnd=function(w){w===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},i.Deflate=y,i.deflate=_,i.deflateRaw=function(w,E){return(E=E||{}).raw=!0,_(w,E)},i.gzip=function(w,E){return(E=E||{}).gzip=!0,_(w,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),l=r("./zlib/constants"),c=r("./zlib/messages"),f=r("./zlib/zstream"),d=r("./zlib/gzheader"),p=Object.prototype.toString;function g(y){if(!(this instanceof g))return new g(y);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},y||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||y&&y.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&!(15&_.windowBits)&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,_.windowBits);if(w!==l.Z_OK)throw new Error(c[w]);this.header=new d,s.inflateGetHeader(this.strm,this.header)}function b(y,_){var w=new g(_);if(w.push(y,!0),w.err)throw w.msg||c[w.err];return w.result}g.prototype.push=function(y,_){var w,E,S,I,C,O,T=this.strm,G=this.options.chunkSize,L=this.options.dictionary,j=!1;if(this.ended)return!1;E=_===~~_?_:_===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof y=="string"?T.input=a.binstring2buf(y):p.call(y)==="[object ArrayBuffer]"?T.input=new Uint8Array(y):T.input=y,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(G),T.next_out=0,T.avail_out=G),(w=s.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&L&&(O=typeof L=="string"?a.string2buf(L):p.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,w=s.inflateSetDictionary(this.strm,O)),w===l.Z_BUF_ERROR&&j===!0&&(w=l.Z_OK,j=!1),w!==l.Z_STREAM_END&&w!==l.Z_OK)return this.onEnd(w),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&w!==l.Z_STREAM_END&&(T.avail_in!==0||E!==l.Z_FINISH&&E!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=a.utf8border(T.output,T.next_out),I=T.next_out-S,C=a.buf2string(T.output,S),T.next_out=I,T.avail_out=G-I,I&&o.arraySet(T.output,T.output,S,I,0),this.onData(C)):this.onData(o.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(j=!0)}while((0<T.avail_in||T.avail_out===0)&&w!==l.Z_STREAM_END);return w===l.Z_STREAM_END&&(E=l.Z_FINISH),E===l.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===l.Z_OK):E!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},g.prototype.onData=function(y){this.chunks.push(y)},g.prototype.onEnd=function(y){y===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Inflate=g,i.inflate=b,i.inflateRaw=function(y,_){return(_=_||{}).raw=!0,b(y,_)},i.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var d in f)f.hasOwnProperty(d)&&(l[d]=f[d])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,f,d,p){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+d),p);else for(var g=0;g<d;g++)l[p+g]=c[f+g]},flattenChunks:function(l){var c,f,d,p,g,b;for(c=d=0,f=l.length;c<f;c++)d+=l[c].length;for(b=new Uint8Array(d),c=p=0,f=l.length;c<f;c++)g=l[c],b.set(g,p),p+=g.length;return b}},a={arraySet:function(l,c,f,d,p){for(var g=0;g<d;g++)l[p+g]=c[f+g]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new s.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(d,p){if(p<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(d,p));for(var g="",b=0;b<p;b++)g+=String.fromCharCode(d[b]);return g}l[254]=l[254]=1,i.string2buf=function(d){var p,g,b,y,_,w=d.length,E=0;for(y=0;y<w;y++)(64512&(g=d.charCodeAt(y)))==55296&&y+1<w&&(64512&(b=d.charCodeAt(y+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),y++),E+=g<128?1:g<2048?2:g<65536?3:4;for(p=new s.Buf8(E),y=_=0;_<E;y++)(64512&(g=d.charCodeAt(y)))==55296&&y+1<w&&(64512&(b=d.charCodeAt(y+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),y++),g<128?p[_++]=g:(g<2048?p[_++]=192|g>>>6:(g<65536?p[_++]=224|g>>>12:(p[_++]=240|g>>>18,p[_++]=128|g>>>12&63),p[_++]=128|g>>>6&63),p[_++]=128|63&g);return p},i.buf2binstring=function(d){return f(d,d.length)},i.binstring2buf=function(d){for(var p=new s.Buf8(d.length),g=0,b=p.length;g<b;g++)p[g]=d.charCodeAt(g);return p},i.buf2string=function(d,p){var g,b,y,_,w=p||d.length,E=new Array(2*w);for(g=b=0;g<w;)if((y=d[g++])<128)E[b++]=y;else if(4<(_=l[y]))E[b++]=65533,g+=_-1;else{for(y&=_===2?31:_===3?15:7;1<_&&g<w;)y=y<<6|63&d[g++],_--;1<_?E[b++]=65533:y<65536?E[b++]=y:(y-=65536,E[b++]=55296|y>>10&1023,E[b++]=56320|1023&y)}return f(E,b)},i.utf8border=function(d,p){var g;for((p=p||d.length)>d.length&&(p=d.length),g=p-1;0<=g&&(192&d[g])==128;)g--;return g<0||g===0?p:g+l[d[g]]>p?g:p}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,l){for(var c=65535&s|0,f=s>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;f=f+(c=c+o[l++]|0)|0,--d;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();n.exports=function(o,a,l,c){var f=s,d=c+l;o^=-1;for(var p=c;p<d;p++)o=o>>>8^f[255&(o^a[p])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),l=r("./adler32"),c=r("./crc32"),f=r("./messages"),d=0,p=4,g=0,b=-2,y=-1,_=4,w=2,E=8,S=9,I=286,C=30,O=19,T=2*I+1,G=15,L=3,j=258,Y=j+L+1,N=42,z=113,A=1,K=2,et=3,M=4;function rt(v,x){return v.msg=f[x],x}function D(v){return(v<<1)-(4<v?9:0)}function q(v){for(var x=v.length;0<=--x;)v[x]=0}function P(v){var x=v.state,h=x.pending;h>v.avail_out&&(h=v.avail_out),h!==0&&(o.arraySet(v.output,x.pending_buf,x.pending_out,h,v.next_out),v.next_out+=h,x.pending_out+=h,v.total_out+=h,v.avail_out-=h,x.pending-=h,x.pending===0&&(x.pending_out=0))}function U(v,x){a._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,x),v.block_start=v.strstart,P(v.strm)}function it(v,x){v.pending_buf[v.pending++]=x}function J(v,x){v.pending_buf[v.pending++]=x>>>8&255,v.pending_buf[v.pending++]=255&x}function X(v,x){var h,u,m=v.max_chain_length,k=v.strstart,B=v.prev_length,R=v.nice_match,F=v.strstart>v.w_size-Y?v.strstart-(v.w_size-Y):0,W=v.window,Q=v.w_mask,V=v.prev,H=v.strstart+j,pt=W[k+B-1],ft=W[k+B];v.prev_length>=v.good_match&&(m>>=2),R>v.lookahead&&(R=v.lookahead);do if(W[(h=x)+B]===ft&&W[h+B-1]===pt&&W[h]===W[k]&&W[++h]===W[k+1]){k+=2,h++;do;while(W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&W[++k]===W[++h]&&k<H);if(u=j-(H-k),k=H-j,B<u){if(v.match_start=x,R<=(B=u))break;pt=W[k+B-1],ft=W[k+B]}}while((x=V[x&Q])>F&&--m!=0);return B<=v.lookahead?B:v.lookahead}function At(v){var x,h,u,m,k,B,R,F,W,Q,V=v.w_size;do{if(m=v.window_size-v.lookahead-v.strstart,v.strstart>=V+(V-Y)){for(o.arraySet(v.window,v.window,V,V,0),v.match_start-=V,v.strstart-=V,v.block_start-=V,x=h=v.hash_size;u=v.head[--x],v.head[x]=V<=u?u-V:0,--h;);for(x=h=V;u=v.prev[--x],v.prev[x]=V<=u?u-V:0,--h;);m+=V}if(v.strm.avail_in===0)break;if(B=v.strm,R=v.window,F=v.strstart+v.lookahead,W=m,Q=void 0,Q=B.avail_in,W<Q&&(Q=W),h=Q===0?0:(B.avail_in-=Q,o.arraySet(R,B.input,B.next_in,Q,F),B.state.wrap===1?B.adler=l(B.adler,R,Q,F):B.state.wrap===2&&(B.adler=c(B.adler,R,Q,F)),B.next_in+=Q,B.total_in+=Q,Q),v.lookahead+=h,v.lookahead+v.insert>=L)for(k=v.strstart-v.insert,v.ins_h=v.window[k],v.ins_h=(v.ins_h<<v.hash_shift^v.window[k+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[k+L-1])&v.hash_mask,v.prev[k&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=k,k++,v.insert--,!(v.lookahead+v.insert<L)););}while(v.lookahead<Y&&v.strm.avail_in!==0)}function It(v,x){for(var h,u;;){if(v.lookahead<Y){if(At(v),v.lookahead<Y&&x===d)return A;if(v.lookahead===0)break}if(h=0,v.lookahead>=L&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+L-1])&v.hash_mask,h=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),h!==0&&v.strstart-h<=v.w_size-Y&&(v.match_length=X(v,h)),v.match_length>=L)if(u=a._tr_tally(v,v.strstart-v.match_start,v.match_length-L),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=L){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+L-1])&v.hash_mask,h=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else u=a._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(u&&(U(v,!1),v.strm.avail_out===0))return A}return v.insert=v.strstart<L-1?v.strstart:L-1,x===p?(U(v,!0),v.strm.avail_out===0?et:M):v.last_lit&&(U(v,!1),v.strm.avail_out===0)?A:K}function ht(v,x){for(var h,u,m;;){if(v.lookahead<Y){if(At(v),v.lookahead<Y&&x===d)return A;if(v.lookahead===0)break}if(h=0,v.lookahead>=L&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+L-1])&v.hash_mask,h=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=L-1,h!==0&&v.prev_length<v.max_lazy_match&&v.strstart-h<=v.w_size-Y&&(v.match_length=X(v,h),v.match_length<=5&&(v.strategy===1||v.match_length===L&&4096<v.strstart-v.match_start)&&(v.match_length=L-1)),v.prev_length>=L&&v.match_length<=v.prev_length){for(m=v.strstart+v.lookahead-L,u=a._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-L),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=m&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+L-1])&v.hash_mask,h=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=L-1,v.strstart++,u&&(U(v,!1),v.strm.avail_out===0))return A}else if(v.match_available){if((u=a._tr_tally(v,0,v.window[v.strstart-1]))&&U(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return A}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(u=a._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<L-1?v.strstart:L-1,x===p?(U(v,!0),v.strm.avail_out===0?et:M):v.last_lit&&(U(v,!1),v.strm.avail_out===0)?A:K}function dt(v,x,h,u,m){this.good_length=v,this.max_lazy=x,this.nice_length=h,this.max_chain=u,this.func=m}function Et(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*T),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*O+1)),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(G+1),this.heap=new o.Buf16(2*I+1),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*I+1),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wt(v){var x;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=w,(x=v.state).pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap?N:z,v.adler=x.wrap===2?0:1,x.last_flush=d,a._tr_init(x),g):rt(v,b)}function kt(v){var x=wt(v);return x===g&&function(h){h.window_size=2*h.w_size,q(h.head),h.max_lazy_match=s[h.level].max_lazy,h.good_match=s[h.level].good_length,h.nice_match=s[h.level].nice_length,h.max_chain_length=s[h.level].max_chain,h.strstart=0,h.block_start=0,h.lookahead=0,h.insert=0,h.match_length=h.prev_length=L-1,h.match_available=0,h.ins_h=0}(v.state),x}function Ft(v,x,h,u,m,k){if(!v)return b;var B=1;if(x===y&&(x=6),u<0?(B=0,u=-u):15<u&&(B=2,u-=16),m<1||S<m||h!==E||u<8||15<u||x<0||9<x||k<0||_<k)return rt(v,b);u===8&&(u=9);var R=new Et;return(v.state=R).strm=v,R.wrap=B,R.gzhead=null,R.w_bits=u,R.w_size=1<<R.w_bits,R.w_mask=R.w_size-1,R.hash_bits=m+7,R.hash_size=1<<R.hash_bits,R.hash_mask=R.hash_size-1,R.hash_shift=~~((R.hash_bits+L-1)/L),R.window=new o.Buf8(2*R.w_size),R.head=new o.Buf16(R.hash_size),R.prev=new o.Buf16(R.w_size),R.lit_bufsize=1<<m+6,R.pending_buf_size=4*R.lit_bufsize,R.pending_buf=new o.Buf8(R.pending_buf_size),R.d_buf=1*R.lit_bufsize,R.l_buf=3*R.lit_bufsize,R.level=x,R.strategy=k,R.method=h,kt(v)}s=[new dt(0,0,0,0,function(v,x){var h=65535;for(h>v.pending_buf_size-5&&(h=v.pending_buf_size-5);;){if(v.lookahead<=1){if(At(v),v.lookahead===0&&x===d)return A;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var u=v.block_start+h;if((v.strstart===0||v.strstart>=u)&&(v.lookahead=v.strstart-u,v.strstart=u,U(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-Y&&(U(v,!1),v.strm.avail_out===0))return A}return v.insert=0,x===p?(U(v,!0),v.strm.avail_out===0?et:M):(v.strstart>v.block_start&&(U(v,!1),v.strm.avail_out),A)}),new dt(4,4,8,4,It),new dt(4,5,16,8,It),new dt(4,6,32,32,It),new dt(4,4,16,16,ht),new dt(8,16,32,32,ht),new dt(8,16,128,128,ht),new dt(8,32,128,256,ht),new dt(32,128,258,1024,ht),new dt(32,258,258,4096,ht)],i.deflateInit=function(v,x){return Ft(v,x,E,15,8,0)},i.deflateInit2=Ft,i.deflateReset=kt,i.deflateResetKeep=wt,i.deflateSetHeader=function(v,x){return v&&v.state?v.state.wrap!==2?b:(v.state.gzhead=x,g):b},i.deflate=function(v,x){var h,u,m,k;if(!v||!v.state||5<x||x<0)return v?rt(v,b):b;if(u=v.state,!v.output||!v.input&&v.avail_in!==0||u.status===666&&x!==p)return rt(v,v.avail_out===0?-5:b);if(u.strm=v,h=u.last_flush,u.last_flush=x,u.status===N)if(u.wrap===2)v.adler=0,it(u,31),it(u,139),it(u,8),u.gzhead?(it(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),it(u,255&u.gzhead.time),it(u,u.gzhead.time>>8&255),it(u,u.gzhead.time>>16&255),it(u,u.gzhead.time>>24&255),it(u,u.level===9?2:2<=u.strategy||u.level<2?4:0),it(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(it(u,255&u.gzhead.extra.length),it(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(v.adler=c(v.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=69):(it(u,0),it(u,0),it(u,0),it(u,0),it(u,0),it(u,u.level===9?2:2<=u.strategy||u.level<2?4:0),it(u,3),u.status=z);else{var B=E+(u.w_bits-8<<4)<<8;B|=(2<=u.strategy||u.level<2?0:u.level<6?1:u.level===6?2:3)<<6,u.strstart!==0&&(B|=32),B+=31-B%31,u.status=z,J(u,B),u.strstart!==0&&(J(u,v.adler>>>16),J(u,65535&v.adler)),v.adler=1}if(u.status===69)if(u.gzhead.extra){for(m=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),P(v),m=u.pending,u.pending!==u.pending_buf_size));)it(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=73)}else u.status=73;if(u.status===73)if(u.gzhead.name){m=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),P(v),m=u.pending,u.pending===u.pending_buf_size)){k=1;break}k=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,it(u,k)}while(k!==0);u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),k===0&&(u.gzindex=0,u.status=91)}else u.status=91;if(u.status===91)if(u.gzhead.comment){m=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),P(v),m=u.pending,u.pending===u.pending_buf_size)){k=1;break}k=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,it(u,k)}while(k!==0);u.gzhead.hcrc&&u.pending>m&&(v.adler=c(v.adler,u.pending_buf,u.pending-m,m)),k===0&&(u.status=103)}else u.status=103;if(u.status===103&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&P(v),u.pending+2<=u.pending_buf_size&&(it(u,255&v.adler),it(u,v.adler>>8&255),v.adler=0,u.status=z)):u.status=z),u.pending!==0){if(P(v),v.avail_out===0)return u.last_flush=-1,g}else if(v.avail_in===0&&D(x)<=D(h)&&x!==p)return rt(v,-5);if(u.status===666&&v.avail_in!==0)return rt(v,-5);if(v.avail_in!==0||u.lookahead!==0||x!==d&&u.status!==666){var R=u.strategy===2?function(F,W){for(var Q;;){if(F.lookahead===0&&(At(F),F.lookahead===0)){if(W===d)return A;break}if(F.match_length=0,Q=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,Q&&(U(F,!1),F.strm.avail_out===0))return A}return F.insert=0,W===p?(U(F,!0),F.strm.avail_out===0?et:M):F.last_lit&&(U(F,!1),F.strm.avail_out===0)?A:K}(u,x):u.strategy===3?function(F,W){for(var Q,V,H,pt,ft=F.window;;){if(F.lookahead<=j){if(At(F),F.lookahead<=j&&W===d)return A;if(F.lookahead===0)break}if(F.match_length=0,F.lookahead>=L&&0<F.strstart&&(V=ft[H=F.strstart-1])===ft[++H]&&V===ft[++H]&&V===ft[++H]){pt=F.strstart+j;do;while(V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&V===ft[++H]&&H<pt);F.match_length=j-(pt-H),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=L?(Q=a._tr_tally(F,1,F.match_length-L),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(Q=a._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),Q&&(U(F,!1),F.strm.avail_out===0))return A}return F.insert=0,W===p?(U(F,!0),F.strm.avail_out===0?et:M):F.last_lit&&(U(F,!1),F.strm.avail_out===0)?A:K}(u,x):s[u.level].func(u,x);if(R!==et&&R!==M||(u.status=666),R===A||R===et)return v.avail_out===0&&(u.last_flush=-1),g;if(R===K&&(x===1?a._tr_align(u):x!==5&&(a._tr_stored_block(u,0,0,!1),x===3&&(q(u.head),u.lookahead===0&&(u.strstart=0,u.block_start=0,u.insert=0))),P(v),v.avail_out===0))return u.last_flush=-1,g}return x!==p?g:u.wrap<=0?1:(u.wrap===2?(it(u,255&v.adler),it(u,v.adler>>8&255),it(u,v.adler>>16&255),it(u,v.adler>>24&255),it(u,255&v.total_in),it(u,v.total_in>>8&255),it(u,v.total_in>>16&255),it(u,v.total_in>>24&255)):(J(u,v.adler>>>16),J(u,65535&v.adler)),P(v),0<u.wrap&&(u.wrap=-u.wrap),u.pending!==0?g:1)},i.deflateEnd=function(v){var x;return v&&v.state?(x=v.state.status)!==N&&x!==69&&x!==73&&x!==91&&x!==103&&x!==z&&x!==666?rt(v,b):(v.state=null,x===z?rt(v,-3):g):b},i.deflateSetDictionary=function(v,x){var h,u,m,k,B,R,F,W,Q=x.length;if(!v||!v.state||(k=(h=v.state).wrap)===2||k===1&&h.status!==N||h.lookahead)return b;for(k===1&&(v.adler=l(v.adler,x,Q,0)),h.wrap=0,Q>=h.w_size&&(k===0&&(q(h.head),h.strstart=0,h.block_start=0,h.insert=0),W=new o.Buf8(h.w_size),o.arraySet(W,x,Q-h.w_size,h.w_size,0),x=W,Q=h.w_size),B=v.avail_in,R=v.next_in,F=v.input,v.avail_in=Q,v.next_in=0,v.input=x,At(h);h.lookahead>=L;){for(u=h.strstart,m=h.lookahead-(L-1);h.ins_h=(h.ins_h<<h.hash_shift^h.window[u+L-1])&h.hash_mask,h.prev[u&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=u,u++,--m;);h.strstart=u,h.lookahead=L-1,At(h)}return h.strstart+=h.lookahead,h.block_start=h.strstart,h.insert=h.lookahead,h.lookahead=0,h.match_length=h.prev_length=L-1,h.match_available=0,v.next_in=R,v.input=F,v.avail_in=B,h.wrap=k,g},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,l,c,f,d,p,g,b,y,_,w,E,S,I,C,O,T,G,L,j,Y,N,z,A,K;a=s.state,l=s.next_in,A=s.input,c=l+(s.avail_in-5),f=s.next_out,K=s.output,d=f-(o-s.avail_out),p=f+(s.avail_out-257),g=a.dmax,b=a.wsize,y=a.whave,_=a.wnext,w=a.window,E=a.hold,S=a.bits,I=a.lencode,C=a.distcode,O=(1<<a.lenbits)-1,T=(1<<a.distbits)-1;t:do{S<15&&(E+=A[l++]<<S,S+=8,E+=A[l++]<<S,S+=8),G=I[E&O];e:for(;;){if(E>>>=L=G>>>24,S-=L,(L=G>>>16&255)===0)K[f++]=65535&G;else{if(!(16&L)){if(!(64&L)){G=I[(65535&G)+(E&(1<<L)-1)];continue e}if(32&L){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}j=65535&G,(L&=15)&&(S<L&&(E+=A[l++]<<S,S+=8),j+=E&(1<<L)-1,E>>>=L,S-=L),S<15&&(E+=A[l++]<<S,S+=8,E+=A[l++]<<S,S+=8),G=C[E&T];r:for(;;){if(E>>>=L=G>>>24,S-=L,!(16&(L=G>>>16&255))){if(!(64&L)){G=C[(65535&G)+(E&(1<<L)-1)];continue r}s.msg="invalid distance code",a.mode=30;break t}if(Y=65535&G,S<(L&=15)&&(E+=A[l++]<<S,(S+=8)<L&&(E+=A[l++]<<S,S+=8)),g<(Y+=E&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(E>>>=L,S-=L,(L=f-d)<Y){if(y<(L=Y-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(z=w,(N=0)===_){if(N+=b-L,L<j){for(j-=L;K[f++]=w[N++],--L;);N=f-Y,z=K}}else if(_<L){if(N+=b+_-L,(L-=_)<j){for(j-=L;K[f++]=w[N++],--L;);if(N=0,_<j){for(j-=L=_;K[f++]=w[N++],--L;);N=f-Y,z=K}}}else if(N+=_-L,L<j){for(j-=L;K[f++]=w[N++],--L;);N=f-Y,z=K}for(;2<j;)K[f++]=z[N++],K[f++]=z[N++],K[f++]=z[N++],j-=3;j&&(K[f++]=z[N++],1<j&&(K[f++]=z[N++]))}else{for(N=f-Y;K[f++]=K[N++],K[f++]=K[N++],K[f++]=K[N++],2<(j-=3););j&&(K[f++]=K[N++],1<j&&(K[f++]=K[N++]))}break}}break}}while(l<c&&f<p);l-=j=S>>3,E&=(1<<(S-=j<<3))-1,s.next_in=l,s.next_out=f,s.avail_in=l<c?c-l+5:5-(l-c),s.avail_out=f<p?p-f+257:257-(f-p),a.hold=E,a.bits=S}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),l=r("./inffast"),c=r("./inftrees"),f=1,d=2,p=0,g=-2,b=1,y=852,_=592;function w(N){return(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(N){var z;return N&&N.state?(z=N.state,N.total_in=N.total_out=z.total=0,N.msg="",z.wrap&&(N.adler=1&z.wrap),z.mode=b,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new s.Buf32(y),z.distcode=z.distdyn=new s.Buf32(_),z.sane=1,z.back=-1,p):g}function I(N){var z;return N&&N.state?((z=N.state).wsize=0,z.whave=0,z.wnext=0,S(N)):g}function C(N,z){var A,K;return N&&N.state?(K=N.state,z<0?(A=0,z=-z):(A=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?g:(K.window!==null&&K.wbits!==z&&(K.window=null),K.wrap=A,K.wbits=z,I(N))):g}function O(N,z){var A,K;return N?(K=new E,(N.state=K).window=null,(A=C(N,z))!==p&&(N.state=null),A):g}var T,G,L=!0;function j(N){if(L){var z;for(T=new s.Buf32(512),G=new s.Buf32(32),z=0;z<144;)N.lens[z++]=8;for(;z<256;)N.lens[z++]=9;for(;z<280;)N.lens[z++]=7;for(;z<288;)N.lens[z++]=8;for(c(f,N.lens,0,288,T,0,N.work,{bits:9}),z=0;z<32;)N.lens[z++]=5;c(d,N.lens,0,32,G,0,N.work,{bits:5}),L=!1}N.lencode=T,N.lenbits=9,N.distcode=G,N.distbits=5}function Y(N,z,A,K){var et,M=N.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new s.Buf8(M.wsize)),K>=M.wsize?(s.arraySet(M.window,z,A-M.wsize,M.wsize,0),M.wnext=0,M.whave=M.wsize):(K<(et=M.wsize-M.wnext)&&(et=K),s.arraySet(M.window,z,A-K,et,M.wnext),(K-=et)?(s.arraySet(M.window,z,A-K,K,0),M.wnext=K,M.whave=M.wsize):(M.wnext+=et,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=et))),0}i.inflateReset=I,i.inflateReset2=C,i.inflateResetKeep=S,i.inflateInit=function(N){return O(N,15)},i.inflateInit2=O,i.inflate=function(N,z){var A,K,et,M,rt,D,q,P,U,it,J,X,At,It,ht,dt,Et,wt,kt,Ft,v,x,h,u,m=0,k=new s.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!N||!N.state||!N.output||!N.input&&N.avail_in!==0)return g;(A=N.state).mode===12&&(A.mode=13),rt=N.next_out,et=N.output,q=N.avail_out,M=N.next_in,K=N.input,D=N.avail_in,P=A.hold,U=A.bits,it=D,J=q,x=p;t:for(;;)switch(A.mode){case b:if(A.wrap===0){A.mode=13;break}for(;U<16;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(2&A.wrap&&P===35615){k[A.check=0]=255&P,k[1]=P>>>8&255,A.check=a(A.check,k,2,0),U=P=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&P)<<8)+(P>>8))%31){N.msg="incorrect header check",A.mode=30;break}if((15&P)!=8){N.msg="unknown compression method",A.mode=30;break}if(U-=4,v=8+(15&(P>>>=4)),A.wbits===0)A.wbits=v;else if(v>A.wbits){N.msg="invalid window size",A.mode=30;break}A.dmax=1<<v,N.adler=A.check=1,A.mode=512&P?10:12,U=P=0;break;case 2:for(;U<16;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(A.flags=P,(255&A.flags)!=8){N.msg="unknown compression method",A.mode=30;break}if(57344&A.flags){N.msg="unknown header flags set",A.mode=30;break}A.head&&(A.head.text=P>>8&1),512&A.flags&&(k[0]=255&P,k[1]=P>>>8&255,A.check=a(A.check,k,2,0)),U=P=0,A.mode=3;case 3:for(;U<32;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.head&&(A.head.time=P),512&A.flags&&(k[0]=255&P,k[1]=P>>>8&255,k[2]=P>>>16&255,k[3]=P>>>24&255,A.check=a(A.check,k,4,0)),U=P=0,A.mode=4;case 4:for(;U<16;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.head&&(A.head.xflags=255&P,A.head.os=P>>8),512&A.flags&&(k[0]=255&P,k[1]=P>>>8&255,A.check=a(A.check,k,2,0)),U=P=0,A.mode=5;case 5:if(1024&A.flags){for(;U<16;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.length=P,A.head&&(A.head.extra_len=P),512&A.flags&&(k[0]=255&P,k[1]=P>>>8&255,A.check=a(A.check,k,2,0)),U=P=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(D<(X=A.length)&&(X=D),X&&(A.head&&(v=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Array(A.head.extra_len)),s.arraySet(A.head.extra,K,M,X,v)),512&A.flags&&(A.check=a(A.check,K,X,M)),D-=X,M+=X,A.length-=X),A.length))break t;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(D===0)break t;for(X=0;v=K[M+X++],A.head&&v&&A.length<65536&&(A.head.name+=String.fromCharCode(v)),v&&X<D;);if(512&A.flags&&(A.check=a(A.check,K,X,M)),D-=X,M+=X,v)break t}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(D===0)break t;for(X=0;v=K[M+X++],A.head&&v&&A.length<65536&&(A.head.comment+=String.fromCharCode(v)),v&&X<D;);if(512&A.flags&&(A.check=a(A.check,K,X,M)),D-=X,M+=X,v)break t}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;U<16;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(P!==(65535&A.check)){N.msg="header crc mismatch",A.mode=30;break}U=P=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),N.adler=A.check=0,A.mode=12;break;case 10:for(;U<32;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}N.adler=A.check=w(P),U=P=0,A.mode=11;case 11:if(A.havedict===0)return N.next_out=rt,N.avail_out=q,N.next_in=M,N.avail_in=D,A.hold=P,A.bits=U,2;N.adler=A.check=1,A.mode=12;case 12:if(z===5||z===6)break t;case 13:if(A.last){P>>>=7&U,U-=7&U,A.mode=27;break}for(;U<3;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}switch(A.last=1&P,U-=1,3&(P>>>=1)){case 0:A.mode=14;break;case 1:if(j(A),A.mode=20,z!==6)break;P>>>=2,U-=2;break t;case 2:A.mode=17;break;case 3:N.msg="invalid block type",A.mode=30}P>>>=2,U-=2;break;case 14:for(P>>>=7&U,U-=7&U;U<32;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if((65535&P)!=(P>>>16^65535)){N.msg="invalid stored block lengths",A.mode=30;break}if(A.length=65535&P,U=P=0,A.mode=15,z===6)break t;case 15:A.mode=16;case 16:if(X=A.length){if(D<X&&(X=D),q<X&&(X=q),X===0)break t;s.arraySet(et,K,M,X,rt),D-=X,M+=X,q-=X,rt+=X,A.length-=X;break}A.mode=12;break;case 17:for(;U<14;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(A.nlen=257+(31&P),P>>>=5,U-=5,A.ndist=1+(31&P),P>>>=5,U-=5,A.ncode=4+(15&P),P>>>=4,U-=4,286<A.nlen||30<A.ndist){N.msg="too many length or distance symbols",A.mode=30;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;U<3;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.lens[B[A.have++]]=7&P,P>>>=3,U-=3}for(;A.have<19;)A.lens[B[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,h={bits:A.lenbits},x=c(0,A.lens,0,19,A.lencode,0,A.work,h),A.lenbits=h.bits,x){N.msg="invalid code lengths set",A.mode=30;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;dt=(m=A.lencode[P&(1<<A.lenbits)-1])>>>16&255,Et=65535&m,!((ht=m>>>24)<=U);){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(Et<16)P>>>=ht,U-=ht,A.lens[A.have++]=Et;else{if(Et===16){for(u=ht+2;U<u;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(P>>>=ht,U-=ht,A.have===0){N.msg="invalid bit length repeat",A.mode=30;break}v=A.lens[A.have-1],X=3+(3&P),P>>>=2,U-=2}else if(Et===17){for(u=ht+3;U<u;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}U-=ht,v=0,X=3+(7&(P>>>=ht)),P>>>=3,U-=3}else{for(u=ht+7;U<u;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}U-=ht,v=0,X=11+(127&(P>>>=ht)),P>>>=7,U-=7}if(A.have+X>A.nlen+A.ndist){N.msg="invalid bit length repeat",A.mode=30;break}for(;X--;)A.lens[A.have++]=v}}if(A.mode===30)break;if(A.lens[256]===0){N.msg="invalid code -- missing end-of-block",A.mode=30;break}if(A.lenbits=9,h={bits:A.lenbits},x=c(f,A.lens,0,A.nlen,A.lencode,0,A.work,h),A.lenbits=h.bits,x){N.msg="invalid literal/lengths set",A.mode=30;break}if(A.distbits=6,A.distcode=A.distdyn,h={bits:A.distbits},x=c(d,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,h),A.distbits=h.bits,x){N.msg="invalid distances set",A.mode=30;break}if(A.mode=20,z===6)break t;case 20:A.mode=21;case 21:if(6<=D&&258<=q){N.next_out=rt,N.avail_out=q,N.next_in=M,N.avail_in=D,A.hold=P,A.bits=U,l(N,J),rt=N.next_out,et=N.output,q=N.avail_out,M=N.next_in,K=N.input,D=N.avail_in,P=A.hold,U=A.bits,A.mode===12&&(A.back=-1);break}for(A.back=0;dt=(m=A.lencode[P&(1<<A.lenbits)-1])>>>16&255,Et=65535&m,!((ht=m>>>24)<=U);){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(dt&&!(240&dt)){for(wt=ht,kt=dt,Ft=Et;dt=(m=A.lencode[Ft+((P&(1<<wt+kt)-1)>>wt)])>>>16&255,Et=65535&m,!(wt+(ht=m>>>24)<=U);){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}P>>>=wt,U-=wt,A.back+=wt}if(P>>>=ht,U-=ht,A.back+=ht,A.length=Et,dt===0){A.mode=26;break}if(32&dt){A.back=-1,A.mode=12;break}if(64&dt){N.msg="invalid literal/length code",A.mode=30;break}A.extra=15&dt,A.mode=22;case 22:if(A.extra){for(u=A.extra;U<u;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.length+=P&(1<<A.extra)-1,P>>>=A.extra,U-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;dt=(m=A.distcode[P&(1<<A.distbits)-1])>>>16&255,Et=65535&m,!((ht=m>>>24)<=U);){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(!(240&dt)){for(wt=ht,kt=dt,Ft=Et;dt=(m=A.distcode[Ft+((P&(1<<wt+kt)-1)>>wt)])>>>16&255,Et=65535&m,!(wt+(ht=m>>>24)<=U);){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}P>>>=wt,U-=wt,A.back+=wt}if(P>>>=ht,U-=ht,A.back+=ht,64&dt){N.msg="invalid distance code",A.mode=30;break}A.offset=Et,A.extra=15&dt,A.mode=24;case 24:if(A.extra){for(u=A.extra;U<u;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}A.offset+=P&(1<<A.extra)-1,P>>>=A.extra,U-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){N.msg="invalid distance too far back",A.mode=30;break}A.mode=25;case 25:if(q===0)break t;if(X=J-q,A.offset>X){if((X=A.offset-X)>A.whave&&A.sane){N.msg="invalid distance too far back",A.mode=30;break}At=X>A.wnext?(X-=A.wnext,A.wsize-X):A.wnext-X,X>A.length&&(X=A.length),It=A.window}else It=et,At=rt-A.offset,X=A.length;for(q<X&&(X=q),q-=X,A.length-=X;et[rt++]=It[At++],--X;);A.length===0&&(A.mode=21);break;case 26:if(q===0)break t;et[rt++]=A.length,q--,A.mode=21;break;case 27:if(A.wrap){for(;U<32;){if(D===0)break t;D--,P|=K[M++]<<U,U+=8}if(J-=q,N.total_out+=J,A.total+=J,J&&(N.adler=A.check=A.flags?a(A.check,et,J,rt-J):o(A.check,et,J,rt-J)),J=q,(A.flags?P:w(P))!==A.check){N.msg="incorrect data check",A.mode=30;break}U=P=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;U<32;){if(D===0)break t;D--,P+=K[M++]<<U,U+=8}if(P!==(4294967295&A.total)){N.msg="incorrect length check",A.mode=30;break}U=P=0}A.mode=29;case 29:x=1;break t;case 30:x=-3;break t;case 31:return-4;case 32:default:return g}return N.next_out=rt,N.avail_out=q,N.next_in=M,N.avail_in=D,A.hold=P,A.bits=U,(A.wsize||J!==N.avail_out&&A.mode<30&&(A.mode<27||z!==4))&&Y(N,N.output,N.next_out,J-N.avail_out)?(A.mode=31,-4):(it-=N.avail_in,J-=N.avail_out,N.total_in+=it,N.total_out+=J,A.total+=J,A.wrap&&J&&(N.adler=A.check=A.flags?a(A.check,et,J,N.next_out-J):o(A.check,et,J,N.next_out-J)),N.data_type=A.bits+(A.last?64:0)+(A.mode===12?128:0)+(A.mode===20||A.mode===15?256:0),(it==0&&J===0||z===4)&&x===p&&(x=-5),x)},i.inflateEnd=function(N){if(!N||!N.state)return g;var z=N.state;return z.window&&(z.window=null),N.state=null,p},i.inflateGetHeader=function(N,z){var A;return N&&N.state&&2&(A=N.state).wrap?((A.head=z).done=!1,p):g},i.inflateSetDictionary=function(N,z){var A,K=z.length;return N&&N.state?(A=N.state).wrap!==0&&A.mode!==11?g:A.mode===11&&o(1,z,K,0)!==A.check?-3:Y(N,z,K,K)?(A.mode=31,-4):(A.havedict=1,p):g},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,d,p,g,b,y,_,w){var E,S,I,C,O,T,G,L,j,Y=w.bits,N=0,z=0,A=0,K=0,et=0,M=0,rt=0,D=0,q=0,P=0,U=null,it=0,J=new s.Buf16(16),X=new s.Buf16(16),At=null,It=0;for(N=0;N<=15;N++)J[N]=0;for(z=0;z<g;z++)J[d[p+z]]++;for(et=Y,K=15;1<=K&&J[K]===0;K--);if(K<et&&(et=K),K===0)return b[y++]=20971520,b[y++]=20971520,w.bits=1,0;for(A=1;A<K&&J[A]===0;A++);for(et<A&&(et=A),N=D=1;N<=15;N++)if(D<<=1,(D-=J[N])<0)return-1;if(0<D&&(f===0||K!==1))return-1;for(X[1]=0,N=1;N<15;N++)X[N+1]=X[N]+J[N];for(z=0;z<g;z++)d[p+z]!==0&&(_[X[d[p+z]]++]=z);if(T=f===0?(U=At=_,19):f===1?(U=o,it-=257,At=a,It-=257,256):(U=l,At=c,-1),N=A,O=y,rt=z=P=0,I=-1,C=(q=1<<(M=et))-1,f===1&&852<q||f===2&&592<q)return 1;for(;;){for(G=N-rt,j=_[z]<T?(L=0,_[z]):_[z]>T?(L=At[It+_[z]],U[it+_[z]]):(L=96,0),E=1<<N-rt,A=S=1<<M;b[O+(P>>rt)+(S-=E)]=G<<24|L<<16|j|0,S!==0;);for(E=1<<N-1;P&E;)E>>=1;if(E!==0?(P&=E-1,P+=E):P=0,z++,--J[N]==0){if(N===K)break;N=d[p+_[z]]}if(et<N&&(P&C)!==I){for(rt===0&&(rt=et),O+=A,D=1<<(M=N-rt);M+rt<K&&!((D-=J[M+rt])<=0);)M++,D<<=1;if(q+=1<<M,f===1&&852<q||f===2&&592<q)return 1;b[I=P&C]=et<<24|M<<16|O-y|0}}return P!==0&&(b[O+P]=N-rt<<24|64<<16|0),w.bits=et,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function l(m){for(var k=m.length;0<=--k;)m[k]=0}var c=0,f=29,d=256,p=d+1+f,g=30,b=19,y=2*p+1,_=15,w=16,E=7,S=256,I=16,C=17,O=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(p+2));l(Y);var N=new Array(2*g);l(N);var z=new Array(512);l(z);var A=new Array(256);l(A);var K=new Array(f);l(K);var et,M,rt,D=new Array(g);function q(m,k,B,R,F){this.static_tree=m,this.extra_bits=k,this.extra_base=B,this.elems=R,this.max_length=F,this.has_stree=m&&m.length}function P(m,k){this.dyn_tree=m,this.max_code=0,this.stat_desc=k}function U(m){return m<256?z[m]:z[256+(m>>>7)]}function it(m,k){m.pending_buf[m.pending++]=255&k,m.pending_buf[m.pending++]=k>>>8&255}function J(m,k,B){m.bi_valid>w-B?(m.bi_buf|=k<<m.bi_valid&65535,it(m,m.bi_buf),m.bi_buf=k>>w-m.bi_valid,m.bi_valid+=B-w):(m.bi_buf|=k<<m.bi_valid&65535,m.bi_valid+=B)}function X(m,k,B){J(m,B[2*k],B[2*k+1])}function At(m,k){for(var B=0;B|=1&m,m>>>=1,B<<=1,0<--k;);return B>>>1}function It(m,k,B){var R,F,W=new Array(_+1),Q=0;for(R=1;R<=_;R++)W[R]=Q=Q+B[R-1]<<1;for(F=0;F<=k;F++){var V=m[2*F+1];V!==0&&(m[2*F]=At(W[V]++,V))}}function ht(m){var k;for(k=0;k<p;k++)m.dyn_ltree[2*k]=0;for(k=0;k<g;k++)m.dyn_dtree[2*k]=0;for(k=0;k<b;k++)m.bl_tree[2*k]=0;m.dyn_ltree[2*S]=1,m.opt_len=m.static_len=0,m.last_lit=m.matches=0}function dt(m){8<m.bi_valid?it(m,m.bi_buf):0<m.bi_valid&&(m.pending_buf[m.pending++]=m.bi_buf),m.bi_buf=0,m.bi_valid=0}function Et(m,k,B,R){var F=2*k,W=2*B;return m[F]<m[W]||m[F]===m[W]&&R[k]<=R[B]}function wt(m,k,B){for(var R=m.heap[B],F=B<<1;F<=m.heap_len&&(F<m.heap_len&&Et(k,m.heap[F+1],m.heap[F],m.depth)&&F++,!Et(k,R,m.heap[F],m.depth));)m.heap[B]=m.heap[F],B=F,F<<=1;m.heap[B]=R}function kt(m,k,B){var R,F,W,Q,V=0;if(m.last_lit!==0)for(;R=m.pending_buf[m.d_buf+2*V]<<8|m.pending_buf[m.d_buf+2*V+1],F=m.pending_buf[m.l_buf+V],V++,R===0?X(m,F,k):(X(m,(W=A[F])+d+1,k),(Q=T[W])!==0&&J(m,F-=K[W],Q),X(m,W=U(--R),B),(Q=G[W])!==0&&J(m,R-=D[W],Q)),V<m.last_lit;);X(m,S,k)}function Ft(m,k){var B,R,F,W=k.dyn_tree,Q=k.stat_desc.static_tree,V=k.stat_desc.has_stree,H=k.stat_desc.elems,pt=-1;for(m.heap_len=0,m.heap_max=y,B=0;B<H;B++)W[2*B]!==0?(m.heap[++m.heap_len]=pt=B,m.depth[B]=0):W[2*B+1]=0;for(;m.heap_len<2;)W[2*(F=m.heap[++m.heap_len]=pt<2?++pt:0)]=1,m.depth[F]=0,m.opt_len--,V&&(m.static_len-=Q[2*F+1]);for(k.max_code=pt,B=m.heap_len>>1;1<=B;B--)wt(m,W,B);for(F=H;B=m.heap[1],m.heap[1]=m.heap[m.heap_len--],wt(m,W,1),R=m.heap[1],m.heap[--m.heap_max]=B,m.heap[--m.heap_max]=R,W[2*F]=W[2*B]+W[2*R],m.depth[F]=(m.depth[B]>=m.depth[R]?m.depth[B]:m.depth[R])+1,W[2*B+1]=W[2*R+1]=F,m.heap[1]=F++,wt(m,W,1),2<=m.heap_len;);m.heap[--m.heap_max]=m.heap[1],function(ft,Pt){var ur,Xt,cr,St,Xr,Zn,re=Pt.dyn_tree,Is=Pt.max_code,el=Pt.stat_desc.static_tree,rl=Pt.stat_desc.has_stree,nl=Pt.stat_desc.extra_bits,Cs=Pt.stat_desc.extra_base,fr=Pt.stat_desc.max_length,Hr=0;for(St=0;St<=_;St++)ft.bl_count[St]=0;for(re[2*ft.heap[ft.heap_max]+1]=0,ur=ft.heap_max+1;ur<y;ur++)fr<(St=re[2*re[2*(Xt=ft.heap[ur])+1]+1]+1)&&(St=fr,Hr++),re[2*Xt+1]=St,Is<Xt||(ft.bl_count[St]++,Xr=0,Cs<=Xt&&(Xr=nl[Xt-Cs]),Zn=re[2*Xt],ft.opt_len+=Zn*(St+Xr),rl&&(ft.static_len+=Zn*(el[2*Xt+1]+Xr)));if(Hr!==0){do{for(St=fr-1;ft.bl_count[St]===0;)St--;ft.bl_count[St]--,ft.bl_count[St+1]+=2,ft.bl_count[fr]--,Hr-=2}while(0<Hr);for(St=fr;St!==0;St--)for(Xt=ft.bl_count[St];Xt!==0;)Is<(cr=ft.heap[--ur])||(re[2*cr+1]!==St&&(ft.opt_len+=(St-re[2*cr+1])*re[2*cr],re[2*cr+1]=St),Xt--)}}(m,k),It(W,pt,m.bl_count)}function v(m,k,B){var R,F,W=-1,Q=k[1],V=0,H=7,pt=4;for(Q===0&&(H=138,pt=3),k[2*(B+1)+1]=65535,R=0;R<=B;R++)F=Q,Q=k[2*(R+1)+1],++V<H&&F===Q||(V<pt?m.bl_tree[2*F]+=V:F!==0?(F!==W&&m.bl_tree[2*F]++,m.bl_tree[2*I]++):V<=10?m.bl_tree[2*C]++:m.bl_tree[2*O]++,W=F,pt=(V=0)===Q?(H=138,3):F===Q?(H=6,3):(H=7,4))}function x(m,k,B){var R,F,W=-1,Q=k[1],V=0,H=7,pt=4;for(Q===0&&(H=138,pt=3),R=0;R<=B;R++)if(F=Q,Q=k[2*(R+1)+1],!(++V<H&&F===Q)){if(V<pt)for(;X(m,F,m.bl_tree),--V!=0;);else F!==0?(F!==W&&(X(m,F,m.bl_tree),V--),X(m,I,m.bl_tree),J(m,V-3,2)):V<=10?(X(m,C,m.bl_tree),J(m,V-3,3)):(X(m,O,m.bl_tree),J(m,V-11,7));W=F,pt=(V=0)===Q?(H=138,3):F===Q?(H=6,3):(H=7,4)}}l(D);var h=!1;function u(m,k,B,R){J(m,(c<<1)+(R?1:0),3),function(F,W,Q,V){dt(F),V&&(it(F,Q),it(F,~Q)),s.arraySet(F.pending_buf,F.window,W,Q,F.pending),F.pending+=Q}(m,k,B,!0)}i._tr_init=function(m){h||(function(){var k,B,R,F,W,Q=new Array(_+1);for(F=R=0;F<f-1;F++)for(K[F]=R,k=0;k<1<<T[F];k++)A[R++]=F;for(A[R-1]=F,F=W=0;F<16;F++)for(D[F]=W,k=0;k<1<<G[F];k++)z[W++]=F;for(W>>=7;F<g;F++)for(D[F]=W<<7,k=0;k<1<<G[F]-7;k++)z[256+W++]=F;for(B=0;B<=_;B++)Q[B]=0;for(k=0;k<=143;)Y[2*k+1]=8,k++,Q[8]++;for(;k<=255;)Y[2*k+1]=9,k++,Q[9]++;for(;k<=279;)Y[2*k+1]=7,k++,Q[7]++;for(;k<=287;)Y[2*k+1]=8,k++,Q[8]++;for(It(Y,p+1,Q),k=0;k<g;k++)N[2*k+1]=5,N[2*k]=At(k,5);et=new q(Y,T,d+1,p,_),M=new q(N,G,0,g,_),rt=new q(new Array(0),L,0,b,E)}(),h=!0),m.l_desc=new P(m.dyn_ltree,et),m.d_desc=new P(m.dyn_dtree,M),m.bl_desc=new P(m.bl_tree,rt),m.bi_buf=0,m.bi_valid=0,ht(m)},i._tr_stored_block=u,i._tr_flush_block=function(m,k,B,R){var F,W,Q=0;0<m.level?(m.strm.data_type===2&&(m.strm.data_type=function(V){var H,pt=4093624447;for(H=0;H<=31;H++,pt>>>=1)if(1&pt&&V.dyn_ltree[2*H]!==0)return o;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return a;for(H=32;H<d;H++)if(V.dyn_ltree[2*H]!==0)return a;return o}(m)),Ft(m,m.l_desc),Ft(m,m.d_desc),Q=function(V){var H;for(v(V,V.dyn_ltree,V.l_desc.max_code),v(V,V.dyn_dtree,V.d_desc.max_code),Ft(V,V.bl_desc),H=b-1;3<=H&&V.bl_tree[2*j[H]+1]===0;H--);return V.opt_len+=3*(H+1)+5+5+4,H}(m),F=m.opt_len+3+7>>>3,(W=m.static_len+3+7>>>3)<=F&&(F=W)):F=W=B+5,B+4<=F&&k!==-1?u(m,k,B,R):m.strategy===4||W===F?(J(m,2+(R?1:0),3),kt(m,Y,N)):(J(m,4+(R?1:0),3),function(V,H,pt,ft){var Pt;for(J(V,H-257,5),J(V,pt-1,5),J(V,ft-4,4),Pt=0;Pt<ft;Pt++)J(V,V.bl_tree[2*j[Pt]+1],3);x(V,V.dyn_ltree,H-1),x(V,V.dyn_dtree,pt-1)}(m,m.l_desc.max_code+1,m.d_desc.max_code+1,Q+1),kt(m,m.dyn_ltree,m.dyn_dtree)),ht(m),R&&dt(m)},i._tr_tally=function(m,k,B){return m.pending_buf[m.d_buf+2*m.last_lit]=k>>>8&255,m.pending_buf[m.d_buf+2*m.last_lit+1]=255&k,m.pending_buf[m.l_buf+m.last_lit]=255&B,m.last_lit++,k===0?m.dyn_ltree[2*B]++:(m.matches++,k--,m.dyn_ltree[2*(A[B]+d+1)]++,m.dyn_dtree[2*U(k)]++),m.last_lit===m.lit_bufsize-1},i._tr_align=function(m){J(m,2,3),X(m,S,Y),function(k){k.bi_valid===16?(it(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):8<=k.bi_valid&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)}(m)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var l,c,f,d,p=1,g={},b=!1,y=o.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(o);_=_&&_.setTimeout?_:o,l={}.toString.call(o.process)==="[object process]"?function(I){process.nextTick(function(){E(I)})}:function(){if(o.postMessage&&!o.importScripts){var I=!0,C=o.onmessage;return o.onmessage=function(){I=!1},o.postMessage("","*"),o.onmessage=C,I}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",S,!1):o.attachEvent("onmessage",S),function(I){o.postMessage(d+I,"*")}):o.MessageChannel?((f=new MessageChannel).port1.onmessage=function(I){E(I.data)},function(I){f.port2.postMessage(I)}):y&&"onreadystatechange"in y.createElement("script")?(c=y.documentElement,function(I){var C=y.createElement("script");C.onreadystatechange=function(){E(I),C.onreadystatechange=null,c.removeChild(C),C=null},c.appendChild(C)}):function(I){setTimeout(E,0,I)},_.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var C=new Array(arguments.length-1),O=0;O<C.length;O++)C[O]=arguments[O+1];var T={callback:I,args:C};return g[p]=T,l(p),p++},_.clearImmediate=w}function w(I){delete g[I]}function E(I){if(b)setTimeout(E,0,I);else{var C=g[I];if(C){b=!0;try{(function(O){var T=O.callback,G=O.args;switch(G.length){case 0:T();break;case 1:T(G[0]);break;case 2:T(G[0],G[1]);break;case 3:T(G[0],G[1],G[2]);break;default:T.apply(a,G)}})(C)}finally{w(I),b=!1}}}}function S(I){I.source===o&&typeof I.data=="string"&&I.data.indexOf(d)===0&&E(+I.data.slice(d.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Jr<"u"?Jr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Po);var dl=Po.exports;const pl=ol(dl);function gl(e,t){return t={exports:{}},e(t,t.exports),t.exports}var ml=_l,yl=xl,wl=Sl,te=[],Vt=[],vl=typeof Uint8Array<"u"?Uint8Array:Array,Qn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ke=0,bl=Qn.length;Ke<bl;++Ke)te[Ke]=Qn[Ke],Vt[Qn.charCodeAt(Ke)]=Ke;Vt["-".charCodeAt(0)]=62;Vt["_".charCodeAt(0)]=63;function Uo(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function _l(e){var t=Uo(e),r=t[0],n=t[1];return(r+n)*3/4-n}function Al(e,t,r){return(t+r)*3/4-r}function xl(e){var t,r=Uo(e),n=r[0],i=r[1],s=new vl(Al(e,n,i)),o=0,a=i>0?n-4:n,l;for(l=0;l<a;l+=4)t=Vt[e.charCodeAt(l)]<<18|Vt[e.charCodeAt(l+1)]<<12|Vt[e.charCodeAt(l+2)]<<6|Vt[e.charCodeAt(l+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=Vt[e.charCodeAt(l)]<<2|Vt[e.charCodeAt(l+1)]>>4,s[o++]=t&255),i===1&&(t=Vt[e.charCodeAt(l)]<<10|Vt[e.charCodeAt(l+1)]<<4|Vt[e.charCodeAt(l+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function El(e){return te[e>>18&63]+te[e>>12&63]+te[e>>6&63]+te[e&63]}function kl(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(El(n));return i.join("")}function Sl(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(kl(e,o,o+s>a?a:o+s));return n===1?(t=e[r-1],i.push(te[t>>2]+te[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(te[t>>10]+te[t>>4&63]+te[t<<2&63]+"=")),i.join("")}var qn={byteLength:ml,toByteArray:yl,fromByteArray:wl};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Il=function(t,r,n,i,s){var o,a,l=s*8-i-1,c=(1<<l)-1,f=c>>1,d=-7,p=n?s-1:0,g=n?-1:1,b=t[r+p];for(p+=g,o=b&(1<<-d)-1,b>>=-d,d+=l;d>0;o=o*256+t[r+p],p+=g,d-=8);for(a=o&(1<<-d)-1,o>>=-d,d+=i;d>0;a=a*256+t[r+p],p+=g,d-=8);if(o===0)o=1-f;else{if(o===c)return a?NaN:(b?-1:1)*(1/0);a=a+Math.pow(2,i),o=o-f}return(b?-1:1)*a*Math.pow(2,o-i)},Cl=function(t,r,n,i,s,o){var a,l,c,f=o*8-s-1,d=(1<<f)-1,p=d>>1,g=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=i?0:o-1,y=i?1:-1,_=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,a=d):(a=Math.floor(Math.log(r)/Math.LN2),r*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+p>=1?r+=g/c:r+=g*Math.pow(2,1-p),r*c>=2&&(a++,c/=2),a+p>=d?(l=0,a=d):a+p>=1?(l=(r*c-1)*Math.pow(2,s),a=a+p):(l=r*Math.pow(2,p-1)*Math.pow(2,s),a=0));s>=8;t[n+b]=l&255,b+=y,l/=256,s-=8);for(a=a<<s|l,f+=s;f>0;t[n+b]=a&255,b+=y,a/=256,f-=8);t[n+b-y]|=_*128},je={read:Il,write:Cl},Pn=gl(function(e,t){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=o,t.SlowBuffer=w,t.INSPECT_MAX_BYTES=50;var n=2147483647;t.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=i(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{var x=new Uint8Array(1),h={foo:function(){return 42}};return Object.setPrototypeOf(h,Uint8Array.prototype),Object.setPrototypeOf(x,h),x.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function s(x){if(x>n)throw new RangeError('The value "'+x+'" is invalid for option "size"');var h=new Uint8Array(x);return Object.setPrototypeOf(h,o.prototype),h}function o(x,h,u){if(typeof x=="number"){if(typeof h=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(x)}return a(x,h,u)}o.poolSize=8192;function a(x,h,u){if(typeof x=="string")return d(x,h);if(ArrayBuffer.isView(x))return g(x);if(x==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(x));if(kt(x,ArrayBuffer)||x&&kt(x.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(kt(x,SharedArrayBuffer)||x&&kt(x.buffer,SharedArrayBuffer)))return b(x,h,u);if(typeof x=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var m=x.valueOf&&x.valueOf();if(m!=null&&m!==x)return o.from(m,h,u);var k=y(x);if(k)return k;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof x[Symbol.toPrimitive]=="function")return o.from(x[Symbol.toPrimitive]("string"),h,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(x))}o.from=function(x,h,u){return a(x,h,u)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function l(x){if(typeof x!="number")throw new TypeError('"size" argument must be of type number');if(x<0)throw new RangeError('The value "'+x+'" is invalid for option "size"')}function c(x,h,u){return l(x),x<=0?s(x):h!==void 0?typeof u=="string"?s(x).fill(h,u):s(x).fill(h):s(x)}o.alloc=function(x,h,u){return c(x,h,u)};function f(x){return l(x),s(x<0?0:_(x)|0)}o.allocUnsafe=function(x){return f(x)},o.allocUnsafeSlow=function(x){return f(x)};function d(x,h){if((typeof h!="string"||h==="")&&(h="utf8"),!o.isEncoding(h))throw new TypeError("Unknown encoding: "+h);var u=E(x,h)|0,m=s(u),k=m.write(x,h);return k!==u&&(m=m.slice(0,k)),m}function p(x){for(var h=x.length<0?0:_(x.length)|0,u=s(h),m=0;m<h;m+=1)u[m]=x[m]&255;return u}function g(x){if(kt(x,Uint8Array)){var h=new Uint8Array(x);return b(h.buffer,h.byteOffset,h.byteLength)}return p(x)}function b(x,h,u){if(h<0||x.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(x.byteLength<h+(u||0))throw new RangeError('"length" is outside of buffer bounds');var m;return h===void 0&&u===void 0?m=new Uint8Array(x):u===void 0?m=new Uint8Array(x,h):m=new Uint8Array(x,h,u),Object.setPrototypeOf(m,o.prototype),m}function y(x){if(o.isBuffer(x)){var h=_(x.length)|0,u=s(h);return u.length===0||x.copy(u,0,0,h),u}if(x.length!==void 0)return typeof x.length!="number"||Ft(x.length)?s(0):p(x);if(x.type==="Buffer"&&Array.isArray(x.data))return p(x.data)}function _(x){if(x>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return x|0}function w(x){return+x!=x&&(x=0),o.alloc(+x)}o.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==o.prototype},o.compare=function(h,u){if(kt(h,Uint8Array)&&(h=o.from(h,h.offset,h.byteLength)),kt(u,Uint8Array)&&(u=o.from(u,u.offset,u.byteLength)),!o.isBuffer(h)||!o.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===u)return 0;for(var m=h.length,k=u.length,B=0,R=Math.min(m,k);B<R;++B)if(h[B]!==u[B]){m=h[B],k=u[B];break}return m<k?-1:k<m?1:0},o.isEncoding=function(h){switch(String(h).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(h,u){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return o.alloc(0);var m;if(u===void 0)for(u=0,m=0;m<h.length;++m)u+=h[m].length;var k=o.allocUnsafe(u),B=0;for(m=0;m<h.length;++m){var R=h[m];if(kt(R,Uint8Array))B+R.length>k.length?o.from(R).copy(k,B):Uint8Array.prototype.set.call(k,R,B);else if(o.isBuffer(R))R.copy(k,B);else throw new TypeError('"list" argument must be an Array of Buffers');B+=R.length}return k};function E(x,h){if(o.isBuffer(x))return x.length;if(ArrayBuffer.isView(x)||kt(x,ArrayBuffer))return x.byteLength;if(typeof x!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(x));var u=x.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&u===0)return 0;for(var k=!1;;)switch(h){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return It(x).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Et(x).length;default:if(k)return m?-1:It(x).length;h=(""+h).toLowerCase(),k=!0}}o.byteLength=E;function S(x,h,u){var m=!1;if((h===void 0||h<0)&&(h=0),h>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,h>>>=0,u<=h))return"";for(x||(x="utf8");;)switch(x){case"hex":return rt(this,h,u);case"utf8":case"utf-8":return z(this,h,u);case"ascii":return et(this,h,u);case"latin1":case"binary":return M(this,h,u);case"base64":return N(this,h,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,h,u);default:if(m)throw new TypeError("Unknown encoding: "+x);x=(x+"").toLowerCase(),m=!0}}o.prototype._isBuffer=!0;function I(x,h,u){var m=x[h];x[h]=x[u],x[u]=m}o.prototype.swap16=function(){var h=this.length;if(h%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var u=0;u<h;u+=2)I(this,u,u+1);return this},o.prototype.swap32=function(){var h=this.length;if(h%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var u=0;u<h;u+=4)I(this,u,u+3),I(this,u+1,u+2);return this},o.prototype.swap64=function(){var h=this.length;if(h%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var u=0;u<h;u+=8)I(this,u,u+7),I(this,u+1,u+6),I(this,u+2,u+5),I(this,u+3,u+4);return this},o.prototype.toString=function(){var h=this.length;return h===0?"":arguments.length===0?z(this,0,h):S.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(h){if(!o.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h?!0:o.compare(this,h)===0},o.prototype.inspect=function(){var h="",u=t.INSPECT_MAX_BYTES;return h=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(h+=" ... "),"<Buffer "+h+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(h,u,m,k,B){if(kt(h,Uint8Array)&&(h=o.from(h,h.offset,h.byteLength)),!o.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(h));if(u===void 0&&(u=0),m===void 0&&(m=h?h.length:0),k===void 0&&(k=0),B===void 0&&(B=this.length),u<0||m>h.length||k<0||B>this.length)throw new RangeError("out of range index");if(k>=B&&u>=m)return 0;if(k>=B)return-1;if(u>=m)return 1;if(u>>>=0,m>>>=0,k>>>=0,B>>>=0,this===h)return 0;for(var R=B-k,F=m-u,W=Math.min(R,F),Q=this.slice(k,B),V=h.slice(u,m),H=0;H<W;++H)if(Q[H]!==V[H]){R=Q[H],F=V[H];break}return R<F?-1:F<R?1:0};function C(x,h,u,m,k){if(x.length===0)return-1;if(typeof u=="string"?(m=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,Ft(u)&&(u=k?0:x.length-1),u<0&&(u=x.length+u),u>=x.length){if(k)return-1;u=x.length-1}else if(u<0)if(k)u=0;else return-1;if(typeof h=="string"&&(h=o.from(h,m)),o.isBuffer(h))return h.length===0?-1:O(x,h,u,m,k);if(typeof h=="number")return h=h&255,typeof Uint8Array.prototype.indexOf=="function"?k?Uint8Array.prototype.indexOf.call(x,h,u):Uint8Array.prototype.lastIndexOf.call(x,h,u):O(x,[h],u,m,k);throw new TypeError("val must be string, number or Buffer")}function O(x,h,u,m,k){var B=1,R=x.length,F=h.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(x.length<2||h.length<2)return-1;B=2,R/=2,F/=2,u/=2}function W(ft,Pt){return B===1?ft[Pt]:ft.readUInt16BE(Pt*B)}var Q;if(k){var V=-1;for(Q=u;Q<R;Q++)if(W(x,Q)===W(h,V===-1?0:Q-V)){if(V===-1&&(V=Q),Q-V+1===F)return V*B}else V!==-1&&(Q-=Q-V),V=-1}else for(u+F>R&&(u=R-F),Q=u;Q>=0;Q--){for(var H=!0,pt=0;pt<F;pt++)if(W(x,Q+pt)!==W(h,pt)){H=!1;break}if(H)return Q}return-1}o.prototype.includes=function(h,u,m){return this.indexOf(h,u,m)!==-1},o.prototype.indexOf=function(h,u,m){return C(this,h,u,m,!0)},o.prototype.lastIndexOf=function(h,u,m){return C(this,h,u,m,!1)};function T(x,h,u,m){u=Number(u)||0;var k=x.length-u;m?(m=Number(m),m>k&&(m=k)):m=k;var B=h.length;m>B/2&&(m=B/2);for(var R=0;R<m;++R){var F=parseInt(h.substr(R*2,2),16);if(Ft(F))return R;x[u+R]=F}return R}function G(x,h,u,m){return wt(It(h,x.length-u),x,u,m)}function L(x,h,u,m){return wt(ht(h),x,u,m)}function j(x,h,u,m){return wt(Et(h),x,u,m)}function Y(x,h,u,m){return wt(dt(h,x.length-u),x,u,m)}o.prototype.write=function(h,u,m,k){if(u===void 0)k="utf8",m=this.length,u=0;else if(m===void 0&&typeof u=="string")k=u,m=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(m)?(m=m>>>0,k===void 0&&(k="utf8")):(k=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var B=this.length-u;if((m===void 0||m>B)&&(m=B),h.length>0&&(m<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");for(var R=!1;;)switch(k){case"hex":return T(this,h,u,m);case"utf8":case"utf-8":return G(this,h,u,m);case"ascii":case"latin1":case"binary":return L(this,h,u,m);case"base64":return j(this,h,u,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,h,u,m);default:if(R)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),R=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(x,h,u){return h===0&&u===x.length?qn.fromByteArray(x):qn.fromByteArray(x.slice(h,u))}function z(x,h,u){u=Math.min(x.length,u);for(var m=[],k=h;k<u;){var B=x[k],R=null,F=B>239?4:B>223?3:B>191?2:1;if(k+F<=u){var W,Q,V,H;switch(F){case 1:B<128&&(R=B);break;case 2:W=x[k+1],(W&192)===128&&(H=(B&31)<<6|W&63,H>127&&(R=H));break;case 3:W=x[k+1],Q=x[k+2],(W&192)===128&&(Q&192)===128&&(H=(B&15)<<12|(W&63)<<6|Q&63,H>2047&&(H<55296||H>57343)&&(R=H));break;case 4:W=x[k+1],Q=x[k+2],V=x[k+3],(W&192)===128&&(Q&192)===128&&(V&192)===128&&(H=(B&15)<<18|(W&63)<<12|(Q&63)<<6|V&63,H>65535&&H<1114112&&(R=H))}}R===null?(R=65533,F=1):R>65535&&(R-=65536,m.push(R>>>10&1023|55296),R=56320|R&1023),m.push(R),k+=F}return K(m)}var A=4096;function K(x){var h=x.length;if(h<=A)return String.fromCharCode.apply(String,x);for(var u="",m=0;m<h;)u+=String.fromCharCode.apply(String,x.slice(m,m+=A));return u}function et(x,h,u){var m="";u=Math.min(x.length,u);for(var k=h;k<u;++k)m+=String.fromCharCode(x[k]&127);return m}function M(x,h,u){var m="";u=Math.min(x.length,u);for(var k=h;k<u;++k)m+=String.fromCharCode(x[k]);return m}function rt(x,h,u){var m=x.length;(!h||h<0)&&(h=0),(!u||u<0||u>m)&&(u=m);for(var k="",B=h;B<u;++B)k+=v[x[B]];return k}function D(x,h,u){for(var m=x.slice(h,u),k="",B=0;B<m.length-1;B+=2)k+=String.fromCharCode(m[B]+m[B+1]*256);return k}o.prototype.slice=function(h,u){var m=this.length;h=~~h,u=u===void 0?m:~~u,h<0?(h+=m,h<0&&(h=0)):h>m&&(h=m),u<0?(u+=m,u<0&&(u=0)):u>m&&(u=m),u<h&&(u=h);var k=this.subarray(h,u);return Object.setPrototypeOf(k,o.prototype),k};function q(x,h,u){if(x%1!==0||x<0)throw new RangeError("offset is not uint");if(x+h>u)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(h,u,m){h=h>>>0,u=u>>>0,m||q(h,u,this.length);for(var k=this[h],B=1,R=0;++R<u&&(B*=256);)k+=this[h+R]*B;return k},o.prototype.readUintBE=o.prototype.readUIntBE=function(h,u,m){h=h>>>0,u=u>>>0,m||q(h,u,this.length);for(var k=this[h+--u],B=1;u>0&&(B*=256);)k+=this[h+--u]*B;return k},o.prototype.readUint8=o.prototype.readUInt8=function(h,u){return h=h>>>0,u||q(h,1,this.length),this[h]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(h,u){return h=h>>>0,u||q(h,2,this.length),this[h]|this[h+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(h,u){return h=h>>>0,u||q(h,2,this.length),this[h]<<8|this[h+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(h,u){return h=h>>>0,u||q(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+this[h+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(h,u){return h=h>>>0,u||q(h,4,this.length),this[h]*16777216+(this[h+1]<<16|this[h+2]<<8|this[h+3])},o.prototype.readIntLE=function(h,u,m){h=h>>>0,u=u>>>0,m||q(h,u,this.length);for(var k=this[h],B=1,R=0;++R<u&&(B*=256);)k+=this[h+R]*B;return B*=128,k>=B&&(k-=Math.pow(2,8*u)),k},o.prototype.readIntBE=function(h,u,m){h=h>>>0,u=u>>>0,m||q(h,u,this.length);for(var k=u,B=1,R=this[h+--k];k>0&&(B*=256);)R+=this[h+--k]*B;return B*=128,R>=B&&(R-=Math.pow(2,8*u)),R},o.prototype.readInt8=function(h,u){return h=h>>>0,u||q(h,1,this.length),this[h]&128?(255-this[h]+1)*-1:this[h]},o.prototype.readInt16LE=function(h,u){h=h>>>0,u||q(h,2,this.length);var m=this[h]|this[h+1]<<8;return m&32768?m|4294901760:m},o.prototype.readInt16BE=function(h,u){h=h>>>0,u||q(h,2,this.length);var m=this[h+1]|this[h]<<8;return m&32768?m|4294901760:m},o.prototype.readInt32LE=function(h,u){return h=h>>>0,u||q(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},o.prototype.readInt32BE=function(h,u){return h=h>>>0,u||q(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},o.prototype.readFloatLE=function(h,u){return h=h>>>0,u||q(h,4,this.length),je.read(this,h,!0,23,4)},o.prototype.readFloatBE=function(h,u){return h=h>>>0,u||q(h,4,this.length),je.read(this,h,!1,23,4)},o.prototype.readDoubleLE=function(h,u){return h=h>>>0,u||q(h,8,this.length),je.read(this,h,!0,52,8)},o.prototype.readDoubleBE=function(h,u){return h=h>>>0,u||q(h,8,this.length),je.read(this,h,!1,52,8)};function P(x,h,u,m,k,B){if(!o.isBuffer(x))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>k||h<B)throw new RangeError('"value" argument is out of bounds');if(u+m>x.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(h,u,m,k){if(h=+h,u=u>>>0,m=m>>>0,!k){var B=Math.pow(2,8*m)-1;P(this,h,u,m,B,0)}var R=1,F=0;for(this[u]=h&255;++F<m&&(R*=256);)this[u+F]=h/R&255;return u+m},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(h,u,m,k){if(h=+h,u=u>>>0,m=m>>>0,!k){var B=Math.pow(2,8*m)-1;P(this,h,u,m,B,0)}var R=m-1,F=1;for(this[u+R]=h&255;--R>=0&&(F*=256);)this[u+R]=h/F&255;return u+m},o.prototype.writeUint8=o.prototype.writeUInt8=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,1,255,0),this[u]=h&255,u+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,2,65535,0),this[u]=h&255,this[u+1]=h>>>8,u+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,2,65535,0),this[u]=h>>>8,this[u+1]=h&255,u+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,4,4294967295,0),this[u+3]=h>>>24,this[u+2]=h>>>16,this[u+1]=h>>>8,this[u]=h&255,u+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,4,4294967295,0),this[u]=h>>>24,this[u+1]=h>>>16,this[u+2]=h>>>8,this[u+3]=h&255,u+4},o.prototype.writeIntLE=function(h,u,m,k){if(h=+h,u=u>>>0,!k){var B=Math.pow(2,8*m-1);P(this,h,u,m,B-1,-B)}var R=0,F=1,W=0;for(this[u]=h&255;++R<m&&(F*=256);)h<0&&W===0&&this[u+R-1]!==0&&(W=1),this[u+R]=(h/F>>0)-W&255;return u+m},o.prototype.writeIntBE=function(h,u,m,k){if(h=+h,u=u>>>0,!k){var B=Math.pow(2,8*m-1);P(this,h,u,m,B-1,-B)}var R=m-1,F=1,W=0;for(this[u+R]=h&255;--R>=0&&(F*=256);)h<0&&W===0&&this[u+R+1]!==0&&(W=1),this[u+R]=(h/F>>0)-W&255;return u+m},o.prototype.writeInt8=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,1,127,-128),h<0&&(h=255+h+1),this[u]=h&255,u+1},o.prototype.writeInt16LE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,2,32767,-32768),this[u]=h&255,this[u+1]=h>>>8,u+2},o.prototype.writeInt16BE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,2,32767,-32768),this[u]=h>>>8,this[u+1]=h&255,u+2},o.prototype.writeInt32LE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,4,2147483647,-2147483648),this[u]=h&255,this[u+1]=h>>>8,this[u+2]=h>>>16,this[u+3]=h>>>24,u+4},o.prototype.writeInt32BE=function(h,u,m){return h=+h,u=u>>>0,m||P(this,h,u,4,2147483647,-2147483648),h<0&&(h=4294967295+h+1),this[u]=h>>>24,this[u+1]=h>>>16,this[u+2]=h>>>8,this[u+3]=h&255,u+4};function U(x,h,u,m,k,B){if(u+m>x.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function it(x,h,u,m,k){return h=+h,u=u>>>0,k||U(x,h,u,4),je.write(x,h,u,m,23,4),u+4}o.prototype.writeFloatLE=function(h,u,m){return it(this,h,u,!0,m)},o.prototype.writeFloatBE=function(h,u,m){return it(this,h,u,!1,m)};function J(x,h,u,m,k){return h=+h,u=u>>>0,k||U(x,h,u,8),je.write(x,h,u,m,52,8),u+8}o.prototype.writeDoubleLE=function(h,u,m){return J(this,h,u,!0,m)},o.prototype.writeDoubleBE=function(h,u,m){return J(this,h,u,!1,m)},o.prototype.copy=function(h,u,m,k){if(!o.isBuffer(h))throw new TypeError("argument should be a Buffer");if(m||(m=0),!k&&k!==0&&(k=this.length),u>=h.length&&(u=h.length),u||(u=0),k>0&&k<m&&(k=m),k===m||h.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),h.length-u<k-m&&(k=h.length-u+m);var B=k-m;return this===h&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,m,k):Uint8Array.prototype.set.call(h,this.subarray(m,k),u),B},o.prototype.fill=function(h,u,m,k){if(typeof h=="string"){if(typeof u=="string"?(k=u,u=0,m=this.length):typeof m=="string"&&(k=m,m=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!o.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(h.length===1){var B=h.charCodeAt(0);(k==="utf8"&&B<128||k==="latin1")&&(h=B)}}else typeof h=="number"?h=h&255:typeof h=="boolean"&&(h=Number(h));if(u<0||this.length<u||this.length<m)throw new RangeError("Out of range index");if(m<=u)return this;u=u>>>0,m=m===void 0?this.length:m>>>0,h||(h=0);var R;if(typeof h=="number")for(R=u;R<m;++R)this[R]=h;else{var F=o.isBuffer(h)?h:o.from(h,k),W=F.length;if(W===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(R=0;R<m-u;++R)this[R+u]=F[R%W]}return this};var X=/[^+/0-9A-Za-z-_]/g;function At(x){if(x=x.split("=")[0],x=x.trim().replace(X,""),x.length<2)return"";for(;x.length%4!==0;)x=x+"=";return x}function It(x,h){h=h||1/0;for(var u,m=x.length,k=null,B=[],R=0;R<m;++R){if(u=x.charCodeAt(R),u>55295&&u<57344){if(!k){if(u>56319){(h-=3)>-1&&B.push(239,191,189);continue}else if(R+1===m){(h-=3)>-1&&B.push(239,191,189);continue}k=u;continue}if(u<56320){(h-=3)>-1&&B.push(239,191,189),k=u;continue}u=(k-55296<<10|u-56320)+65536}else k&&(h-=3)>-1&&B.push(239,191,189);if(k=null,u<128){if((h-=1)<0)break;B.push(u)}else if(u<2048){if((h-=2)<0)break;B.push(u>>6|192,u&63|128)}else if(u<65536){if((h-=3)<0)break;B.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((h-=4)<0)break;B.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return B}function ht(x){for(var h=[],u=0;u<x.length;++u)h.push(x.charCodeAt(u)&255);return h}function dt(x,h){for(var u,m,k,B=[],R=0;R<x.length&&!((h-=2)<0);++R)u=x.charCodeAt(R),m=u>>8,k=u%256,B.push(k),B.push(m);return B}function Et(x){return qn.toByteArray(At(x))}function wt(x,h,u,m){for(var k=0;k<m&&!(k+u>=h.length||k>=x.length);++k)h[k+u]=x[k];return k}function kt(x,h){return x instanceof h||x!=null&&x.constructor!=null&&x.constructor.name!=null&&x.constructor.name===h.name}function Ft(x){return x!==x}var v=function(){for(var x="0123456789abcdef",h=new Array(256),u=0;u<16;++u)for(var m=u*16,k=0;k<16;++k)h[m+k]=x[u]+x[k];return h}()}),gt=Pn.Buffer;Pn.SlowBuffer;Pn.INSPECT_MAX_BYTES;Pn.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var vi=function(t,r){return vi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},vi(t,r)};function Un(e,t){vi(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Te=function(e){Un(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error),xt=function(e){Un(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function en(e){return e&&e.Math==Math&&e}function zo(){return en(typeof globalThis=="object"&&globalThis)||en(typeof window=="object"&&window)||en(typeof self=="object"&&self)||en(typeof global=="object"&&global)||Function("return this")()}function Nl(){var e=zo();return typeof e.navigator=="object"&&e.navigator.product==="ReactNative"}var Ol=function(t){var r=Nl()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var n=gt.alloc(t),i=0;i<t;++i)n[i]=Math.floor(Math.random()*256);return n},Bl=function(){{if(typeof window<"u"){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(gt.alloc(t))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(t){return globalThis.crypto.getRandomValues(gt.alloc(t))}:Ol}},Go=Bl();function Tl(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function $i(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}function Ll(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Rl(e){return Vr(e)&&Object.prototype.toString.call(e)==="[object Date]"}function Vr(e){return typeof e=="object"&&e!==null}function zn(e,t){var r=!1;function n(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return r||(console.warn(t),r=!0),e.apply(this,i)}return n}function kn(e){if(ArrayBuffer.isView(e))return gt.from(e.buffer,e.byteOffset,e.byteLength);if(Tl(e))return gt.from(e);throw new xt("Must use either Buffer or TypedArray")}var Fl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,Mo=function(e){return typeof e=="string"&&Fl.test(e)},bi=function(e){if(!Mo(e))throw new xt('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return gt.from(t,"hex")},Os=function(e,t){return t===void 0&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")},Pl=Math.pow(2,53),Ul=-Math.pow(2,53),Do=4,Le=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(t!=null&&typeof t!="string"&&!ArrayBuffer.isView(t)&&!(t instanceof ArrayBuffer)&&!Array.isArray(t))throw new xt("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??e.BSON_BINARY_SUBTYPE_DEFAULT,t==null?(this.buffer=gt.alloc(e.BUFFER_SIZE),this.position=0):(typeof t=="string"?this.buffer=gt.from(t,"binary"):Array.isArray(t)?this.buffer=gt.from(t):this.buffer=kn(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if(typeof t=="string"&&t.length!==1)throw new xt("only accepts single character String");if(typeof t!="number"&&t.length!==1)throw new xt("only accepts single character Uint8Array or Array");var r;if(typeof t=="string"?r=t.charCodeAt(0):typeof t=="number"?r=t:r=t[0],r<0||r>255)throw new xt("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=gt.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},e.prototype.write=function(t,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+t.length){var n=gt.alloc(this.buffer.length+t.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(t)?(this.buffer.set(kn(t),r),this.position=r+t.byteLength>this.position?r+t.length:this.position):typeof t=="string"&&(this.buffer.write(t,r,t.length,"binary"),this.position=r+t.length>this.position?r+t.length:this.position)},e.prototype.read=function(t,r){return r=r&&r>0?r:this.position,this.buffer.slice(t,t+r)},e.prototype.value=function(t){return t=!!t,t&&this.buffer.length===this.position?this.buffer:t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(t){return this.buffer.toString(t)},e.prototype.toExtendedJSON=function(t){t=t||{};var r=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return t.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new Bs(this.buffer.slice(0,this.position));throw new Te('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,r){r=r||{};var n,i;if("$binary"in t?r.legacy&&typeof t.$binary=="string"&&"$type"in t?(i=t.$type?parseInt(t.$type,16):0,n=gt.from(t.$binary,"base64")):typeof t.$binary!="string"&&(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=gt.from(t.$binary.base64,"base64")):"$uuid"in t&&(i=4,n=bi(t.$uuid)),!n)throw new xt("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return i===Do?new Bs(n):new e(n,i)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.value(!0);return'new Binary(Buffer.from("'.concat(t.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();Object.defineProperty(Le.prototype,"_bsontype",{value:"Binary"});var Yn=16,Bs=function(e){Un(t,e);function t(r){var n=this,i,s;if(r==null)i=t.generate();else if(r instanceof t)i=gt.from(r.buffer),s=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===Yn)i=kn(r);else if(typeof r=="string")i=bi(r);else throw new xt("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return n=e.call(this,i,Do)||this,n.__id=s,n}return Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,t.cacheHexString&&(this.__id=Os(r))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(r){if(r===void 0&&(r=!0),t.cacheHexString&&this.__id)return this.__id;var n=Os(this.id,r);return t.cacheHexString&&(this.__id=n),n},t.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(r){if(!r)return!1;if(r instanceof t)return r.id.equals(this.id);try{return new t(r).id.equals(this.id)}catch{return!1}},t.prototype.toBinary=function(){return new Le(this.id,Le.SUBTYPE_UUID)},t.generate=function(){var r=Go(Yn);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,gt.from(r)},t.isValid=function(r){return r?r instanceof t?!0:typeof r=="string"?Mo(r):$i(r)?r.length!==Yn?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},t.createFromHexString=function(r){var n=bi(r);return new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}(Le),Gn=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.code=t,this.scope=r}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toJSON();return'new Code("'.concat(String(t.code),'"').concat(t.scope?", ".concat(JSON.stringify(t.scope)):"",")")},e}();Object.defineProperty(Gn.prototype,"_bsontype",{value:"Code"});function zl(e){return Vr(e)&&e.$id!=null&&typeof e.$ref=="string"&&(e.$db==null||typeof e.$db=="string")}var Rr=function(){function e(t,r,n,i){if(!(this instanceof e))return new e(t,r,n,i);var s=t.split(".");s.length===2&&(n=s.shift(),t=s.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(t){this.collection=t},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(t.$db=this.db),t},e.prototype.toExtendedJSON=function(t){t=t||{};var r={$ref:this.collection,$id:this.oid};return t.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},e.fromExtendedJSON=function(t){var r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(t),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();Object.defineProperty(Rr.prototype,"_bsontype",{value:"DBRef"});var Zt=void 0;try{Zt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var Ts=65536,Gl=1<<24,Xe=Ts*Ts,Ko=Xe*Xe,Ls=Ko/2,Rs={},Fs={},nt=function(){function e(t,r,n){if(t===void 0&&(t=0),!(this instanceof e))return new e(t,r,n);typeof t=="bigint"?Object.assign(this,e.fromBigInt(t,!!r)):typeof t=="string"?Object.assign(this,e.fromString(t,!!r)):(this.low=t|0,this.high=r|0,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,r,n){return new e(t,r,n)},e.fromInt=function(t,r){var n,i,s;return r?(t>>>=0,(s=0<=t&&t<256)&&(i=Fs[t],i)?i:(n=e.fromBits(t,(t|0)<0?-1:0,!0),s&&(Fs[t]=n),n)):(t|=0,(s=-128<=t&&t<128)&&(i=Rs[t],i)?i:(n=e.fromBits(t,t<0?-1:0,!1),s&&(Rs[t]=n),n))},e.fromNumber=function(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=Ko)return e.MAX_UNSIGNED_VALUE}else{if(t<=-Ls)return e.MIN_VALUE;if(t+1>=Ls)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%Xe|0,t/Xe|0,r)},e.fromBigInt=function(t,r){return e.fromString(t.toString(),r)},e.fromString=function(t,r,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return e.fromString(t.substring(1),r,n).neg();for(var s=e.fromNumber(Math.pow(n,8)),o=e.ZERO,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+l),n);if(l<8){var f=e.fromNumber(Math.pow(n,l));o=o.mul(f).add(e.fromNumber(c))}else o=o.mul(s),o=o.add(e.fromNumber(c))}return o.unsigned=r,o},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.isLong=function(t){return Vr(t)&&t.__isLong__===!0},e.fromValue=function(t,r){return typeof t=="number"?e.fromNumber(t,r):typeof t=="string"?e.fromString(t,r):e.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,o=t.high>>>16,a=t.high&65535,l=t.low>>>16,c=t.low&65535,f=0,d=0,p=0,g=0;return g+=s+c,p+=g>>>16,g&=65535,p+=i+l,d+=p>>>16,p&=65535,d+=n+a,f+=d>>>16,d&=65535,f+=r+o,f&=65535,e.fromBits(p<<16|g,f<<16|d,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(t){return this.compare(t)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(Zt){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?Zt.div_u:Zt.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,Zt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var n,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;s=e.UZERO}else{if(this.eq(e.MIN_VALUE)){if(t.eq(e.ONE)||t.eq(e.NEG_ONE))return e.MIN_VALUE;if(t.eq(e.MIN_VALUE))return e.ONE;var o=this.shr(1);return n=o.div(t).shl(1),n.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(i=this.sub(t.mul(n)),s=n.add(i.div(t)),s)}else if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=e.ZERO}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),l=a<=48?1:Math.pow(2,a-48),c=e.fromNumber(n),f=c.mul(t);f.isNegative()||f.gt(i);)n-=l,c=e.fromNumber(n,this.unsigned),f=c.mul(t);c.isZero()&&(c=e.ONE),s=s.add(c),i=i.sub(f)}return s},e.prototype.div=function(t){return this.divide(t)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},e.prototype.eq=function(t){return this.equals(t)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t=this.high!==0?this.high:this.low,r;for(r=31;r>0&&!(t&1<<r);r--);return this.high!==0?r+33:r+1},e.prototype.greaterThan=function(t){return this.comp(t)>0},e.prototype.gt=function(t){return this.greaterThan(t)},e.prototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},e.prototype.gte=function(t){return this.greaterThanOrEqual(t)},e.prototype.ge=function(t){return this.greaterThanOrEqual(t)},e.prototype.isEven=function(){return(this.low&1)===0},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return(this.low&1)===1},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return this.high===0&&this.low===0},e.prototype.lessThan=function(t){return this.comp(t)<0},e.prototype.lt=function(t){return this.lessThan(t)},e.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},e.prototype.lte=function(t){return this.lessThanOrEqual(t)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),Zt){var r=(this.unsigned?Zt.rem_u:Zt.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,Zt.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(t){return this.modulo(t)},e.prototype.rem=function(t){return this.modulo(t)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),Zt){var r=Zt.mul(this.low,this.high,t.low,t.high);return e.fromBits(r,Zt.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=t.high>>>16,l=t.high&65535,c=t.low>>>16,f=t.low&65535,d=0,p=0,g=0,b=0;return b+=o*f,g+=b>>>16,b&=65535,g+=s*f,p+=g>>>16,g&=65535,g+=o*c,p+=g>>>16,g&=65535,p+=i*f,d+=p>>>16,p&=65535,p+=s*c,d+=p>>>16,p&=65535,p+=o*l,d+=p>>>16,p&=65535,d+=n*f+i*c+s*l+o*a,d&=65535,e.fromBits(g<<16|b,d<<16|p,this.unsigned)},e.prototype.mul=function(t){return this.multiply(t)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(t){return!this.equals(t)},e.prototype.neq=function(t){return this.notEquals(t)},e.prototype.ne=function(t){return this.notEquals(t)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(t){return this.shiftLeft(t)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(t){return this.shiftRight(t)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(t){return this.shiftRightUnsigned(t)},e.prototype.shru=function(t){return this.shiftRightUnsigned(t)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(t){return this.subtract(t)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*Xe+(this.low>>>0):this.high*Xe+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},e.prototype.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(e.MIN_VALUE)){var r=e.fromNumber(t),n=this.div(r),i=n.mul(r).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=e.fromNumber(Math.pow(t,6),this.unsigned),o=this,a="";;){var l=o.div(s),c=o.sub(l.mul(s)).toInt()>>>0,f=c.toString(t);if(o=l,o.isZero())return f+a;for(;f.length<6;)f="0"+f;a=""+f+a}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(t){return this.lessThanOrEqual(t)},e.prototype.toExtendedJSON=function(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(Gl),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();Object.defineProperty(nt.prototype,"__isLong__",{value:!0});Object.defineProperty(nt.prototype,"_bsontype",{value:"Long"});var Ml=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,Dl=/^(\+|-)?(Infinity|inf)$/i,Kl=/^(\+|-)?NaN$/i,hr=6111,Xn=-6176,Ps=6176,jl=34,Hn=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Us=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),zs=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Wl=/^([-+])?(\d+)?$/,Zl=31,Gs=16383,Vl=30,Ql=31;function Ms(e){return!isNaN(parseInt(e,10))}function ql(e){var t=nt.fromNumber(1e9),r=nt.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new nt(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function Yl(e,t){if(!e&&!t)return{high:nt.fromNumber(0),low:nt.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new nt(e.getLowBits(),0),i=t.shiftRightUnsigned(32),s=new nt(t.getLowBits(),0),o=r.multiply(i),a=r.multiply(s),l=n.multiply(i),c=n.multiply(s);return o=o.add(a.shiftRightUnsigned(32)),a=new nt(a.getLowBits(),0).add(l).add(c.shiftRightUnsigned(32)),o=o.add(a.shiftRightUnsigned(32)),c=a.shiftLeft(32).add(new nt(c.getLowBits(),0)),{high:o,low:c}}function Xl(e,t){var r=e.high>>>0,n=t.high>>>0;if(r<n)return!0;if(r===n){var i=e.low>>>0,s=t.low>>>0;if(i<s)return!0}return!1}function We(e,t){throw new xt('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var ts=function(){function e(t){if(!(this instanceof e))return new e(t);if(typeof t=="string")this.bytes=e.fromString(t).bytes;else if($i(t)){if(t.byteLength!==16)throw new xt("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}else throw new xt("Decimal128 must take a Buffer or string")}return e.fromString=function(t){var r=!1,n=!1,i=!1,s=0,o=0,a=0,l=0,c=0,f=[0],d=0,p=0,g=0,b=0,y=0,_=0,w=new nt(0,0),E=new nt(0,0),S=0,I=0;if(t.length>=7e3)throw new xt(""+t+" not a valid Decimal128 string");var C=t.match(Ml),O=t.match(Dl),T=t.match(Kl);if(!C&&!O&&!T||t.length===0)throw new xt(""+t+" not a valid Decimal128 string");if(C){var G=C[2],L=C[4],j=C[5],Y=C[6];L&&Y===void 0&&We(t,"missing exponent power"),L&&G===void 0&&We(t,"missing exponent base"),L===void 0&&(j||Y)&&We(t,"missing e before exponent")}if((t[I]==="+"||t[I]==="-")&&(r=t[I++]==="-"),!Ms(t[I])&&t[I]!=="."){if(t[I]==="i"||t[I]==="I")return new e(gt.from(r?Us:zs));if(t[I]==="N")return new e(gt.from(Hn))}for(;Ms(t[I])||t[I]===".";){if(t[I]==="."){n&&We(t,"contains multiple periods"),n=!0,I=I+1;continue}d<34&&(t[I]!=="0"||i)&&(i||(c=o),i=!0,f[p++]=parseInt(t[I],10),d=d+1),i&&(a=a+1),n&&(l=l+1),o=o+1,I=I+1}if(n&&!o)throw new xt(""+t+" not a valid Decimal128 string");if(t[I]==="e"||t[I]==="E"){var N=t.substr(++I).match(Wl);if(!N||!N[2])return new e(gt.from(Hn));y=parseInt(N[0],10),I=I+N[0].length}if(t[I])return new e(gt.from(Hn));if(g=0,!d)g=0,b=0,f[0]=0,a=1,d=1,s=0;else if(b=d-1,s=a,s!==1)for(;f[c+s-1]===0;)s=s-1;for(y<=l&&l-y>16384?y=Xn:y=y-l;y>hr;){if(b=b+1,b-g>jl){var z=f.join("");if(z.match(/^0+$/)){y=hr;break}We(t,"overflow")}y=y-1}for(;y<Xn||d<a;){if(b===0&&s<d){y=Xn,s=0;break}if(d<a?a=a-1:b=b-1,y<hr)y=y+1;else{var z=f.join("");if(z.match(/^0+$/)){y=hr;break}We(t,"overflow")}}if(b-g+1<s){var A=o;n&&(c=c+1,A=A+1),r&&(c=c+1,A=A+1);var K=parseInt(t[c+b+1],10),et=0;if(K>=5&&(et=1,K===5)){for(et=f[b]%2===1?1:0,_=c+b+2;_<A;_++)if(parseInt(t[_],10)){et=1;break}}if(et){for(var M=b;M>=0;M--)if(++f[M]>9&&(f[M]=0,M===0))if(y<hr)y=y+1,f[M]=1;else return new e(gt.from(r?Us:zs))}}if(w=nt.fromNumber(0),E=nt.fromNumber(0),s===0)w=nt.fromNumber(0),E=nt.fromNumber(0);else if(b-g<17){var M=g;for(E=nt.fromNumber(f[M++]),w=new nt(0,0);M<=b;M++)E=E.multiply(nt.fromNumber(10)),E=E.add(nt.fromNumber(f[M]))}else{var M=g;for(w=nt.fromNumber(f[M++]);M<=b-17;M++)w=w.multiply(nt.fromNumber(10)),w=w.add(nt.fromNumber(f[M]));for(E=nt.fromNumber(f[M++]);M<=b;M++)E=E.multiply(nt.fromNumber(10)),E=E.add(nt.fromNumber(f[M]))}var rt=Yl(w,nt.fromString("100000000000000000"));rt.low=rt.low.add(E),Xl(rt.low,E)&&(rt.high=rt.high.add(nt.fromNumber(1))),S=y+Ps;var D={low:nt.fromNumber(0),high:nt.fromNumber(0)};rt.high.shiftRightUnsigned(49).and(nt.fromNumber(1)).equals(nt.fromNumber(1))?(D.high=D.high.or(nt.fromNumber(3).shiftLeft(61)),D.high=D.high.or(nt.fromNumber(S).and(nt.fromNumber(16383).shiftLeft(47))),D.high=D.high.or(rt.high.and(nt.fromNumber(0x7fffffffffff)))):(D.high=D.high.or(nt.fromNumber(S&16383).shiftLeft(49)),D.high=D.high.or(rt.high.and(nt.fromNumber(562949953421311)))),D.low=rt.low,r&&(D.high=D.high.or(nt.fromString("9223372036854775808")));var q=gt.alloc(16);return I=0,q[I++]=D.low.low&255,q[I++]=D.low.low>>8&255,q[I++]=D.low.low>>16&255,q[I++]=D.low.low>>24&255,q[I++]=D.low.high&255,q[I++]=D.low.high>>8&255,q[I++]=D.low.high>>16&255,q[I++]=D.low.high>>24&255,q[I++]=D.high.low&255,q[I++]=D.high.low>>8&255,q[I++]=D.high.low>>16&255,q[I++]=D.high.low>>24&255,q[I++]=D.high.high&255,q[I++]=D.high.high>>8&255,q[I++]=D.high.high>>16&255,q[I++]=D.high.high>>24&255,new e(q)},e.prototype.toString=function(){for(var t,r=0,n=new Array(36),i=0;i<n.length;i++)n[i]=0;var s=0,o=!1,a,l={parts:[0,0,0,0]},c,f,d=[];s=0;var p=this.bytes,g=p[s++]|p[s++]<<8|p[s++]<<16|p[s++]<<24,b=p[s++]|p[s++]<<8|p[s++]<<16|p[s++]<<24,y=p[s++]|p[s++]<<8|p[s++]<<16|p[s++]<<24,_=p[s++]|p[s++]<<8|p[s++]<<16|p[s++]<<24;s=0;var w={low:new nt(g,b),high:new nt(y,_)};w.high.lessThan(nt.ZERO)&&d.push("-");var E=_>>26&Zl;if(E>>3===3){if(E===Vl)return d.join("")+"Infinity";if(E===Ql)return"NaN";t=_>>15&Gs,a=8+(_>>14&1)}else a=_>>14&7,t=_>>17&Gs;var S=t-Ps;if(l.parts[0]=(_&16383)+((a&15)<<14),l.parts[1]=y,l.parts[2]=b,l.parts[3]=g,l.parts[0]===0&&l.parts[1]===0&&l.parts[2]===0&&l.parts[3]===0)o=!0;else for(f=3;f>=0;f--){var I=0,C=ql(l);if(l=C.quotient,I=C.rem.low,!!I)for(c=8;c>=0;c--)n[f*9+c]=I%10,I=Math.floor(I/10)}if(o)r=1,n[s]=0;else for(r=36;!n[s];)r=r-1,s=s+1;var O=r-1+S;if(O>=34||O<=-7||S>0){if(r>34)return d.push("".concat(0)),S>0?d.push("E+".concat(S)):S<0&&d.push("E".concat(S)),d.join("");d.push("".concat(n[s++])),r=r-1,r&&d.push(".");for(var i=0;i<r;i++)d.push("".concat(n[s++]));d.push("E"),O>0?d.push("+".concat(O)):d.push("".concat(O))}else if(S>=0)for(var i=0;i<r;i++)d.push("".concat(n[s++]));else{var T=r+S;if(T>0)for(var i=0;i<T;i++)d.push("".concat(n[s++]));else d.push("0");for(d.push(".");T++<0;)d.push("0");for(var i=0;i<r-Math.max(T-1,0);i++)d.push("".concat(n[s++]))}return d.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();Object.defineProperty(ts.prototype,"_bsontype",{value:"Decimal128"});var Mn=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toExtendedJSON=function(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},e.fromExtendedJSON=function(t,r){var n=parseFloat(t.$numberDouble);return r&&r.relaxed?n:new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toExtendedJSON();return"new Double(".concat(t.$numberDouble,")")},e}();Object.defineProperty(Mn.prototype,"_bsontype",{value:"Double"});var Dn=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t|0}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();Object.defineProperty(Dn.prototype,"_bsontype",{value:"Int32"});var es=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();Object.defineProperty(es.prototype,"_bsontype",{value:"MaxKey"});var rs=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();Object.defineProperty(rs.prototype,"_bsontype",{value:"MinKey"});var Hl=new RegExp("^[0-9a-fA-F]{24}$"),Ee=null,Ht=Symbol("id"),Qt=function(){function e(t){if(!(this instanceof e))return new e(t);var r;if(typeof t=="object"&&t&&"id"in t){if(typeof t.id!="string"&&!ArrayBuffer.isView(t.id))throw new xt("Argument passed in must have an id that is of type string or Buffer");"toHexString"in t&&typeof t.toHexString=="function"?r=gt.from(t.toHexString(),"hex"):r=t.id}else r=t;if(r==null||typeof r=="number")this[Ht]=e.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[Ht]=r instanceof gt?r:kn(r);else if(typeof r=="string")if(r.length===12){var n=gt.from(r);if(n.byteLength===12)this[Ht]=n;else throw new xt("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&Hl.test(r))this[Ht]=gt.from(r,"hex");else throw new xt("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new xt("Argument passed in does not match the accepted types");e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[Ht]},set:function(t){this[Ht]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(t){this.id.writeUInt32BE(t,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){typeof t!="number"&&(t=Math.floor(Date.now()/1e3));var r=e.getInc(),n=gt.alloc(12);return n.writeUInt32BE(t,0),Ee===null&&(Ee=Go(5)),n[4]=Ee[0],n[5]=Ee[1],n[6]=Ee[2],n[7]=Ee[3],n[8]=Ee[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n},e.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(t==null)return!1;if(t instanceof e)return this[Ht][11]===t[Ht][11]&&this[Ht].equals(t[Ht]);if(typeof t=="string"&&e.isValid(t)&&t.length===12&&$i(this.id))return t===gt.prototype.toString.call(this.id,"latin1");if(typeof t=="string"&&e.isValid(t)&&t.length===24)return t.toLowerCase()===this.toHexString();if(typeof t=="string"&&e.isValid(t)&&t.length===12)return gt.from(t).equals(this.id);if(typeof t=="object"&&"toHexString"in t&&typeof t.toHexString=="function"){var r=t.toHexString(),n=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===n}return!1},e.prototype.getTimestamp=function(){var t=new Date,r=this.id.readUInt32BE(0);return t.setTime(Math.floor(r)*1e3),t},e.createPk=function(){return new e},e.createFromTime=function(t){var r=gt.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(t,0),new e(r)},e.createFromHexString=function(t){if(typeof t>"u"||t!=null&&t.length!==24)throw new xt("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(gt.from(t,"hex"))},e.isValid=function(t){if(t==null)return!1;try{return new e(t),!0}catch{return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(Math.random()*16777215),e}();Object.defineProperty(Qt.prototype,"generate",{value:zn(function(e){return Qt.generate(e)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(Qt.prototype,"getInc",{value:zn(function(){return Qt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Qt.prototype,"get_inc",{value:zn(function(){return Qt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Qt,"get_inc",{value:zn(function(){return Qt.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Qt.prototype,"_bsontype",{value:"ObjectID"});function Jl(e){return e.split("").sort().join("")}var Fr=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(this.pattern=t,this.options=Jl(r??""),this.pattern.indexOf("\0")!==-1)throw new Te("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new Te("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new Te("The regular expression option [".concat(this.options[n],"] is not supported"))}return e.parseOptions=function(t){return t?t.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(t){return t=t||{},t.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t)if(typeof t.$regex!="string"){if(t.$regex._bsontype==="BSONRegExp")return t}else return new e(t.$regex,e.parseOptions(t.$options));if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new xt("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();Object.defineProperty(Fr.prototype,"_bsontype",{value:"BSONRegExp"});var ns=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();Object.defineProperty(ns.prototype,"_bsontype",{value:"Symbol"});var $l=nt,jo=function(e){Un(t,e);function t(r,n){var i=this;return i instanceof t?(nt.isLong(r)?i=e.call(this,r.low,r.high,!0)||this:Vr(r)&&typeof r.t<"u"&&typeof r.i<"u"?i=e.call(this,r.i,r.t,!0)||this:i=e.call(this,r,n,!0)||this,Object.defineProperty(i,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),i):new t(r,n)}return t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(r){return new t(nt.fromInt(r,!0))},t.fromNumber=function(r){return new t(nt.fromNumber(r,!0))},t.fromBits=function(r,n){return new t(r,n)},t.fromString=function(r,n){return new t(nt.fromString(r,!0,n))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(r){return new t(r.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=nt.MAX_UNSIGNED_VALUE,t}($l);function tu(e){return Vr(e)&&Reflect.has(e,"_bsontype")&&typeof e._bsontype=="string"}var Wo=2147483647,Zo=-2147483648,Vo=9223372036854776e3,Qo=-9223372036854776e3,eu={$oid:Qt,$binary:Le,$uuid:Le,$symbol:ns,$numberInt:Dn,$numberDecimal:ts,$numberDouble:Mn,$numberLong:nt,$minKey:rs,$maxKey:es,$regex:Fr,$regularExpression:Fr,$timestamp:jo};function qo(e,t){if(t===void 0&&(t={}),typeof e=="number"){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=Zo&&e<=Wo)return new Dn(e);if(e>=Qo&&e<=Vo)return nt.fromNumber(e)}return new Mn(e)}if(e==null||typeof e!="object")return e;if(e.$undefined)return null;for(var r=Object.keys(e).filter(function(d){return d.startsWith("$")&&e[d]!=null}),n=0;n<r.length;n++){var i=eu[r[n]];if(i)return i.fromExtendedJSON(e,t)}if(e.$date!=null){var s=e.$date,o=new Date;return t.legacy?typeof s=="number"?o.setTime(s):typeof s=="string"&&o.setTime(Date.parse(s)):typeof s=="string"?o.setTime(Date.parse(s)):nt.isLong(s)?o.setTime(s.toNumber()):typeof s=="number"&&t.relaxed&&o.setTime(s),o}if(e.$code!=null){var a=Object.assign({},e);return e.$scope&&(a.$scope=qo(e.$scope)),Gn.fromExtendedJSON(e)}if(zl(e)||e.$dbPointer){var l=e.$ref?e:e.$dbPointer;if(l instanceof Rr)return l;var c=Object.keys(l).filter(function(d){return d.startsWith("$")}),f=!0;if(c.forEach(function(d){["$ref","$id","$db"].indexOf(d)===-1&&(f=!1)}),f)return Rr.fromExtendedJSON(l)}return e}function ru(e,t){return e.map(function(r,n){t.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return me(r,t)}finally{t.seenObjects.pop()}})}function Ds(e){var t=e.toISOString();return e.getUTCMilliseconds()!==0?t:t.slice(0,-5)+"Z"}function me(e,t){if((typeof e=="object"||typeof e=="function")&&e!==null){var r=t.seenObjects.findIndex(function(w){return w.obj===e});if(r!==-1){var n=t.seenObjects.map(function(w){return w.propertyName}),i=n.slice(0,r).map(function(w){return"".concat(w," -> ")}).join(""),s=n[r],o=" -> "+n.slice(r+1,n.length-1).map(function(w){return"".concat(w," -> ")}).join(""),a=n[n.length-1],l=" ".repeat(i.length+s.length/2),c="-".repeat(o.length+(s.length+a.length)/2-1);throw new xt(`Converting circular structure to EJSON:
`+"    ".concat(i).concat(s).concat(o).concat(a,`
`)+"    ".concat(l,"\\").concat(c,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return ru(e,t);if(e===void 0)return null;if(e instanceof Date||Rl(e)){var f=e.getTime(),d=f>-1&&f<2534023188e5;return t.legacy?t.relaxed&&d?{$date:e.getTime()}:{$date:Ds(e)}:t.relaxed&&d?{$date:Ds(e)}:{$date:{$numberLong:e.getTime().toString()}}}if(typeof e=="number"&&(!t.relaxed||!isFinite(e))){if(Math.floor(e)===e){var p=e>=Zo&&e<=Wo,g=e>=Qo&&e<=Vo;if(p)return{$numberInt:e.toString()};if(g)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||Ll(e)){var b=e.flags;if(b===void 0){var y=e.toString().match(/[gimuy]*$/);y&&(b=y[0])}var _=new Fr(e.source,b);return _.toExtendedJSON(t)}return e!=null&&typeof e=="object"?iu(e,t):e}var nu={Binary:function(e){return new Le(e.value(),e.sub_type)},Code:function(e){return new Gn(e.code,e.scope)},DBRef:function(e){return new Rr(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new ts(e.bytes)},Double:function(e){return new Mn(e.value)},Int32:function(e){return new Dn(e.value)},Long:function(e){return nt.fromBits(e.low!=null?e.low:e.low_,e.low!=null?e.high:e.high_,e.low!=null?e.unsigned:e.unsigned_)},MaxKey:function(){return new es},MinKey:function(){return new rs},ObjectID:function(e){return new Qt(e)},ObjectId:function(e){return new Qt(e)},BSONRegExp:function(e){return new Fr(e.pattern,e.options)},Symbol:function(e){return new ns(e.value)},Timestamp:function(e){return jo.fromBits(e.low,e.high)}};function iu(e,t){if(e==null||typeof e!="object")throw new Te("not an object instance");var r=e._bsontype;if(typeof r>"u"){var n={};for(var i in e){t.seenObjects.push({propertyName:i,obj:null});try{var s=me(e[i],t);i==="__proto__"?Object.defineProperty(n,i,{value:s,writable:!0,enumerable:!0,configurable:!0}):n[i]=s}finally{t.seenObjects.pop()}}return n}else if(tu(e)){var o=e;if(typeof o.toExtendedJSON!="function"){var a=nu[e._bsontype];if(!a)throw new xt("Unrecognized or invalid _bsontype: "+e._bsontype);o=a(o)}return r==="Code"&&o.scope?o=new Gn(o.code,me(o.scope,t)):r==="DBRef"&&o.oid&&(o=new Rr(me(o.collection,t),me(o.oid,t),me(o.db,t),me(o.fields,t))),o.toExtendedJSON(t)}else throw new Te("_bsontype must be a string, but was: "+typeof r)}var Ks;(function(e){function t(s,o){var a=Object.assign({},{relaxed:!0,legacy:!1},o);return typeof a.relaxed=="boolean"&&(a.strict=!a.relaxed),typeof a.strict=="boolean"&&(a.relaxed=!a.strict),JSON.parse(s,function(l,c){if(l.indexOf("\0")!==-1)throw new Te("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(l)));return qo(c,a)})}e.parse=t;function r(s,o,a,l){a!=null&&typeof a=="object"&&(l=a,a=0),o!=null&&typeof o=="object"&&!Array.isArray(o)&&(l=o,o=void 0,a=0);var c=Object.assign({relaxed:!0,legacy:!1},l,{seenObjects:[{propertyName:"(root)",obj:null}]}),f=me(s,c);return JSON.stringify(f,o,a)}e.stringify=r;function n(s,o){return o=o||{},JSON.parse(r(s,o))}e.serialize=n;function i(s,o){return o=o||{},t(JSON.stringify(s),o)}e.deserialize=i})(Ks||(Ks={}));var js=zo();js.Map?js.Map:function(){function e(t){t===void 0&&(t=[]),this._keys=[],this._values={};for(var r=0;r<t.length;r++)if(t[r]!=null){var n=t[r],i=n[0],s=n[1];this._keys.push(i),this._values[i]={v:s,i:this._keys.length-1}}}return e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(t){var r=this._values[t];return r==null?!1:(delete this._values[t],this._keys.splice(r.i,1),!0)},e.prototype.entries=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?[n,t._values[n].v]:void 0,done:n===void 0}}}},e.prototype.forEach=function(t,r){r=r||this;for(var n=0;n<this._keys.length;n++){var i=this._keys[n];t.call(r,this._values[i].v,i,r)}},e.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},e.prototype.has=function(t){return this._values[t]!=null},e.prototype.keys=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?n:void 0,done:n===void 0}}}},e.prototype.set=function(t,r){return this._values[t]?(this._values[t].v=r,this):(this._keys.push(t),this._values[t]={v:r,i:this._keys.length-1},this)},e.prototype.values=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?t._values[n].v:void 0,done:n===void 0}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),e}();nt.fromNumber(Pl);nt.fromNumber(Ul);var Jn=new Uint8Array(8);new DataView(Jn.buffer,Jn.byteOffset,Jn.byteLength);var su=1024*1024*17;gt.alloc(su);function rn(e){return Math.floor(Math.random()*Math.floor(e))}function ou(e){if(e==null)return"";let t=e.replace(/<br ?[/]?>/g,`
`);return t=t.replace(/(<([^>]+)>)/gi,""),t=t.replace(/&bull;/g,""),t=t.replace(/[&][^;]*;/g,""),t=t.replace(/\n */g,`
`),t=t.replace(/\n\n*/g,`
`),t=t.replace(//g,"-"),t}function xp(e,t,r){const n=document.createElement("a"),i=new Blob([r],{type:t}),s=URL.createObjectURL(i);n.setAttribute("href",s),n.setAttribute("download",e),n.setAttribute("target","_blank"),n.click()}function au(e){return e.toLowerCase().replace(/\s/g,"_")}function lu(e,t=198209835){let r,n,i=t===void 0?2166136261:t;for(r=0,n=e.length;r<n;r++)i^=e.charCodeAt(r),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0}function uu(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function cu(e,t=r=>r.toString()){const r={};for(let n=0;n<e.length;n++){const i=e[n],s=t(i),o=r[s];o?o.push(i):r[s]=[i]}return r}function Ws(e,t){const r=[e];for(;r.length;){const n=r.pop();for(const i of Object.values(n))i&&typeof i=="object"&&r.push(i);Array.isArray(n)||t(n)}}function Yo([e],[t]){return e.localeCompare(t,void 0,{numeric:!0})}function fu([e],[t]){return t.localeCompare(e,void 0,{numeric:!0})}function hu(e,t){return e.map(r=>[(t(r)??"").toString(),r]).sort(Yo).map(([,r])=>r)}function _i(e,t){return e.map(r=>[(t(r)??"").toString(),r]).sort(Yo).map(([,r])=>r)}function Qe(e,t){return e.map(r=>[(t(r)??"").toString(),r]).sort(fu).map(([,r])=>r)}function wr(e){return Object.create(e)}function qt(e,t,r){const n=e[t];if(n){n.push(r);return}e[t]=[r]}function du(e,t,r){const n=e[t];if(n){n.filter(i=>i!==r),n.length||delete e[t];return}}function ue(e){return e&&typeof e=="object"}function Zs(e){return!Object.getPrototypeOf(Object.getPrototypeOf(e))}function Vs(e,t){return e.startsWith(t)?e.substring(t.length):e}function Xo(e,t){return e.endsWith(t)?e.substring(0,e.length-t.length):e}function Ho(e){const r=`^(?=.*${uu(e).split(" ").map(i=>`(?=.*${i})`).join("")}).*$`;return new RegExp(r,"i")}function xr(){return[rn(65535),rn(65535),rn(65535),rn(65535)].map(e=>e.toString(16)).join("-")}function*pu(e,t){for(let r=0;r<Math.min(e.length,t.length);r++)yield[e[r],t[r]]}function gu(e){return e.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}async function mu(e,t,r){var n=new pl;return n.file(e,t),await n.generateAsync({type:r,compression:"DEFLATE"})}function yu(e,t){let r=e;for(;r&&!Object.is(r,r.parent);){if(t(r))return r;r=r.parent}}function Ep(e,t){let r=e.parent;for(;r&&!Object.is(r,r.parent);){if(t(r))return r;r=r.parent}}function Ai(e,t){let r=e.parent;for(;r&&!(!r||t(r)===!1);)r=r.parent}function kp(e){for(const t of e)return t}const wu=["modifiers","modifierGroups","constraints","entryLinks","categoryLinks","selectionEntries","selectionEntryGroups","infoLinks","infoGroups","rules","profiles"],Jo=["profile","rule","infoLink","infoGroup","selectionEntry","selectionEntryGroup","entryLink","profiles","rules","infoLinks","infoGroups","entryLinks","selectionEntries","selectionEntryLinks","selectionEntryGroups","categoryLinks","costTypes","profileTypes","characteristicTypes","categoryEntries","categories","forceEntries","forces","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","rules","rootRules","publications","catalogueLinks","constraints","characteristics","costs"],vu=["conditions","conditionGroups","modifiers","modifierGroups","repeats"],is=new Set([...Jo,...vu]),bu=new Set(Jo);function ve(e){if(e.gameSystem)return e.gameSystem;if(e.catalogue)return e.catalogue;throw Error("getDataObject data argument is not a valid system or catalogue")}function $n(e){if(e.isCatalogue&&e.isCatalogue()){if(e.id&&e.gameSystemId)return`${e.gameSystemId}-${e.id}`;if(e.id)return`${e.id}`}if(e.catalogue)return`${e.catalogue.gameSystemId}-${e.catalogue.id}`;if(e.gameSystem)return e.gameSystem.id;throw Error("getDataId data argument is not a valid system or catalogue")}class Bt{constructor(t){Z(this,"id");Z(this,"type");Z(this,"shared");Z(this,"import");Z(this,"collective");Z(this,"comment");Z(this,"publicationId");Z(this,"profileTypes");Z(this,"name");Z(this,"hidden");Z(this,"value");Z(this,"page");Z(this,"defaultAmount");Z(this,"profiles");Z(this,"rules");Z(this,"infoLinks");Z(this,"infoGroups");Z(this,"publications");Z(this,"costs");Z(this,"selectionEntries");Z(this,"selectionEntryGroups");Z(this,"entryLinks");Z(this,"categoryEntries");Z(this,"categoryLinks");Z(this,"forceEntries");Z(this,"sharedSelectionEntryGroups");Z(this,"sharedSelectionEntries");Z(this,"sharedProfiles");Z(this,"sharedRules");Z(this,"sharedInfoGroups");Z(this,"target");Z(this,"modifiers");Z(this,"modifierGroups");Z(this,"constraints");Z(this,"repeats");Z(this,"conditions");Z(this,"conditionGroups");Z(this,"catalogue");Z(this,"extra_constraints");Z(this,"childs");Z(this,"loaded");Z(this,"collective_recursive");Z(this,"limited_to_one");Z(this,"associations");Z(this,"associationConstraints");return Object.setPrototypeOf(t,Object.getPrototypeOf(this))}get url(){return"%{main_catalogue|catalogue}/%{id}/%{getName}"}process(){this.loaded||(this.collective_recursive=this.isCollectiveRecursive(),this.limited_to_one=!this.canAmountBeAbove1(),this.loaded=!0)}toJson(){return pn(this)}getCatalogue(){return this.catalogue}getGameSystem(){return this.catalogue.getGameSystem()}get[Symbol.toStringTag](){return globalThis.isEditor?"Object":"ObjectNoObserve"}isGroup(){return!1}isForce(){return!1}isCatalogue(){return!1}isLink(){return!1}isCategory(){return!1}isRoster(){return!1}isQuantifiable(){return!1}isEntry(){return!1}isIdUnique(){return!1}isRule(){return!1}isProfile(){return!1}isInfoGroup(){return!1}isUnit(){for(const t of this.categoryLinks||[])if(t.primary)return!0;return!1}getId(){return this.id}getType(){return this.type}getHidden(){return this.hidden}getPage(){return this.page}getName(){return this.name}getDefaultAmount(){return this.defaultAmount}isCollective(){return this.collective}isCollectiveRecursive(){const t=[...this.selectionsIterator()];for(;t.length;){const r=t.pop();if(!r.isCollective()&&!r.isGroup())return!1;t.push(...r.selectionsIterator())}return!0}isEmptyNode(){for(const t of wu)if(this[t]!==void 0)return!1;return!0}*forcesIterator(){}*associationsIterator(){this.associations&&(yield*this.associations)}*profilesIterator(){var t;for(const r of Ur(this))r.profiles&&(yield*r.profiles),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(n=>n.type==="profile").map(n=>n.target))}*rulesIterator(){var t;for(const r of Ur(this))r.rules&&(yield*r.rules),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(n=>n.type==="rule").map(n=>n.target))}*constraintsIterator(){this.constraints&&(yield*this.constraints)}*extraConstraintsIterator(){this.extra_constraints&&(yield*this.extra_constraints)}*modifierGroupsIterator(){this.modifierGroups&&(yield*this.modifierGroups)}*modifiersIterator(){this.modifiers&&(yield*this.modifiers)}*modifierGroupsIteratorRecursive(){yield this,this.isLink()&&(yield this.target);for(const t of this.modifierGroupsIterator())yield t,yield*Sn(t.modifierGroups)}*selectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*localSelectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*nodesIterator(){this.isLink()&&(yield*this.target.nodesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.isLink()&&(yield*this.target.entriesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks),this.childs&&(yield*this.childs)}*iterateSelectionEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateSelectionEntriesWithRoot(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*iterateAllRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*categoryLinksIterator(){this.categoryLinks&&(yield*this.categoryLinks)}*infoLinksIterator(){this.infoLinks&&(yield*this.infoLinks)}*infoGroupsIterator(){this.infoGroups&&(yield*this.infoGroups)}*infoRulesIterator(){this.rules&&(yield*this.rules)}*infoProfilesIterator(){this.profiles&&(yield*this.profiles)}forEachCond(t,r=0){if(t(this,0)===void 0)for(const n of this.selectionsIterator())n.forEachCond(t,r+1)}forEach(t){t(this);for(const r of this.selectionsIterator())r.forEach(t)}forEachNode(t){t(this);for(const r of this.nodesIterator())r.forEachNode(t)}forEachNodeCb(t){const r=[this],n=new Set;for(;r.length;){const i=r.pop();if(!n.has(i.id)){if(n.add(i.id),t(i),i.childs){r.push(...i.childs);continue}if(i.target){const s=i.target;s.selectionEntries&&r.push(...s.selectionEntries),s.selectionEntryGroups&&r.push(...s.selectionEntryGroups),s.entryLinks&&r.push(...s.entryLinks)}i.selectionEntries&&r.push(...i.selectionEntries),i.selectionEntryGroups&&r.push(...i.selectionEntryGroups),i.entryLinks&&r.push(...i.entryLinks)}}}forEachObjectWhitelist(t,r=is){const n=[this];for(;n.length;){const i=n.pop();for(const s in i){const o=i[s];if(r.has(s)&&ue(o))if(Array.isArray(o)){if(o.length&&ue(o[0]))for(let a=0;a<o.length;a++){const l=o[a];t(l,i),n.push(l)}}else t(o,i),n.push(o)}}}forEachObject(t,r=new Set){const n=[this];for(;n.length;){const i=n.pop();for(const s of Object.keys(i)){const o=i[s];if(!r.has(s)&&ue(o))if(Array.isArray(o)){if(o.length&&ue(o[0]))for(let a=o.length;a--;){const l=o[a];t(l,i),n.push(l)}}else t(o,i),n.push(o)}}}findOption(t){for(const r of this.selectionsIterator())if(t(r))return r}findOptionRecursive(t){const r=[...this.selectionsIterator()];for(;r.length;){const n=r.pop();if(t(n))return n}}getCosts(){return this.costs||[]}getPrimaryCategory(){for(const t of this.categoryLinks||[])if(t.primary)return t.targetId;return Ie}getPrimaryCategoryLink(){for(const t of this.categoryLinks||[])if(t.primary)return t}getBoundConstraint(t){const r=Object.assign({},t);r.name=this.getName(),r.parent=this;const n=t.shared||this instanceof $o;r.childId=this.isLink()&&n?this.targetId:this.id,r.scope="self",r.modifiers=[];for(const i of this.modifiersIterator())(i.field===t.id||i.field==="hidden")&&r.modifiers.push(i);r.modifierGroups=[];for(const i of this.modifierGroupsIterator())t:for(const s of Sn([i]))for(const o of s.modifiers||[])if(o.field===t.id||o.field==="hidden"){r.modifierGroups.push(i);break t}return r}getChildBoundConstraints(t){const r=[];for(const n of this.selectionsIterator())if(!(t&&n.isGroup())){for(const i of n.constraintsIterator())(i.type==="min"||i.type==="exactly")&&i.scope==="parent"&&r.push(n.getBoundConstraint(i));n.isGroup()&&r.push(...n.getChildBoundConstraints())}return r}canAmountBeAbove1(){const t=Au(this.constraintsIterator(),[...this.modifierGroupsIterator(),{modifiers:[...this.modifiersIterator()]}]);return!t.length||t.includes(-1)?!0:Math.min(...t)>1}hasOption(t){let r;return this.forEachCond(n=>(n.getName()===t&&(r=!0),r)),!!r}}class ti extends Bt{isEntry(){return!0}isQuantifiable(){return!0}isIdUnique(){return!0}}class ei extends Bt{getDefaultSelectionEntryId(){return this.defaultSelectionEntryId}isGroup(){return!0}isIdUnique(){return!0}}class Pr extends Bt{constructor(){super(...arguments);Z(this,"targetId")}isLink(){return!0}isGroup(){return this.target.isGroup()}isCategory(){return this.target.isCategory()}isQuantifiable(){return this.target.isQuantifiable()}isEntry(){return this.target.isEntry()}isIdUnique(){return!1}isProfile(){var r;return((r=this.target)==null?void 0:r.isProfile())||!1}isRule(){var r;return((r=this.target)==null?void 0:r.isRule())||!1}isInfoGroup(){var r;return((r=this.target)==null?void 0:r.isInfoGroup())||!1}isUnit(){if(this.target.isUnit())return!0;for(const r of this.categoryLinks||[])if(r.primary)return!0;return!1}getId(){return this.targetId}getType(){var r;return(r=this.target)==null?void 0:r.type}getPage(){var r;return this.page||((r=this.target)==null?void 0:r.page)}getHidden(){return this.target.hidden||this.hidden}getDefaultSelectionEntryId(){var r;return this.defaultSelectionEntryId||((r=this.target)==null?void 0:r.getDefaultSelectionEntryId())}get associationConstraints(){return this.target.associationConstraints}get associations(){var r;return(r=this.target)==null?void 0:r.associations}isCollective(){return super.isCollective()||this.target.isCollective()}*extraConstraintsIterator(){yield*this.target.extraConstraintsIterator(),yield*super.extraConstraintsIterator()}*associationsIterator(){yield*this.target.associationsIterator(),yield*super.associationsIterator()}*rulesIterator(){yield*this.target.rulesIterator(),yield*super.rulesIterator()}*profilesIterator(){yield*this.target.profilesIterator(),yield*super.profilesIterator()}*constraintsIterator(){this.target&&(yield*this.target.constraintsIterator()),yield*super.constraintsIterator()}*modifierGroupsIterator(){yield*this.target.modifierGroupsIterator(),yield*super.modifierGroupsIterator()}*modifiersIterator(){yield*this.target.modifiersIterator(),yield*super.modifiersIterator()}*selectionsIterator(){yield*this.target.selectionsIterator(),yield*super.selectionsIterator()}*categoryLinksIterator(){yield*this.target.categoryLinksIterator(),yield*super.categoryLinksIterator()}*infoLinksIterator(){yield*this.target.infoLinksIterator(),yield*super.infoLinksIterator()}*infoGroupsIterator(){yield*this.target.infoGroupsIterator(),yield*super.infoGroupsIterator()}*infoRulesIterator(){yield*this.target.infoRulesIterator(),yield*super.infoRulesIterator()}*infoProfilesIterator(){yield*this.target.infoProfilesIterator(),yield*super.infoProfilesIterator()}getDefaultAmount(){return this.defaultAmount===void 0?this.target.defaultAmount:this.defaultAmount}getName(){var r;return((r=this.target)==null?void 0:r.name)||this.name}getParent(){return this.parent}getPrimaryCategory(){for(const r of this.categoryLinks||[])if(r.primary)return r.targetId;for(const r of this.target.categoryLinks||[])if(r.primary)return r.targetId;return Ie}getPrimaryCategoryLink(){for(const r of this.categoryLinks||[])if(r.primary)return r;for(const r of this.target.categoryLinks||[])if(r.primary)return r}getCosts(){var n;const r={};if((n=this.target)!=null&&n.costs)for(const i of this.target.costs)r[i.typeId]=i;if(this.costs)for(const i of this.costs)r[i.typeId]=i;return Object.values(r)}}Pr.prototype.keyInfoCache={};class _u extends Pr{getTypeName(){var t;return(t=this.target)==null?void 0:t.typeName}}class $o extends Pr{constructor(){super(...arguments);Z(this,"primary");Z(this,"main_catalogue")}get units(){return this.target.units}*selectionsIterator(){yield*this.target.units}isEmpty(){return this.target.isEmpty()}}const Ie="(No Category)",ri="(Illegal Units)";class Er extends Bt{constructor(){super(...arguments);Z(this,"units");Z(this,"main_catalogue")}isCategory(){return!0}*selectionsIterator(){yield*this.units}isEmpty(){return!this.units.length}isIdUnique(){return!this.isEmptyNode()}}class ni extends Bt{constructor(){super(...arguments);Z(this,"categories");Z(this,"forces");Z(this,"main_catalogue")}isForce(){return!0}isEntry(){return!0}isIdUnique(){return!0}*selectionsIterator(){yield*this.categories,this.forces&&(yield*this.forces)}*rulesIterator(){var r;for(const n of Ur(this))n.rules&&(yield*n.rules),n.infoLinks&&(yield*(r=n.infoLinks)==null?void 0:r.filter(i=>i.type==="rule").map(i=>i.target));this.main_catalogue&&(yield*this.main_catalogue.rulesIterator())}generateForces(r){const n=[];for(const i of this.forceEntries||[]){const s=wr(i);s.main_catalogue=this.main_catalogue;const o=[];for(const a of i.categoryLinks||[])a.targetId in r&&o.push(r[a.targetId]);s.categories=o,this.main_catalogue.index[s.id]=s,n.push(s)}return this.forces=n,n}isEmpty(){for(const r of this.categories)if(!r.isEmpty())return!1;return!0}*forcesIterator(){this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}}const ii=1/0;function Au(e,t){var i,s,o,a;const r=[];function n(l){r.push(l)}for(const l of e){const c=r.length;if(l.field!=="selections"||l.type!=="max")continue;if(l.value>1){n(l.value);continue}let f=l.value;for(const d of Sn(t))for(const p of d.modifiers||[])if(p.field===l.id){if(p.type==="increment"){if((i=d.repeats)!=null&&i.length||(s=p.repeats)!=null&&s.length){n(ii);continue}if(f+=p.value,f>1){n(f);continue}}if(p.type==="decrement"&&p.value<0){if((o=d.repeats)!=null&&o.length||(a=p.repeats)!=null&&a.length){n(ii);continue}if(f-=p.value,f>1){n(f);continue}}if(p.type==="set"&&p.value>1){if(p.value===-1){n(ii);continue}n(p.value)}}c===r.length&&n(f)}return r}class xu extends Bt{}class si extends Bt{isProfile(){return!0}getTypeName(){return this.typeName}isIdUnique(){return!0}}class oi extends Bt{isInfoGroup(){return!0}isIdUnique(){return!0}}const Qs=new Set(["any","model","unit","upgrade","mount","crew"]);class Je extends Bt{}class ta extends Bt{}class ea extends Bt{}class dn extends Bt{getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description}isRule(){return!0}isIdUnique(){return!0}}function*Ur(e){yield e;for(const t of e.infoGroups||[])yield*Ur(t);for(const t of e.infoLinks||[])t.type==="infoGroup"&&(yield*Ur(t.target))}function*Sn(e){if(e)for(const t of e)yield t,yield*Sn(t.modifierGroups)}const ra=new Set(["publications","costTypes","profileTypes","profiles","categoryEntries","forceEntries","selectionEntries","entryLinks","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedInfoGroups","characteristics","modifiers","constraints","categoryLinks","costs","conditionGroups","conditions","repeats","selectionEntryGroups","infoLinks","characteristicTypes","catalogueLinks","modifierGroups","sharedRules","rules","infoGroups","associations"]),or=new Set([...ra,"defaultAmount","id","import","importRootEntries","name","hidden","field","scope","value","percentValue","shared","includeChildSelections","includeChildForces","childId","type","targetId","primary","typeId","collective","$text","page","typeName","defaultSelectionEntryId","revision","battleScribeVersion","authorName","authorContact","authorUrl","library","gameSystemId","gameSystemRevision","xmlns","readme","description","comment","publicationDate","publisher","publisherId","publisherUrl","shortName","repeats","roundUp","defaultCostLimit","publicationId","label","labelMembers","maxAssociationsPerMember","ids","min","max","of"]);function ss(e,t=!1){const r={catalogue:void 0,gameSystem:void 0},n={...e};e.gameSystemId?(r.catalogue=n,r.catalogue.type="catalogue",delete r.gameSystem):(r.gameSystem=n,r.gameSystem.type="gameSystem",delete r.catalogue);const i=t?ve(r):r;return JSON.stringify(i,(o,a)=>{if(!(Array.isArray(a)&&a.length===0)&&(a===n||or.has(o)||isFinite(Number(o))))return a})}function pn(e,t){return JSON.stringify(e,function(n,i){if(!(Array.isArray(i)&&i.length===0)&&(or.has(n)||isFinite(Number(n))||t!=null&&t.has(n)))return i})}function Eu(e,t,r){const n=(r==null?void 0:r.forceArray)===!1;return e=Array.isArray(e)&&(e==null?void 0:e.length)===1&&n?e[0]:e,JSON.stringify(e,function(s,o){if(or.has(s)||isFinite(Number(s))||t!=null&&t.has(s))return o},(r==null?void 0:r.formatted)===!0?2:void 0)}function gn(e,t,r=is){for(const n in e)if(r.has(n)){const i=e[n];if(Array.isArray(i)&&i.length&&ue(i[0]))for(let s=0;s<i.length;s++){const o=i[s];t(o,e),gn(o,t,r)}}}class os extends Bt{constructor(){super(...arguments);Z(this,"targetId");Z(this,"importRootEntries")}isLink(){return!1}}class qs extends Bt{constructor(){super(...arguments);Z(this,"shortName");Z(this,"publisher");Z(this,"publicationDate");Z(this,"publisherUrl")}}class Ys extends Bt{constructor(){super(...arguments);Z(this,"library");Z(this,"revision");Z(this,"gameSystemId");Z(this,"gameSystemRevision");Z(this,"authorContact");Z(this,"authorName");Z(this,"authorUrl");Z(this,"battleScribeVersion");Z(this,"costTypes");Z(this,"catalogueLinks");Z(this,"gameSystem");Z(this,"initialized");Z(this,"loaded_wiki");Z(this,"loaded_editor");Z(this,"imports");Z(this,"importsWithEntries");Z(this,"index");Z(this,"unresolvedLinks",{});Z(this,"forces");Z(this,"categories");Z(this,"units");Z(this,"roster_constraints");Z(this,"manager");Z(this,"book");Z(this,"short");Z(this,"version");Z(this,"nrversion");Z(this,"lastUpdated");Z(this,"costIndex");Z(this,"fullFilePath");Z(this,"errors")}init(r=!0){this.initialized||(this.initialized=!0,this.generateImports(r),this.resolveAllLinks(this.imports,r),this.generateCostIndex())}process(){if(this.loaded)return;this.loaded=!0,this.init();const r=this.generateUnits(),n=this.generateCategories(r);this.categories=Object.values(n),this.generateForces(n),this.generateExtraConstraints()}processForWiki(r){if(this.loaded_wiki)return;this.loaded_wiki=!0,this.process();const n=r.rules||{};r.rules=n,this.imports.forEach(s=>{qt(s,"links",this)});function i(s,o){s.parent=o,s.target&&qt(s.target,"links",o),s instanceof dn&&(n[s.id]=s)}gn(this,i,bu);for(const s of this.forces||[]){s.parent=this;for(const o of s.categories)o.parent=s}}processForEditor(){this.loaded_editor||(this.loaded_editor=!0,this.init(!1),this.gameSystem&&qt(this.gameSystem,"links",this),gn(this,(r,n)=>{if(r.parent=n,r.catalogue=this,r.target&&qt(r.target,"links",r),r.isProfile()&&!r.isLink()){const s=this.findOptionById(r.typeId);s&&qt(s,"links",r)}const i=r.value;if(i){const s=this.findOptionById(i);s&&qt(s,"other_links",r)}this.refreshErrors(r)},ra))}get url(){return"%{book}"}isCatalogue(){return!0}isGameSystem(){return this.gameSystemId===this.id||!this.gameSystemId}isIdUnique(){return!0}getCatalogue(){return this}getGameSystem(){return this.isGameSystem()?this:this.gameSystem}getSystemId(){return this.isGameSystem()?this.id:this.gameSystemId}addError(r,n){this.removeError(r,n.id),r.errors||(r.errors=[]),this.errors||(this.errors=[]),r.errors.push(n),this.errors.push(n)}onRemoveError(r,n=!0){if(this.errors){const i=this.errors.indexOf(r);i>=0&&this.errors.splice(i,1)}if(r.other&&n){const i=r.other;i.getCatalogue().removeError(i,"duplicate-id-1",!1),i.getCatalogue().removeError(i,"duplicate-id-2",!1)}}removeErrors(r){var n;(n=r.errors)==null||n.forEach(i=>this.onRemoveError(i)),delete r.errors}removeError(r,n,i=!0){var s;(s=r.errors)!=null&&s.length&&(r.errors=r.errors.filter(o=>(o.id===n&&this.onRemoveError(o,i),o.id!==n)))}*iterateCategoryEntries(){for(const r of this.imports)for(const n of r.categoryEntries||[])yield n;this.categoryEntries&&(yield*this.categoryEntries)}*iterateCostTypes(){for(const r of this.imports)for(const n of r.costTypes||[])yield n;this.costTypes&&(yield*this.costTypes)}*forcesIterator(){for(const r of this.imports)for(const n of r.forceEntries||[])yield n;this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}*iterateProfileTypes(){for(const r of this.importsWithEntries)r.profileTypes&&(yield*r.profileTypes);this.profileTypes&&(yield*this.profileTypes)}*iteratePublications(){for(const r of this.imports)for(const n of r.publications||[])yield n;for(const r of this.publications||[])yield r}*iterateSelectionEntries(){for(const r of this.importsWithEntries){for(const n of r.sharedSelectionEntries||[])yield n;for(const n of r.sharedSelectionEntryGroups||[])yield n}this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllImported(){const r=["sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","categoryEntries"],n=["rules","entryLinks","profiles","infoGroups","selectionEntries","selectionEntryGroups"];for(const i of this.importsWithEntries)for(const s of n)for(const o of i[s]||[])o.import!==!1&&(yield o);for(const i of this.imports)for(const s of r)for(const o of i[s]||[])yield o;for(const i of n)for(const s of this[i]||[])yield s;for(const i of r)for(const s of this[i]||[])yield s}*iterateSelectionEntriesWithRoot(){for(const r of this.importsWithEntries){for(const n of r.selectionEntries||[])n.import!==!1&&(yield n);for(const n of r.entryLinks||[])n.import!==!1&&(yield n);for(const n of r.sharedSelectionEntries||[])yield n;for(const n of r.sharedSelectionEntryGroups||[])yield n}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllRootEntries(){for(const r of this.importsWithEntries){for(const n of r.selectionEntries||[])n.import!==!1&&(yield n);for(const n of r.entryLinks||[])n.import!==!1&&(yield n)}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.selectionEntries&&(yield*this.selectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}forEachNode(r){if(r(this),this.childs)for(const n of this.childs)n.forEachNode(r)}*selectionsIterator(){yield*this.forces}findOptionById(r){var s;const n=this.index[r];if(n)return n;const i=(s=this.imports.find(o=>r in o.index))==null?void 0:s.index[r];if(i)return i;this.book&&this.manager.getLoadedCatalogue(r)}findOptionByIdGlobal(r){var s;const n=this.index[r];if(n)return n;const i=(s=this.imports.find(o=>r in o.index))==null?void 0:s.index[r];if(i)return i;if(this.manager){const o=this.manager.findOptionById(r);return o||this.manager.getCatalogueInfo({targetId:r})}}findOptionsById(r){const n=[];for(const i of[this,...this.imports])for(const s of Object.values(i.index))s.id&&s.id===r&&n.push(s);return n}findOptionsByText(r){var s,o,a;if(!r||!r.trim()){const l=[];for(const c of[this,...this.imports])for(const f of Object.values(c.index))if(f.getName){if(f.isLink()&&f.target&&f.isCategory()&&!((s=f.parent)!=null&&s.isForce()))continue;l.push(f)}else console.log(f);return l}const n=[],i=Ho(r);for(const l of[this,...this.imports])for(const c of Object.values(l.index)){const f=(o=c.getName)==null?void 0:o.call(c);if(f&&String(f).match(i)){if(c.isLink()&&c.target&&c.isCategory()&&!((a=c.parent)!=null&&a.isForce()))continue;n.push(c)}}return n}generateNonConflictingId(){for(;;){const r=xr();if(this.findOptionById(r)===void 0)return r}}generateCostIndex(){const r={};for(const n of this.imports)for(const i of n.costTypes||[])r[i.id]=i,this.index[i.id]=i;for(const n of this.costTypes||[])r[n.id]=n,this.index[n.id]=n;return this.costIndex=r,r}generateImports(r=!0){const n={},i={};this.gameSystem&&(this.gameSystem.init(r),n[this.gameSystem.id]=this.gameSystem,i[this.gameSystem.id]=this.gameSystem,this.gameSystem.import||(this.gameSystem.imports=[]));for(const s of this.catalogueLinks||[]){const o=s.target;if(o){o.init(r);for(const a of o.imports)i[a.id]=a;for(const a of o.importsWithEntries)n[a.id]=a;s.importRootEntries&&(n[o.id]=o),i[o.id]=o}}return this.imports=Object.values(i),this.importsWithEntries=Object.values(n),this.imports}generateForces(r){var i,s;const n=[];for(const o of this.forcesIterator()){const a=wr(o);a.main_catalogue=this;const l=[];(s=(i=r[Ie])==null?void 0:i.units)!=null&&s.length&&l.push(r[Ie]);const c=new Set;for(const d of o.categoryLinks||[])if(d.targetId in r){const p=wr(d);p.main_catalogue=this;const g=r[p.targetId];p.target=g,p.childs=g.childs;for(const b of p.childs)c.add(b.id);l.push(p)}const f=this.units.filter(d=>!c.has(d.id));if(f.length){const d=wr(r[ri]);d.childs=f,d.units=f,l.push(d)}a.childs=l,a.categories=l,this.index[a.id]=a,a.forceEntries&&a.generateForces(r),n.push(a)}return this.forces=n,this.childs=n,n}generateCategories(r){const n={};for(const a of this.iterateCategoryEntries()){const l=wr(a);l.main_catalogue=this;const c=r[l.id]||[];l.units=c,l.childs=c,this.index[a.id]=a,n[l.id]=l}const i=r[Ie]||[],s={name:"Uncategorized",id:Ie,hidden:!1,units:i,childs:i,catalogue:this};n[Ie]=Object.setPrototypeOf(s,Er.prototype);const o={name:"Illegal Units",id:ri,hidden:!0,units:[],childs:[],catalogue:this};return n[ri]=Object.setPrototypeOf(o,Er.prototype),n}generateUnits(){const r=[];for(const s of this.importsWithEntries){const o=s.isGameSystem();for(const a of s.selectionEntries||[])(o||a.import!==!1)&&r.push(a);for(const a of s.entryLinks||[])(o||a.import!==!1)&&r.push(a)}for(const s of this.selectionEntries||[])r.push(s);for(const s of this.entryLinks||[])r.push(s);const n=hu(r,s=>s.getName());return this.units=n,cu(n,s=>s.getPrimaryCategory())}generateExtraConstraints(){const r={},n=[],i={},s=new Set,o={};function a(l,c,f){const d=c.target||c;for(const p of f){const g=`${p.id}::${c.id}`;switch(p.scope){case"parent":break;case"roster":r[g]=c.getBoundConstraint(p);break;case"force":n.push(c.getBoundConstraint(p));break;case"primary-category":case"primary-catalogue":console.warn(`unsupported scope:${p.scope} from category ${c.getName()} ${c.getId()}`);break;default:if(s.has(p.scope)){qt(i,p.scope,d.getBoundConstraint(p));break}const b=l.index[p.scope];if(b){const y=b.extra_constraints||[];y.push(c.getBoundConstraint(p)),b.extra_constraints=y;break}console.warn(`unsupported scope:${p.scope} from category ${c.getName()} ${c.getId()}`);break}}}for(const l of this.forcesIteratorRecursive()){s.add(l.id);for(const c of l.categories)c.constraints&&a(this,c,c.constraints.filter(f=>f.scope==="roster"))}for(const l of this.categories)s.add(l.id);for(const l of this.categories){a(this,l,l.constraintsIterator());const c={};l.forEachNodeCb(f=>{var d;if(f&&!f.isForce()&&(!f.isGroup()&&!f.extra_constraints&&(f.extra_constraints=f.getChildBoundConstraints(!0)),!(f.isCategory()&&f.isLink())&&!(!f.constraints&&!((d=f.target)!=null&&d.constraints)))){for(const p of f.constraintsIterator())if(p.type==="min"||p.type==="exactly"){const g=`${p.id}::${f.id}`;switch(p.scope){case"parent":break;case"roster":r[g]=f.getBoundConstraint(p);break;case"force":c[g]=f.getBoundConstraint(p);break;case"primary-category":case"primary-catalogue":console.warn(`unsupported scope:${p.scope} from ${f.getName()} ${f.id}`);break;default:if(s.has(p.scope)){qt(i,p.scope,f.getBoundConstraint(p));break}const b=this.index[p.scope];if(b){const y=b.extra_constraints||[];y.push(f.getBoundConstraint(p)),b.extra_constraints=y;break}console.warn(`unsupported scope:${p.scope} from ${f.getName()}${f.id}`);break}}}}),o[l.getId()]=Object.values(c)}for(const l of this.forcesIteratorRecursive()){const c=l.extra_constraints||[];c.push(...n),l.id in i&&c.push(...i[l.id]),c.length&&(l.extra_constraints=c);for(const f of l.categories)f.getId()in o&&c.push(...o[f.getId()]);c.length&&(l.extra_constraints=c)}for(const l of this.categories){const c=l.extra_constraints||[];l.id in i&&c.push(...i[l.id]),c.length&&(l.extra_constraints=c)}this.roster_constraints=Object.values(r)}async reload(r){const n=r;delete this.loaded,delete this.loaded_editor;const i=this.isGameSystem()?"gameSystem":"catalogue";return await n.loadData({[i]:this})}refreshErrors(r){var n;r.isLink()?r.target?this.removeError(r,"no-target"):(this.addError(r,{source:r,severity:"error",msg:"Link has no target",id:"no-target"}),(n=this.unresolvedLinks[r.targetId])!=null&&n.includes(se(r))||qt(this.unresolvedLinks,r.targetId,se(r))):r.isProfile()?r.typeId?this.removeError(r,"no-profile-type"):this.addError(r,{source:r,severity:"error",msg:"Profile has no type",id:"no-profile-type"}):r instanceof Je&&this.updateCondition(r)}addToIndex(r){var n,i;if(r.id){if(r.catalogue=this,this.index[r.id]&&this.index[r.id]!==r){const s=this.index[r.id];(r.isIdUnique()||s.isIdUnique()||r.getName()!==s.getName())&&(this.addError(s,{source:s,severity:"error",msg:`Duplicate id ${r.id} ${r.getName()}`,id:"duplicate-id-1",other:r}),this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${s.getName()}`,id:"duplicate-id-2",other:s}))}if(this.index[r.id]=r,this.unresolvedLinks&&this.unresolvedLinks[r.id])for(const s of this.unresolvedLinks[r.id])s.isLink()?this.refreshErrors(s):this.updateLink(s);if((n=this.manager)!=null&&n.unresolvedLinks&&((i=this.manager.unresolvedLinks[r.id])!=null&&i.length))for(const s of this.manager.unresolvedLinks[r.id])s.catalogue.refreshErrors(s)}}removeFromIndex(r){r.id&&this.index[r.id]===r&&delete this.index[r.id],this.removeErrors(r);for(const n of r.links||[])delete n.target,n.catalogue.refreshErrors(n);for(const n of r.other_links||[])n.catalogue.refreshErrors(n)}resolveAllLinks(r,n=!0){const i=[],s=[],o=[],a=[],l=[];this.index||(this.index=Ou(),gn(this,(f,d)=>{this.addToIndex(f),f.publicationId&&s.push(f),f.isLink()&&(i.push(f),a.push(d)),Cu(f)&&o.push(f)},is)),l.push(this.index);for(const f of r)l.push(f.index);const c=ku(i,l,a,n);if(Su(s,l),Iu(o,l),!n){this.unresolvedLinks={};for(const f of c)qt(this.unresolvedLinks,f.targetId,f)}}removeRef(r,n){n.links||(n.links=[]);const i=n.links.indexOf(r);i>=0&&n.links.splice(i,1)}addRef(r,n){n.links||(n.links=[]),n.links.push(r)}removeOtherRef(r,n){n.other_links||(n.other_links=[]);const i=n.other_links.indexOf(r);i>=0&&n.other_links.splice(i,1)}addOtherRef(r,n){n.other_links||(n.other_links=[]),n.other_links.push(r)}updateLink(r){if(r.target&&this.removeRef(r,r.target),r.target=this.findOptionById(r.targetId),r.target&&this.addRef(r,r.target),r.target!=null){const n=r.target.editorTypeName;n=="category"?delete r.type:r.type=n}return this.refreshErrors(r),r.target!==void 0}updateCondition(r,n){var s;if(["exactly","min","max"].includes(r.type))return;const i=["instanceOf","notInstanceOf"].includes(r.type);if(n&&!Qs.has(n)){const o=i?this.findOptionByIdGlobal(n):this.findOptionById(n);o&&this.removeOtherRef(r,o)}if(r.childId){if(Qs.has(r.childId)){this.removeError(r,"id-not-exist");return}const o=i?this.findOptionByIdGlobal(r.childId):this.findOptionById(r.childId);if(o){this.addOtherRef(r,o),this.removeError(r,"id-not-exist"),du(this.manager.unresolvedLinks,r.childId,r);return}(s=this.manager.unresolvedLinks[r.childId])!=null&&s.includes(r)||qt(this.manager.unresolvedLinks,r.childId,r)}this.addError(r,{source:r,severity:"warning",msg:"child id does not exist",id:"id-not-exist"})}unlinkLink(r){r.target&&this.removeRef(r,r.target)}}function ku(e=[],t,r,n=!0){const i=e.length;let s=0;for(;e.length!==s;){const o=e,a=r;s=o.length,e=[],r=[];for(let l=0;l<o.length;l++){const c=o[l],f=a[l],d=c.targetId;let p;for(const g of t)if(d in g){p=g[d];break}if(p){c.target=p;continue}e.push(c),r.push(f)}}if(e.length&&n){console.warn(`${i-e.length}/${i} links resolved in ${e[0].catalogue.name}`),console.log(`unresolved links: ${e.map(o=>`${o.id} -> ${o.targetId}`)}`);for(let o=0;o<e.length;o++){const a=e[o],l=r[o];for(const[c,f]of Object.entries(l))if(f===a&&delete l[c],Array.isArray(f))for(const d in f)f[d]===a&&f.splice(d,1)}}return e}function Su(e=[],t){for(const r of e)for(const n of t)if(r.publicationId in n){r.publication=n[r.publicationId];break}}function Iu(e=[],t){for(const r of e){const n=r.childId;for(const i of t)if(n in i){r.childId=i[n].getId();break}}}function Cu(e){return e.shared!==!1&&e.childId!==void 0}class Nu{get[Symbol.toStringTag](){return"ObjectNoObserve"}}function Ou(){return new Nu}function vr(e){return yu(e,r=>!(r instanceof ta||r instanceof Je||r instanceof ea))}function Bu(e,t){if(!e)return;const r=e.getCatalogue();if(e.parent){const i=vr(e);if(i){for(const s of i.constraintsIterator())if(s.id===t)return s}}return r.findOptionById(t)}function $e(e,t){if(e){const r=e.catalogue||e,n=Bu(e,t);if(n){const s=n.type;if(s&&["min","max","exactly"].includes(s))return Tu(e,n);if(n.name)return n.isCategory&&n.isCategory()?`${n.name}`:n.url?`${n.name}`:n.name}const i=r.manager;if(i){const s=r.manager.findOptionById(t)||i.getCatalogueInfo({targetId:t});return(s==null?void 0:s.name)||t}}return t}function Xs(e,t,r=!1,n=$e){const i=t.type||"none",s=t.value===void 0?1:t.percentValue?`${t.value}%`:t.value,o=n(e,t.field),a=["selections","forces"].includes(o)?` ${o}`:` ${o}`,l=n(e,t.childId||"")+(r?`(${t.childId||"any"})`:""),c=l&&a?"of ":"",f=n(e,t.scope),d=f===(e==null?void 0:e.getName())?"":`${f}`,p=t.includeChildSelections?" (recursive)":"",g=d?` in ${d}${p}`:"";switch(i){case"instanceOf":return`${d} is ${l}`;case"notInstanceOf":return`${d} is not ${l}`;case"atLeast":return`${s}+${a} ${c}${l}${g}`;case"greaterThan":return`${Number(s)+1}+${a} ${c}${l}${g}`;case"atMost":return`${s}${s===0?"":"-"}${a} ${c}${l}${g}`;case"lessThan":return`${Number(s)-1}${Number(s)-1===0?"":"-"}${a} ${c}${l}${g}`;case"equalTo":return`${s}${a} ${c}${l}${g}`;case"notEqualTo":return`not ${s}${a} ${c}${l}${g}`;case"none":return`${a} ${c}${l}${g}`;default:return`${i} ${s}${a} ${c}${l}${g}`}}function Tu(e,t,r=$e){const n=t.field==="selections"?"":` ${r(e,t.field)}`,i=t.scope==="parent"?"":`(${r(e,t.scope)})`,s=t.childId?` ${r(e,t.childId)}`:"";return`${t.type}${n}${s}${i}`}function Lu(e,t,r=$e){var n;return`${t.type} ${r(e,t.field)} ${r(e,(n=t.value)==null?void 0:n.toString())}`}function na(e){return e.arrayBuffer?e.arrayBuffer():new Promise((t,r)=>{const n=new FileReader;n.addEventListener("loadend",()=>{t(n.result)}),n.addEventListener("error",r),n.readAsArrayBuffer(e)})}async function Ru(e){const t=await na(e);return new Uint8Array(t)}function ia(e){return typeof Blob<"u"&&e instanceof Blob}function zr(e){return typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer}const Fu=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function Pu(e){return e.byteOffset===0&&e.byteLength===e.buffer.byteLength}class Hs{constructor(t){this.typedArray=t instanceof ArrayBuffer||zr(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,r){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,r)}}class Js{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,r){const n=this.blob.slice(t,t+r),i=await na(n);return new Uint8Array(i)}async sliceAsBlob(t,r,n=""){return this.blob.slice(t,t+r,n)}}function Uu(e,t){var r=Uint8Array;if(e[0]==3&&e[1]==0)return t||new r(0);var n=Gu,i=sa,s=zu,o=oa,a=t==null;a&&(t=new r(e.length>>>2<<3));for(var l=0,c=0,f=0,d=0,p=0,g=0,b=0,y=0,_=0,w,E;l==0;){if(l=n(e,_,1),c=n(e,_+1,2),_+=3,c==0){_&7&&(_+=8-(_&7));var S=(_>>>3)+4,I=e[S-4]|e[S-3]<<8;a&&(t=ai(t,y+I)),t.set(new r(e.buffer,e.byteOffset+S,I),y),_=S+I<<3,y+=I;continue}if(a&&(t=ai(t,y+(1<<17))),c==1&&(w=at.flmap,E=at.fdmap,g=512-1,b=32-1),c==2){f=i(e,_,5)+257,d=i(e,_+5,5)+1,p=i(e,_+10,4)+4,_+=14;for(var C=0;C<38;C+=2)at.itree[C]=0,at.itree[C+1]=0;for(var O=1,C=0;C<p;C++){var T=i(e,_+C*3,3);at.itree[(at.ordr[C]<<1)+1]=T,T>O&&(O=T)}_+=3*p,kr(at.itree,O),Sr(at.itree,O,at.imap),w=at.lmap,E=at.dmap,_=s(at.imap,(1<<O)-1,f+d,e,_,at.ttree);var G=$s(at.ttree,0,f,at.ltree);g=(1<<G)-1;var L=$s(at.ttree,f,d,at.dtree);b=(1<<L)-1,kr(at.ltree,G),Sr(at.ltree,G,w),kr(at.dtree,L),Sr(at.dtree,L,E)}for(;;){var j=w[o(e,_)&g];_+=j&15;var Y=j>>>4;if(!(Y>>>8))t[y++]=Y;else{if(Y==256)break;var N=y+Y-254;if(Y>264){var z=at.ldef[Y-257];N=y+(z>>>3)+i(e,_,z&7),_+=z&7}var A=E[o(e,_)&b];_+=A&15;var K=A>>>4,et=at.ddef[K],M=(et>>>4)+n(e,_,et&15);for(_+=et&15,a&&(t=ai(t,y+(1<<17)));y<N;)t[y]=t[y++-M],t[y]=t[y++-M],t[y]=t[y++-M],t[y]=t[y++-M];y=N}}}return t.length==y?t:t.slice(0,y)}function ai(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function zu(e,t,r,n,i,s){for(var o=sa,a=oa,l=0;l<r;){var c=e[a(n,i)&t];i+=c&15;var f=c>>>4;if(f<=15)s[l]=f,l++;else{var d=0,p=0;f==16?(p=3+o(n,i,2),i+=2,d=s[l-1]):f==17?(p=3+o(n,i,3),i+=3):f==18&&(p=11+o(n,i,7),i+=7);for(var g=l+p;l<g;)s[l]=d,l++}}return i}function $s(e,t,r,n){for(var i=0,s=0,o=n.length>>>1;s<r;){var a=e[s+t];n[s<<1]=0,n[(s<<1)+1]=a,a>i&&(i=a),s++}for(;s<o;)n[s<<1]=0,n[(s<<1)+1]=0,s++;return i}function kr(e,t){for(var r=e.length,n,i,s,o,a,l=at.bl_count,o=0;o<=t;o++)l[o]=0;for(o=1;o<r;o+=2)l[e[o]]++;var c=at.next_code;for(n=0,l[0]=0,i=1;i<=t;i++)n=n+l[i-1]<<1,c[i]=n;for(s=0;s<r;s+=2)a=e[s+1],a!=0&&(e[s]=c[a],c[a]++)}function Sr(e,t,r){for(var n=e.length,i=at.rev15,s=0;s<n;s+=2)if(e[s+1]!=0)for(var o=s>>1,a=e[s+1],l=o<<4|a,c=t-a,f=e[s]<<c,d=f+(1<<c);f!=d;){var p=i[f]>>>15-t;r[p]=l,f++}}function to(e,t){for(var r=at.rev15,n=15-t,i=0;i<e.length;i+=2){var s=e[i]<<t-e[i+1];e[i]=r[s]>>>n}}function sa(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function Gu(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function oa(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}const at=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,at.rev15[t]=(r>>>16|r<<16)>>>17}function n(i,s,o){for(;s--!=0;)i.push(0,o)}for(var t=0;t<32;t++)at.ldef[t]=at.of0[t]<<3|at.exb[t],at.ddef[t]=at.df0[t]<<4|at.dxb[t];n(at.fltree,144,8),n(at.fltree,255-143,9),n(at.fltree,279-255,7),n(at.fltree,287-279,8),kr(at.fltree,9),Sr(at.fltree,9,at.flmap),to(at.fltree,9),n(at.fdtree,32,5),kr(at.fdtree,5),Sr(at.fdtree,5,at.fdmap),to(at.fdtree,5),n(at.itree,19,0),n(at.ltree,286,0),n(at.dtree,30,0),n(at.ttree,320,0)})();const eo={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}(),update:function(e,t,r,n){for(var i=0;i<n;i++)e=eo.table[(e^t[r+i])&255]^e>>>8;return e},crc:function(e,t,r){return eo.update(4294967295,e,t,r)^4294967295}};function Mu(e,t){return Uu(e,t)}const ro={numWorkers:1,workerURL:"",useWorkers:!1};let Du=0;const mn=[];function li(e){return new Promise((t,r)=>{const n=new Worker(e);n.onmessage=i=>{i.data==="start"?(n.onerror=void 0,n.onmessage=void 0,t(n)):r(new Error(`unexpected message: ${i.data}`))},n.onerror=r})}function Ku(e,t){return e.require?e.require(t):{}}(function(){if(Fu){const{Worker:e}=Ku(module,"worker_threads");return{async createWorker(t){return new e(t)},addEventListener(t,r){t.on("message",n=>{r({target:t,data:n})})},async terminate(t){await t.terminate()}}}else return{async createWorker(e){try{return await li(e)}catch{console.warn("could not load worker:",e)}let t;try{const r=await fetch(e,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${e}`);t=await r.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const n=await li(e);return ro.workerURL=e,n}catch{console.warn("could not load worker via fetch:",e)}if(t!==void 0)try{e=`data:application/javascript;base64,${btoa(t)}`;const r=await li(e);return ro.workerURL=e,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}}})();function ju(e,t,r,n){const i=new Uint8Array(t);Mu(e,i),n(r?new Blob([i],{type:r}):i.buffer)}async function Wu(){if(mn.length!==0)for(;mn.length;){const{src:e,uncompressedSize:t,type:r,resolve:n}=mn.shift();let i=e;ia(e)&&(i=await Ru(e)),ju(i,t,r,n)}}function aa(e,t,r){return new Promise((n,i)=>{mn.push({src:e,uncompressedSize:t,type:r,resolve:n,reject:i,id:Du++}),Wu()})}function Zu(e,t){const r=e&31,n=(e>>5&15)-1,i=(e>>9&127)+1980,s=0,o=(t&31)*2,a=t>>5&63,l=t>>11&31;return new Date(i,n,r,l,a,o,s)}class Vu{constructor(t,r){this._reader=t,this._rawEntry=r,this.name=r.name,this.nameBytes=r.nameBytes,this.size=r.uncompressedSize,this.compressedSize=r.compressedSize,this.comment=r.comment,this.commentBytes=r.commentBytes,this.compressionMethod=r.compressionMethod,this.lastModDate=Zu(r.lastModFileDate,r.lastModFileTime),this.isDirectory=r.uncompressedSize===0&&r.name.endsWith("/"),this.encrypted=!!(r.generalPurposeBitFlag&1),this.externalFileAttributes=r.externalFileAttributes,this.versionMadeBy=r.versionMadeBy}async blob(t="application/octet-stream"){return await nc(this._reader,this._rawEntry,t)}async arrayBuffer(){return await rc(this._reader,this._rawEntry)}async text(){const t=await this.arrayBuffer();return Ir(new Uint8Array(t))}async json(){const t=await this.text();return JSON.parse(t)}}const ui=22,Qu=65535,qu=101010256,Yu=101075792;async function nr(e,t,r){return await e.read(t,r)}async function xi(e,t,r,n){return e.sliceAsBlob?await e.sliceAsBlob(t,r,n):await e.read(t,r)}const Xu={unsigned(){return 0}};function Tt(e,t){return e[t]+e[t+1]*256}function Ut(e,t){return e[t]+e[t+1]*256+e[t+2]*65536+e[t+3]*16777216}function Ne(e,t){return Ut(e,t)+Ut(e,t+4)*4294967296}const Hu=new TextDecoder;function Ir(e,t){return zr(e.buffer)&&(e=new Uint8Array(e)),Hu.decode(e)}async function Ju(e,t){const r=Math.min(ui+Qu,t),n=t-r,i=await nr(e,n,r);for(let s=r-ui;s>=0;--s){if(Ut(i,s)!==qu)continue;const o=new Uint8Array(i.buffer,i.byteOffset+s,i.byteLength-s),a=Tt(o,4);if(a!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${a}`);const l=Tt(o,10),c=Ut(o,12),f=Ut(o,16),d=Tt(o,20),p=o.length-ui;if(d!==p)throw new Error(`invalid comment length. expected: ${p}, actual: ${d}`);const g=new Uint8Array(o.buffer,o.byteOffset+22,d),b=Ir(g);return l===65535||f===4294967295?await tc(e,n+s,b,g):await la(e,f,c,l,b,g)}throw new Error("could not find end of central directory. maybe not zip file")}const $u=117853008;async function tc(e,t,r,n){const i=t-20,s=await nr(e,i,20);if(Ut(s,0)!==$u)throw new Error("invalid zip64 end of central directory locator signature");const o=Ne(s,8),a=await nr(e,o,56);if(Ut(a,0)!==Yu)throw new Error("invalid zip64 end of central directory record signature");const l=Ne(a,32),c=Ne(a,40),f=Ne(a,48);return la(e,f,c,l,r,n)}const ec=33639248;async function la(e,t,r,n,i,s){let o=0;const a=await nr(e,t,r),l=[];for(let f=0;f<n;++f){const d=a.subarray(o,o+46),p=Ut(d,0);if(p!==ec)throw new Error(`invalid central directory file header signature: 0x${p.toString(16)}`);const g={versionMadeBy:Tt(d,4),versionNeededToExtract:Tt(d,6),generalPurposeBitFlag:Tt(d,8),compressionMethod:Tt(d,10),lastModFileTime:Tt(d,12),lastModFileDate:Tt(d,14),crc32:Ut(d,16),compressedSize:Ut(d,20),uncompressedSize:Ut(d,24),fileNameLength:Tt(d,28),extraFieldLength:Tt(d,30),fileCommentLength:Tt(d,32),internalFileAttributes:Tt(d,36),externalFileAttributes:Ut(d,38),relativeOffsetOfLocalHeader:Ut(d,42)};if(g.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");o+=46;const b=a.subarray(o,o+g.fileNameLength+g.extraFieldLength+g.fileCommentLength);g.nameBytes=b.slice(0,g.fileNameLength),g.name=Ir(g.nameBytes);const y=g.fileNameLength+g.extraFieldLength,_=b.slice(g.fileNameLength,y);g.extraFields=[];let w=0;for(;w<_.length-3;){const S=Tt(_,w+0),I=Tt(_,w+2),C=w+4,O=C+I;if(O>_.length)throw new Error("extra field length exceeds extra field buffer size");g.extraFields.push({id:S,data:_.slice(C,O)}),w=O}if(g.commentBytes=b.slice(y,y+g.fileCommentLength),g.comment=Ir(g.commentBytes),o+=b.length,g.uncompressedSize===4294967295||g.compressedSize===4294967295||g.relativeOffsetOfLocalHeader===4294967295){const S=g.extraFields.find(O=>O.id===1);if(!S)throw new Error("expected zip64 extended information extra field");const I=S.data;let C=0;if(g.uncompressedSize===4294967295){if(C+8>I.length)throw new Error("zip64 extended information extra field does not include uncompressed size");g.uncompressedSize=Ne(I,C),C+=8}if(g.compressedSize===4294967295){if(C+8>I.length)throw new Error("zip64 extended information extra field does not include compressed size");g.compressedSize=Ne(I,C),C+=8}if(g.relativeOffsetOfLocalHeader===4294967295){if(C+8>I.length)throw new Error("zip64 extended information extra field does not include relative header offset");g.relativeOffsetOfLocalHeader=Ne(I,C),C+=8}}const E=g.extraFields.find(S=>S.id===28789&&S.data.length>=6&&S.data[0]===1&&Ut(S.data,1),Xu.unsigned(g.nameBytes));if(E&&(g.fileName=Ir(E.data.slice(5))),g.compressionMethod===0){let S=g.uncompressedSize;if(g.generalPurposeBitFlag&1&&(S+=12),g.compressedSize!==S)throw new Error(`compressed size mismatch for stored file: ${g.compressedSize} != ${S}`)}l.push(g)}return{zip:{comment:i,commentBytes:s},entries:l.map(f=>new Vu(e,f))}}async function ua(e,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const r=await nr(e,t.relativeOffsetOfLocalHeader,30),n=await e.getLength(),i=Ut(r,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const s=Tt(r,26),o=Tt(r,28),a=t.relativeOffsetOfLocalHeader+r.length+s+o;let l;if(t.compressionMethod===0)l=!1;else if(t.compressionMethod===8)l=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);const c=a,f=c+t.compressedSize;if(t.compressedSize!==0&&f>n)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${n}`);return{decompress:l,fileDataStart:c}}async function rc(e,t){const{decompress:r,fileDataStart:n}=await ua(e,t);if(!r){const o=await nr(e,n,t.compressedSize);return Pu(o)?o.buffer:o.slice().buffer}const i=await xi(e,n,t.compressedSize);return await aa(i,t.uncompressedSize)}async function nc(e,t,r){const{decompress:n,fileDataStart:i}=await ua(e,t);if(!n){const a=await xi(e,i,t.compressedSize,r);return ia(a)?a:new Blob([zr(a.buffer)?new Uint8Array(a):a],{type:r})}const s=await xi(e,i,t.compressedSize);return await aa(s,t.uncompressedSize,r)}async function ic(e){let t;if(typeof Blob<"u"&&e instanceof Blob)t=new Js(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new Hs(e);else if(zr(e)||zr(e.buffer))t=new Hs(e);else if(typeof e=="string"){const n=await fetch(e);if(!n.ok)throw new Error(`failed http request ${e}, status: ${n.status}: ${n.statusText}`);const i=await n.blob();t=new Js(i)}else if(typeof e.getLength=="function"&&typeof e.read=="function")t=e;else throw new Error("unsupported source type");const r=await t.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await Ju(t,r)}async function ca(e){const{zip:t,entries:r}=await ic(e);return{zip:t,entries:Object.fromEntries(r.map(n=>[n.name,n]))}}var as={},ls={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+r+"]*",i=new RegExp("^"+n+"$"),s=function(a,l){const c=[];let f=l.exec(a);for(;f;){const d=[];d.startIndex=l.lastIndex-f[0].length;const p=f.length;for(let g=0;g<p;g++)d.push(f[g]);c.push(d),f=l.exec(a)}return c},o=function(a){const l=i.exec(a);return!(l===null||typeof l>"u")};e.isExist=function(a){return typeof a<"u"},e.isEmptyObject=function(a){return Object.keys(a).length===0},e.merge=function(a,l,c){if(l){const f=Object.keys(l),d=f.length;for(let p=0;p<d;p++)c==="strict"?a[f[p]]=[l[f[p]]]:a[f[p]]=l[f[p]]}},e.getValue=function(a){return e.isExist(a)?a:""},e.isName=o,e.getAllMatches=s,e.nameRegexp=n})(ls);const us=ls,sc={allowBooleanAttributes:!1,unpairedTags:[]};as.validate=function(e,t){t=Object.assign({},sc,t);const r=[];let n=!1,i=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let s=0;s<e.length;s++)if(e[s]==="<"&&e[s+1]==="?"){if(s+=2,s=io(e,s),s.err)return s}else if(e[s]==="<"){let o=s;if(s++,e[s]==="!"){s=so(e,s);continue}else{let a=!1;e[s]==="/"&&(a=!0,s++);let l="";for(;s<e.length&&e[s]!==">"&&e[s]!==" "&&e[s]!=="	"&&e[s]!==`
`&&e[s]!=="\r";s++)l+=e[s];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),s--),!dc(l)){let d;return l.trim().length===0?d="Invalid space after '<'.":d="Tag '"+l+"' is an invalid name.",Ct("InvalidTag",d,Mt(e,s))}const c=lc(e,s);if(c===!1)return Ct("InvalidAttr","Attributes for '"+l+"' have open quote.",Mt(e,s));let f=c.value;if(s=c.index,f[f.length-1]==="/"){const d=s-f.length;f=f.substring(0,f.length-1);const p=oo(f,t);if(p===!0)n=!0;else return Ct(p.err.code,p.err.msg,Mt(e,d+p.err.line))}else if(a)if(c.tagClosed){if(f.trim().length>0)return Ct("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Mt(e,o));{const d=r.pop();if(l!==d.tagName){let p=Mt(e,d.tagStartPos);return Ct("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",Mt(e,o))}r.length==0&&(i=!0)}}else return Ct("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Mt(e,s));else{const d=oo(f,t);if(d!==!0)return Ct(d.err.code,d.err.msg,Mt(e,s-f.length+d.err.line));if(i===!0)return Ct("InvalidXml","Multiple possible root nodes found.",Mt(e,s));t.unpairedTags.indexOf(l)!==-1||r.push({tagName:l,tagStartPos:o}),n=!0}for(s++;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="!"){s++,s=so(e,s);continue}else if(e[s+1]==="?"){if(s=io(e,++s),s.err)return s}else break;else if(e[s]==="&"){const d=fc(e,s);if(d==-1)return Ct("InvalidChar","char '&' is not expected.",Mt(e,s));s=d}else if(i===!0&&!no(e[s]))return Ct("InvalidXml","Extra text at the end",Mt(e,s));e[s]==="<"&&s--}}else{if(no(e[s]))continue;return Ct("InvalidChar","char '"+e[s]+"' is not expected.",Mt(e,s))}if(n){if(r.length==1)return Ct("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",Mt(e,r[0].tagStartPos));if(r.length>0)return Ct("InvalidXml","Invalid '"+JSON.stringify(r.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ct("InvalidXml","Start tag expected.",1);return!0};function no(e){return e===" "||e==="	"||e===`
`||e==="\r"}function io(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const n=e.substr(r,t-r);if(t>5&&n==="xml")return Ct("InvalidXml","XML declaration allowed only at the start of the document.",Mt(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function so(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const oc='"',ac="'";function lc(e,t){let r="",n="",i=!1;for(;t<e.length;t++){if(e[t]===oc||e[t]===ac)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){i=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:i}}const uc=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function oo(e,t){const r=us.getAllMatches(e,uc),n={};for(let i=0;i<r.length;i++){if(r[i][1].length===0)return Ct("InvalidAttr","Attribute '"+r[i][2]+"' has no space in starting.",dr(r[i]));if(r[i][3]!==void 0&&r[i][4]===void 0)return Ct("InvalidAttr","Attribute '"+r[i][2]+"' is without value.",dr(r[i]));if(r[i][3]===void 0&&!t.allowBooleanAttributes)return Ct("InvalidAttr","boolean attribute '"+r[i][2]+"' is not allowed.",dr(r[i]));const s=r[i][2];if(!hc(s))return Ct("InvalidAttr","Attribute '"+s+"' is an invalid name.",dr(r[i]));if(!n.hasOwnProperty(s))n[s]=1;else return Ct("InvalidAttr","Attribute '"+s+"' is repeated.",dr(r[i]))}return!0}function cc(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function fc(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,cc(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function Ct(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function hc(e){return us.isName(e)}function dc(e){return us.isName(e)}function Mt(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function dr(e){return e.startIndex+e[1].length}var cs={};const fa={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},pc=function(e){return Object.assign({},fa,e)};cs.buildOptions=pc;cs.defaultOptions=fa;class gc{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,[":@"]:t[":@"]}):this.child.push({[t.tagname]:t.child})}}var mc=gc;function yc(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,i=!1,s=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!s){if(i&&bc(e,t))t+=7,[entityName,val,t]=wc(e,t+1),val.indexOf("&")===-1&&(r[entityName]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&_c(e,t))t+=8;else if(i&&Ac(e,t))t+=8;else if(i&&xc(e,t))t+=9;else if(vc)s=!0;else throw new Error("Invalid DOCTYPE");n++,o=""}else if(e[t]===">"){if(s?e[t-1]==="-"&&e[t-2]==="-"&&(s=!1,n--):n--,n===0)break}else e[t]==="["?i=!0:o+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function wc(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const n=e[t++];let i="";for(;t<e.length&&e[t]!==n;t++)i+=e[t];return[r,i,t]}function vc(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function bc(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function _c(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function Ac(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function xc(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}var Ec=yc;const kc=/^[-+]?0x[a-fA-F0-9]+$/,Sc=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ic={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Cc(e,t={}){if(t=Object.assign({},Ic,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&kc.test(r))return Number.parseInt(r,16);{const n=Sc.exec(r);if(n){const i=n[1],s=n[2];let o=Nc(n[3]);const a=n[4]||n[6];if(!t.leadingZeros&&s.length>0&&i&&r[2]!==".")return e;if(!t.leadingZeros&&s.length>0&&!i&&r[1]!==".")return e;{const l=Number(r),c=""+l;return c.search(/[eE]/)!==-1||a?t.eNotation?l:e:r.indexOf(".")!==-1?c==="0"&&o===""||c===o||i&&c==="-"+o?l:e:s?o===c||i+o===c?l:e:r===c||r===i+c?l:e}}else return e}}function Nc(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var Oc=Cc;const fs=ls,pr=mc,Bc=Ec,Tc=Oc;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,fs.nameRegexp);let Lc=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=Rc,this.parseXml=Gc,this.parseTextData=Fc,this.resolveNameSpace=Pc,this.buildAttributesMap=zc,this.isItStopNode=jc,this.replaceEntitiesValue=Dc,this.readStopNodeData=Zc,this.saveTextToParentTag=Kc,this.addChild=Mc}};function Rc(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Fc(e,t,r,n,i,s,o){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const a=this.options.tagValueProcessor(t,e,r,i,s);return a==null?e:typeof a!=typeof e||a!==e?a:this.options.trimValues?ki(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?ki(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Pc(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const Uc=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function zc(e,t,r){if(!this.options.ignoreAttributes&&typeof e=="string"){const n=fs.getAllMatches(e,Uc),i=n.length,s={};for(let o=0;o<i;o++){const a=this.resolveNameSpace(n[o][1]);let l=n[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const f=this.options.attributeValueProcessor(a,l,t);f==null?s[c]=l:typeof f!=typeof l||f!==l?s[c]=f:s[c]=ki(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[c]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=s,o}return s}}const Gc=function(e){e=e.replace(/\r\n?/g,`
`);const t=new pr("!xml");let r=t,n="",i="";for(let s=0;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="/"){const a=Oe(e,">",s,"Closing Tag is not closed.");let l=e.substring(s+2,a).trim();if(this.options.removeNSPrefix){const d=l.indexOf(":");d!==-1&&(l=l.substr(d+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),r&&(n=this.saveTextToParentTag(n,r,i));const c=i.substring(i.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${l}>`);let f=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(f=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):f=i.lastIndexOf("."),i=i.substring(0,f),r=this.tagsNodeStack.pop(),n="",s=a}else if(e[s+1]==="?"){let a=Ei(e,s,!1,"?>");if(!a)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,i),!(this.options.ignoreDeclaration&&a.tagName==="?xml"||this.options.ignorePiTags)){const l=new pr(a.tagName);l.add(this.options.textNodeName,""),a.tagName!==a.tagExp&&a.attrExpPresent&&(l[":@"]=this.buildAttributesMap(a.tagExp,i,a.tagName)),this.addChild(r,l,i)}s=a.closeIndex+1}else if(e.substr(s+1,3)==="!--"){const a=Oe(e,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){const l=e.substring(s+4,a-2);n=this.saveTextToParentTag(n,r,i),r.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}s=a}else if(e.substr(s+1,2)==="!D"){const a=Bc(e,s);this.docTypeEntities=a.entities,s=a.i}else if(e.substr(s+1,2)==="!["){const a=Oe(e,"]]>",s,"CDATA is not closed.")-2,l=e.substring(s+9,a);if(n=this.saveTextToParentTag(n,r,i),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]);else{let c=this.parseTextData(l,r.tagname,i,!0,!1,!0);c==null&&(c=""),r.add(this.options.textNodeName,c)}s=a+2}else{let a=Ei(e,s,this.options.removeNSPrefix),l=a.tagName,c=a.tagExp,f=a.attrExpPresent,d=a.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,i,!1));const p=r;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(r=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),l!==t.tagname&&(i+=i?"."+l:l),this.isItStopNode(this.options.stopNodes,i,l)){let g="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)s=a.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)s=a.closeIndex;else{const y=this.readStopNodeData(e,l,d+1);if(!y)throw new Error(`Unexpected end of ${l}`);s=y.i,g=y.tagContent}const b=new pr(l);l!==c&&f&&(b[":@"]=this.buildAttributesMap(c,i,l)),g&&(g=this.parseTextData(g,l,i,!0,f,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),b.add(this.options.textNodeName,g),this.addChild(r,b,i)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),c=l):c=c.substr(0,c.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const g=new pr(l);l!==c&&f&&(g[":@"]=this.buildAttributesMap(c,i,l)),this.addChild(r,g,i),i=i.substr(0,i.lastIndexOf("."))}else{const g=new pr(l);this.tagsNodeStack.push(r),l!==c&&f&&(g[":@"]=this.buildAttributesMap(c,i,l)),this.addChild(r,g,i),r=g}n="",s=d}}else n+=e[s];return t.child};function Mc(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}const Dc=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function Kc(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function jc(e,t,r){const n="*."+r;for(const i in e){const s=e[i];if(n===s||t===s)return!0}return!1}function Wc(e,t,r=">"){let n,i="";for(let s=t;s<e.length;s++){let o=e[s];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===r[0])if(r[1]){if(e[s+1]===r[1])return{data:i,index:s}}else return{data:i,index:s};else o==="	"&&(o=" ");i+=o}}function Oe(e,t,r,n){const i=e.indexOf(t,r);if(i===-1)throw new Error(n);return i+t.length-1}function Ei(e,t,r,n=">"){const i=Wc(e,t+1,n);if(!i)return;let s=i.data;const o=i.index,a=s.search(/\s/);let l=s,c=!0;if(a!==-1&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),r){const f=l.indexOf(":");f!==-1&&(l=l.substr(f+1),c=l!==i.data.substr(f+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c}}function Zc(e,t,r){const n=r;let i=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const s=Oe(e,">",r,`${t} is not closed`);if(e.substring(r+2,s).trim()===t&&(i--,i===0))return{tagContent:e.substring(n,r),i:s};r=s}else if(e[r+1]==="?")r=Oe(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=Oe(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=Oe(e,"]]>",r,"StopNode is not closed.")-2;else{const s=Ei(e,r,">");s&&((s&&s.tagName)===t&&s.tagExp[s.tagExp.length-1]!=="/"&&i++,r=s.closeIndex)}}function ki(e,t,r){if(t&&typeof e=="string"){const n=e.trim();return n==="true"?!0:n==="false"?!1:Tc(e,r)}else return fs.isExist(e)?e:""}var Vc=Lc,ha={};function Qc(e,t){return da(e,t)}function da(e,t,r){let n;const i={};for(let s=0;s<e.length;s++){const o=e[s],a=qc(o);let l="";if(r===void 0?l=a:l=r+"."+a,a===t.textNodeName)n===void 0?n=o[a]:n+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=da(o[a],t,l);const f=Xc(c,t);o[":@"]?Yc(c,o[":@"],l,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),i[a]!==void 0&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(c)):t.isArray(a,l,f)?i[a]=[c]:i[a]=c}}}return typeof n=="string"?n.length>0&&(i[t.textNodeName]=n):n!==void 0&&(i[t.textNodeName]=n),i}function qc(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function Yc(e,t,r,n){if(t){const i=Object.keys(t),s=i.length;for(let o=0;o<s;o++){const a=i[o];n.isArray(a,r+"."+a,!0,!0)?e[a]=[t[a]]:e[a]=t[a]}}}function Xc(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}ha.prettify=Qc;const{buildOptions:Hc}=cs,Jc=Vc,{prettify:$c}=ha,tf=as;let ef=class{constructor(t){this.externalEntities={},this.options=Hc(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const s=tf.validate(t,r);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}const n=new Jc(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(t);return this.options.preserveOrder||i===void 0?i:$c(i,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};var rf=ef;const nf=`
`;function sf(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=nf),pa(e,t,"",r)}function pa(e,t,r,n){let i="",s=!1;for(let o=0;o<e.length;o++){const a=e[o],l=of(a);let c="";if(r.length===0?c=l:c=`${r}.${l}`,l===t.textNodeName){let b=a[l];af(c,t)||(b=t.tagValueProcessor(l,b),b=ga(b,t)),s&&(i+=n),i+=b,s=!1;continue}else if(l===t.cdataPropName){s&&(i+=n),i+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,s=!1;continue}else if(l===t.commentPropName){i+=n+`<!--${a[l][0][t.textNodeName]}-->`,s=!0;continue}else if(l[0]==="?"){const b=ao(a[":@"],t),y=l==="?xml"?"":n;let _=a[l][0][t.textNodeName];_=_.length!==0?" "+_:"",i+=y+`<${l}${_}${b}?>`,s=!0;continue}let f=n;f!==""&&(f+=t.indentBy);const d=ao(a[":@"],t),p=n+`<${l}${d}`,g=pa(a[l],t,c,f);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?i+=p+">":i+=p+"/>":(!g||g.length===0)&&t.suppressEmptyNode?i+=p+"/>":g&&g.endsWith(">")?i+=p+`>${g}${n}</${l}>`:(i+=p+">",g&&n!==""&&(g.includes("/>")||g.includes("</"))?i+=n+t.indentBy+g+n:i+=g,i+=`</${l}>`),s=!0}return i}function of(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function ao(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){let i=t.attributeValueProcessor(n,e[n]);i=ga(i,t),i===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${i}"`}return r}function af(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function ga(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}var lf=sf;const uf=lf,cf={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function xe(e){this.options=Object.assign({},cf,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=df),this.processTextOrObjNode=ff,this.options.format?(this.indentate=hf,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}xe.prototype.build=function(e){return this.options.preserveOrder?uf(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)};xe.prototype.j2x=function(e,t){let r="",n="";for(let i in e)if(!(typeof e[i]>"u"))if(e[i]===null)i[0]==="?"?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)n+=this.buildTextValNode(e[i],i,"",t);else if(typeof e[i]!="object"){const s=this.isAttribute(i);if(s)r+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let o=this.options.tagValueProcessor(i,""+e[i]);n+=this.replaceEntitiesValue(o)}else n+=this.buildTextValNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const s=e[i].length;let o="";for(let a=0;a<s;a++){const l=e[i][a];typeof l>"u"||(l===null?i[0]==="?"?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar:typeof l=="object"?this.options.oneListGroup?o+=this.j2x(l,t+1).val:o+=this.processTextOrObjNode(l,i,t):o+=this.buildTextValNode(l,i,"",t))}this.options.oneListGroup&&(o=this.buildObjectNode(o,i,"",t)),n+=o}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const s=Object.keys(e[i]),o=s.length;for(let a=0;a<o;a++)r+=this.buildAttrPairStr(s[a],""+e[i][s[a]])}else n+=this.processTextOrObjNode(e[i],i,t);return{attrStr:r,val:n}};xe.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function ff(e,t,r){const n=this.j2x(e,r+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}xe.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,s="";return t[0]==="?"&&(s="?",i=""),r&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+s+">"+e+i:this.options.commentPropName!==!1&&t===this.options.commentPropName&&s.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+s+this.tagEndChar+e+this.indentate(n)+i}};xe.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t};xe.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),i===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+i+"</"+t+this.tagEndChar}};xe.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function hf(e){return this.options.indentBy.repeat(e)}function df(e){return e.startsWith(this.options.attributeNamePrefix)?e.substr(this.attrPrefixLen):!1}var pf=xe;const gf=as,mf=rf,yf=pf;var ma={XMLParser:mf,XMLValidator:gf,XMLBuilder:yf};const wf={catalogueLinks:{allowedChildrens:[]},publications:{allowedChildrens:[]},costTypes:{allowedChildrens:[]},profileTypes:{allowedChildrens:["characteristicTypes"]},categoryEntries:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},categoryLinks:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},forceEntries:{allowedChildrens:["forceEntries","categoryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","costs"]},entryLinks:{allowedChildrens:"type"},selectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},selectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},associations:{allowedChildrens:["constraints","modifiers","modifierGroups"]},sharedRules:{allowedChildrens:["modifiers","modifierGroups"]},rule:{allowedChildrens:["modifiers","modifierGroups"]},rules:{allowedChildrens:["modifiers","modifierGroups"]},profile:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},profiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},sharedProfiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},infoGroup:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoLinks:{allowedChildrens:"type"},modifiers:{allowedChildrens:["conditions","conditionGroups","repeats"]},modifierGroups:{allowedChildrens:["modifiers","modifierGroups","conditions","conditionGroups","repeats"]},conditions:{allowedChildrens:[]},conditionGroups:{allowedChildrens:["conditions","conditionGroups"]},catalogue:{allowedChildrens:["catalogueLinks","publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]},gameSystem:{allowedChildrens:["publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]}},Re={categories:"category",catalogueLinks:"catalogueLink",categoryEntries:"categoryEntry",categoryLinks:"categoryLink",characteristics:"characteristic",characteristicTypes:"characteristicType",conditions:"condition",conditionGroups:"conditionGroup",constraints:"constraint",costs:"cost",costLimits:"costLimit",costTypes:"costType",entryLinks:"entryLink",forceEntries:"forceEntry",infoGroups:"infoGroup",infoLinks:"infoLink",forces:"force",modifiers:"modifier",modifierGroups:"modifierGroup",profiles:"profile",profileTypes:"profileType",publications:"publication",repeats:"repeat",rules:"rule",selections:"selection",selectionEntries:"selectionEntry",selectionEntryGroups:"selectionEntryGroup",sharedInfoGroups:"infoGroup",sharedProfiles:"profile",sharedRules:"rule",sharedSelectionEntries:"selectionEntry",sharedSelectionEntryGroups:"selectionEntryGroup",associations:"association"},lo=/&(?:amp|lt|gt|quot|#39|apos);/g,vf={"&amp;":"&","&apos;":"'","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},uo=e=>lo.test(e)?e.replace(lo,t=>vf[t]):e,hs={};for(const e in Re)hs[Re[e]]=e;const ir={};for(const[e,t]of Object.entries(wf))typeof t.allowedChildrens=="string"?ir[e]=t.allowedChildrens:ir[e]=new Set(t.allowedChildrens);function bf(e,t){const r={allowBooleanAttributes:!0,ignoreAttributes:!1,attributeNamePrefix:"",textNodeName:"$text",parseAttributeValue:!0,processEntities:!1,parseTagValue:!1,ignoreDeclaration:!0,isArray:(n,i,s,o)=>!o&&n in hs,attributeValueProcessor:(n,i)=>uo(i),tagValueProcessor:(n,i)=>uo(i)};return new ma.XMLParser(r).parse(e)}async function Cp(e,t){const r=await ca(e),n={};console.log("unzipping folder",r,"path",t);for(const i in r.entries){const s=r.entries[i];if(s.isDirectory)continue;const o=Vs(Vs(i,t),"/");if(o.startsWith("."))continue;const a=ya(o)?await s.arrayBuffer():await s.text();n[o]=a}return n}async function _f(e){if(typeof e=="string"){var t=new TextEncoder;e=t.encode(e)}const r=await ca(e);for(const n of Object.values(r.entries))return await n.text();throw"unzipFile failed: No Entries"}const Af=["gstz","zip","catz"],xf=["gst","gstz","xml","zip","cat","catz","json"];function Kn(e){return e.split(".").pop().toLowerCase()}function ya(e){const t=Kn(e);return Af.includes(t)}function Ef(e){const t=Kn(e);return!!xf.includes(t)}const co={sharedRules:"shareRule",sharedProfiles:"sharedProfile",sharedInfoGroups:"sharedInfoGroup",sharedSelectionEntries:"sharedSelectionEntry",sharedSelectionEntryGroups:"sharedSelectionEntryGroup"};function Si(e){var t,r;for(let n in e)if(e[n]==="")delete e[n];else if(Re[n]&&e[n])if(n in co){const i=e[n][Re[n]],s=e[n][co[n]];e[n]=[...Array.isArray(i)?i:[],...Array.isArray(s)?s:[]],(t=e[n])==null||t.forEach(Si)}else{const i=e[n][Re[n]];i&&(e[n]=i,(r=e[n])==null||r.forEach(Si))}}function wa(e,t){const r=ir[t],n=typeof r=="string"?ir[e[r]]:r;for(let i in e)i in Re&&Array.isArray(e[i])&&(n&&!n.has(i)?delete e[i]:e[i].forEach(s=>wa(s,i)))}const fo=new Set;function va(e,t){let r=ir[t];if(typeof r=="string"){const n=e[r];if(n){const i=If(n);if(typeof i!="string"||i===r)return fo;r=ir[i]}}return r||fo}function ho(e){const t=bf(e);Si(ve(t));const r=t.catalogue?"catalogue":"gameSystem";t.catalogue?(t.playable=1,t.id=lu(t.catalogue.id),t.include=[1e3]):(t.playable=0,t.id=1e3);const n=t[r];return t.name=n.name,t.short=au(n.name),t.playable=!n.library,t.version=n.battleScribeVersion,t.nrversion=n.revision,t}async function kf(e,t){switch(t=Kn(t),t){case"xml":case"cat":case"gst":return ho(e);case"zip":case"catz":case"gstz":return ho(await _f(e));case"json":return JSON.parse(e);default:throw new Error("Extension not supported "+t)}}function Sf(e){return Re[e]}function If(e){return hs[e]}const ds=new Set(["readme","comment","description"]),ba=new Set(["?xml","$text","_"]);function Cf(e){for(const[t,r]of Object.entries(e))ds.has(t)?e[t]=Array.isArray(r)?r:[r]:Array.isArray(r)&&!ba.has(t)&&(e[t]=[{[Sf(t)]:r}])}function Nf(e){return Ws(e,t=>{typeof t=="object"&&Cf(t)}),Ws(e,t=>{if(typeof t=="object")for(const[r,n]of Object.entries(t))Array.isArray(n)||ba.has(r)||ds.has(r)||ue(n)||(t[`_${r}`]=n,delete t[r])}),e}function Of(e){const t=JSON.parse(ss(e));Nf(t);const r={textNodeName:"$text",format:!0,attributeNamePrefix:"_",ignoreAttributes:!1,suppressBooleanAttributes:!1,suppressEmptyNode:!0};return t.gameSystem&&(t.gameSystem.xmlns="http://www.battlescribe.net/schema/gameSystemSchema"),t.catalogue&&(t.catalogue.xmlns="http://www.battlescribe.net/schema/catalogueSchema"),`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
`+new ma.XMLBuilder(r).build(t)}const _a=[{type:"publications",name:"Publications",icon:"publication.png"},{type:"costTypes",name:"Cost Types",icon:"cost.png"},{type:"profileTypes",name:"Profile Types",icon:"profileType.png"},{type:"categoryEntries",name:"Category Entries",icon:"category.png"},{type:"forceEntries",name:"Force Entries",icon:"force.png"},{type:"sharedSelectionEntries",name:"Shared Selection Entries",icon:"selectionEntryLink.png"},{type:"sharedSelectionEntryGroups",name:"Shared Selection Entry Groups",icon:"shared_groups.png"},{type:"sharedProfiles",name:"Shared Profiles",icon:"shared_profiles.png"},{type:"sharedRules",name:"Shared Rules",icon:"shared_rules.png"},{type:"infoGroups",name:"Shared Info Groups",icon:"infoGroup.png"},{type:"rules",links:"infoLinks",name:"Root Rules",icon:"rule.png"},{type:"selectionEntries",links:"entryLinks",name:"Root Selection Entries",icon:"selectionEntry.png"}],Bf=[{type:"catalogueLinks",name:"Catalogue Links",icon:"catalogueLink.png"},..._a];function Se(e,t){switch(e){case"selectionEntry":return"Entry";case"selectionEntryGroup":return"Group";case"selectionEntryLink":return"Entry (link)";case"selectionEntryGroupLink":return"Group (link)";case"force":return"Force";case"category":return"Category";case"categoryLink":return"Category (link)";case"catalogueLink":return"Catalogue (link)";case"publication":return"Publication";case"costType":return"Cost Type";case"costs":return"Cost";case"link":return"Link";case"profileType":return"Profile Type";case"profile":return"Profile";case"rule":return"Rule";case"infoLink":return"Info (link)";case"infoGroup":return"Info Group";case"profileLink":return"Profile";case"ruleLink":return"Rule (link)";case"infoGroupLink":return"Info Group (link)";case"characteristic":return"Characteristic";case"characteristicType":return"Characteristic Type";case"constraint":return"Constraint";case"condition":return"Condition";case"modifier":return"Modifier";case"modifierGroup":return"Modifier Group";case"repeat":return"Repeat";case"conditionGroup":return"Condition Group";case"catalogue":return"Catalogue";case"gameSystem":return"Game System";default:return console.warn("unknown getTypeLabel key",e),e}}function ye(e,t){switch(e){case"selectionEntries":return"selectionEntry";case"selectionEntryGroups":return"selectionEntryGroup";case"sharedSelectionEntries":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntry";case"sharedSelectionEntryGroups":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntryGroup";case"entryLinks":return t!=null&&t.target?t.target.editorTypeName+"Link":"link";case"forceEntries":return"force";case"categoryEntries":return"category";case"categoryLinks":return"categoryLink";case"catalogueLinks":return"catalogueLink";case"publications":return"publication";case"costTypes":return"costType";case"costs":return"cost";case"profileTypes":return"profileType";case"profiles":return"profile";case"rules":return"rule";case"characteristics":return"characteristic";case"characteristicTypes":return"characteristicType";case"sharedProfiles":return"profile";case"sharedRules":return"rule";case"sharedInfoGroups":return"infoGroup";case"infoLinks":return t?`${t.type||"info"}Link`:"infoLink";case"infoGroups":return"infoGroup";case"associations":return"association";case"constraints":return"constraint";case"conditions":return"condition";case"modifiers":return"modifier";case"modifierGroups":return"modifierGroup";case"repeats":return"repeat";case"conditionGroups":return"conditionGroup";case"catalogue":case"gameSystem":return e;default:return console.warn("unknown getTypeName key",e),e}}function Tf(e,t=!0){var i,s,o,a,l,c;const r=e.parentKey,n=[];switch(r){case"sharedProfiles":case"profiles":n.push(e.typeName);break;case"selectionEntries":case"sharedSelectionEntries":e.isEntry()&&e.getType()!=="upgrade"&&n.push(e.getType());break;case"entryLinks":e.target&&e.isEntry()&&e.getType()!=="upgrade"&&n.push(e.getType());break;case"modifierGroups":n.push(`(${(((i=e.modifiers)==null?void 0:i.length)||0)+(((s=e.modifierGroups)==null?void 0:s.length)||0)})`);break}if((o=e.links)!=null&&o.length||(a=e.other_links)!=null&&a.length){const f=((l=e.links)==null?void 0:l.length)===1?"":"s";n.push(`(${((c=e.links)==null?void 0:c.length)||0} ref${f})`)}return e.comment&&e.comment[0]&&n.push("# "+e.comment),n.join(" ")}function Aa(e){const t=e.parentKey;switch(t){case"selectionEntries":case"sharedSelectionEntries":case"selectionEntryGroups":case"sharedSelectionEntryGroups":case"entryLinks":case"forceEntries":case"categoryLinks":case"categoryEntries":case"sharedInfoGroups":case"infoGroups":case"catalogueLinks":case"publications":case"profileTypes":case"catalogue":case"rules":case"sharedRules":case"costTypes":case"sharedProfiles":case"profiles":return e.getName();case"modifiers":return Lu(vr(e),e);case"repeats":{const r=e,n=vr(e);return n||console.error("no parent for repeat",e),`Repeat ${r.repeats} times for every ${r.value} ${$e(n,r.field)} in ${$e(n,r.scope)} of ${r.childId?$e(n,r.childId):" any"}`}case"conditions":return Xs(vr(e),e);case"constraints":return Xs(vr(e),e);case"modifierGroups":return"Modify...";case"conditionGroups":return`${e.type.toUpperCase()}`;case"infoLinks":return e.target?Aa(e.target):e.getName();case"associations":return`${e.label}`;default:return console.log(t,e),t}}function ps(e,t){t(e);const r=[e];for(;r.length;){const n=r.pop();for(const i of Object.keys(n)){if(!or.has(i)||ds.has(i))continue;const s=n[i];if(s&&Array.isArray(s))for(const o of s)r.push(o),t(o,i,n)}}}function Lf(e){const t=e.parent;if(t){const r=t[e.parentKey],n=r.indexOf(e);n!==-1&&r.splice(n,1)}}async function po(e,t){const r=e.catalogue;ps(e,(n,i,s)=>{r.removeFromIndex(n),n.isLink&&n.isLink()&&(r.unlinkLink(n),delete n.target),delete n.parent,delete n.catalogue}),t&&e instanceof os&&await r.reload(t)}async function gr(e,t,r,n){let i=!1;for(const s of Array.isArray(e)?e:[e])ps(s,(o,a,l)=>{ue(o)&&(o.parent=l||r,o.catalogue=t,t.addToIndex(o),o.isLink()&&t.updateLink(o),o instanceof os&&o.targetId&&(i=!0),t.refreshErrors(o))});i&&r&&await(r.catalogue||r).reload(n)}function ie(e){if(!e.parent&&!e.isCatalogue())return[{id:e.id,key:e.parentKey,index:0}];const t=[];for(;e.parent;){const r=e.parent||e.catalogue;t.push({key:e.parentKey,index:r[e.parentKey].indexOf(e),id:e.id}),e=e.parent}return t.reverse(),t}function go(e,t,r){let n=e;for(let o=0;o<t.length-1;o++){const a=t[o];n=n[a.key][a.index]}const i=t[t.length-1];return n[i.key]||(n[i.key]=[]),n[i.key].splice(i.index,0,r),n}function Rf(e,t){let r=e;for(const n of t){if(r=r[n.key],!r)return;r=r[n.index]}return r}function nn(e,t){let r=e;const n=t[t.length-1];for(const o of t)o!==n&&(r=r[o.key][o.index]);const s=r[n.key].splice(n.index,1)[0];if(!s)throw new Error("popAtEntryPath failed");return s}function mo(e,t){ps(t,(r,n,i)=>{if(r.id){if(r instanceof Je)return;r.id=e.generateNonConflictingId()}})}function Ff(e,t,r){if(e.isCatalogue()){if(r)switch(t){case"sharedRules":case"rules":return["sharedRules","rules"].includes(r)?r:"";case"sharedProfiles":case"profiles":return["sharedProfiles","profiles"].includes(r)?r:"";case"sharedInfoGroups":case"infoGroups":return["sharedInfoGroups","infoGroups"].includes(r)?r:"";case"sharedSelectionEntries":case"selectionEntries":return["sharedSelectionEntries","selectionEntries"].includes(r)?r:"";case"sharedSelectionEntryGroups":case"selectionEntryGroups":return["sharedSelectionEntryGroups","selectionEntryGroups"].includes(r)?r:"";default:return t}}else switch(t){case"sharedRules":return"rules";case"sharedProfiles":return"profiles";case"sharedInfoGroups":return"infoGroups";case"sharedSelectionEntries":return"selectionEntries";case"sharedSelectionEntryGroups":return"selectionEntryGroups";default:return t}return t}const Pf={};function Uf(e,t,r){if(t in e)return e[t];const n=class extends Bt{get parentKey(){return t}get editorTypeName(){return ye(t,this)}toString(){return`${this.editorTypeName} - ${this.getName()}`}};return n.prototype.parentKey,Object.setPrototypeOf(n.prototype,Object.getPrototypeOf(r)),e[t]=n.prototype,n.prototype}function zf(e,t,r){Object.setPrototypeOf(r,Uf(e,t,r))}const yn={"*":Bt.prototype,catalogue:Ys.prototype,catalogueLinks:os.prototype,gameSystem:Ys.prototype,forceEntries:ni.prototype,forces:ni.prototype,force:ni.prototype,categoryEntries:Er.prototype,category:Er.prototype,categories:Er.prototype,link:Pr.prototype,infoLinks:_u.prototype,categoryLinks:$o.prototype,entry:ti.prototype,selectionEntries:ti.prototype,entryLinks:Pr.prototype,sharedSelectionEntries:ti.prototype,group:ei.prototype,selectionEntryGroups:ei.prototype,sharedSelectionEntryGroups:ei.prototype,sharedRules:dn.prototype,rules:dn.prototype,rule:dn.prototype,profileTypes:xu.prototype,sharedProfiles:si.prototype,profiles:si.prototype,profile:si.prototype,sharedInfoGroups:oi.prototype,infoGroups:oi.prototype,infoGroup:oi.prototype,publications:qs.prototype,publication:qs.prototype,repeats:Je.prototype,conditions:Je.prototype,constraints:Je.prototype,modifiers:ta.prototype,modifierGroups:ea.prototype};Object.values(yn);function Gf(e){return e in yn?yn[e]:yn["*"]}function Ii(e,t){const r=Gf(t);return r&&(Object.setPrototypeOf(e,r),e.post_init&&e.post_init(),globalThis.isEditor&&zf(e.keyInfoCache||Pf,t,e)),e}function br(e){const t=[e];for(;t.length;){const r=t.pop();for(const n of Object.keys(r)){const i=r[n];if(ue(i))if(Array.isArray(i)){if(i.length&&ue(i[0]))for(let s=i.length;s--;){const o=i[s];Zs(o)&&(Ii(o,n),t.push(o))}}else Zs(i)&&(Ii(i,n),t.push(i))}}}const yo=Ji("catalogues",{state:()=>({dict:{},version:1}),persist:{storage:globalThis.localStorage},actions:{get(e){return e in this.dict||(this.dict[e]={}),this.dict[e]},setEdited(e,t){this.get(e).edited=t},getEdited(e){return this.get(e).edited},setErrors(e,t){this.get(e).errors=t},getErrors(e){return this.get(e).errors},getDependents(e){return this.get(e).dependents},updateCatalogue(e){var i;const t=e.id,r=e.gameSystemId||e.id,n=(i=e.catalogueLinks)==null?void 0:i.map(s=>({targetId:s.targetId===r?r:`${r}-${s.targetId}`,sourceId:t===r?r:`${r}-${t}`,importRootEntries:s.importRootEntries,sourceName:e.name}));e.gameSystemId&&(n==null||n.push({targetId:e.gameSystemId,sourceId:t,importRootEntries:!0,sourceName:e.name})),this.setDependencies(t,n)},setDependencies(e,t){var n;const r=(n=this.get(e))==null?void 0:n.dependencies;if(r)for(const i of r)this.removeDependent(i.targetId,i);if(t)for(const i of t)this.addDependent(i.targetId,i);this.get(e).dependencies=t||[]},setDependents(e,t){this.get(e).dependents=t},addDependent(e,t){const r=this.get(e);r.dependents||(r.dependents=[]),r.dependents.push(t)},removeDependent(e,t){var n;const r=(n=this.get(e))==null?void 0:n.dependents;if(r){const i=r.findIndex(s=>s.sourceId===t.sourceId);i>=0&&r.splice(i,1)}}}});function Mf(e){return e.replaceAll("\\","/").split("/").slice(0,-1).join("/")}function xa(e){const t=e.replaceAll("\\","/").split("/");return t[t.length-1]}async function Df(e){return electron?await electron.invoke("getFolderFiles",e):[]}async function Np(e){if(electron)try{const t=[];if(!await electron.invoke("isDirectory",e))return[];const n=await electron.invoke("readdirSync",e);for(const i of n){const s=`${e}/${i}`;try{if(await electron.invoke("isDirectory",s)){const a={name:i,path:s};t.push(a)}}catch(o){console.error("Error reading dir:",s,o);continue}}return t}catch(t){throw console.error("Error:",t),t}}async function wo(e,t){if(!electron)return;const r=Mf(e);await electron.invoke("mkdirSync",r,{recursive:!0}),await electron.invoke("writeFileSync",e,t)}async function Op(e){if(electron)return electron.invoke("showOpenDialog",e)}async function Bp(e){if(electron)return electron.invoke("showMessageBoxSync",e)}async function Tp(){if(electron)return electron.invoke("closeWindow")}async function Lp(e){if(electron)return await electron.invoke("getPath",e)}async function Kf(e){electron&&await electron.invoke("mkdirSync",e,{recursive:!0})}let vo=!1;const bo={};async function jf(e,t){electron&&(vo||(vo=!0,electron.on("fileChanged",(r,n,i)=>{const s=bo[n];s&&s(n,i)})),await electron.invoke("chokidarWatchFile",e),bo[e]=t)}const Wf={name:"ErrorIcon",props:{errors:{type:Array,default:[]},showNumber:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1}},data(){return{show:!1}},methods:{display(){if(!this.clickable)return;this.show=!0;const e=()=>{this.show=!1};addEventListener("click",e,{capture:!0,once:!0})},errorToText(e){return ou(e.msg)},errorExtraText(e){return e.extra},gotoError(e){const t=Wn();e.source?t.goto(e.source):console.warn("Couldn't goto error: no source attached"),this.show=!1}},computed:{computedShowNumber(){return!(this.showNumber===!1||this.showNumber===void 0||this.showNumber===null)},getImage(){let e=this.errors.find(n=>n.severity==="warning"),t=this.errors.find(n=>!n.severity||n.severity==="error"),r=this.errors.find(n=>!n.severity||n.severity==="info");return t?"./assets/icons/error_exclamation.png":e?"./assets/icons/warning_exclamation.png":r?"./assets/icons/info_exclamation.png":"./assets/icons/error_exclamation.png"},numErrors(){var e;return((e=this.errors)==null?void 0:e.length)||0},errorText(){return _i(this.errors||[],e=>e.msg).map(e=>` ${this.errorToText(e)}
`).join("").trim()}}};const Zf=["title"],Vf=["src"],Qf={key:0},qf={key:0,class:"fixed bg text"},Yf=["onClick"],Xf={key:0,class:"grey"};function Hf(e,t,r,n,i,s){return s.numErrors?(tt(),ot("span",{key:0,class:"ErrorIcon cursor-pointer mt-auto",title:s.errorText},[ct("span",{onClick:t[0]||(t[0]=o=>s.display()),class:"inline-flex align-items gap-4px"},[ct("img",{src:s.getImage},null,8,Vf),s.computedShowNumber?(tt(),ot("span",Qf,Dt(s.numErrors),1)):ut("",!0)]),i.show?(tt(),ot("div",qf,[(tt(!0),ot(Jt,null,yr(r.errors,o=>(tt(),ot("div",{onClick:a=>s.gotoError(o),class:"border py-3px px-10px hover-darken"},[mt(Dt(s.errorToText(o))+" ",1),s.errorExtraText(o)?(tt(),ot("span",Xf,Dt(s.errorExtraText(o)),1)):ut("",!0)],8,Yf))),256))])):ut("",!0)],8,Zf)):ut("",!0)}const Jf=Zr(Wf,[["render",Hf],["__scopeId","data-v-daa65959"]]);const $f={},th={style:{width:"100%",height:"0px","text-align":"left",margin:"0",padding:"0"}};function eh(e,t){return tt(),ot("hr",th)}const rh=Zr($f,[["render",eh],["__scopeId","data-v-43dd2251"]]),nh={name:"ContextMenu",data(){return{left:100,top:100,bottom:100,right:100,width:200,height:200,visible:!1,isDown:!1,isRight:!1,payload:void 0}},props:{modelValue:{type:Boolean,default:!0}},methods:{do_update(e){var r,n;if(this.width=((r=this.el)==null?void 0:r.clientWidth)||this.width,this.height=((n=this.el)==null?void 0:n.clientHeight)||this.height,this.top=e.clientY,this.left=e.clientX,this.avoid){const i=this.avoid,s=i.offsetLeft;this.left=s+i.offsetWidth;var t=e.target.getBoundingClientRect();this.top=t.top-1}this.left=Math.min(this.left,window.innerWidth-this.width)+2,this.top=Math.min(this.top,window.innerHeight-7-this.height),this.bottom=window.innerHeight-this.top,this.right=window.innerWidth-this.left},update(e){e.preventDefault(),this.do_update(e),this.$nextTick(()=>{this.do_update(e)})},show(e,t){this.payload=t,this.visible=!0,this.update(e),this.$emit("update:modelValue",!0)},close(){this.visible=!1,this.$emit("update:modelValue",!1)}},mounted(){addEventListener("click",this.close,{capture:!0}),addEventListener("contextmenu",this.close,{capture:!0}),addEventListener("scroll",this.close,{capture:!0})},unmounted(){addEventListener("click",this.close,{capture:!0}),removeEventListener("contextmenu",this.close,{capture:!0}),removeEventListener("scroll",this.close,{capture:!0})},computed:{el(){return this.$refs["context-menu"]},style(){const e={};return e.top=`${this.top}px`,e.left=`${this.left}px`,e},avoid(){var e;return(e=this.$el.parentElement)==null?void 0:e.closest(".context-menu")}}};function ih(e,t,r,n,i,s){return mi((tt(),Kt(ll,{to:"#dialogs"},[mi(ct("li",{ref:"context-menu",class:"context-menu",style:al(s.style)},[wi(e.$slots,"default",{payload:i.payload})],4),[[yi,i.visible]])],512)),[[yi,i.visible]])}const sh=Zr(nh,[["render",ih]]),oh={name:"EditorCollapsibleBox",props:{payload:{},collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},titleCollapse:{type:Boolean,default:!0},group:{type:Array,required:!0},modelValue:{default:!0},altclickable:{default:!1}},data(){return{collapsed:!0,initiated:!1,selected:!1,alt:!1}},created(){this.defcollapsed==!1&&this.collapseSwitch()},setup(){return{store:Wn()}},mounted(){var e;addEventListener("keydown",this.handleKeyDown),addEventListener("keyup",this.handleKeyUp),this.$el.vnode=this,(e=this.group)==null||e.push(this),this.init(this.payload)},updated(){this.$el.vnode=this},unmounted(){var e;if(removeEventListener("keydown",this.handleKeyDown),removeEventListener("keyup",this.handleKeyUp),this.group&&Array.isArray(this.group)){const t=this.group.indexOf(this);t!==-1&&((e=this.group)==null||e.splice(t,1))}},watch:{payload(e){this.init(e)},collapsed(e){e!==this.modelValue&&this.$emit("update:modelValue",e)},modelValue(e){e!=this.collapsed&&(this.collapsed=e)}},computed:{dropdownSrc(){let e=2,t=[`./assets/icons/right${e}.png`,`./assets/icons/down${e}.png`],r=this.collapsed?0:1;return t[r]},hide(){return!this.collapsible},nocollapse(){return!this.collapsible},box(){return!this.nobox},opened(){return this.collapsible&&!this.collapsed}},methods:{cut(){console.log("cut")},copy(){console.log("copy")},paste(){console.log("paste")},init(e){(e==null?void 0:e.select)!==void 0&&(e.select&&this.store.do_select(null,this,this.group),e==null||delete e.select)},select(){this.selected=!0,this.store.select(this,()=>this.unselect(),this.payload)},unselect(){this.selected=!1},open(){this.collapsed&&this.collapseSwitch()},close(){this.collapsed||this.collapseSwitch()},do_select(e){this.store.do_select(e,this,this.group),this.$el.focus()},do_rightcllick_select(e){this.store.do_rightclick_select(e,this,this.group)},collapseSwitch(){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?this.$emit("open"):this.$emit("close")},handleKeyDown(e){e.key==="Alt"&&(this.alt=!0,e.preventDefault())},handleKeyUp(e){e.key==="Alt"&&(this.alt=!1,e.preventDefault())}}};const ah=["src"],lh={key:1,class:"content"};function uh(e,t,r,n,i,s){return tt(),ot("div",{class:He([{box:s.box,nobox:r.nobox,nocollapse:s.nocollapse,collapsed:i.collapsed,opened:s.opened},"collapsible-box"]),onContextmenu:t[8]||(t[8]=(...o)=>s.do_rightcllick_select&&s.do_rightcllick_select(...o))},[r.notitle?ut("",!0):(tt(),ot("h3",{key:0,class:He(["title hover-darken",{selected:i.selected,arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&i.collapsed,alt:i.alt&&r.altclickable}]),onClick:[t[1]||(t[1]=Ce((...o)=>s.do_select&&s.do_select(...o),["stop"])),t[2]||(t[2]=Ce(o=>e.$emit("ctrlclick"),["ctrl","stop"])),t[3]||(t[3]=Ce(o=>e.$emit("altclick"),["alt","stop"]))],onDblclick:t[4]||(t[4]=(...o)=>s.collapseSwitch&&s.collapseSwitch(...o)),onPaste:t[5]||(t[5]=(...o)=>s.paste&&s.paste(...o)),onCopy:t[6]||(t[6]=(...o)=>s.paste&&s.paste(...o)),onCut:t[7]||(t[7]=(...o)=>s.paste&&s.paste(...o))},[ct("div",{class:"arrow-wrap",onClick:t[0]||(t[0]=Ce((...o)=>s.collapseSwitch&&s.collapseSwitch(...o),["stop"]))},[ct("img",{class:He([{hide:s.hide},"arrow icon"]),src:s.dropdownSrc},null,10,ah)]),wi(e.$slots,"title",{},void 0,!0)],34)),i.initiated?mi((tt(),ot("div",lh,[wi(e.$slots,"content",{},void 0,!0)],512)),[[yi,!i.collapsed||!r.collapsible]]):ut("",!0)],34)}const ch=Zr(oh,[["render",uh],["__scopeId","data-v-7e10f425"]]),Cr=Ji("editor-ui",{state:()=>({catalogues:{}}),persist:{storage:globalThis.localStorage},actions:{collapse_level(e){var t;if(e>=0){const r=`depth-${e} collapsible-box opened`,n=document.documentElement.getElementsByClassName(r);if(n!=null&&n.length)for(const i of n)(t=ae(i))==null||t.close()}},collapse_all(){this.collapse_level(1),this.collapse_level(0)},collapse_deepest(){const e="collapsible-box opened",t=document.documentElement.getElementsByClassName(e);let r=-1;if(t!=null&&t.length)for(const n of t)n.classList.forEach(i=>{i.startsWith("depth-")&&(r=Math.max(r,parseInt(i.split("-")[1])))});this.collapse_level(r)},set_state(e,t){function r(s,o,a=0){const l=`depth-${a} collapsible-box opened`,c=s.getElementsByClassName(l);if(c!=null&&c.length)for(const f of c){const d=Ye(ae(f)),p=d.parentKey,g=d.parent;let b=o;if(g){const y=g[p];if(!y||!Array.isArray(y))continue;const _=y.indexOf(d);p in o||(o[p]={});const w=o[p];_ in w||(w[_]={}),b=w[_]}else{const y=[...f.classList].filter(_=>or.has(_));for(const _ of y)o[_]={},o[_][0]={},b=o[_][0]}r(f,b,a+1)}}const n={};r(document.documentElement,n);const i={...t,open:n};return this.$state.catalogues[e]=i,n},get_data(e){const t=this.$state.catalogues[e];return t||{}},get_root(e,t){let r=this.$state.catalogues[e];return!(!r||(r=r.open[t],!r))},get(e,t){if(!t.length)return!1;let r=this.$state.catalogues[e];if(!r)return!1;let n=r.open[t[0].key];if(!n||(n=n[0],!n))return!1;for(const i of t){const s=n[i.key];if(!s)return!1;const o=s[i.index];if(!o)return!1;n=o}return!0}}});function fh(e){return Math.round(e*100)/100}function hh(e){let t="";e=Qe(e,r=>r.name);for(const r of e)if(r.value!=0){let n="";r.name.length!=0&&(n=" "+r.name),t=`${t}<span class='cost'>${fh(r.value)}${n}</span>`}return t.length==0?t:`<span class="costList">${t}</span>`}const sn={selectionEntry:1,entryLink:1,selectionEntryGroup:2,entryGroupLink:2,constraint:3,forceEntry:4,profile:5,modifier:6,modifierGroup:7,categoryLink:8,infoLink:9},dh=new Set(["force"]),ph=new Set(["modifierGroups","conditionGroups"]),gh=new Set(["characteristicTypes","characteristics","costs"]),mh={name:"CatalogueEntry",components:{ContextMenu:sh,EditorCollapsibleBox:ch},setup(){return{store:Wn(),state:Cr(),settings:Fo()}},props:{item:{type:Object,required:!0},group:{type:Array},forceShowRecursive:{type:Boolean,default:!1},showImported:{type:Boolean},imported:{type:Boolean},depth:{type:Number,default:0}},data(){return{groups:{},contextmenuopen:!1,open:!1,open_categories:void 0}},mounted(){if(this.catalogue&&(this.catalogue.processForEditor(),!this.imported&&(this.open=ph.has(this.item.parentKey)||this.state.get(this.catalogue.id,ie(this.item)),this.item.isCatalogue()))){const e=new Set;for(const t of this.categories)this.state.get_root(this.catalogue.id,t.type)&&e.add(t.type);this.open_categories=e}},methods:{escapeXml:gu,getTypeName:ye,getTypeLabel:Se,getName:Aa,getNameExtra:Tf,key(e){return e.id?e.id:(e.$id||(e.$id=`temp-${xr()}`),e.$id)},should_be_open(e){var t;return(t=this.open_categories)==null?void 0:t.has(e)},sortable(e){return this.settings.sort==="none"?!1:e?dh.has(e.editorTypeName)===!1:!0},get_group(e){return e in this.groups||(this.groups[e]=[]),this.groups[e]},ref_count(e){var t;switch(e.editorTypeName){case"category":default:return(t=e.links)==null?void 0:t.length}},async onctrlclick(){this.store.can_follow(this.item)?await this.store.follow(this.item):this.imported?await this.store.goto(this.item):(this.item.links||this.item.other_links)&&(this.store.mode="references")},debug(){console.log(this.item.name,this.item.editorTypeName,se(this.item)),console.log("component",this),console.log(this.allowedChildren)},getTypedArray(e,t,r){if(!t)return;const n=t,i=e[n];if(i&&Array.isArray(i))for(const s of i)this.filter_child(s)&&r.push({item:s,type:t});if(this.showImported){const o=["selectionEntries","selectionEntryLinks","rules"].includes(t)?e.importsWithEntries:e.imports;for(const a of o){const l=a[n],c=a.isGameSystem();if(l&&Array.isArray(l))for(const f of l)this.filter_child(f)&&(!c&&f.import===!1||r.push({item:f,type:t,imported:!0}))}}},allowed(e){if(Array.isArray(e)){for(const t of e)if(this.allowedChildren.has(t))return!0;return!1}return this.allowedChildren.has(e)},filter_child(e){return!(!this.forceShow&&this.store.filter&&e.showInEditor!==!0)},sorted(e){if(!this.sortable(this.item))return Qe(e,t=>sn[t.item.editorTypeName]||1e3);switch(this.settings.sort){default:case"asc":const t=_i(e,i=>i.item.getName()||"");return Qe(t,i=>sn[i.item.editorTypeName]||1e3);case"desc":const r=Qe(e,i=>i.item.getName()||"");return Qe(r,i=>sn[i.item.editorTypeName]||1e3);case"type":const n=_i(e,i=>(i.item.isProfile()?i.item.getTypeName():i.item.getType())||"");return Qe(n,i=>sn[i.item.editorTypeName]||1e3)}},menu(e){return{show:(t,r)=>{this.contextmenuopen=!0,this.$nextTick(()=>{var n;(n=this.$refs[e])==null||n.show(t,r)})},close:(t,r)=>{var n;(n=this.$refs[e])==null||n.se(t,r),this.contextmenuopen=!1}}},get_field(e){return this.item[e]},get_target_field(e){if(this.item.target)return this.item.target[e]},hideType(e){if(e==="categoryLinks"&&!this.item.isForce()||gh.has(e))return!0}},computed:{costs(){var n;const e=[],t=this.item.getCatalogue(),r=this.item.getCosts();for(const i of r){const s=((n=t.findOptionById(i.typeId))==null?void 0:n.name)||i.name||i.typeId;s&&e.push({name:s,value:i.value,typeId:i.typeId})}return hh(e)},link(){return this.item},iscollapsible(){return this.mixedChildren.length>0},contextmenu(){return this.menu("contextmenu")},nestedcontextmenu(){return this.menu("nestedcontextmenu")},catalogue(){return this.item.getCatalogue()},catalogues(){return this.catalogue.imports},allowedChildren(){return va(this.item,this.item.parentKey)},forceShow(){return this.item.showChildsInEditor||this.forceShowRecursive},mixedChildren(){const e=[];for(const t of this.allowedChildren){if(this.hideType(t))continue;const r=this.get_field(t);if(r!=null&&r.length)for(const n of r)this.filter_child(n)&&e.push({type:t,item:n})}if(this.item.isLink()&&this.item.target){const t=[];for(const r of this.allowedChildren){if(this.hideType(r))continue;const n=this.get_target_field(r);if(n!=null&&n.length)for(const i of n)this.filter_child(i)&&t.push({type:r,item:i,imported:!0})}return[...this.sorted(t),...this.sorted(e)]}return this.sorted(e)},categories(){return this.item.isCatalogue()?this.item.isGameSystem()?_a:Bf:[]},groupedCategories(){return this.categories.map(e=>{const t=[];return e.type&&this.getTypedArray(this.item,e.type,t),e.links&&this.getTypedArray(this.item,e.links,t),{...e,items:this.sorted(t)}})}}},yh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TiyIVBzOICGaoThbEijhqFYpQIdQKrTqYXD+hSUOS4uIouBYc/FisOrg46+rgKgiCHyCuLk6KLlLi/5JCixgPjvvx7t7j7h0gNCpMs7omAE23zVQiLmWyq1L3K0IYgYgYJIVZxpwsJ+E7vu4R4OtdlGf5n/tz9OXyFgMCEvEsM0ybeIN4etM2OO8Ti6yk5IjPicdNuiDxI9dVj984F10WeKZoplPzxCKxVOxgtYNZydSIp4gjOU2nfCHjcY7zFmetUmOte/IXhvP6yjLXaQ4jgUUsQYYEFTWUUYGNKK06KRZStB/38Q+5fplcKrnKYORYQBUaFNcP/ge/u7UKsUkvKRwHQi+O8zEKdO8CzbrjfB87TvMECD4DV3rbX20AM5+k19ta5Ajo3wYurtuaugdc7gCDT4ZiKq4UpCkUCsD7GX1TFhi4BXrXvN5a+zh9ANLUVfIGODgExoqUve7z7p7O3v490+rvB80rcsuoyXg3AAAABmJLR0QA6AAAAADh5zdhAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5wUfFDQeXQWMGwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAG9SURBVCjPhdO/a1NRFMDx7733PfOiFcGhErUoBm1DwFH8DwQnR90KLiI4aAbd/DNsQVCHLh0EqyA4uPofBDMphaRU0FgiLcm75xyH9xrNj9IzHt6Xz708rqOch62nttvrMrh2j+PmwpmEV09uueRwsdvrcvf+Kpc3NljY3iZ4jy0vo60Wp6pVTlYqZFlGlqY8X3sJwDje6XXZXF/n9qWbrNbrALz+XeXLp58z8vcfS5OxqdFsNjmx72A4BCB1VWq12kSYpinfujtTsSmqihfBYix2oyHtdnsibjQamNpkrFrEQeM4rjhYWVkZh51Op/jOdDYWEZKYY5YD4OOIwWAwjr33iAgmc+QYI0Fy1Ao5iZFYnuJwYoyoynw5xBxzhRw0R0TGoXOukHX62CLEGEmiw1wpaz5flqNkdYTElXKckAFEBJ2WpZSDOh5n13HOcWf4da5sEmdjEWHt7A1k8SIhBF74KpX/ZDMr5HLn/8URVWXhapMkSQghkC7Vx/9fVTGz4np5eefNj5/t4GCfZ48eoKok3pNl2ZEvynvP8M+AN28/WDIaDdnr9zlXO8+7rfcs/rpy7JOsnY7s9fv8Bc0zE6+cxDjNAAAAAElFTkSuQmCC",wh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQCAYAAAAiYZ4HAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bi1IqIu0g4pChumhBVMRRq1CECqFWaNXB5NIvaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIq4uToouU+L+k0CLGg+N+vLv3uHsH+BsVpppd44CqWUY6mRCyuVWh+xVBhNCPUUQkZupzopiC5/i6h4+vd3Ge5X3uz9Gr5E0G+ATiWaYbFvEG8fSmpXPeJ46ykqQQnxOPGXRB4keuyy6/cS467OeZUSOTnieOEgvFDpY7mJUMlXiKOKaoGuX7sy4rnLc4q5Uaa92TvzCc11aWuU5zCEksYgkiBMiooYwKLMRp1Ugxkab9hId/0PGL5JLJVQYjxwKqUCE5fvA/+N2tWZiccJPCCSD4Ytsfw0D3LtCs2/b3sW03T4DAM3Cltf3VBjDzSXq9rcWOgL5t4OK6rcl7wOUOMPCkS4bkSAGa/kIBeD+jb8oBkVsgtOb21trH6QOQoa5SN8DBITBSpOx1j3f3dPb275lWfz9cmHKeGGO3IgAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFChE0NOeyIIsAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB2klEQVQoz43SP2gUURDH8e+83WVFOa5USKF1QMiZaGfAExH/9dYKIlZ2gkGtDATstBEEqzT2kkJDRNBCJVxOzUEakzvRkCLNbS532Z0Zi1tP04gDw6vefH4MIy8W33jW3+VfdezwEepTNQGIu70drl44z54quSq5GeqOuwPQaDT49vMHix+X/ezJExLcHTND8xzNc/b6fXZ3dsiyjG63S5ZlXLt8cfQpNjMECCIkUfQnR1FQmLG9vc2T+XkAltbXic2cIMK5l8d5dekzH1ZWqFarHB0bg6KgXq/j7lQqFRZeLxGrGyLC0pWvmDunJycxd3LVfRKAuhF7Galx9w4Ts3N8arVI05Rer0eappgZaZpSqVRwM2JTJYgwNfcIM+PU+DjmPupclX6eE4lgqoRCh8Lt5wkhBN43m7TabVobG3zf3CSJIg4kCUkUUWgpiAiPryvuwnSthpntU5IoIgphKJgpAtyfmUFEeNdsstrpsLy2NpKCyDCSKbGWwsPZWRyYnpjAf0//SxJAVQmqQ+HWs4AAbxsNvrTbrHY6dLa2CCKjVlXiwWAAwNMb4C6cqdVwwMp7MncoVz8YDIizLBtdg5ST3B0p3wBYCEgIZFlGnDjcvPeA/6nqwUP8AtTWMEb6wHGvAAAAAElFTkSuQmCC",vh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bS0UqIlYQ6ZChOlkQFXHUKhShQqgVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4B/kaFqWbXOKBqlpFOJoRsblUIvSKIMPoRxaDETH1OFFPwHF/38PH1Ls6zvM/9OXqVvMkAn0A8y3TDIt4gnt60dM77xBFWkhTic+Ixgy5I/Mh12eU3zkWH/TwzYmTS88QRYqHYwXIHs5KhEk8RxxRVo3x/1mWF8xZntVJjrXvyF4bz2soy12lGkcQiliBCgIwayqjAQpxWjRQTadpPePiHHb9ILplcZTByLKAKFZLjB/+D392ahckJNymcAIIvtv0xAoR2gWbdtr+Pbbt5AgSegSut7a82gJlP0uttLXYE9G0DF9dtTd4DLneAoSddMiRHCtD0FwrA+xl9Uw4YuAV61tzeWvs4fQAy1FXqBjg4BEaLlL3u8e7uzt7+PdPq7wdBJ3KT7BaVSwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDBEdBk5IsTwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACx0lEQVQ4y42O309TBxiGn3N6qKZGNLqwhUSIFhDMUFwXb2pxJoyIAv7elmXJdsHlZvA/8G7ZrpbMu91oYtAbo0QzhSYGGtivokB7Ss85LS1VxFFKtRBSjrbn88rGxbjwJe/N9+R58yps8OLpjJhPnvznt22LZ2PyTGpObo2ExBGpRETk1khIXBuR448z9B5pZ2xigsFgkJelEnW1tcQzGdT/k2OzaYnNpek90k65XGapUOCbk6dZKhQAcBzn/QV6MiV6OsXJo59h2zaOCC1eLw8tg30NDZWC98oDw0FZF5H5+XkJDQ7Ks4UFKb56JXapJCURGRgOip5MyTsLoolZmUomOP15BwuZDLGxMYrFIpFQiHK5jOpycWNomNbde/i4YY+ivS1HrKRMWiZnj3fxOJlEHx2tMF9HB+5Nm7j++z3aGptobfQqAJWCaSshE0acL3q6SZsmU8FgRT7U1cVH9fVcu3MXX3Mz+5salDdMBZg0LQnHYpzr6WY2HufR0BCO4+A4Dr7OTnZ5vVy7Pcgne/dyoKlReXu1MmmYEtZ1vjx7hjnDID4yUoH1Ph+pTIbR8T/w1tUR8PuJRiLYtk11dTWHAwFcbYH2S1+dP0c2myUVCuF2u3G73TQHAkzrOtUeD2e6T2AZJuPj43g2b6a35wTlUonpqWl4OBOXywM35IWIRE1THty8KbFEQlZE5Ou+PjGMhFzovyiRqCX5fFEiUUsu9F8Uw0jIjz/9LErueUHST+cZDYfp++5bstksH9bU8NuVqzydmeF45ym2bt3C/ft3yb/IsWP7Bxw71s3q6hp//vUAZTGXl7W1NXTD4JFp0P/D9/zy62Uaa2sprqwS/udvFEXB4/HQdvAg0UiE4vo6iqLg9/tRnmVzsri4SH55mX9zS0xaFp+2tLBz23bslzaqqlKlVaFpGlXuKjSXhqZpuDQNVVV5DQyKeoiSxZAyAAAAAElFTkSuQmCC",bh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgjN9BzCj0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABnElEQVQoz42SsWoiURSGv5m5OIVplsQBky67ICisi6QQ3GreQRBsrHwEn8GHEMTCQiufIFVIsQRcd8Bml7XJFuvsIJoE1Lkzs8XEYSaaxB9ucbn3+8899/wKwM3d92Dh2Pi+j+/7vCVVVVFVlQ+nGb5efVEEgGP/5ar4GSNzxjGa2/+4m/wIDQGklEfDAEbmDCllzMB1o0NN0xBC7C3P8wDodDrEGQFEfSuKEl2Ma7vdkkql6Pf7zOdz4kzCIAgCgISJlBJd1xkMBiwWC8rlcsJADYFw0263GY1GaJrGZrNhvV6j6zrD4ZDlckk+n8c0TeKMiFcsFAqMx2Nc16VarQLQ7XZxHIdSqUSlUoletmNCAz/cmKaJ4zhMp1N6vR6r1QrbthOVI4NnJmzheSTpdJpGo0E2m8WyLGazGblcjlqttvexXnyML9PXbDYxDINisUi9Xj+YhcQUdr8fV6vVejNMO0YFCICJZR2dxIllsSupXN9+C37/+smf+3s8T0YRfU1CCDRNkL045/LjJ5TbsRU8PT5woIt3lT454T+zOsZSlUjWPwAAAABJRU5ErkJggg==",_h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgiC+YHR/sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABwUlEQVQoz42TT4vaQBjGfzHBSw6rt+2lhLL04lFY+h1aevPup/CqIH4D2YJ4Fbsbqv1Da6nXYi+ibL3YdruoZHXXSzaVVMgkmR7SFcU27A/eyzDPM8+8844CcDmZyevrBUEQEAYhcSTUBKqqcnj4gEfGQ0UDmM+veHx0RDqd4j7Y9i3fLy4iQwAhxL3FAOl0CiHErsEdqqqiadpeBUEAQL1eZ1ujAYRhdG9FUTYbt/E8j2QySaPRYLlcsq3ZMZBSAmxMbNvGsizCMKTf77NarTAMg8FgwGI+53IyiwTv3n+QQghZLpelaZpSCCEdx5G9Xk/G8bn3RWrbJ2YyGYbDIUIIcrkcQRDQ7XY5OXlBu92iWq2iaRphGJLNZlmv1ygAr9qv5fNnT3FdF9M0mU6nGIaBZVkUi8X/vsbHT92oB77vA6DrOvl8nlqtxmg0wvO82ASbhjdPz6QQYqcqlYoslUqxPWi/eRv14F8UCgU6nU5sgs38NE/P5Pn5170UrVYrNkGj+VIq3378lOPxmOl0gu/7+H9dXdflZnmDc+vsTGoiEX2mg9QBx8dPUGZXC7la/doM0R3r32tc191b30bXdf4AswSDFyrGAhMAAAAASUVORK5CYII=",Ea="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9Tix9UOlhBikOG6mRBVMRRq1CECqFWaNXB5PoJTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/5cUWsR4cNyPd/ced+8AoVFhqtk1DqiaZaQScTGTXRW7XxHAIHoRQkRmpj4nSUl4jq97+Ph6F+NZ3uf+HP25vMkAn0g8y3TDIt4gnt60dM77xGFWknPE58RjBl2Q+JHristvnIsOCzwzbKRT88RhYrHYwUoHs5KhEk8RR3OqRvlCxuUc5y3OaqXGWvfkLwzmtZVlrtMcRgKLWIIEEQpqKKMCCzFaNVJMpGg/7uGPOH6JXAq5ymDkWEAVKmTHD/4Hv7s1C5MTblIwDgRebPtjBOjeBZp12/4+tu3mCeB/Bq60tr/aAGY+Sa+3tegRENoGLq7bmrIHXO4AQ0+6bMiO5KcpFArA+xl9UxYYuAX61tzeWvs4fQDS1FXyBjg4BEaLlL3u8e6ezt7+PdPq7wcvuHKMRIsU1QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFFQkWEGZMN3sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABVElEQVQoz93Ry0oCARjF8f/kpC0mZYoupJZWWhSouUopy0fQxxF9kagXKNpEtLZVQajdFl28kVp2mRFGiS4zTLsiqkXLOtvf4nx8B/58BID84bHZaNTRX/V3ELtFnE4XAD9ZOBQQhINcwaxUyng9Y/TJMlarFcMweFAUcvkCAOG50BcrV6p4veMI6xubptvt5PjoiPOLS3TDYGR4CFmWP53aarW4bt4iWixM+X0EgkFqtQZdWltDkiQUVSWVzgAQjUZYXFwgkUiQTCaJx+PEYjEAUukMiqoiSRJaW0NYWV0zPaPj1Os17pU7NE1Df3n+9mGi1YbdbmegfxCXy031qoywtb1j7u/tMTsTwuPx4XDIPD52KJXOODnNA/xo85EIwmW5au5ms1ycn/H0/NHcY7MxMTkJQKlY/GL+qWmWlpcR6jdNs9PuoBv6r/YXLSJSr8Q/yBspXJbfdFchHAAAAABJRU5ErkJggg==",Ah="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8ziBhJZiFZ3AVKUUKyZCgpahqjxmPh3jtmqLl3pntHNpbKVll4bLwWNtZsLWyVUh4lWxsrYiNd/3NHzaRGOXU6v75zvq9zvgPBg4xpuZU9YNl5JzYW0RIzs1r1M1XU0Ugtnbrp5oaj0QnKjo9bAmq96VZZ/G/UJxddEwKa8JCZc/LCC8IDq/mc4h3hsLmkJ4VPhbscuaDwvdKNAr8oTvscVJlhJx4bEQ4La+kSNkrYXHIs4X7htqRlS34wUeCk4jXFVmbF/LmnemFo0Z6eUrrMVsYYZ5IoGgYrLJMhT7estiguMdmPlPG3+P6ouAxxLWOKY5QsFrrvR/3B727dVF9vISkUgaonz3trh+ot+Nr0vM9Dz/s6gopHuLCL/uwBDL6LvlnU2vahYR3OLouasQ3nG9D8kNMd3ZcqZAZTKXg9kW+agaZrqJ0r9Pazz/EdxKWriSvY3YOOtGTPl3l3TWlvf57x+yPyDUN6cpTX8RfMAAAAmVBMVEVAQUE9PT1YWFg9Pj5VVVVUVFQrKytZWVkpKSpERERRUVFQUFBDQ0NYWVo+Pz9TU1NSUlI4OTlXV1cgISFdXV04ODk4ODhRUlMhIiInJycuLi5KSkpJSUkoKCk7OztBQUE8PDzj5ugLCwtaWlpeXl5CQkK/wcNdX18BAQEJCQkUFRUfICAuLy8fHx8TFBTn6uzNz9HIyswAAABWGAQaAAAAM3RSTlP//////////////////////////////////////////////////////////////////wBxnr2OAAAACXBIWXMAAC4hAAAuIQEHW/z/AAAAmUlEQVQoU03MyRKCMBBF0RDSBBUICMgQAUFlUBTM/3+clbRF+TZ96yyaKBzZAo9FqYWFYDMGYJtEcDgD6pg04O72DA6eu4GP4G+gAsEgDEwiqOgIEdYP4gRiLITU4nBKTWrIcqGfhnmGUJRSajjLstBQ1XWD0FzqSpG2azwprreEh9K7dy3ph3F6PN15rl7vaRx6sqyfv63LF52MIsEsSTP4AAAAAElFTkSuQmCC",xh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgeFvbyUt0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABKElEQVQoz6XPMUtCcRSG8eeCqR8ktKEaJYMw/QYtFUQQFFREUIM4GEEYRAkN0dQSQQWFIBQ4lSlKBA1SLQ2B9BlsuH/v9ZwGtYQIC9/5HH48VuX1TQGMbbORiLO9m8bn9wOwvrKEiqIoIoKK0B8IshZPYLUfy8UCL89PDA4NMzYepds8ba2YvyW5lSK1mSQ0Esbn97O6uICKoKqIKiqCiHB0ctoUS4U7spnL1hFMTE4Rica6i4X8DdMzs4TCozzcl8ldXxGJxlien/tSRAWVZuvx+cV343/nAZot7YaOlk5FWq2NRoOzTLZH8beWtiIiOI5D3RiMMeTyxR7Ej1qN/b0d3qvVH4rruhjbxhhDvV7HdR0CwQHSB4dYpceKGmMj8jfYsqDP6+UTS3LlTs6Kx84AAAAASUVORK5CYII=",Eh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAABuElEQVQ4T32Tu04CQRSGf9gLEKQgYmQN2qACNhpNCBSAPoKXRHoqtcWeh6A0EtGChMZoY7QwitGEgpcwoBJvhSD3cWcYUbKjXzKZ//xz2TNnZ/AfyysrhDYeCjHz3kAkEiHu8XHQRjW3DZh4P0QkGmWLKYT01z5VqyhcXxvmCzN4fXmBLMs8AtPUE2HYIBCYI5qmodFocAdMu91uNsatAYYN5hcWuDIiGhPWIBqLkTGXCxaLBTabjXm1Wh1b2ztMfzM5NcWVgFA4TBKJhF7Dv7m5vSMSn29AVpTUzPQ0rFYrksldxOObSKfTKJVKKBaL6PV6qNU/xUcIhcJEUWR4vV5kMhnuGjk7v8BQBqtr66TZbKZ8s7Ps7JIkweFw/JNB/ScDn89HaNE8Hg+LqVZVFblcjsUijk9O+xn4/QHico2yRXptoCgKuzxUO53OPzN4e3+H6b7ySPwzXgSDQZjN5sGvo32r1UI+n2dfE3GQPYTp8qpA9vf3cJTNsorbR0Zgt9uhKiq7Jb1uF+1OB512m21IW0ePF5eWsLa+AdND9ZlUymW09Qm/odf3o/ZBXxN3hpH0I2raBL4ARzrLEHEzjREAAAAASUVORK5CYII=",kh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAPCAYAAADUFP50AAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAH9SURBVDhPnZJPaBNBFMa//ZPNpgHT0HartRD/IKJSRIoFLd5VPEmPBgQtXgqCnooIohRE8CBe9CZCTx48evGioKlKpCGiFUWxNmnS3eomNNnN7mafM2NZXNKTD37L8L3ve7MzjIQt6vrDdbIaJNaDGQm3Lg30+GLC5bsrdPRgGsfG0hgZUoVWNQMUyi28+9jCvaujvRtN31yirz/bFAQB+b4fg2u8xz2b9r81deUNff7eJNd1yXEcmsy/iLGwWBc97uFenpH5Z+JQGqOGAjYdbDryZ3YIThzZhmaziYXSmuhxDz8KL+Xk9DO6OLUPmbQEIhLsz2nIGSF+VBoolH4hNxxie38btt3AQDaFmnzqhrxccbFrpA9hGMLzPJimhWq1huevV/HgSRUTYwYunN0NWVbZUGA4q4BnZFXtA5jgOB1Ylo1OJ4CiJHDnsQ1JSmFuZg9c14OqagJip+MZeW9uEF+W22i1PBbQkEjogsL8cYHndSONs2oBPCM/vT8uvSz60PUUNC0ZcXqmIvhXSybZwDLAM+JWi0syzAYPpqLJup4RxHZbT6L8TRO3GlV+9je9/+BQve5QrebQxkYg4GuuvS216RzzbNrjT443xg9omDycwE6D/QyzrZhdvFr0UfzkY/52NvL3vj1W56+ZtGYrYm30d/FobmhL338U8AdLygpqJt/tXAAAAABJRU5ErkJggg==",Sh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAIwSURBVDhPdVNLaBNRFD3jTJs0iQnWtqC2uLEWUlxIUBBxWQjqRigoaNxoEQSRKiIuKqILQRA/hIiCCwviDxoURLGCiJLGT6AhUGvTJjYfpTGdNGknE83n+uZlNASTA3eYuee8e+57746ABhi5vUjpLPH3DpuAS8fWNtTVJU9eTdA2uxk7tpixvlPiue8/S5gIKfg0peDG6e6GRTB0cZpm43kqlUpULBbrQstpnKbR5TUMnvpAX6M5KhQKpKoq7XS9rQv/5ALnNI2m1ZdhlfbY3m9Gd5cI5gLmAtfedTx2bbUil8vBH0xxTtNo27p8Z5IXEJ1DL+joYC9sZgFExKNvYyva27KIz89BTi/AZpCh5uKIRqMwSSvwB+bgfXTzAuy7vbSYWSFZlimVSlE4PEvBYIiue56wOs3x3jdBkiSZANaEqv5CNruMSqUCUWzB83dLsG8ah8dzC17vGNxuN5iY8w6Hg+lVCPtOBOjskR60m1Te8l9EIjNwOgf0r//x8tV49Z6v3E3SgYEWlMtlTmg4fv4Nhl0dTZ3TcqYq3H/mBwVCy5RMLlEikeGx5/Dj6uaawPv0Gf2bGNe5DA0fNGJDJzsC1r3P9xoWi6GpcyyR1FfqOMQKXBtV6GPwN90bHdM9GuP+g4c159DUF4p8S+PztBEzcQti82EUlRiMrQrWtMno6SrBZjVitdUKSRTRu7mv9mNEYwk2mnnelppXoShK3ekLggCD0QCTycyuUhtM4A+OzZgJPZUHrgAAAABJRU5ErkJggg==",Ih="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=",Ch="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAAzElEQVQ4T2NkwAIWLFiw6+hzX1col8FacvPuhIQENyiXMAAZENfw9D+IhgpRF6A4O7/r2n9DsVO7V5zSc40wu4RBn39l5jqxTAurV8FOhTKxAgx5ZAGjkO3/oUysAFkerE/Tez08UIi1GUSD9DEou67+D8IgQRiNCyCrA2Gm//8ZGWqjv+4GCcJoXABZHUgfilNV3DbhtRlZHsOLxPoZBpigNBisPsDhClKgH3gCHIjoNEgeqpSGAGSTbfwD0tM2SINj8sv/MIzdAAYGAB1Xk+VGE8P2AAAAAElFTkSuQmCC",Nh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB+UlEQVQ4T5WTz2sTQRTHv7M/6iH4m7aXTTZnqY1E1JBSsChW1KJSYijiwZN4Lo1/giZetHhWiaHaH9aoNbEHtb8sCagtChWTNNAt9eaWellpDs+ZaSwGbZJ+4PFm38z77O7sDkOdTM68p59ra3LcdfZMRZ9SzlUZe5WmHboG/yEfrCWrXN0GbycmaWp6inK5bxSNxahcrqDmk9g/bOzetROp9DhuRCKbr/F4cIhGk8+ltKbE+eVgfb2EtmAAN29FZVP8UYLa24JwHEeuqSkplUoyVldtnDzRgTt3+ylw7AgWFr5ifm5Orqn6dVKvx+n7ygpMjwGXy4WGBp1XGZasZWQyWdyORWX/lpKxVJosy0JrywFMz8zCtu3yzAZ/BIL/SpIvXtKyEBxswfznL/B6vTjfdW7LG/6zJyOjz6hYLMLX6sOHj59gGEZVgaBCMjj8lIqLiwgcDWI2k4Hh9qD74oWqAsGmZODJEBUKeXQcP413E29gmibCoe6aAoGUxBMDlM/l+ZkI8Z8qCQ8X9IRDdQkEysN4ggr5AsKXrmJ4JAGTb+KVyz11CwSst6+Prl+L4P6De2hubsSpzk4oigLGQ+S/Q1V5nW2MGWMyN+7bw5g4A9lsFm63G37/YSiqCk3joWo8a1B56PwEy2tdlzUxrygql6po2r+X/QZc4Kt8vjU1QAAAAABJRU5ErkJggg==",Oh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8zyKORhVGSxV0MK0pIlgwlRU1j1AwW7r1jhpp7TfeObCyVrbLw2HgtbKzZWtgqpTxKtjZWxEa6/ueOmkmNcup0fn3nfF/nfAeCBznTcqt7wLILTnwsqiVTM1rtMzW0UE8Tbbrp5odjsQkqjo9bAmq96VZZ/G80phdcEwKa8JCZdwrC88IDq4W84h3hsLmop4VPhbscuaDwvdKNIr8ozvocVJlhJxEfEQ4La9kyNsrYXHQs4X7hSNqyJT+YLHJa8ZpiK7di/txTvTC0YE9PKV1mO2OMM0kMDYMVlshRoFtWWxSXuOxHK/jbfH9MXIa4ljDFMcoyFrrvR/3B727dTF9vMSkUhZonz3vrgNot+Nr0vM9Dz/s6gqpHuLBL/uUDGHwXfbOkRfahaR3OLkuasQ3nG9D6kNcd3ZeqZAYzGXg9kW9KQfM1NMwWe/vZ5/gOEtLVxBXs7kFnVrLnKry7rry3P8/4/RH9Bi+4coweluJpAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB7klEQVQ4T5WSS0xTQRSG/zu33fFYGdJF17BS08tGE3YGFuICmgrojkCIC8FECjtIWAnIrilNMGgAeRRtCyVo7A6Npg12oeHVEjHlsS4p5XVJjzPDhZRAbuo3i3PmzPyTf+aMggJxd3WTkWJwoP9Sx4xoihA7nfV40dFuVP4DIV76ukSJxAblu7jAYkRTSkuKMfJm9Ir1i8MKusLpqY7HLuelSMSO9udyrSAHuq7j4CAjD+FQa0szVlfX5JppFwKhOcpm9mX+6/eKjPk0PXlqZDewsPiJXg8NkRnfvv+gGx2E5sO0nUqhpLgINpsNXu8wgsEAPB4PLBYLcrkcNE1DJnt4/QofAkFKcXGlQ0N4IYyB/lfGynU+f4lANXLJzOxH+rv1B/fvVWFuPmRUCZ2dbjQ2NkgH8XgcsVhMusge5jmYnPbTFhdXP6iFf3YcDq0S8Z/Lpg74Vc//wdjEJCUTSTx66JLi23fuoqnBJQ+PRCKoq6sXqXTg8/n4m3gRjUZle/FubIJ6evtofX1PflUxl7s5Ym7G+6lpUl663fSsrQujbz0oK7uF6poaMMaQTqexuZnE7s4Ojk9OoCiKrIsohqC8ogLK1IyfhB273Q4Hf3mmqrxVKs70MxwdH0FlKqxWK68zGcVc5a1U+T7GGP4BgBQJdqV6GiMAAAAASUVORK5CYII=",Bh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSkWqDhYp4hCwOlkQFXHUKhShQqgVWnUwufRDaNKQtLg4Cq4FBz8Wqw4uzro6uAqC4AeIo5OToouU+L+k0CLGg+N+vLv3uHsHCPUS06zAGKDpFTOViIuZ7IoYfEUAEfSgH0Mys4xZSUrCc3zdw8fXuxjP8j735+hWcxYDfCLxDDPMCvE68dRmxeC8TxxmRVklPiceNemCxI9cV1x+41xwWOCZYTOdmiMOE4uFNlbamBVNjXiSOKpqOuULGZdVzluctVKVNe/JXxjK6ctLXKc5iAQWsAgJIhRUsYESKojRqpNiIUX7cQ//gOOXyKWQawOMHPMoQ4Ps+MH/4He3Vn5i3E0KxYGOF9v+GAaCu0CjZtvfx7bdOAH8z8CV3vKX68D0J+m1lhY9Anq3gYvrlqbsAZc7QOTJkE3Zkfw0hXweeD+jb8oCfbdA16rbW3Mfpw9AmrpK3gAHh8BIgbLXPN7d2d7bv2ea/f0AZphyovX12KAAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfmBBgOKgbgcs+YAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAzFJREFUOMuVlWtMFGcUht8Ztt1lZmFwZlmWXXZZkF0tEW1TI02s2kvU/miJicaUeMFoURtquDRYTdqGhhAjRkNL0ia9gReIrRVawRQjmqz+MsbourUlbUkI7sLOfLNovKS2Ro+/WGbKboBJ5s98532+c857cgZEhBv7D9rivuA+vXKNSESYyxtp2WFVg4FGdV25nYiA29uarJri7mQQY0xReu9vXGWfLexiS5NVz8n9RocYZRbpl/tvrsiG6vSsZxBuMwhRBiGqyfKZeytfE2aC/bl/3/MJr+u7SR2DEE14Cutw7dtfOSbP22s80CSpj214PSsd7LeP662ay9Vh1MRF5xeRtnYLiAgNoS2cruR+qBsCmJTdx8pXTCv/yieNNt1b0KkZYlV3YfuNjs4MIkIyEKFD0HIdDcZb9eyc/sSqsmSmQ427bczpOmqMUeX8tqHWpowkx3h79NjbmHDk1Zqgotz/6K2XskZ2VlrVIv8JU5kF8z+/2laXYWRM68/aB+dxx6Hs0Q1GMUk6q3r93UbYmE0+3Nt9iv+/PmXTK4+v5nRBqTH2VIc4lVm+70i4d4BPpU07FruadnFqib/OZBSEaNzhODxyqJ9Pp+OR5ql5LGdydx++QgBn/P6c/m+pZeADKZ0uJfCPvR+JzpOnjkJ/+CoAIgAcOA4AnuJJWWaIdccWlsmptBwRmWH1taLSdfL7DPZgOQEgAOSe18U/fTSM+D+fTsZZeD7yX6m4yRmJT5gAxvqHq6oEtaj4tMnN0iWtPw528USEiSLvexqEWNIoi3ROe7lYTmnK37U1dtVd8JMRNu4qaPk6HE4agOvt0Is91cwAZYI0OFoWVEzAa9XvZ2l5bhNsbOGiAz9Ebk5z82LPu5zqd29nEKcyzcwZHF0WyCUi4NZnrXZVVnpMo1Hob/750vW0o9HXcZNTS/K3GzPVefuFkaWL8hAv9lUktwyE6FjJC80N2h1+xn0IAgt4qiZ7qkGIxRYE6rF56BYSLs8ODUJ0fPGLzV9duszPemP/fpxjQe9WDWJszOc7WD16jAcR4Z3QAW68fEn5l3+p/Fx/AYGWIEbeWLa8gsIcEeEZsTM0Y8K17+YAAAAASUVORK5CYII=";const vt=e=>(ul("data-v-9e3fdc46"),e=e(),cl(),e),Th={class:"head"},Lh=vt(()=>ct("img",{src:yh},null,-1)),Rh={key:0,class:"gray"},Fh={class:"typeIcon-wrapper"},Ph=["src"],Uh={class:"typeIcon-wrapper"},zh=["src"],Gh={key:0,class:"gray"},Mh=["innerHTML"],Dh={key:0,class:"gray"},Kh={class:"gray"},jh=["onClick"],Wh=["src"],Zh=["src"],Vh=["src"],Qh=vt(()=>ct("img",{class:"pr-4px",src:wh},null,-1)),qh=vt(()=>ct("img",{class:"pr-4px",src:vh},null,-1)),Yh=vt(()=>ct("img",{class:"pr-4px",src:bh},null,-1)),Xh=vt(()=>ct("img",{class:"pr-4px",src:_h},null,-1)),Hh=vt(()=>ct("img",{class:"pr-4px",src:Ea},null,-1)),Jh=vt(()=>ct("img",{class:"pr-4px",src:Ah},null,-1)),$h=vt(()=>ct("img",{class:"pr-4px",src:xh},null,-1)),td=vt(()=>ct("img",{class:"pr-4px",src:Eh},null,-1)),ed=vt(()=>ct("img",{class:"pr-4px",src:Ea},null,-1)),rd=vt(()=>ct("img",{class:"pr-4px",src:kh},null,-1)),nd=vt(()=>ct("img",{class:"pr-4px",src:Sh},null,-1)),id=vt(()=>ct("img",{class:"pr-4px",src:Ih},null,-1)),sd=vt(()=>ct("img",{class:"pr-4px",src:Ch},null,-1)),od=vt(()=>ct("img",{class:"pr-4px",src:Nh},null,-1)),ad=vt(()=>ct("img",{class:"pr-4px",src:Oh},null,-1)),ld=vt(()=>ct("span",{class:"gray absolute right-5px"},"Ctrl+X",-1)),ud=vt(()=>ct("span",{class:"gray absolute right-5px"},"Ctrl+C",-1)),cd=vt(()=>ct("span",{class:"gray absolute right-5px"},"Ctrl+V",-1)),fd=vt(()=>ct("span",{class:"gray absolute right-5px"},"Ctrl+D",-1)),hd=vt(()=>ct("span",null," Move Up ",-1)),dd=[hd],pd=vt(()=>ct("span",null," Move Down ",-1)),gd=[pd],md=vt(()=>ct("span",null," Move To ",-1)),yd=vt(()=>ct("span",{class:"absolute right-5px"},"",-1)),wd=[md,yd],vd=["onClick"],bd=vt(()=>ct("img",{class:"w-12px pr-4px",src:Bh},null,-1)),_d=vt(()=>ct("span",{class:"gray absolute right-5px"},"Del",-1));function Ad(e,t,r,n,i,s){const o=Vn("EditorCollapsibleBox"),a=Vn("CatalogueEntry",!0),l=Jf,c=rh,f=Vn("ContextMenu");return tt(),ot("div",{class:"item unselectable",onMouseup:t[29]||(t[29]=Ce((...d)=>s.debug&&s.debug(...d),["middle","stop"])),onContextmenu:t[30]||(t[30]=Ce((...d)=>s.contextmenu.show&&s.contextmenu.show(...d),["stop"]))},[r.item.editorTypeName==="catalogue"||r.item.editorTypeName==="gameSystem"?(tt(),ot(Jt,{key:0},[ct("div",Th,[$r(o,{payload:s.catalogue,nobox:"",group:[],collapsible:!1},{title:pe(()=>[Lh,mt(" "+Dt(s.catalogue.name)+" ",1),s.getNameExtra(s.catalogue)?(tt(),ot("span",Rh,""+Dt(s.getNameExtra(s.catalogue)),1)):ut("",!0)]),content:pe(()=>[]),_:1},8,["payload"])]),(tt(!0),ot(Jt,null,yr(s.groupedCategories,d=>(tt(),Kt(o,{key:d.type,altclickable:n.store.can_follow(r.item)||r.imported,onAltclick:s.onctrlclick,collapsible:d.items.length>0,group:s.get_group("entries"),payload:d.type,onContextmenu:Ce(p=>s.contextmenu.show(p,d.type),["stop"]),class:He([d.type,d.links,`depth-${r.depth}`]),nobox:"",defcollapsed:!s.should_be_open(d.type)},{title:pe(()=>[ct("span",null,[ct("span",Fh,[ct("img",{class:"typeIcon",src:`./assets/bsicons/${d.icon}`},null,8,Ph)]),mt(" "+Dt(d.name),1)])]),content:pe(()=>[(tt(!0),ot(Jt,null,yr(d.items,p=>(tt(),Kt(a,{key:s.key(p.item),item:p.item,group:s.get_group(d.type),forceShowRecursive:s.forceShow,imported:p.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:2},1032,["altclickable","onAltclick","collapsible","group","payload","onContextmenu","class","defcollapsed"]))),128))],64)):(tt(),Kt(o,{key:1,altclickable:n.store.can_follow(r.item)||r.imported,onAltclick:s.onctrlclick,collapsible:s.mixedChildren&&s.mixedChildren.length>0,empty:!s.mixedChildren||s.mixedChildren.length==0,group:r.group||[],payload:r.item,class:He([r.item.parentKey,`depth-${r.depth}`]),defcollapsed:!i.open,nobox:""},{title:pe(()=>[ct("span",null,[ct("span",Uh,[ct("img",{class:"typeIcon",src:`./assets/bsicons/${r.item.editorTypeName}.png`},null,8,zh)]),$r(l,{errors:r.item.errors},null,8,["errors"]),ct("span",{class:He({imported:r.imported,filtered:r.item.highlight})},Dt(s.getName(r.item)),3),s.getNameExtra(r.item)?(tt(),ot("span",Gh,""+Dt(s.getNameExtra(r.item)),1)):ut("",!0),s.costs?(tt(),ot("span",{key:1,class:"ml-10px",innerHTML:s.costs},null,8,Mh)):ut("",!0)])]),content:pe(()=>[(tt(!0),ot(Jt,null,yr(s.mixedChildren,d=>(tt(),Kt(a,{key:s.key(d.item),item:d.item,group:s.get_group("default"),forceShowRecursive:s.forceShow,imported:r.imported||d.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:1},8,["altclickable","onAltclick","collapsible","empty","group","payload","class","defcollapsed"])),i.contextmenuopen?(tt(),Kt(f,{key:2,modelValue:i.contextmenuopen,"onUpdate:modelValue":t[28]||(t[28]=d=>i.contextmenuopen=d),ref:"contextmenu"},{default:pe(({payload:d})=>{var p,g,b,y,_;return[!d&&r.item?(tt(),ot(Jt,{key:0},[n.store.can_follow(r.item)?(tt(),ot("div",{key:0,onClick:t[0]||(t[0]=w=>n.store.follow(s.link))},[mt(" Follow "),s.link.target.catalogue!==r.item.catalogue?(tt(),ot("span",Dh," ("+Dt(((p=s.link.target.catalogue)==null?void 0:p.getName())||s.link.target.getName())+") ",1)):ut("",!0)])):ut("",!0),r.imported?(tt(),ot("div",{key:1,onClick:t[1]||(t[1]=w=>n.store.goto(r.item))},[mt(" Goto "),ct("span",Kh," ("+Dt((g=r.item.catalogue)==null?void 0:g.getName())+") ",1)])):ut("",!0),(b=r.item.links)!=null&&b.length||(y=r.item.other_links)!=null&&y.length?(tt(),ot("div",{key:2,onClick:t[2]||(t[2]=w=>n.store.mode="references")}," References ("+Dt(r.item.links?r.item.links.length:0)+") ",1)):ut("",!0),r.item.isLink()||r.item.links||r.imported?(tt(),Kt(c,{key:3})):ut("",!0)],64)):ut("",!0),d?(tt(),ot(Jt,{key:1},[ct("div",{onClick:w=>n.store.create(d)},[ct("img",{class:"pr-4px",src:`assets/bsicons/${s.getTypeName(d)}.png`},null,8,Wh),mt(" "+Dt(s.getTypeLabel(s.getTypeName(d))),1)],8,jh),d==="selectionEntries"?(tt(),ot("div",{key:0,onClick:t[3]||(t[3]=w=>n.store.create("entryLinks",{type:"selectionEntry"}))},[ct("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,Zh),mt(" Link ")])):ut("",!0),d==="rules"?(tt(),ot("div",{key:1,onClick:t[4]||(t[4]=w=>n.store.create("infoLinks",{type:"profile"}))},[ct("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,Vh),mt(" Link ")])):ut("",!0),$r(c)],64)):(tt(),ot(Jt,{key:2},[s.allowed("forceEntries")?(tt(),ot("div",{key:0,onClick:t[5]||(t[5]=w=>n.store.create("forceEntries"))},[Qh,mt(" Force ")])):ut("",!0),s.allowed("categoryLinks")&&r.item.isForce()?(tt(),ot("div",{key:1,onClick:t[6]||(t[6]=w=>n.store.create("categoryLinks"))},[qh,mt(" Category ")])):ut("",!0),s.allowed(["forces","categoryLinks"])?(tt(),Kt(c,{key:2})):ut("",!0),s.allowed("selectionEntries")?(tt(),ot("div",{key:3,onClick:t[7]||(t[7]=w=>n.store.create("selectionEntries"))},[Yh,mt(" Entry ")])):ut("",!0),s.allowed("selectionEntryGroups")?(tt(),ot("div",{key:4,onClick:t[8]||(t[8]=w=>n.store.create("selectionEntryGroups"))},[Xh,mt(" Group ")])):ut("",!0),s.allowed("entryLinks")?(tt(),ot("div",{key:5,onClick:t[9]||(t[9]=w=>n.store.create("entryLinks",{type:"selectionEntry"}))},[Hh,mt(" Link ")])):ut("",!0),s.allowed(["selectionEntries","selectionEntryGroups","entryLinks"])?(tt(),Kt(c,{key:6})):ut("",!0),s.allowed("profiles")?(tt(),ot("div",{key:7,onClick:t[10]||(t[10]=w=>n.store.create_child("profiles",r.item))},[Jh,mt(" Profile ")])):ut("",!0),s.allowed("rules")?(tt(),ot("div",{key:8,onClick:t[11]||(t[11]=w=>n.store.create("rules"))},[$h,mt(" Rule ")])):ut("",!0),s.allowed("infoGroups")?(tt(),ot("div",{key:9,onClick:t[12]||(t[12]=w=>n.store.create("infoGroups"))},[td,mt(" Info Group ")])):ut("",!0),s.allowed("infoLinks")?(tt(),ot("div",{key:10,onClick:t[13]||(t[13]=w=>n.store.create("infoLinks",{type:"profile"}))},[ed,mt(" Info Link ")])):ut("",!0),s.allowed(["profiles","rules","infoGroups","infoLinks"])?(tt(),Kt(c,{key:11})):ut("",!0),s.allowed("conditions")?(tt(),ot("div",{key:12,onClick:t[14]||(t[14]=w=>n.store.create("conditions"))},[rd,mt(" Condition ")])):ut("",!0),s.allowed("conditionGroups")?(tt(),ot("div",{key:13,onClick:t[15]||(t[15]=w=>n.store.create("conditionGroups"))},[nd,mt(" Condition Group ")])):ut("",!0),s.allowed("repeats")?(tt(),ot("div",{key:14,onClick:t[16]||(t[16]=w=>n.store.create("repeats"))},[id,mt(" Repeat ")])):ut("",!0),s.allowed(["conditions","conditionGroups","repeats"])?(tt(),Kt(c,{key:15})):ut("",!0),s.allowed("constraints")?(tt(),ot("div",{key:16,onClick:t[17]||(t[17]=w=>n.store.create_child("constraints",r.item))},[sd,mt(" Constraint ")])):ut("",!0),s.allowed("modifiers")?(tt(),ot("div",{key:17,onClick:t[18]||(t[18]=w=>n.store.create("modifiers"))},[od,mt(" Modifier ")])):ut("",!0),s.allowed("modifierGroups")?(tt(),ot("div",{key:18,onClick:t[19]||(t[19]=w=>n.store.create("modifierGroups"))},[ad,mt(" Modifier Group ")])):ut("",!0),s.allowed(["constraints","modifiers","modifierGroups"])?(tt(),Kt(c,{key:19})):ut("",!0)],64)),d?ut("",!0):(tt(),ot("div",{key:3,onClick:t[20]||(t[20]=(...w)=>n.store.cut&&n.store.cut(...w))},[mt("Cut"),ld])),d?ut("",!0):(tt(),ot("div",{key:4,onClick:t[21]||(t[21]=(...w)=>n.store.copy&&n.store.copy(...w))},[mt("Copy"),ud])),ct("div",{onClick:t[22]||(t[22]=(...w)=>n.store.paste&&n.store.paste(...w))},[mt("Paste"),cd]),d?ut("",!0):(tt(),ot("div",{key:5,onClick:t[23]||(t[23]=(...w)=>n.store.duplicate&&n.store.duplicate(...w))},[mt("Duplicate"),fd])),s.sortable(r.item.parent)?ut("",!0):(tt(),ot("div",{key:6,onClick:t[24]||(t[24]=w=>n.store.move_up(r.item))},dd)),s.sortable(r.item.parent)?ut("",!0):(tt(),ot("div",{key:7,onClick:t[25]||(t[25]=w=>n.store.move_down(r.item))},gd)),!d&&((_=n.store.get_move_targets(r.item))!=null&&_.length)?(tt(),ot(Jt,{key:8},[ct("div",{onMouseover:t[26]||(t[26]=(...w)=>s.nestedcontextmenu.show&&s.nestedcontextmenu.show(...w))},wd,32),$r(f,{ref:"nestedcontextmenu"},{default:pe(()=>[(tt(!0),ot(Jt,null,yr(n.store.get_move_targets(r.item),w=>(tt(),ot("div",{onClick:E=>n.store.move(r.item,s.catalogue,w.target,w.type)},Dt(w.target.name)+" - "+Dt(w.type),9,vd))),256))]),_:1},512)],64)):ut("",!0),d?ut("",!0):(tt(),Kt(c,{key:9})),d?ut("",!0):(tt(),ot("div",{key:10,onClick:t[27]||(t[27]=w=>n.store.remove())},[bd,mt("Remove"),_d]))]}),_:1},8,["modelValue"])):ut("",!0)],32)}const xd=Zr(mh,[["render",Ad],["__scopeId","data-v-9e3fdc46"]]),ka={showImported:!1,ignoreProfilesRules:!1,filter:"",scroll:0,selection:void 0},Rp=fl({components:{CatalogueEntry:xd},emits:["scrolltop"],setup(){return{store:Wn(),uistate:Cr(),settings:Fo()}},data(){return{...ka,...this.defaults,shouldScrollTo:void 0,shouldScrollToElement:void 0}},async mounted(){this.load(),addEventListener("keydown",this.keydown),addEventListener("copy",this.copy),addEventListener("paste",this.paste),addEventListener("cut",this.cut)},unmounted(){removeEventListener("keydown",this.keydown),removeEventListener("copy",this.copy),removeEventListener("paste",this.paste),removeEventListener("cut",this.cut)},props:{catalogue:{type:Object,required:!0},defaults:{type:Object,default:{}}},methods:{onscroll(e){this.scroll=e.target.scrollTop},load(){this.$nextTick(async()=>{if(this.shouldScrollTo=this.scroll,this.selection)try{let e=Rf(this.catalogue,this.selection);const t=this.selection[this.selection.length-1];if(!e&&t.id&&(e=this.catalogue.findOptionById(t.id)),e){const r=await this.store.open(e);r&&(await ae(r).do_select(),this.shouldScrollToElement=r)}}catch(e){console.error(e)}})},async set_scroll(e){const t=this.$refs.scrollable;t&&(t.scrollTop=e),this.$nextTick(async()=>{const r=this.$refs.scrollable;r&&(r.scrollTop=e)})},async scroll_to(e){e.scrollIntoView({block:"nearest",inline:"center"}),this.$nextTick(async()=>{e.scrollIntoView({block:"nearest",inline:"center"})})},should_capture_copy(e){var t;return!((t=getSelection())!=null&&t.toString())},should_capture_paste(e){var r,n;const t=(((r=e.target)==null?void 0:r.tagName)||"").toLowerCase();return!(["input"].includes(t)||(n=e.target)!=null&&n.isContentEditable||this.$route.name!=="catalogue")},async cut(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.cut(e))},async copy(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.copy(e))},async paste(e){this.should_capture_paste(e)&&(e.preventDefault(),await this.store.paste(e))},async keydown(e){var n,i;if(this.$route.name!=="catalogue"||!e.target)return;const t=(i=(n=e.target)==null?void 0:n.tagName)==null?void 0:i.toLowerCase(),r=e.key.toLowerCase();e.ctrlKey&&r==="f"&&(e.preventDefault(),this.$refs["editor-searchbox"].focus()),r==="escape"&&(this.$refs["editor-searchbox"].blur(),this.store.filter="",this.update(this.filterData)),t==="body"&&(e.ctrlKey&&r==="z"&&(e.preventDefault(),await this.store.undo()),e.ctrlKey&&r==="y"&&(e.preventDefault(),await this.store.redo()),e.ctrlKey&&r==="d"&&(e.preventDefault(),await this.store.duplicate()),r==="delete"&&(e.preventDefault(),await this.store.remove()))},async update(e){const{filter:t,ignoreProfilesRules:r}=e,n=this.store.filtered;for(const i of n)delete i.showInEditor,delete i.showChildsInEditor,delete i.highlight,Ai(i,s=>{delete s.showInEditor,delete i.showChildsInEditor});if(t.length>1){this.store.set_filter(t),this.store.filtered=this.catalogue.findOptionsByText(t),r&&(this.store.filtered=this.store.filtered.filter(i=>!i.isProfile()&&!i.isRule()&&!i.isInfoGroup()));for(const i of this.store.filtered)i.showInEditor=!0,i.showChildsInEditor=!0,i.highlight=!0,Ai(i,s=>{s.showInEditor=!0});if(await hl(),this.store.filtered.length<300){for(const i of this.store.filtered)if(i.parent)try{await this.store.open(i,!1)}catch{continue}}}else this.store.set_filter(""),this.store.filtered=[]}},computed:{filterData(){return{filter:this.filter.trim(),ignoreProfilesRules:this.ignoreProfilesRules}}},watch:{filterData:{handler(e){this.update(e)},immediate:!0},showImported:{immediate:!0,handler(e){e&&this.catalogue.imports.map(t=>t.processForEditor())}},shouldScrollTo(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.set_scroll(e)})},shouldScrollToElement(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.scroll_to(e)})}}});const bt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Nt=Object.keys,Rt=Array.isArray;function Gt(e,t){return typeof t!="object"||Nt(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||bt.Promise||(bt.Promise=Promise);const Gr=Object.getPrototypeOf,Ed={}.hasOwnProperty;function Wt(e,t){return Ed.call(e,t)}function sr(e,t){typeof t=="function"&&(t=t(Gr(e))),(typeof Reflect>"u"?Nt:Reflect.ownKeys)(t).forEach(r=>{fe(e,r,t[r])})}const Sa=Object.defineProperty;function fe(e,t,r,n){Sa(e,t,Gt(r&&Wt(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function tr(e){return{from:function(t){return e.prototype=Object.create(t.prototype),fe(e.prototype,"constructor",e),{extend:sr.bind(null,e.prototype)}}}}const kd=Object.getOwnPropertyDescriptor;function gs(e,t){let r;return kd(e,t)||(r=Gr(e))&&gs(r,t)}const Sd=[].slice;function In(e,t,r){return Sd.call(e,t,r)}function Ia(e,t){return t(e)}function _r(e){if(!e)throw new Error("Assertion Failed")}function Ca(e){bt.setImmediate?setImmediate(e):setTimeout(e,0)}function Na(e,t){return e.reduce((r,n,i)=>{var s=t(n,i);return s&&(r[s[0]]=s[1]),r},{})}function he(e,t){if(Wt(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,i=t.length;n<i;++n){var s=he(e,t[n]);r.push(s)}return r}var o=t.indexOf(".");if(o!==-1){var a=e[t.substr(0,o)];return a===void 0?void 0:he(a,t.substr(o+1))}}function Yt(e,t,r){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){_r(typeof r!="string"&&"length"in r);for(var n=0,i=t.length;n<i;++n)Yt(e,t[n],r[n])}else{var s=t.indexOf(".");if(s!==-1){var o=t.substr(0,s),a=t.substr(s+1);if(a==="")r===void 0?Rt(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r;else{var l=e[o];l&&Wt(e,o)||(l=e[o]={}),Yt(l,a,r)}}else r===void 0?Rt(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Oa(e){var t={};for(var r in e)Wt(e,r)&&(t[r]=e[r]);return t}const Id=[].concat;function Ba(e){return Id.apply([],e)}const Ta="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ba([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>bt[e]),Cd=Ta.map(e=>bt[e]);Na(Ta,e=>[e,!0]);let we=null;function Qr(e){we=typeof WeakMap<"u"&&new WeakMap;const t=Ci(e);return we=null,t}function Ci(e){if(!e||typeof e!="object")return e;let t=we&&we.get(e);if(t)return t;if(Rt(e)){t=[],we&&we.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(Ci(e[r]))}else if(Cd.indexOf(e.constructor)>=0)t=e;else{const s=Gr(e);for(var i in t=s===Object.prototype?{}:Object.create(s),we&&we.set(e,t),e)Wt(e,i)&&(t[i]=Ci(e[i]))}return t}const{toString:Nd}={};function Ni(e){return Nd.call(e).slice(8,-1)}const Oi=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Od=typeof Oi=="symbol"?function(e){var t;return e!=null&&(t=e[Oi])&&t.apply(e)}:function(){return null},qe={};function le(e){var t,r,n,i;if(arguments.length===1){if(Rt(e))return e.slice();if(this===qe&&typeof e=="string")return[e];if(i=Od(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const ms=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var ee=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function La(e,t){ee=e,Ra=t}var Ra=()=>!0;const Bd=!new Error("").stack;function De(){if(Bd)try{throw De.arguments,new Error}catch(e){return e}return new Error}function Bi(e,t){var r=e.stack;return r?(t=t||0,r.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),r.split(`
`).slice(t).filter(Ra).map(n=>`
`+n).join("")):""}var Fa=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ys=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Fa),Td={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function er(e,t){this._e=De(),this.name=e,this.message=t}function Pa(e,t){return e+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Cn(e,t,r,n){this._e=De(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Pa(e,t)}function Nr(e,t){this._e=De(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=Pa(e,t)}tr(er).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Bi(this._e,2))}},toString:function(){return this.name+": "+this.message}}),tr(Cn).from(er),tr(Nr).from(er);var ws=ys.reduce((e,t)=>(e[t]=t+"Error",e),{});const Ld=er;var lt=ys.reduce((e,t)=>{var r=t+"Error";function n(i,s){this._e=De(),this.name=r,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Td[t]||r,this.inner=null)}return tr(n).from(Ld),e[t]=n,e},{});lt.Syntax=SyntaxError,lt.Type=TypeError,lt.Range=RangeError;var _o=Fa.reduce((e,t)=>(e[t+"Error"]=lt[t],e),{}),wn=ys.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=lt[t]),e),{});function yt(){}function Mr(e){return e}function Rd(e,t){return e==null||e===Mr?t:function(r){return t(e(r))}}function Ge(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Fd(e,t){return e===yt?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Ge(n,this.onsuccess):n),i&&(this.onerror=this.onerror?Ge(i,this.onerror):i),s!==void 0?s:r}}function Pd(e,t){return e===yt?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ge(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Ge(n,this.onerror):n)}}function Ud(e,t){return e===yt?t:function(r){var n=e.apply(this,arguments);Gt(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ge(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Ge(s,this.onerror):s),n===void 0?o===void 0?void 0:o:Gt(n,o)}}function zd(e,t){return e===yt?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function vs(e,t){return e===yt?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then(function(){return t.apply(n,s)})}return t.apply(this,arguments)}}wn.ModifyError=Cn,wn.DexieError=er,wn.BulkError=Nr;var Dr={};const[Ti,Nn,Li]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Gr(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Gr(t),e]})(),Ua=Nn&&Nn.then,vn=Ti&&Ti.constructor,bs=!!Li;var Ri=!1,Gd=Li?()=>{Li.then(on)}:bt.setImmediate?setImmediate.bind(null,on):bt.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{on(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(on,0)},Or=function(e,t){Ar.push([e,t]),On&&(Gd(),On=!1)},Fi=!0,On=!0,Fe=[],bn=[],Pi=null,Ui=Mr,rr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xo,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{xo(e[0],e[1])}catch{}})}},st=rr,Ar=[],Pe=0,_n=[];function $(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=yt,this._lib=!1;var t=this._PSD=st;if(ee&&(this._stackHolder=De(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==Dr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Gi(this,this._value))}this._state=null,this._value=null,++t.ref,Ga(this,e)}const zi={get:function(){var e=st,t=Bn;function r(n,i){var s=!e.global&&(e!==st||t!==Bn);const o=s&&!de();var a=new $((l,c)=>{_s(this,new za(Tn(n,e,s,o),Tn(i,e,s,o),l,c,e))});return ee&&Ka(a,this),a}return r.prototype=Dr,r},set:function(e){fe(this,"then",e&&e.prototype===Dr?zi:{get:function(){return e},set:zi.set})}};function za(e,t,r,n,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=i}function Ga(e,t){try{t(r=>{if(e._state===null){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&qr();r&&typeof r.then=="function"?Ga(e,(i,s)=>{r instanceof $?r._then(i,s):r.then(i,s)}):(e._state=!0,e._value=r,Ma(e)),n&&Yr()}},Gi.bind(null,e))}catch(r){Gi(e,r)}}function Gi(e,t){if(bn.push(t),e._state===null){var r=e._lib&&qr();t=Ui(t),e._state=!1,e._value=t,ee&&t!==null&&typeof t=="object"&&!t._promise&&function(n,i,s){try{n.apply(null,s)}catch(o){i&&i(o)}}(()=>{var n=gs(t,"stack");t._promise=e,fe(t,"stack",{get:()=>Ri?n&&(n.get?n.get.apply(t):n.value):e.stack})}),function(n){Fe.some(i=>i._value===n._value)||Fe.push(n)}(e),Ma(e),r&&Yr()}}function Ma(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)_s(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),Pe===0&&(++Pe,Or(()=>{--Pe==0&&As()},[]))}function _s(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Pe,Or(Md,[r,e,t])}else e._listeners.push(t)}function Md(e,t,r){try{Pi=t;var n,i=t._value;t._state?n=e(i):(bn.length&&(bn=[]),n=e(i),bn.indexOf(i)===-1&&function(s){for(var o=Fe.length;o;)if(Fe[--o]._value===s._value)return void Fe.splice(o,1)}(t)),r.resolve(n)}catch(s){r.reject(s)}finally{Pi=null,--Pe==0&&As(),--r.psd.ref||r.psd.finalize()}}function Da(e,t,r){if(t.length===r)return t;var n="";if(e._state===!1){var i,s,o=e._value;o!=null?(i=o.name||"Error",s=o.message||o,n=Bi(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+n)}return ee&&((n=Bi(e._stackHolder,2))&&t.indexOf(n)===-1&&t.push(n),e._prev&&Da(e._prev,t,r)),t}function Ka(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function on(){qr()&&Yr()}function qr(){var e=Fi;return Fi=!1,On=!1,e}function Yr(){var e,t,r;do for(;Ar.length>0;)for(e=Ar,Ar=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(Ar.length>0);Fi=!0,On=!0}function As(){var e=Fe;Fe=[],e.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var t=_n.slice(0),r=t.length;r;)t[--r]()}function an(e){return new $(Dr,!1,e)}function _t(e,t){var r=st;return function(){var n=qr(),i=st;try{return _e(r,!0),e.apply(this,arguments)}catch(s){t&&t(s)}finally{_e(i,!1),n&&Yr()}}}sr($.prototype,{then:zi,_then:function(e,t){_s(this,new za(null,null,e,t,st))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,n=>n instanceof t?r(n):an(n)):this.then(null,n=>n&&n.name===t?r(n):an(n))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),an(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Ri=!0;var e=Da(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Ri=!1}}},timeout:function(e,t){return e<1/0?new $((r,n)=>{var i=setTimeout(()=>n(new lt.Timeout(t)),e);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&fe($.prototype,Symbol.toStringTag,"Dexie.Promise"),rr.env=ja(),sr($,{all:function(){var e=le.apply(null,arguments).map(ln);return new $(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach((i,s)=>$.resolve(i).then(o=>{e[s]=o,--n||t(e)},r))})},resolve:e=>{if(e instanceof $)return e;if(e&&typeof e.then=="function")return new $((r,n)=>{e.then(r,n)});var t=new $(Dr,!0,e);return Ka(t,Pi),t},reject:an,race:function(){var e=le.apply(null,arguments).map(ln);return new $((t,r)=>{e.map(n=>$.resolve(n).then(t,r))})},PSD:{get:()=>st,set:e=>st=e},totalEchoes:{get:()=>Bn},newPSD:be,usePSD:lr,scheduler:{get:()=>Or,set:e=>{Or=e}},rejectionMapper:{get:()=>Ui,set:e=>{Ui=e}},follow:(e,t)=>new $((r,n)=>be((i,s)=>{var o=st;o.unhandleds=[],o.onunhandled=s,o.finalize=Ge(function(){(function(a){function l(){a(),_n.splice(_n.indexOf(l),1)}_n.push(l),++Pe,Or(()=>{--Pe==0&&As()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),e()},t,r,n))}),vn&&(vn.allSettled&&fe($,"allSettled",function(){const e=le.apply(null,arguments).map(ln);return new $(t=>{e.length===0&&t([]);let r=e.length;const n=new Array(r);e.forEach((i,s)=>$.resolve(i).then(o=>n[s]={status:"fulfilled",value:o},o=>n[s]={status:"rejected",reason:o}).then(()=>--r||t(n)))})}),vn.any&&typeof AggregateError<"u"&&fe($,"any",function(){const e=le.apply(null,arguments).map(ln);return new $((t,r)=>{e.length===0&&r(new AggregateError([]));let n=e.length;const i=new Array(n);e.forEach((s,o)=>$.resolve(s).then(a=>t(a),a=>{i[o]=a,--n||r(new AggregateError(i))}))})}));const Lt={awaits:0,echoes:0,id:0};var Dd=0,An=[],ci=0,Bn=0,Kd=0;function be(e,t,r,n){var i=st,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Kd;var o=rr.env;s.env=bs?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject,nthen:Ao(o.nthen,s),gthen:Ao(o.gthen,s)}:{},t&&Gt(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=lr(s,e,r,n);return s.ref===0&&s.finalize(),a}function ar(){return Lt.id||(Lt.id=++Dd),++Lt.awaits,Lt.echoes+=100,Lt.id}function de(){return!!Lt.awaits&&(--Lt.awaits==0&&(Lt.id=0),Lt.echoes=100*Lt.awaits,!0)}function ln(e){return Lt.echoes&&e&&e.constructor===vn?(ar(),e.then(t=>(de(),t),t=>(de(),Ot(t)))):e}function jd(e){++Bn,Lt.echoes&&--Lt.echoes!=0||(Lt.echoes=Lt.id=0),An.push(st),_e(e,!0)}function Wd(){var e=An[An.length-1];An.pop(),_e(e,!1)}function _e(e,t){var r=st;if((t?!Lt.echoes||ci++&&e===st:!ci||--ci&&e===st)||Wa(t?jd.bind(null,e):Wd),e!==st&&(st=e,r===rr&&(rr.env=ja()),bs)){var n=rr.env.Promise,i=e.env;Nn.then=i.nthen,n.prototype.then=i.gthen,(r.global||e.global)&&(Object.defineProperty(bt,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function ja(){var e=bt.Promise;return bs?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(bt,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Nn.then,gthen:e.prototype.then}:{}}function lr(e,t,r,n,i){var s=st;try{return _e(e,!0),t(r,n,i)}finally{_e(s,!1)}}function Wa(e){Ua.call(Ti,e)}function Tn(e,t,r,n){return typeof e!="function"?e:function(){var i=st;r&&ar(),_e(t,!0);try{return e.apply(this,arguments)}finally{_e(i,!1),n&&Wa(de)}}}function Ao(e,t){return function(r,n){return e.call(this,Tn(r,t),Tn(n,t))}}(""+Ua).indexOf("[native code]")===-1&&(ar=de=yt);function xo(e,t){var r;try{r=t.onuncatched(e)}catch{}if(r!==!1)try{var n,i={promise:t,reason:e};if(bt.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),Gt(n,i)):bt.CustomEvent&&Gt(n=new CustomEvent("unhandledrejection",{detail:i}),i),n&&bt.dispatchEvent&&(dispatchEvent(n),!bt.PromiseRejectionEvent&&bt.onunhandledrejection))try{bt.onunhandledrejection(n)}catch{}ee&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var Ot=$.reject;function Mi(e,t,r,n){if(e.idbdb&&(e._state.openComplete||st.letThrough||e._vip)){var i=e._createTransaction(t,r,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===ws.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>Mi(e,t,r,n))):Ot(s)}return i._promise(t,(s,o)=>be(()=>(st.trans=i,n(s,o,i)))).then(s=>i._completion.then(()=>s))}if(e._state.openComplete)return Ot(new lt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Ot(new lt.DatabaseClosed);e.open().catch(yt)}return e._state.dbReadyPromise.then(()=>Mi(e,t,r,n))}const Be=String.fromCharCode(65535),ne="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Br=[],jn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Zd=jn,Vd=jn,Za=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Me(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Va={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function un(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=Qr(t))[e],t)}class Qd{_trans(t,r,n){const i=this._tx||st.trans,s=this.name;function o(l,c,f){if(!f.schema[s])throw new lt.NotFound("Table "+s+" not part of transaction");return r(f.idbtrans,f)}const a=qr();try{return i&&i.db===this.db?i===st.trans?i._promise(t,o,n):be(()=>i._promise(t,o,n),{trans:i,transless:st.transless||st}):Mi(this.db,t,[this.name],o)}finally{a&&Yr()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:t}).then(i=>this.hook.reading.fire(i))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(Rt(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=Nt(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&r.every(f=>c.keyPath.indexOf(f)>=0)&&c.keyPath.every(f=>r.indexOf(f)>=0))[0];if(n&&this.db._maxKey!==Be)return this.where(n.name).equals(n.keyPath.map(c=>t[c]));!n&&ee&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(c,f){try{return s.cmp(c,f)===0}catch{return!1}}const[a,l]=r.reduce(([c,f],d)=>{const p=i[d],g=t[d];return[c||p,c||!p?Me(f,p&&p.multi?b=>{const y=he(b,d);return Rt(y)&&y.some(_=>o(g,_))}:b=>o(g,he(b,d))):f]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):n?this.filter(l):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,Rt(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const r=n=>{if(!n)return n;const i=Object.create(t.prototype);for(var s in n)if(Wt(n,s))try{i[s]=n[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t}defineClass(){return this.mapToClass(function(t){Gt(this,t)})}add(t,r){const{auto:n,keyPath:i}=this.schema.primKey;let s=t;return i&&n&&(s=un(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:r!=null?[r]:null,values:[s]})).then(o=>o.numFailures?$.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Yt(t,i,o)}catch{}return o})}update(t,r){if(typeof t!="object"||Rt(t))return this.where(":id").equals(t).modify(r);{const n=he(t,this.schema.primKey.keyPath);if(n===void 0)return Ot(new lt.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?Nt(r).forEach(i=>{Yt(t,i,r[i])}):r(t,{value:t,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(t,r){const{auto:n,keyPath:i}=this.schema.primKey;let s=t;return i&&n&&(s=un(i)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:r!=null?[r]:null})).then(o=>o.numFailures?$.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Yt(t,i,o)}catch{}return o})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?$.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Va})).then(t=>t.numFailures?$.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,r,n){const i=Array.isArray(r)?r:void 0,s=(n=n||(i?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new lt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new lt.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let f=l&&a?t.map(un(l)):t;return this.core.mutate({trans:o,type:"add",keys:i,values:f,wantResults:s}).then(({numFailures:d,results:p,lastResult:g,failures:b})=>{if(d===0)return s?p:g;throw new Nr(`${this.name}.bulkAdd(): ${d} of ${c} operations failed`,b)})})}bulkPut(t,r,n){const i=Array.isArray(r)?r:void 0,s=(n=n||(i?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new lt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new lt.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let f=l&&a?t.map(un(l)):t;return this.core.mutate({trans:o,type:"put",keys:i,values:f,wantResults:s}).then(({numFailures:d,results:p,lastResult:g,failures:b})=>{if(d===0)return s?p:g;throw new Nr(`${this.name}.bulkPut(): ${d} of ${c} operations failed`,b)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:t})).then(({numFailures:n,lastResult:i,failures:s})=>{if(n===0)return i;throw new Nr(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,s)})}}function Tr(e){var t={},r=function(a,l){if(l){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return t[a].subscribe.apply(null,f),e}if(typeof a=="string")return t[a]};r.addEventType=s;for(var n=1,i=arguments.length;n<i;++n)s(arguments[n]);return r;function s(a,l,c){if(typeof a=="object")return o(a);l||(l=zd),c||(c=yt);var f={subscribers:[],fire:c,subscribe:function(d){f.subscribers.indexOf(d)===-1&&(f.subscribers.push(d),f.fire=l(f.fire,d))},unsubscribe:function(d){f.subscribers=f.subscribers.filter(function(p){return p!==d}),f.fire=f.subscribers.reduce(l,c)}};return t[a]=r[a]=f,f}function o(a){Nt(a).forEach(function(l){var c=a[l];if(Rt(c))s(l,a[l][0],a[l][1]);else{if(c!=="asap")throw new lt.InvalidArgument("Invalid event config");var f=s(l,Mr,function(){for(var d=arguments.length,p=new Array(d);d--;)p[d]=arguments[d];f.subscribers.forEach(function(g){Ca(function(){g.apply(null,p)})})})}})}}function mr(e,t){return tr(t).from({prototype:e}),t}function Ze(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function fi(e,t){e.filter=Me(e.filter,t)}function hi(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>Me(n(),t()):t,e.justLimit=r&&!n}function xn(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new lt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Eo(e,t,r){const n=xn(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function cn(e,t,r,n){const i=e.replayFilter?Me(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(a,l,c)=>{if(!i||i(l,c,p=>l.stop(p),p=>l.fail(p))){var f=l.primaryKey,d=""+f;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(f)),Wt(s,d)||(s[d]=!0,t(a,l,c))}};return Promise.all([e.or._iterate(o,r),ko(Eo(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return ko(Eo(e,n,r),Me(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function ko(e,t,r,n){var i=_t(n?(s,o,a)=>r(n(s),o,a):r);return e.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();t&&!t(s,a=>o=a,a=>{s.stop(a),o=yt},a=>{s.fail(a),o=yt})||i(s.value,s,a=>o=a),o()})})}function zt(e,t){try{const r=So(e),n=So(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(i,s){const o=i.length,a=s.length,l=o<a?o:a;for(let c=0;c<l;++c)if(i[c]!==s[c])return i[c]<s[c]?-1:1;return o===a?0:o<a?-1:1}(Io(e),Io(t));case"Array":return function(i,s){const o=i.length,a=s.length,l=o<a?o:a;for(let c=0;c<l;++c){const f=zt(i[c],s[c]);if(f!==0)return f}return o===a?0:o<a?-1:1}(e,t)}}catch{}return NaN}function So(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const r=Ni(e);return r==="ArrayBuffer"?"binary":r}function Io(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class qd{_read(t,r){var n=this._ctx;return n.error?n.table._trans(null,Ot.bind(null,n.error)):n.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,Ot.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=Me(r.algorithm,t)}_iterate(t,r){return cn(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&Gt(n,t),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(n=>cn(r,t,n,r.table.core))}count(t){return this._read(r=>{const n=this._ctx,i=n.table.core;if(Ze(n,!0))return i.count({trans:r,query:{index:xn(n,i.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var s=0;return cn(n,()=>(++s,!1),r,i).then(()=>s)}).then(t)}sortBy(t,r){const n=t.split(".").reverse(),i=n[0],s=n.length-1;function o(c,f){return f?o(c[n[f]],f-1):c[i]}var a=this._ctx.dir==="next"?1:-1;function l(c,f){var d=o(c,s),p=o(f,s);return d<p?-a:d>p?a:0}return this.toArray(function(c){return c.sort(l)}).then(r)}toArray(t){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&Ze(n,!0)&&n.limit>0){const{valueMapper:i}=n,s=xn(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:s,range:n.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return cn(n,s=>i.push(s),r,n.table.core).then(()=>i)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,Ze(r)?hi(r,()=>{var n=t;return(i,s)=>n===0||(n===1?(--n,!1):(s(()=>{i.advance(n),n=0}),!1))}):hi(r,()=>{var n=t;return()=>--n<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),hi(this._ctx,()=>{var r=t;return function(n,i,s){return--r<=0&&i(s),r>=0}},!0),this}until(t,r){return fi(this._ctx,function(n,i,s){return!t(n.value)||(i(s),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,n;return fi(this._ctx,function(i){return t(i.value)}),r=this._ctx,n=t,r.isMatch=Me(r.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){t(i.primaryKey,i)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.key)}).then(function(){return n}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&Ze(r,!0)&&r.limit>0)return this._read(i=>{var s=xn(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:s,range:r.range}})}).then(({result:i})=>i).then(t);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,s){n.push(s.primaryKey)}).then(function(){return n}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var n={};return fi(this._ctx,function(i){var s=i.primaryKey.toString(),o=Wt(n,s);return n[s]=!0,!o}),this}modify(t){var r=this._ctx;return this._write(n=>{var i;if(typeof t=="function")i=t;else{var s=Nt(t),o=s.length;i=function(y){for(var _=!1,w=0;w<o;++w){var E=s[w],S=t[E];he(y,E)!==S&&(Yt(y,E,S),_=!0)}return _}}const a=r.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,f=this.db._options.modifyChunkSize||200,d=[];let p=0;const g=[],b=(y,_)=>{const{failures:w,numFailures:E}=_;p+=y-E;for(let S of Nt(w))d.push(w[S])};return this.clone().primaryKeys().then(y=>{const _=w=>{const E=Math.min(f,y.length-w);return a.getMany({trans:n,keys:y.slice(w,w+E),cache:"immutable"}).then(S=>{const I=[],C=[],O=l?[]:null,T=[];for(let L=0;L<E;++L){const j=S[L],Y={value:Qr(j),primKey:y[w+L]};i.call(Y,Y.value,Y)!==!1&&(Y.value==null?T.push(y[w+L]):l||zt(c(j),c(Y.value))===0?(C.push(Y.value),l&&O.push(y[w+L])):(T.push(y[w+L]),I.push(Y.value)))}const G=Ze(r)&&r.limit===1/0&&(typeof t!="function"||t===di)&&{index:r.index,range:r.range};return Promise.resolve(I.length>0&&a.mutate({trans:n,type:"add",values:I}).then(L=>{for(let j in L.failures)T.splice(parseInt(j),1);b(I.length,L)})).then(()=>(C.length>0||G&&typeof t=="object")&&a.mutate({trans:n,type:"put",keys:O,values:C,criteria:G,changeSpec:typeof t!="function"&&t}).then(L=>b(C.length,L))).then(()=>(T.length>0||G&&t===di)&&a.mutate({trans:n,type:"delete",keys:T,criteria:G}).then(L=>b(T.length,L))).then(()=>y.length>w+E&&_(w+f))})};return _(0).then(()=>{if(d.length>0)throw new Cn("Error modifying one or more objects",d,p,g);return y.length})})})}delete(){var t=this._ctx,r=t.range;return Ze(t)&&(t.isPrimKey&&!Vd||r.type===3)?this._write(n=>{const{primaryKey:i}=t.table.core.schema,s=r;return t.table.core.count({trans:n,query:{index:i,range:s}}).then(o=>t.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:c,numFailures:f})=>{if(f)throw new Cn("Could not delete some values",Object.keys(a).map(d=>a[d]),o-f);return o-f}))}):this.modify(di)}}const di=(e,t)=>t.value=null;function Yd(e,t){return e<t?-1:e===t?0:1}function Xd(e,t){return e>t?-1:e===t?0:1}function jt(e,t,r){var n=e instanceof qa?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function Ve(e){return new e.Collection(e,()=>Qa("")).limit(0)}function Hd(e,t,r,n,i,s){for(var o=Math.min(e.length,n.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==n[l])return i(e[l],r[l])<0?e.substr(0,l)+r[l]+r.substr(l+1):i(e[l],n[l])<0?e.substr(0,l)+n[l]+r.substr(l+1):a>=0?e.substr(0,a)+t[a]+r.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<n.length&&s==="next"?e+r.substr(e.length):o<e.length&&s==="prev"?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function fn(e,t,r,n){var i,s,o,a,l,c,f,d=r.length;if(!r.every(y=>typeof y=="string"))return jt(e,"String expected.");function p(y){i=function(w){return w==="next"?E=>E.toUpperCase():E=>E.toLowerCase()}(y),s=function(w){return w==="next"?E=>E.toLowerCase():E=>E.toUpperCase()}(y),o=y==="next"?Yd:Xd;var _=r.map(function(w){return{lower:s(w),upper:i(w)}}).sort(function(w,E){return o(w.lower,E.lower)});a=_.map(function(w){return w.upper}),l=_.map(function(w){return w.lower}),c=y,f=y==="next"?"":n}p("next");var g=new e.Collection(e,()=>ge(a[0],l[d-1]+n));g._ondirectionchange=function(y){p(y)};var b=0;return g._addAlgorithm(function(y,_,w){var E=y.key;if(typeof E!="string")return!1;var S=s(E);if(t(S,l,b))return!0;for(var I=null,C=b;C<d;++C){var O=Hd(E,S,a[C],l[C],o,c);O===null&&I===null?b=C+1:(I===null||o(I,O)>0)&&(I=O)}return _(I!==null?function(){y.continue(I+f)}:w),!1}),g}function ge(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Qa(e){return{type:1,lower:e,upper:e}}class qa{get Collection(){return this._ctx.table.db.Collection}between(t,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(n||i)&&(!n||!i)?Ve(this):new this.Collection(this,()=>ge(t,r,!n,!i))}catch{return jt(this,ne)}}equals(t){return t==null?jt(this,ne):new this.Collection(this,()=>Qa(t))}above(t){return t==null?jt(this,ne):new this.Collection(this,()=>ge(t,void 0,!0))}aboveOrEqual(t){return t==null?jt(this,ne):new this.Collection(this,()=>ge(t,void 0,!1))}below(t){return t==null?jt(this,ne):new this.Collection(this,()=>ge(void 0,t,!1,!0))}belowOrEqual(t){return t==null?jt(this,ne):new this.Collection(this,()=>ge(void 0,t))}startsWith(t){return typeof t!="string"?jt(this,"String expected."):this.between(t,t+Be,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):fn(this,(r,n)=>r.indexOf(n[0])===0,[t],Be)}equalsIgnoreCase(t){return fn(this,(r,n)=>r===n[0],[t],"")}anyOfIgnoreCase(){var t=le.apply(qe,arguments);return t.length===0?Ve(this):fn(this,(r,n)=>n.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=le.apply(qe,arguments);return t.length===0?Ve(this):fn(this,(r,n)=>n.some(i=>r.indexOf(i)===0),t,Be)}anyOf(){const t=le.apply(qe,arguments);let r=this._cmp;try{t.sort(r)}catch{return jt(this,ne)}if(t.length===0)return Ve(this);const n=new this.Collection(this,()=>ge(t[0],t[t.length-1]));n._ondirectionchange=s=>{r=s==="next"?this._ascending:this._descending,t.sort(r)};let i=0;return n._addAlgorithm((s,o,a)=>{const l=s.key;for(;r(l,t[i])>0;)if(++i,i===t.length)return o(a),!1;return r(l,t[i])===0||(o(()=>{s.continue(t[i])}),!1)}),n}notEqual(t){return this.inAnyRange([[-(1/0),t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=le.apply(qe,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return jt(this,ne)}const r=t.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[-(1/0),i]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const n=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(t.length===0)return Ve(this);if(!t.every(E=>E[0]!==void 0&&E[1]!==void 0&&i(E[0],E[1])<=0))return jt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",lt.InvalidArgument);const l=!r||r.includeLowers!==!1,c=r&&r.includeUppers===!0;let f,d=i;function p(E,S){return d(E[0],S[0])}try{f=t.reduce(function(E,S){let I=0,C=E.length;for(;I<C;++I){const O=E[I];if(n(S[0],O[1])<0&&n(S[1],O[0])>0){O[0]=o(O[0],S[0]),O[1]=a(O[1],S[1]);break}}return I===C&&E.push(S),E},[]),f.sort(p)}catch{return jt(this,ne)}let g=0;const b=c?E=>i(E,f[g][1])>0:E=>i(E,f[g][1])>=0,y=l?E=>s(E,f[g][0])>0:E=>s(E,f[g][0])>=0;let _=b;const w=new this.Collection(this,()=>ge(f[0][0],f[f.length-1][1],!l,!c));return w._ondirectionchange=E=>{E==="next"?(_=b,d=i):(_=y,d=s),f.sort(p)},w._addAlgorithm((E,S,I)=>{for(var C=E.key;_(C);)if(++g,g===f.length)return S(I),!1;return!!function(O){return!b(O)&&!y(O)}(C)||(this._cmp(C,f[g][1])===0||this._cmp(C,f[g][0])===0||S(()=>{d===i?E.continue(f[g][0]):E.continue(f[g][1])}),!1)}),w}startsWithAnyOf(){const t=le.apply(qe,arguments);return t.every(r=>typeof r=="string")?t.length===0?Ve(this):this.inAnyRange(t.map(r=>[r,r+Be])):jt(this,"startsWithAnyOf() only works with strings")}}function $t(e){return _t(function(t){return Kr(t),e(t.target.error),!1})}function Kr(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Ae=Tr(null,"storagemutated");class Jd{_lock(){return _r(!st.global),++this._reculock,this._reculock!==1||st.global||(st.lockOwnerFor=this),this}_unlock(){if(_r(!st.global),--this._reculock==0)for(st.global||(st.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{lr(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&st.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(_r(!this.idbtrans),!t&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new lt.DatabaseClosed(n);case"MissingAPIError":throw new lt.MissingAPI(n.message,n);default:throw new lt.OpenFailed(n)}if(!this.active)throw new lt.TransactionInactive;return _r(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=_t(i=>{Kr(i),this._reject(t.error)}),t.onabort=_t(i=>{Kr(i),this.active&&this._reject(new lt.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=_t(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Ae.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,n){if(t==="readwrite"&&this.mode!=="readwrite")return Ot(new lt.ReadOnly("Transaction is readonly"));if(!this.active)return Ot(new lt.TransactionInactive);if(this._locked())return new $((s,o)=>{this._blockedFuncs.push([()=>{this._promise(t,r,n).then(s,o)},st])});if(n)return be(()=>{var s=new $((o,a)=>{this._lock();const l=r(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new $((s,o)=>{var a=r(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const n=$.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=r._waitingFor;return new $((o,a)=>{n.then(l=>r._waitingQueue.push(_t(o.bind(null,l))),l=>r._waitingQueue.push(_t(a.bind(null,l)))).finally(()=>{r._waitingFor===s&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new lt.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(Wt(r,t))return r[t];const n=this.schema[t];if(!n)throw new lt.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,n,this);return i.core=this.db.core.table(t),r[t]=i,i}}function Di(e,t,r,n,i,s,o){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(i?"++":"")+Ya(t)}}function Ya(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Xa(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Na(r,n=>[n.name,n])}}let jr=e=>{try{return e.only([[]]),jr=()=>[[]],[[]]}catch{return jr=()=>Be,Be}};function Ki(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>he(r,t)}(e):t=>he(t,e)}function Co(e){return[].slice.call(e)}let $d=0;function Lr(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function tp(e,t,r){function n(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:f,lowerOpen:d,upperOpen:p}=l;return c===void 0?f===void 0?null:t.upperBound(f,!!p):f===void 0?t.lowerBound(c,!!d):t.bound(c,f,!!d,!!p)}const{schema:i,hasGetAll:s}=function(l,c){const f=Co(l.objectStoreNames);return{schema:{name:l.name,tables:f.map(d=>c.objectStore(d)).map(d=>{const{keyPath:p,autoIncrement:g}=d,b=Rt(p),y=p==null,_={},w={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y,compound:b,keyPath:p,autoIncrement:g,unique:!0,extractKey:Ki(p)},indexes:Co(d.indexNames).map(E=>d.index(E)).map(E=>{const{name:S,unique:I,multiEntry:C,keyPath:O}=E,T={name:S,compound:Rt(O),keyPath:O,unique:I,multiEntry:C,extractKey:Ki(O)};return _[Lr(O)]=T,T}),getIndexByKeyPath:E=>_[Lr(E)]};return _[":id"]=w.primaryKey,p!=null&&(_[Lr(p)]=w.primaryKey),w})},hasGetAll:f.length>0&&"getAll"in c.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),o=i.tables.map(l=>function(c){const f=c.name;return{name:f,schema:c,mutate:function({trans:d,type:p,keys:g,values:b,range:y}){return new Promise((_,w)=>{_=_t(_);const E=d.objectStore(f),S=E.keyPath==null,I=p==="put"||p==="add";if(!I&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);const{length:C}=g||b||{length:1};if(g&&b&&g.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(C===0)return _({numFailures:0,failures:{},results:[],lastResult:void 0});let O;const T=[],G=[];let L=0;const j=N=>{++L,Kr(N)};if(p==="deleteRange"){if(y.type===4)return _({numFailures:L,failures:G,results:[],lastResult:void 0});y.type===3?T.push(O=E.clear()):T.push(O=E.delete(n(y)))}else{const[N,z]=I?S?[b,g]:[b,null]:[g,null];if(I)for(let A=0;A<C;++A)T.push(O=z&&z[A]!==void 0?E[p](N[A],z[A]):E[p](N[A])),O.onerror=j;else for(let A=0;A<C;++A)T.push(O=E[p](N[A])),O.onerror=j}const Y=N=>{const z=N.target.result;T.forEach((A,K)=>A.error!=null&&(G[K]=A.error)),_({numFailures:L,failures:G,results:p==="delete"?g:T.map(A=>A.result),lastResult:z})};O.onerror=N=>{j(N),Y(N)},O.onsuccess=Y})},getMany:({trans:d,keys:p})=>new Promise((g,b)=>{g=_t(g);const y=d.objectStore(f),_=p.length,w=new Array(_);let E,S=0,I=0;const C=T=>{const G=T.target;w[G._pos]=G.result,++I===S&&g(w)},O=$t(b);for(let T=0;T<_;++T)p[T]!=null&&(E=y.get(p[T]),E._pos=T,E.onsuccess=C,E.onerror=O,++S);S===0&&g(w)}),get:({trans:d,key:p})=>new Promise((g,b)=>{g=_t(g);const y=d.objectStore(f).get(p);y.onsuccess=_=>g(_.target.result),y.onerror=$t(b)}),query:function(d){return p=>new Promise((g,b)=>{g=_t(g);const{trans:y,values:_,limit:w,query:E}=p,S=w===1/0?void 0:w,{index:I,range:C}=E,O=y.objectStore(f),T=I.isPrimaryKey?O:O.index(I.name),G=n(C);if(w===0)return g({result:[]});if(d){const L=_?T.getAll(G,S):T.getAllKeys(G,S);L.onsuccess=j=>g({result:j.target.result}),L.onerror=$t(b)}else{let L=0;const j=_||!("openKeyCursor"in T)?T.openCursor(G):T.openKeyCursor(G),Y=[];j.onsuccess=N=>{const z=j.result;return z?(Y.push(_?z.value:z.primaryKey),++L===w?g({result:Y}):void z.continue()):g({result:Y})},j.onerror=$t(b)}})}(s),openCursor:function({trans:d,values:p,query:g,reverse:b,unique:y}){return new Promise((_,w)=>{_=_t(_);const{index:E,range:S}=g,I=d.objectStore(f),C=E.isPrimaryKey?I:I.index(E.name),O=b?y?"prevunique":"prev":y?"nextunique":"next",T=p||!("openKeyCursor"in C)?C.openCursor(n(S),O):C.openKeyCursor(n(S),O);T.onerror=$t(w),T.onsuccess=_t(G=>{const L=T.result;if(!L)return void _(null);L.___id=++$d,L.done=!1;const j=L.continue.bind(L);let Y=L.continuePrimaryKey;Y&&(Y=Y.bind(L));const N=L.advance.bind(L),z=()=>{throw new Error("Cursor not stopped")};L.trans=d,L.stop=L.continue=L.continuePrimaryKey=L.advance=()=>{throw new Error("Cursor not started")},L.fail=_t(w),L.next=function(){let A=1;return this.start(()=>A--?this.continue():this.stop()).then(()=>this)},L.start=A=>{const K=new Promise((M,rt)=>{M=_t(M),T.onerror=$t(rt),L.fail=rt,L.stop=D=>{L.stop=L.continue=L.continuePrimaryKey=L.advance=z,M(D)}}),et=()=>{if(T.result)try{A()}catch(M){L.fail(M)}else L.done=!0,L.start=()=>{throw new Error("Cursor behind last entry")},L.stop()};return T.onsuccess=_t(M=>{T.onsuccess=et,et()}),L.continue=j,L.continuePrimaryKey=Y,L.advance=N,et(),K},_(L)},w)})},count({query:d,trans:p}){const{index:g,range:b}=d;return new Promise((y,_)=>{const w=p.objectStore(f),E=g.isPrimaryKey?w:w.index(g.name),S=n(b),I=S?E.count(S):E.count();I.onsuccess=_t(C=>y(C.target.result)),I.onerror=$t(_)})}}}(l)),a={};return o.forEach(l=>a[l.name]=l),{stack:"dbcore",transaction:e.transaction.bind(e),table(l){if(!a[l])throw new Error(`Table '${l}' not found`);return a[l]},MIN_KEY:-1/0,MAX_KEY:jr(t),schema:i}}function ji({_novip:e},t){const r=t.db,n=function(i,s,{IDBKeyRange:o,indexedDB:a},l){return{dbcore:function(f,d){return d.reduce((p,{create:g})=>({...p,...g(p)}),f)}(tp(s,o,l),i.dbcore)}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach(i=>{const s=i.name;e.core.schema.tables.some(o=>o.name===s)&&(i.core=e.core.table(s),e[s]instanceof e.Table&&(e[s].core=i.core))})}function Ln({_novip:e},t,r,n){r.forEach(i=>{const s=n[i];t.forEach(o=>{const a=gs(o,i);(!a||"value"in a&&a.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?fe(o,i,{get(){return this.table(i)},set(l){Sa(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,s))})})}function Wi({_novip:e},t){t.forEach(r=>{for(let n in r)r[n]instanceof e.Table&&delete r[n]})}function ep(e,t){return e._cfg.version-t._cfg.version}function rp(e,t,r,n){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(r),s._completion.catch(n);const o=s._reject.bind(s),a=st.transless||st;be(()=>{st.trans=s,st.transless=a,t===0?(Nt(i).forEach(l=>{pi(r,l,i[l].primKey,i[l].indexes)}),ji(e,r),$.follow(()=>e.on.populate.fire(s)).catch(o)):function({_novip:l},c,f,d){const p=[],g=l._versions;let b=l._dbSchema=Vi(l,l.idbdb,d),y=!1;function _(){return p.length?$.resolve(p.shift()(f.idbtrans)).then(_):$.resolve()}return g.filter(w=>w._cfg.version>=c).forEach(w=>{p.push(()=>{const E=b,S=w._cfg.dbschema;Qi(l,E,d),Qi(l,S,d),b=l._dbSchema=S;const I=Ha(E,S);I.add.forEach(O=>{pi(d,O[0],O[1].primKey,O[1].indexes)}),I.change.forEach(O=>{if(O.recreate)throw new lt.Upgrade("Not yet support for changing primary key");{const T=d.objectStore(O.name);O.add.forEach(G=>Zi(T,G)),O.change.forEach(G=>{T.deleteIndex(G.name),Zi(T,G)}),O.del.forEach(G=>T.deleteIndex(G))}});const C=w._cfg.contentUpgrade;if(C&&w._cfg.version>c){ji(l,d),f._memoizedTables={},y=!0;let O=Oa(S);I.del.forEach(j=>{O[j]=E[j]}),Wi(l,[l.Transaction.prototype]),Ln(l,[l.Transaction.prototype],Nt(O),O),f.schema=O;const T=ms(C);let G;T&&ar();const L=$.follow(()=>{if(G=C(f),G&&T){var j=de.bind(null,null);G.then(j,j)}});return G&&typeof G.then=="function"?$.resolve(G):L.then(()=>G)}}),p.push(E=>{(!y||!Zd)&&function(S,I){[].slice.call(I.db.objectStoreNames).forEach(C=>S[C]==null&&I.db.deleteObjectStore(C))}(w._cfg.dbschema,E),Wi(l,[l.Transaction.prototype]),Ln(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),f.schema=l._dbSchema})}),_().then(()=>{var w,E;E=d,Nt(w=b).forEach(S=>{E.db.objectStoreNames.contains(S)||pi(E,S,w[S].primKey,w[S].indexes)})})}(e,t,s,r).catch(o)})}function Ha(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const i=e[n],s=t[n];if(i){const o={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!jn)o.recreate=!0,r.change.push(o);else{const a=i.idxByName,l=s.idxByName;let c;for(c in a)l[c]||o.del.push(c);for(c in l){const f=a[c],d=l[c];f?f.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}}else r.add.push([n,s])}return r}function pi(e,t,r,n){const i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(s=>Zi(i,s)),i}function Zi(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Vi(e,t,r){const n={};return In(t.objectStoreNames,0).forEach(i=>{const s=r.objectStore(i);let o=s.keyPath;const a=Di(Ya(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),l=[];for(let f=0;f<s.indexNames.length;++f){const d=s.index(s.indexNames[f]);o=d.keyPath;var c=Di(d.name,o,!!d.unique,!!d.multiEntry,!1,o&&typeof o!="string",!1);l.push(c)}n[i]=Xa(i,a,l)}),n}function Qi({_novip:e},t,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const s=n[i],o=r.objectStore(s);e._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const l=o.indexNames[a],c=o.index(l).keyPath,f=typeof c=="string"?c:"["+In(c).join("+")+"]";if(t[s]){const d=t[s].idxByName[f];d&&(d.name=l,delete t[s].idxByName[f],t[s].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&bt.WorkerGlobalScope&&bt instanceof bt.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class np{_parseStoresSpec(t,r){Nt(t).forEach(n=>{if(t[n]!==null){var i=t[n].split(",").map((o,a)=>{const l=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return Di(l,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),Rt(c),a===0)}),s=i.shift();if(s.multi)throw new lt.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new lt.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new lt.Schema("Index must have a name and cannot be an empty string")}),r[n]=Xa(n,s,i)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?Gt(this._cfg.storesSource,t):t;const n=r._versions,i={};let s={};return n.forEach(o=>{Gt(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),r._dbSchema=s,Wi(r,[r._allTables,r,r.Transaction.prototype]),Ln(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],Nt(s),s),r._storeNames=Nt(s),this}upgrade(t){return this._cfg.contentUpgrade=vs(this._cfg.contentUpgrade||yt,t),this}}function xs(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Ue("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Es(e){return e&&typeof e.databases=="function"}function qi(e){return be(function(){return st.letThrough=!0,e()})}function ip(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function sp(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?Ot(t.dbOpenError):e);ee&&(t.openCanceller._stackHolder=De()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function i(){if(t.openCanceller!==n)throw new lt.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return $.race([n,(typeof navigator>"u"?$.resolve():ip()).then(()=>new $((l,c)=>{if(i(),!r)throw new lt.MissingAPI;const f=e.name,d=t.autoSchema?r.open(f):r.open(f,Math.round(10*e.verno));if(!d)throw new lt.MissingAPI;d.onerror=$t(c),d.onblocked=_t(e._fireOnBlocked),d.onupgradeneeded=_t(p=>{if(o=d.transaction,t.autoSchema&&!e._options.allowEmptyDB){d.onerror=Kr,o.abort(),d.result.close();const b=r.deleteDatabase(f);b.onsuccess=b.onerror=_t(()=>{c(new lt.NoSuchDatabase(`Database ${f} doesnt exist`))})}else{o.onerror=$t(c);var g=p.oldVersion>Math.pow(2,62)?0:p.oldVersion;a=g<1,e._novip.idbdb=d.result,rp(e,g/10,o,c)}},c),d.onsuccess=_t(()=>{o=null;const p=e._novip.idbdb=d.result,g=In(p.objectStoreNames);if(g.length>0)try{const y=p.transaction((b=g).length===1?b[0]:b,"readonly");t.autoSchema?function({_novip:_},w,E){_.verno=w.version/10;const S=_._dbSchema=Vi(0,w,E);_._storeNames=In(w.objectStoreNames,0),Ln(_,[_._allTables],Nt(S),S)}(e,p,y):(Qi(e,e._dbSchema,y),function(_,w){const E=Ha(Vi(0,_.idbdb,w),_._dbSchema);return!(E.add.length||E.change.some(S=>S.add.length||S.change.length))}(e,y)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ji(e,y)}catch{}var b;Br.push(e),p.onversionchange=_t(y=>{t.vcFired=!0,e.on("versionchange").fire(y)}),p.onclose=_t(y=>{e.on("close").fire(y)}),a&&function({indexedDB:y,IDBKeyRange:_},w){!Es(y)&&w!=="__dbnames"&&xs(y,_).put({name:w}).catch(yt)}(e._deps,f),l()},c)}))]).then(()=>(i(),t.onReadyBeingFired=[],$.resolve(qi(()=>e.on.ready.fire(e.vip))).then(function l(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(vs,yt);return t.onReadyBeingFired=[],$.resolve(qi(()=>c(e.vip))).then(l)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(l=>{t.dbOpenError=l;try{o&&o.abort()}catch{}return n===t.openCanceller&&e._close(),Ot(l)}).finally(()=>{t.openComplete=!0,s()})}function Yi(e){var t=s=>e.next(s),r=i(t),n=i(s=>e.throw(s));function i(s){return o=>{var a=s(o),l=a.value;return a.done?l:l&&typeof l.then=="function"?l.then(r,n):Rt(l)?Promise.all(l).then(r,n):r(l)}}return i(t)()}function op(e,t,r){var n=arguments.length;if(n<2)throw new lt.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var s=Ba(i);return[e,s,r]}function Ja(e,t,r,n,i){return $.resolve().then(()=>{const s=st.transless||st,o=e._createTransaction(t,r,e._dbSchema,n),a={trans:o,transless:s};if(n)o.idbtrans=n.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(d){return d.name===ws.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>Ja(e,t,r,null,i))):Ot(d)}const l=ms(i);let c;l&&ar();const f=$.follow(()=>{if(c=i.call(o,o),c)if(l){var d=de.bind(null,null);c.then(d,d)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Yi(c))},a);return(c&&typeof c.then=="function"?$.resolve(c).then(d=>o.active?d:Ot(new lt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):f.then(()=>c)).then(d=>(n&&o._resolve(),o._completion.then(()=>d))).catch(d=>(o._reject(d),Ot(d)))})}function hn(e,t,r){const n=Rt(e)?e.slice():[e];for(let i=0;i<r;++i)n.push(t);return n}const ap={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,i={},s=[];function o(f,d,p){const g=Lr(f),b=i[g]=i[g]||[],y=f==null?0:typeof f=="string"?1:f.length,_=d>0,w={...p,isVirtual:_,keyTail:d,keyLength:y,extractKey:Ki(f),unique:!_&&p.unique};return b.push(w),w.isPrimaryKey||s.push(w),y>1&&o(y===2?f[0]:f.slice(0,y-1),d+1,p),b.sort((E,S)=>E.keyTail-S.keyTail),w}const a=o(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(const f of n.indexes)o(f.keyPath,0,f);function l(f){const d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:(p=f.query.range,g=d.keyTail,{type:p.type===1?2:p.type,lower:hn(p.lower,p.lowerOpen?e.MAX_KEY:e.MIN_KEY,g),lowerOpen:!0,upper:hn(p.upper,p.upperOpen?e.MIN_KEY:e.MAX_KEY,g),upperOpen:!0})}}:f;var p,g}return{...r,schema:{...n,primaryKey:a,indexes:s,getIndexByKeyPath:function(f){const d=i[Lr(f)];return d&&d[0]}},count:f=>r.count(l(f)),query:f=>r.query(l(f)),openCursor(f){const{keyTail:d,isVirtual:p,keyLength:g}=f.query.index;return p?r.openCursor(l(f)).then(b=>b&&function(y){return Object.create(y,{continue:{value:function(w){w!=null?y.continue(hn(w,f.reverse?e.MAX_KEY:e.MIN_KEY,d)):f.unique?y.continue(y.key.slice(0,g).concat(f.reverse?e.MIN_KEY:e.MAX_KEY,d)):y.continue()}},continuePrimaryKey:{value(w,E){y.continuePrimaryKey(hn(w,e.MAX_KEY,d),E)}},primaryKey:{get:()=>y.primaryKey},key:{get(){const w=y.key;return g===1?w[0]:w.slice(0,g)}},value:{get:()=>y.value}})}(b)):r.openCursor(f)}}}}}};function ks(e,t,r,n){return r=r||{},n=n||"",Nt(e).forEach(i=>{if(Wt(t,i)){var s=e[i],o=t[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const a=Ni(s);a!==Ni(o)?r[n+i]=t[i]:a==="Object"?ks(s,o,r,n+i+"."):s!==o&&(r[n+i]=t[i])}else s!==o&&(r[n+i]=t[i])}else r[n+i]=void 0}),Nt(t).forEach(i=>{Wt(e,i)||(r[n+i]=t[i])}),r}const lp={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema;return{...r,mutate(s){const o=st.trans,{deleting:a,creating:l,updating:c}=o.table(t).hook;switch(s.type){case"add":if(l.fire===yt)break;return o._promise("readwrite",()=>f(s),!0);case"put":if(l.fire===yt&&c.fire===yt)break;return o._promise("readwrite",()=>f(s),!0);case"delete":if(a.fire===yt)break;return o._promise("readwrite",()=>f(s),!0);case"deleteRange":if(a.fire===yt)break;return o._promise("readwrite",()=>function(p){return d(p.trans,p.range,1e4)}(s),!0)}return r.mutate(s);function f(p){const g=st.trans,b=p.keys||function(y,_){return _.type==="delete"?_.keys:_.keys||_.values.map(y.extractKey)}(n,p);if(!b)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?{...p,keys:b}:{...p}).type!=="delete"&&(p.values=[...p.values]),p.keys&&(p.keys=[...p.keys]),function(y,_,w){return _.type==="add"?Promise.resolve([]):y.getMany({trans:_.trans,keys:w,cache:"immutable"})}(r,p,b).then(y=>{const _=b.map((w,E)=>{const S=y[E],I={onerror:null,onsuccess:null};if(p.type==="delete")a.fire.call(I,w,S,g);else if(p.type==="add"||S===void 0){const C=l.fire.call(I,w,p.values[E],g);w==null&&C!=null&&(w=C,p.keys[E]=w,n.outbound||Yt(p.values[E],n.keyPath,w))}else{const C=ks(S,p.values[E]),O=c.fire.call(I,C,w,S,g);if(O){const T=p.values[E];Object.keys(O).forEach(G=>{Wt(T,G)?T[G]=O[G]:Yt(T,G,O[G])})}}return I});return r.mutate(p).then(({failures:w,results:E,numFailures:S,lastResult:I})=>{for(let C=0;C<b.length;++C){const O=E?E[C]:b[C],T=_[C];O==null?T.onerror&&T.onerror(w[C]):T.onsuccess&&T.onsuccess(p.type==="put"&&y[C]?p.values[C]:O)}return{failures:w,results:E,numFailures:S,lastResult:I}}).catch(w=>(_.forEach(E=>E.onerror&&E.onerror(w)),Promise.reject(w)))})}function d(p,g,b){return r.query({trans:p,values:!1,query:{index:n,range:g},limit:b}).then(({result:y})=>f({type:"delete",keys:y,trans:p}).then(_=>_.numFailures>0?Promise.reject(_.failures[0]):y.length<b?{failures:[],numFailures:0,lastResult:void 0}:d(p,{...g,lower:y[y.length-1],lowerOpen:!0},b)))}}}}})};function $a(e,t,r){try{if(!t||t.keys.length<e.length)return null;const n=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)zt(t.keys[i],e[s])===0&&(n.push(r?Qr(t.values[i]):t.values[i]),++s);return n.length===e.length?n:null}catch{return null}}const up={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const i=$a(n.keys,n.trans._cache,n.cache==="clone");return i?$.resolve(i):r.getMany(n).then(s=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Qr(s):s},s))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function Ss(e){return!("from"in e)}const oe=function(e,t){if(!this){const r=new oe;return e&&"d"in e&&Gt(r,e),r}Gt(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Wr(e,t,r){const n=zt(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Ss(e))return Gt(e,{from:t,to:r,d:1});const i=e.l,s=e.r;if(zt(r,e.from)<0)return i?Wr(i,t,r):e.l={from:t,to:r,d:1,l:null,r:null},No(e);if(zt(t,e.to)>0)return s?Wr(s,t,r):e.r={from:t,to:r,d:1,l:null,r:null},No(e);zt(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),zt(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&Rn(e,i),s&&o&&Rn(e,s)}function Rn(e,t){Ss(t)||function r(n,{from:i,to:s,l:o,r:a}){Wr(n,i,s),o&&r(n,o),a&&r(n,a)}(e,t)}function cp(e,t){const r=Xi(t);let n=r.next();if(n.done)return!1;let i=n.value;const s=Xi(e);let o=s.next(i.from),a=o.value;for(;!n.done&&!o.done;){if(zt(a.from,i.to)<=0&&zt(a.to,i.from)>=0)return!0;zt(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Xi(e){let t=Ss(e)?null:{s:0,n:e};return{next(r){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&zt(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||zt(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function No(e){var t,r;const n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...e},a=e[i];e.from=a.from,e.to=a.to,e[i]=a[i],o[i]=a[s],e[s]=o,o.d=Oo(o)}e.d=Oo(e)}function Oo({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}sr(oe.prototype,{add(e){return Rn(this,e),this},addKey(e){return Wr(this,e,e),this},addKeys(e){return e.forEach(t=>Wr(this,t,t)),this},[Oi](){return Xi(this)}});const fp={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new oe(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const i=e.table(n),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:p=>{const g=p.trans,b=g.mutatedParts||(g.mutatedParts={}),y=O=>{const T=`idb://${t}/${n}/${O}`;return b[T]||(b[T]=new oe)},_=y(""),w=y(":dels"),{type:E}=p;let[S,I]=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[];const C=p.trans._cache;return i.mutate(p).then(O=>{if(Rt(S)){E!=="delete"&&(S=O.results),_.addKeys(S);const T=$a(S,C);T||E==="add"||w.addKeys(S),(T||I)&&function(G,L,j,Y){function N(z){const A=G(z.name||"");function K(M){return M!=null?z.extractKey(M):null}const et=M=>z.multiEntry&&Rt(M)?M.forEach(rt=>A.addKey(rt)):A.addKey(M);(j||Y).forEach((M,rt)=>{const D=j&&K(j[rt]),q=Y&&K(Y[rt]);zt(D,q)!==0&&(D!=null&&et(D),q!=null&&et(q))})}L.indexes.forEach(N)}(y,s,T,I)}else if(S){const T={from:S.lower,to:S.upper};w.add(T),_.add(T)}else _.add(r),w.add(r),s.indexes.forEach(T=>y(T.name).add(r));return O})}},f=({query:{index:p,range:g}})=>{var b,y;return[p,new oe((b=g.lower)!==null&&b!==void 0?b:e.MIN_KEY,(y=g.upper)!==null&&y!==void 0?y:e.MAX_KEY)]},d={get:p=>[o,new oe(p.key)],getMany:p=>[o,new oe().addKeys(p.keys)],count:f,query:f,openCursor:f};return Nt(d).forEach(p=>{c[p]=function(g){const{subscr:b}=st;if(b){const y=I=>{const C=`idb://${t}/${n}/${I}`;return b[C]||(b[C]=new oe)},_=y(""),w=y(":dels"),[E,S]=d[p](g);if(y(E.name||"").add(S),!E.isPrimaryKey){if(p!=="count"){const I=p==="query"&&l&&g.values&&i.query({...g,values:!1});return i[p].apply(this,arguments).then(C=>{if(p==="query"){if(l&&g.values)return I.then(({result:T})=>(_.addKeys(T),C));const O=g.values?C.result.map(a):C.result;g.values?_.addKeys(O):w.addKeys(O)}else if(p==="openCursor"){const O=C,T=g.values;return O&&Object.create(O,{key:{get:()=>(w.addKey(O.primaryKey),O.key)},primaryKey:{get(){const G=O.primaryKey;return w.addKey(G),G}},value:{get:()=>(T&&_.addKey(O.primaryKey),O.value)}})}return C})}w.add(r)}}return i[p].apply(this,arguments)}}),c}}}};class Ue{constructor(t,r){this._middlewares={},this.verno=0;const n=Ue.dependencies;this._options=r={addons:Ue.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:yt,dbReadyPromise:null,cancelOpen:yt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new $(a=>{s.dbReadyResolve=a}),s.openCanceller=new $((a,l)=>{s.cancelOpen=l}),this._state=s,this.name=t,this.on=Tr(this,"populate","blocked","versionchange","close",{ready:[vs,yt]}),this.on.ready.subscribe=Ia(this.on.ready.subscribe,a=>(l,c)=>{Ue.vip(()=>{const f=this._state;if(f.openComplete)f.dbOpenError||$.resolve().then(l),c&&a(l);else if(f.onReadyBeingFired)f.onReadyBeingFired.push(l),c&&a(l);else{a(l);const d=this;c||a(function p(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(p)})}})}),this.Collection=(o=this,mr(qd.prototype,function(a,l){this.db=o;let c=Va,f=null;if(l)try{c=l()}catch(b){f=b}const d=a._ctx,p=d.table,g=p.hook.reading.fire;this._ctx={table:p,index:d.index,isPrimKey:!d.index||p.schema.primKey.keyPath&&d.index===p.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:f,or:d.or,valueMapper:g!==Mr?g:null}})),this.Table=function(a){return mr(Qd.prototype,function(l,c,f){this.db=a,this._tx=f,this.name=l,this.schema=c,this.hook=a._allTables[l]?a._allTables[l].hook:Tr(null,{creating:[Fd,yt],reading:[Rd,Mr],updating:[Ud,yt],deleting:[Pd,yt]})})}(this),this.Transaction=function(a){return mr(Jd.prototype,function(l,c,f,d,p){this.db=a,this.mode=l,this.storeNames=c,this.schema=f,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Tr(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $((g,b)=>{this._resolve=g,this._reject=b}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},g=>{var b=this.active;return this.active=!1,this.on.error.fire(g),this.parent?this.parent._reject(g):b&&this.idbtrans&&this.idbtrans.abort(),Ot(g)})})}(this),this.Version=function(a){return mr(np.prototype,function(l){this.db=a,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return mr(qa.prototype,function(l,c,f){this.db=a,this._ctx={table:l,index:c===":id"?null:c,or:f};const d=a._deps.indexedDB;if(!d)throw new lt.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(p,g)=>d.cmp(g,p),this._max=(p,g)=>d.cmp(p,g)>0?p:g,this._min=(p,g)=>d.cmp(p,g)<0?p:g,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=jr(r.IDBKeyRange),this._createTransaction=(a,l,c,f)=>new this.Transaction(a,l,c,this._options.chromeTransactionDurability,f),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Br.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(a))},this.use(ap),this.use(lp),this.use(fp),this.use(up),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(t){if(isNaN(t)||t<.1)throw new lt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new lt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var n=r.filter(i=>i._cfg.version===t)[0];return n||(n=new this.Version(t),r.push(n),r.sort(ep),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||st.letThrough||this._vip)?t():new $((r,n)=>{if(this._state.openComplete)return n(new lt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new lt.DatabaseClosed);this.open().catch(yt)}this._state.dbReadyPromise.then(r,n)}).then(t)}use({stack:t,create:r,level:n,name:i}){i&&this.unuse({stack:t,name:i});const s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:r,level:n??10,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:t,name:r,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>n?i.create!==n:!!r&&i.name!==r)),this}open(){return sp(this)}_close(){const t=this._state,r=Br.indexOf(this);if(r>=0&&Br.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new $(n=>{t.dbReadyResolve=n}),t.openCanceller=new $((n,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new lt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new $((n,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=_t(()=>{(function({indexedDB:a,IDBKeyRange:l},c){!Es(a)&&c!=="__dbnames"&&xs(a,l).delete(c).catch(yt)})(this._deps,this.name),n()}),o.onerror=$t(i),o.onblocked=this._fireOnBlocked};if(t)throw new lt.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Nt(this._allTables).map(t=>this._allTables[t])}transaction(){const t=op.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,n){let i=st.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const s=t.indexOf("?")!==-1;let o,a;t=t.replace("!","").replace("?","");try{if(a=r.map(c=>{var f=c instanceof this.Table?c.name:c;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),t=="r"||t==="readonly")o="readonly";else{if(t!="rw"&&t!="readwrite")throw new lt.InvalidArgument("Invalid transaction mode: "+t);o="readwrite"}if(i){if(i.mode==="readonly"&&o==="readwrite"){if(!s)throw new lt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1){if(!s)throw new lt.SubTransaction("Table "+c+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(f,d)=>{d(c)}):Ot(c)}const l=Ja.bind(null,this,o,a,i,n);return i?i._promise(o,l,"lock"):st.trans?lr(st.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!Wt(this._allTables,t))throw new lt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const hp=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class dp{constructor(t){this._subscribe=t}subscribe(t,r,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:n})}[hp](){return this}}function tl(e,t){return Nt(t).forEach(r=>{Rn(e[r]||(e[r]=new oe),t[r])}),e}function pp(e){return new dp(t=>{const r=ms(e);let n=!1,i={},s={};const o={get closed(){return n},unsubscribe:()=>{n=!0,Ae.storagemutated.unsubscribe(f)}};t.start&&t.start(o);let a=!1,l=!1;function c(){return Nt(s).some(p=>i[p]&&cp(i[p],s[p]))}const f=p=>{tl(i,p),c()&&d()},d=()=>{if(a||n)return;i={};const p={},g=function(b){r&&ar();const y=()=>be(e,{subscr:b,trans:null}),_=st.trans?lr(st.transless,y):y();return r&&_.then(de,de),_}(p);l||(Ae("storagemutated",f),l=!0),a=!0,Promise.resolve(g).then(b=>{a=!1,n||(c()?d():(i={},s=p,t.next&&t.next(b)))},b=>{a=!1,t.error&&t.error(b),o.unsubscribe()})};return d(),o})}let Hi;try{Hi={indexedDB:bt.indexedDB||bt.mozIndexedDB||bt.webkitIndexedDB||bt.msIndexedDB,IDBKeyRange:bt.IDBKeyRange||bt.webkitIDBKeyRange}}catch{Hi={indexedDB:null,IDBKeyRange:null}}const ke=Ue;function En(e){let t=ce;try{ce=!0,Ae.storagemutated.fire(e)}finally{ce=t}}sr(ke,{...wn,delete:e=>new ke(e,{addons:[]}).delete(),exists:e=>new ke(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:r}){return Es(t)?Promise.resolve(t.databases()).then(n=>n.map(i=>i.name).filter(i=>i!=="__dbnames")):xs(t,r).toCollection().primaryKeys()}(ke.dependencies).then(e)}catch{return Ot(new lt.MissingAPI)}},defineClass:()=>function(e){Gt(this,e)},ignoreTransaction:e=>st.trans?lr(st.transless,e):e(),vip:qi,async:function(e){return function(){try{var t=Yi(e.apply(this,arguments));return t&&typeof t.then=="function"?t:$.resolve(t)}catch(r){return Ot(r)}}},spawn:function(e,t,r){try{var n=Yi(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:$.resolve(n)}catch(i){return Ot(i)}},currentTransaction:{get:()=>st.trans||null},waitFor:function(e,t){const r=$.resolve(typeof e=="function"?ke.ignoreTransaction(e):e).timeout(t||6e4);return st.trans?st.trans.waitFor(r):r},Promise:$,debug:{get:()=>ee,set:e=>{La(e,e==="dexie"?()=>!0:Za)}},derive:tr,extend:Gt,props:sr,override:Ia,Events:Tr,on:Ae,liveQuery:pp,extendObservabilitySet:tl,getByKeyPath:he,setByKeyPath:Yt,delByKeyPath:function(e,t){typeof t=="string"?Yt(e,t,void 0):"length"in t&&[].map.call(t,function(r){Yt(e,r,void 0)})},shallowClone:Oa,deepClone:Qr,getObjectDiff:ks,cmp:zt,asap:Ca,minKey:-(1/0),addons:[],connections:Br,errnames:ws,dependencies:Hi,semVer:"3.2.3",version:"3.2.3".split(".").map(e=>parseInt(e)).reduce((e,t,r)=>e+t/Math.pow(10,2*r))}),ke.maxKey=jr(ke.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ae("storagemutated",e=>{if(!ce){let t;jn?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),ce=!0,dispatchEvent(t),ce=!1}}),addEventListener("x-storagemutated-1",({detail:e})=>{ce||En(e)}));let ce=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel("x-storagemutated-1");typeof e.unref=="function"&&e.unref(),Ae("storagemutated",t=>{ce||e.postMessage(t)}),e.onmessage=t=>{t.data&&En(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ae("storagemutated",t=>{try{ce||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key==="x-storagemutated-1"){const r=JSON.parse(t.newValue);r&&En(r.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type==="x-storagemutated-1"&&En(t.changedParts)})}$.rejectionMapper=function(e,t){if(!e||e instanceof er||e instanceof TypeError||e instanceof SyntaxError||!e.name||!_o[e.name])return e;var r=new _o[e.name](t||e.message,e);return"stack"in e&&fe(r,"stack",{get:function(){return this.inner.stack}}),r},La(ee,Za);class gp extends Ue{constructor(){super("nr-editor");Z(this,"catalogues");Z(this,"systems");this.version(5).stores({catalogues:"id, content.catalogue.id, content.catalogue.gameSystemId",systems:"id"})}}const ze=new gp;function Fp(e){const t=/^(?:(http(s?)?:\/\/)?github.com\/)?([^\/]+)\/([^\/]+)$/,r=e.match(t);if(!r)return null;const[,n="https://",i,s,o]=r;return!s||!o?null:`https://github.com/${s}/${o}`}async function Bo(e,t){try{const r=e.split("/"),n=r[r.length-2],i=r[r.length-1].replace(".git",""),s=`https://api.github.com/repos/${n}/${i}/contents/${encodeURIComponent(t)}`;console.log(`Querying github api at ${s}`);const o=await $fetch(s,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});if(!o||!(o!=null&&o.download_url))throw new Error("No download_url found");console.log(`Downloading file at ${o==null?void 0:o.download_url}`);const a=await $fetch(o.download_url,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});return console.log(`Downloaded file, length: ${a.length}`),a}catch(r){throw r}}async function mp(e,t,r){try{return await Bo(e,t)}catch(n){if(!r)throw n;return await Bo(e,r)}}async function yp(e,t){if(t.fullFilePath)try{const r=xa(t.fullFilePath),n=r.endsWith("z")?Xo(r,"z"):void 0,i=await mp(e.githubUrl,r,n),s=/revision="(\d+)"/,o=i.match(s);if(o){const a=(Number(o[1])||0)+1;return console.log(`Revision of ${t.name}: ${t.revision} -> ${a}`),a}}catch(r){console.error(r)}return t.revision||1}function To(e,t){if(e)return e[t]||e["*"]}async function Fn(e,t,r,n){if(!t.catalogue&&!t.gameSystem)throw Error("invalid loadBsData argument: no .catalogue or .gameSystem in data");const i=t.catalogue?"catalogue":"gameSystem",s=i==="gameSystem",o=i==="catalogue",a=t[i],l=a;if(l.loaded||l.loaded_editor)return l;br(a);const c=Ii(a,i);if(c.manager=e,o){const d={targetId:c.gameSystemId},p=e.getLoadedCatalogue(d,r);if(p)c.gameSystem=p;else{const g=await e.getData(d,r),b=e.getLoadedCatalogue(d,r);b?c.gameSystem=b:c.gameSystem=await Fn(e,g,r)}}const f=[];for(const d of(c==null?void 0:c.catalogueLinks)||[]){if(!d.targetId){console.warn(`invalid link: no targetId in link: ${d}, found in ${a.name}`);continue}if(d.targetId===c.id){d.target=c;continue}const p=e.getLoadedCatalogue(d,r);if(p){d.target=p;continue}const g=e.getData(d,r).then(b=>{const y=e.getLoadedCatalogue(d,r);if(y){d.target=y;return}return Fn(e,b,r).then(_=>d.target=_)});f.push(g)}return await Promise.all(f),s&&e.addLoadedSystem(c),o&&e.addLoadedCatalogue(c),c}class wp{constructor(){Z(this,"catalogues",{});Z(this,"unresolvedLinks")}async getData(t,r){throw new Error("Method not implemented.")}getCatalogueInfo(t){}findOptionById(t){}getLoadedCatalogue(t,r){const n=typeof t=="string"?t:t.targetId||t.name,i=To(r,n)||"default",s=this.catalogues[n];return s?s[i]:void 0}addLoadedCatalogue(t,r){const n=To(r,t.id)||"default";this.catalogues[t.name]||(this.catalogues[t.name]={}),this.catalogues[t.id]||(this.catalogues[t.id]={}),this.catalogues[t.name][n]=t,this.catalogues[t.id][n]=t}addLoadedSystem(t,r){return this.addLoadedCatalogue(t,r)}unloadAll(){this.catalogues={}}async loadData(t,r){const n=await Fn(this,t,r);return n.process(),n}async loadCatalogue(t,r,n){const i=this.getLoadedCatalogue(t,r);if(i&&!n)return i;const s=await this.getData(t,r);if(s)return await this.loadData(s,r);throw Error(`Couldn't load catalogue: couldn't getData ${t}`)}}class Lo extends wp{constructor(){super(...arguments);Z(this,"gameSystem",null);Z(this,"catalogueFiles",{});Z(this,"allLoaded");Z(this,"loadedCatalogues",{});Z(this,"github");Z(this,"unresolvedLinks",{});Z(this,"index",{})}async loadData(r,n){return await Fn(this,r,n)}findOptionById(r){for(const n of Object.values(this.loadedCatalogues))if(n.index[r])return n.index[r]}unloadAll(){super.unloadAll(),this.loadedCatalogues={};for(const r of this.getAllCatalogueFiles()){const n=ve(r);delete n.loaded,delete n.loaded_editor}delete this.allLoaded}async loadAll(r){let n=Object.values(this.catalogueFiles).length+1,i=0;if(this.gameSystem){r&&await r(i,n,`Loading ${this.gameSystem.gameSystem.name}`),(await this.loadCatalogue({targetId:this.gameSystem.gameSystem.id})).processForEditor(),i++;for(const o of Object.values(this.catalogueFiles))r&&await r(i,n,`Loading ${o.catalogue.name}`),(await this.loadCatalogue({targetId:o.catalogue.id})).processForEditor(),i++,r&&await r(i,n,`Loading ${o.catalogue.name}`)}this.allLoaded=!0}getLoadedCatalogue(r,n){const i=r.targetId||r.name;return this.loadedCatalogues[i]}addLoadedCatalogue(r,n){this.loadedCatalogues[r.id]=r}getAllLoadedCatalogues(){var n;return((n=this.gameSystem)==null?void 0:n.gameSystem.id)?Object.values(this.loadedCatalogues):[]}getCatalogueInfo(r){var n,i;if(((n=this.gameSystem)==null?void 0:n.gameSystem.id)===r.targetId)return(i=this.gameSystem)==null?void 0:i.gameSystem;for(const s of Object.values(this.catalogueFiles))if(s.catalogue.id===r.targetId)return s.catalogue}getAllCatalogueFiles(){return[...this.gameSystem?[this.gameSystem]:[],...Object.values(this.catalogueFiles)]}setSystem(r){this.gameSystem=r}setCatalogue(r){const n=r.catalogue.id;this.catalogueFiles[n]=r}removeCatalogue(r){for(const[n,i]of Object.entries(this.catalogueFiles))i.catalogue.id===r.catalogue.id&&delete this.catalogueFiles[n]}async getData(r,n){var a;if(r.targetId==((a=this.gameSystem)==null?void 0:a.gameSystem.id))return this.gameSystem;if(r.targetId in this.catalogueFiles)return this.catalogueFiles[r.targetId];const i=await ze.catalogues.get({"content.catalogue.id":r.targetId});if(i)return i.content;const s=await ze.systems.get(r.targetId);if(s)return s.content;const o=r.name?`name ${r.name}`:`id ${r.targetId}`;throw Error(`Couldn't import catalogue with ${o}, perhaps it wasnt uploaded?`)}}function ae(e){return e.vnode}function Ye(e){const t=e.$parent;if(t.item)return t.item;const r=t.$parent;return r.item?r.item:r.$parent.item}function vp(e){const t=ss(e);!!!e.gameSystemId?ze.systems.put({content:JSON.parse(t),path:e.fullFilePath,id:e.id}):ze.catalogues.put({content:JSON.parse(t),path:e.fullFilePath,id:`${e.gameSystemId}-${e.id}`})}async function bp(e){const t=e.fullFilePath;if(!t){console.error(`No path included in the catalogue ${e.name} to save at`);return}const r=Kn(t);if(t.endsWith(".json")){const n=ss(e);await wo(t,n)}else{const n=Of(e),i=ya(r),o=xa(t).replace(".gstz",".gst").replace(".catz",".cat"),a=i?await mu(o,n,"uint8array"):n;await wo(t,a)}}function Ro(e){electron?bp(e):vp(e)}const gi=new Set(["select","showInEditor","showChildsInEditor"]),Wn=Ji("editor",{state:()=>({selections:[],selectedElementGroup:null,selectedElement:null,selectedItem:null,filter:"",filterRegex:RegExp(""),filtered:[],undoStack:[],undoStackPos:-1,historyStack:[],historyStackPos:0,clipboard:[],mode:"edit",clipboardmode:"json",gameSystems:{},gameSystemsLoaded:!1,unsavedChanges:{},unsavedCount:0}),actions:{async create_system(e,t,r){console.log("Creating system with name:",e);const n=`sys-${xr()}`,i=this.get_system(n),s=t?`${Xo(t.replaceAll("\\","/"),"/")}/${e}`:"";if(electron){if(!s)throw new Error("No folder specified");Kf(s)}const o={gameSystem:{id:n,name:e,battleScribeVersion:"2.03",revision:1,categoryEntries:[{name:"Default Category",id:"default-category"}],forceEntries:[{name:"Default Force",hidden:!1,id:"default-force",categoryLinks:[{name:"Default Category",hidden:!1,id:"default-force-category-link",targetId:"default-category"}]}],selectionEntries:[{type:"upgrade",import:!0,name:"Default Root Entry",hidden:!1,id:"default-entry",categoryLinks:[{targetId:"default-category",id:"default-category-link",primary:!0,name:"Default Category",hidden:!1}]}]}};return s&&(o.gameSystem.fullFilePath=`${s}/${e}.${r||"gst"}`),i.setSystem(o),Ro(o.gameSystem),i},async load_systems_from_folder(e,t){var a,l;if(!globalThis.electron)throw new Error("Not running in electron");const r=await Df(e);if(!(r!=null&&r.length))return;console.log("Loading",r.length,"files",r);const n=[],i=[],s=[],o=r.filter(c=>Ef(c.name));for(const c of o){t&&await t(i.length,o.length,c.path);const f=await kf(c.data,c.name.endsWith("json")?"json":"xml"),d=(a=f==null?void 0:f.gameSystem)==null?void 0:a.id,p=(l=f==null?void 0:f.catalogue)==null?void 0:l.id;if(ve(f).fullFilePath=c.path.replaceAll("\\","/"),d){const g=this.get_system(d);g.setSystem(f),s.push(g),n.push(d)}if(p){const g=this.get_system(f.catalogue.gameSystemId);g.catalogueFiles[p]=Ns(f)}i.push(f)}t&&await t(i.length,o.length);for(const c of s)t&&await t(0,0,"Checking for github integration"),await this.load_system(c);return n},async load_systems_from_db(e=!1){if(!this.gameSystemsLoaded&&!e){this.gameSystemsLoaded=!0;let t=await ze.systems.offset(0).keys();for(let r of t)r in this.gameSystems||this.load_system_from_db(r)}},async load_system_from_db(e){const t=await ze.systems.get(e),r=t==null?void 0:t.content;if(!r)throw new Error("System not found "+e);r.gameSystem.fullFilePath=t.path;const n=await ze.catalogues.where({"content.catalogue.gameSystemId":e}),i=this.get_system(r.gameSystem.id);i.setSystem(r);for(let{content:s,path:o}of await n.toArray()){const a=s.catalogue.id;s.catalogue.fullFilePath=o,i.catalogueFiles[a]=Ns(s)}this.load_system(i,!0)},async load_system(e,t=!1){var r,n,i;if(e.gameSystem){const s=yo();if(e.unloadAll(),!t)for(const l of e.getAllCatalogueFiles()){const c=this.get_catalogue_state(l);c&&(c.changed=!1,c.unsaved=!1),s.updateCatalogue(ve(l)),s.setEdited(ve(l).id,!1)}const o=e.gameSystem.gameSystem.publications,a=o==null?void 0:o.find(l=>{var c;return((c=l.name)==null?void 0:c.trim().toLowerCase())==="github"});a&&((r=a.shortName)!=null&&r.includes("/"))&&a.publisherUrl&&(e.github={githubUrl:a.publisherUrl,githubRepo:a.shortName,githubOwner:(n=a.shortName)==null?void 0:n.split("/")[0],githubName:(i=a.shortName)==null?void 0:i.split("/")[1]})}for(const s of e.getAllCatalogueFiles()){const o=ve(s);o.fullFilePath&&jf(o.fullFilePath,()=>{this.on_file_changed(s)})}},on_file_changed(e){console.log(ve(e).name,"changed")},async get_or_load_system(e){return e in this.gameSystems||(this.gameSystems[e]=new Lo,await this.load_system_from_db(e)),this.gameSystems[e]},get_system(e){return e in this.gameSystems||(this.gameSystems[e]=new Lo),this.gameSystems[e]},delete_system(e){delete this.gameSystems[e]},get_catalogue_state(e){const t=$n(e);return this.unsavedChanges[t]},set_catalogue_changed(e,t=!0){const r=$n(e);r in this.unsavedChanges||(this.unsavedChanges[r]={changed:!1,unsaved:!1}),t?(this.unsavedChanges[r].changed=!0,this.unsavedChanges[r].unsaved||(this.unsavedCount+=1,this.unsavedChanges[r].unsaved=t)):this.unsavedChanges[r].unsaved=t},async save_catalogue(e,t){const r=t.revision;e.github&&(t.revision=await yp(e.github,t)),Ro(t);const n=yo(),i=$n(t);n.updateCatalogue(t),n.setEdited(i,!0);const s=this.get_catalogue_state(t);return s.unsaved&&(this.unsavedCount--,s.unsaved=!1),t.revision!==r},async save_all(e){var n,i,s;let t=!1,r=0;try{for(const o of Object.values(this.gameSystems))if(!(e&&((i=(n=o.gameSystem)==null?void 0:n.gameSystem)==null?void 0:i.id)!==e))for(const a of o.getAllLoadedCatalogues())(s=this.get_catalogue_state(a))!=null&&s.unsaved&&await this.save_catalogue(o,a)&&(r+=1)}catch{t=!0}return r&&notify(`Incremented ${r} catalogue's revision"`),t},set_filter(e){this.$state.filter=e,this.filterRegex=Ho(e)},init(e){this.catalogueComponent=e,globalThis.$store=this},rerender_catalogue(){this.catalogueComponent&&(this.catalogueComponent.key+=1)},unselect(e){const t=[],r=[];for(const n of this.selections)e===void 0||se(n.obj)===se(e)?r.push(n):t.push(n);this.selections=t;for(const n of r)n.onunselected&&n.onunselected(),n.obj===this.selectedItem&&(this.selectedItem=null)},is_selected(e){return this.selections.find(t=>t.obj===e)!==void 0},select(e,t,r){this.is_selected(e)||this.selections.push({obj:e,onunselected:t,payload:r})},do_select(e,t,r){const n=Array.isArray(r)?r:[r],i=this.selectedElementGroup,s=this.selectedElement;if(this.selectedElement=t,this.selectedElementGroup=r,e!=null&&e.shiftKey&&se(r)===se(i)){const o=n.findIndex(f=>f===se(s)),a=n.findIndex(f=>f===se(this.selectedElement)),l=Math.min(o,a),c=Math.max(o,a);for(let f=l;f<=c;f++)n[f].select();return}!(e!=null&&e.ctrlKey)&&!(e!=null&&e.metaKey)&&this.unselect(),e!=null&&e.ctrlKey&&this.is_selected(t)?this.unselect(t):(t.select(),this.selectedItem=t,this.mode="edit")},do_rightclick_select(e,t,r){this.is_selected(t)||this.do_select(e,t,r)},get_selections(){return this.selections.map(e=>Ye(e.obj))},get_selections_with_payload(){return this.selections.map(e=>({obj:Ye(e.obj),payload:e.payload}))},get_selected(){return this.selectedItem&&Ye(this.selectedItem)},async do_action(e,t,r){try{await r()}catch(n){console.error(n);return}if(this.undoStackPos<this.undoStack.length){const n=this.undoStack.length-this.undoStackPos-1;this.undoStack.splice(this.undoStackPos+1,n,{type:e,undo:t,redo:r})}else this.undoStack.push({type:e,undo:t,redo:r});this.undoStackPos+=1},async set_clipboard(e,t){if(this.clipboardmode==="json"){const r=e.map(i=>({parentKey:i.parentKey,...i})),n=Eu(r,new Set(["parentKey"]),{forceArray:!1,formatted:!0});t!=null&&t.clipboardData?t.clipboardData.setData("text/plain",n):await navigator.clipboard.writeText(n)}else this.clipboard=e},async get_clipboard(e){if(this.clipboardmode==="json")if(e!=null&&e.clipboardData){const t=e.clipboardData.getData("text/plain");return t?JSON.parse(t):[]}else{const t=await navigator.clipboard.readText();return JSON.parse(t)}return this.clipboard},can_undo(){return!!this.undoStack[this.undoStackPos]},async undo(){const e=this.undoStack[this.undoStackPos];e&&(await e.undo(),this.undoStackPos--)},can_redo(){return!!this.undoStack[this.undoStackPos+1]},async redo(){const e=this.undoStack[this.undoStackPos+1];e&&(await e.redo(),this.undoStackPos++)},async cut(e){await this.set_clipboard(this.get_selections(),e),this.remove()},async copy(e){await this.set_clipboard(this.get_selections(),e)},async paste(e){this.add(await this.get_clipboard(e))},async duplicate(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let n=[];const i=async()=>{n=[];for(const o of e){const a=JSON.parse(pn(o,gi));if(!o.parent)continue;const l=o.parent[o.parentKey];if(!Array.isArray(l))throw new Error(`Couldn't duplicate: parent[${o.parentKey}] is not an array`);br({[o.parentKey]:a}),mo(t,a),await gr(a,t,o.parent,this.get_system(r)),l.push(a),n.push(a)}},s=()=>{for(const o of n)nn(t,ie(o))};await this.do_action("dupe",s,i),this.set_catalogue_changed(t,!0)},async remove(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let n=[];for(const l of e)l.catalogue===t&&n.push(l);let i=[],s=[];const o=async()=>{const l=n,c=this.get_system(r);s=[],i=[];for(const f of l){const d=ie(f),p=nn(t,d);s.push(p),i.push(d),await po(p,c)}s.reverse(),i.reverse()},a=async()=>{for(const[l,c]of pu(i,s)){const f=go(t,l,c);await gr(c,t,f,this.get_system(r))}};await this.do_action("remove",a,o),this.set_catalogue_changed(t,!0),this.unselect()},async add(e,t,r){let n=[];if(r?(r=Array.isArray(r)?r:[r],n=r.map(f=>({obj:f}))):n=this.get_selections_with_payload(),!n.length){console.error("Couldn't add: no selection or parent(s) provided");return}const i=Array.isArray(e)?e:[e];if(!i.length){console.error("Couldn't add: no data provided");return}const s=n[0].obj.getCatalogue(),o=s.getSystemId();let a=[];const l=async()=>{var f;a=[];for(const d of n){const p=d.obj,g=d.payload;await this.open(p,!0);for(const b of i){const y=Ff(p,t||b.parentKey,g);if(!y){console.warn("Couldn't create",t||b.parentKey,"in",g);continue}p[y]||(p[y]=[]);const _=p[y];if(!Array.isArray(_))continue;if(!((f=va(p,p.parentKey))!=null&&f.has(y))){console.warn("Couldn't add",y,"to a",p.parentKey,"because it is not allowed");continue}const w=b instanceof Bt?pn(b,gi):JSON.stringify(b),E=JSON.parse(w);wa(E,y),delete E.parentKey,br({[y]:E}),mo(s,E),await gr(E,s,p,this.get_system(o)),E.showChildsInEditor=!0;let S=E;for(;S;)S.showInEditor=!0,S=S.parent;this.filtered.push(E),_.push(E),a.push(E)}}},c=()=>{for(const f of a)nn(s,ie(f))};await this.do_action("add",c,l),this.set_catalogue_changed(s,!0)},open_selected(){for(const e of this.selections)e.obj.open()},get_initial_object(e,t){switch(e){case"costTypes":return{name:`New ${Se(ye(e))}`,defaultCostLimit:-1};case"repeats":return{value:1,repeats:1,field:"selections",scope:"parent",childId:"any",shared:!0,roundUp:!1};case"constraints":{const i=(t==null?void 0:t.parentKey)==="associations",s={type:"min",value:1,field:t!=null&&t.isForce()?"forces":"selections",scope:"parent",shared:!0};return i&&(s.childId="any"),s}case"conditions":return{type:"atLeast",value:1,field:"selections",scope:"parent",childId:"any",shared:!0};case"modifiers":return{type:"set",value:!0,field:"hidden"};case"modifierGroups":case"conditionGroups":return{type:"and"};case"sharedSelectionEntries":case"selectionEntries":return{type:"upgrade",import:!0,name:`New ${Se(ye(e))}`,hidden:!1};case"entryLinks":return{import:!0,name:`New ${Se(ye(e))}`,hidden:!1};case"associations":return{min:1,max:1,scope:"roster",includeChildSelections:!1,of:"any",ids:[],label:"Association",labelMembers:"Unit",hidden:!1};case"sharedProfiles":case"profiles":const r=t==null?void 0:t.catalogue.iterateProfileTypes().next().value;return{name:(!t||t!=null&&t.isCatalogue()||t==null?void 0:t.getName())||"New Profile",typeId:r==null?void 0:r.id,typeName:r==null?void 0:r.name,hidden:!1};case"catalogueLinks":return{type:"catalogue",name:`New ${Se(ye(e))}`};case"categoryLinks":return{type:"category",name:`New ${Se(ye(e))}`,hidden:!1};default:return{name:`New ${Se(ye(e))}`,hidden:!1}}},async create(e,t){const r={...this.get_initial_object(e),select:!0,...t};["modifiers","conditions","modifierGroups","conditionGroups"].includes(e)||(r.id=xr()),await this.add(r,e),this.open_selected()},async create_child(e,t,r){const n={...this.get_initial_object(e,t),id:xr(),select:!0,...r};await this.add(n,e,t),this.open_selected()},can_move(e){return!e.isLink()},get_move_targets(e){const t=e.catalogue;if(!t||e.isLink())return;const r=[];if(!e.parentKey.startsWith("shared")&&this.move_to_key(e,"shared")?r.push({target:t,type:"shared"}):e.parentKey.startsWith("shared")&&this.move_to_key(e,"root")&&r.push({target:t,type:"root"}),this.move_to_key(e,"shared"))for(const n of t.imports)r.push({target:n,type:"root"}),r.push({target:n,type:"shared"});else for(const n of t.imports)r.push({target:n,type:"root"});return r},move_to_key(e,t){if(t==="shared")switch(e.editorTypeName){case"infoGroup":return"sharedInfoGroups";case"rule":return"sharedRules";case"profile":return"sharedProfiles";case"selectionEntry":return"sharedSelectionEntries";case"selectionEntryGroup":return"sharedSelectionEntryGroups";default:return""}switch(e.editorTypeName){case"infoGroup":return"infoGroups";case"rule":return"rules";case"profile":return"profiles";case"selectionEntry":return"selectionEntries";case"selectionEntryGroup":return"selectionEntryGroups";default:return e.parentKey}},async move(e,t,r,n){await(async()=>{const s=this.move_to_key(e,n);if(!s){console.error("Could not find key for move",e.editorTypeName,n);return}const o=e.parent,a=ie(e);Lf(e),po(e);const l=JSON.parse(pn(e,gi));br({[s]:l}),await gr(l,r,r,this.get_system(r.getSystemId())),r[s]||(r[s]=[]),r[s].push(l);const f=["rule","infoGroup","profile","selectionEntry","selectionEntryGroup"].includes(e.editorTypeName),d=f&&!e.parentKey.startsWith("shared");if(f&&d){const p={targetId:l.id,id:t.generateNonConflictingId(),type:e.editorTypeName,name:e.getName(),hidden:e.hidden,select:!0};e.isEntry()&&(p.collective=e.collective);const g=e.isEntry()||e.isGroup()?"entryLinks":"infoLinks";br({[g]:p}),a[a.length-1].key=g,await gr(p,t,o,this.get_system(t.getSystemId())),go(t,a,p)}else nn(t,ie(e))})(),this.set_catalogue_changed(t,!0),this.set_catalogue_changed(r,!0)},async open(e,t){let r=document.getElementById("editor-entries");if(!r)return;async function n(l){const c=ae(l);c.open(),await c.$nextTick()}async function i(l){const c=ae(l);c.close(),await c.$nextTick()}const s=ie(e);if(!(s!=null&&s.length))return;r=r.getElementsByClassName(`depth-0 ${s[0].key}`)[0],await n(r);const o=[];Ai(e,l=>{o.push(l)}),o.pop(),o.reverse(),o.push(e);const a=o[o.length-1];for(let l=0;l<o.length;l++){const c=o[l],d=[...r.getElementsByClassName(`depth-${l+1} ${c.parentKey}`)].find(p=>Ye(ae(p))===c);if(!d)throw new Error("Invalid path");r=d,c!==a&&await n(r),c===a&&(t===!1?await i(r):t===!0&&await n(r))}return r},async goto_catalogue(e,t){var n,i;if(!this.$router)throw new Error("Cannot follow link to another catalogue without $router set");const r=((n=this.$router.currentRoute.query)==null?void 0:n.id)||((i=this.$router.currentRoute.query)==null?void 0:i.systemId);return e!==r?(this.$router.push({name:"catalogue",query:{systemId:t||e,id:e}}),this.$nextTick=new Promise((s,o)=>{this.$nextTickResolve=s}),await this.$nextTick,!0):!1},async goto(e){const t=e.getCatalogue();this.put_current_state_in_history();const r=Cr();r.get_data(t.id).selection=ie(e),await this.goto_catalogue(t.id,t.gameSystemId);const n=await this.open(e);if(n){const i=ae(n);this.do_select(null,i,i),n.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}else setTimeout(async()=>{const i=await this.open(e);if(i){const s=ae(i);this.do_select(null,s,s),i.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}},50)},can_follow(e){return!!(e!=null&&e.target)},async follow(e){e!=null&&e.target&&await this.goto(e.target)},async move_up(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>0){const n=t.splice(r,1)[0];t.splice(r-1,0,n)}}},async move_down(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>=0&&r<t.length-1){const n=t.splice(r,1)[0];t.splice(r+1,0,n)}}},get_leftpanel_open_collapsible_boxes(){function e(r,n,i=0){const s=`depth-${i} collapsible-box opened`,o=r.getElementsByClassName(s);if(o!=null&&o.length)for(const a of o){const l=Ye(ae(a)),c=l.parentKey,f=l.parent;if(f){if(!f[c])continue;const d=f[c].indexOf(l);c in n||(n[c]={}),d in n[c]||(n[c][d]={}),e(a,n[c][d],i+1)}else{const d=[...a.classList].filter(p=>or.has(p));for(const p of d)n[p]={},n[p][0]={};e(a,n[d[0]][0],i+1)}}}const t={};return e(document.documentElement,t),t},get_leftpanel_state(){if(!this.catalogueComponent)return{};const e={},t=this.catalogueComponent.$refs.leftpanel;for(const r of Object.keys(ka))e[r]=t[r];return e},get_current_state(){var r;const e=this.get_selected(),t=(r=this.catalogueComponent)==null?void 0:r.cat;return{...this.get_leftpanel_state(),mode:this.mode,open:this.get_leftpanel_open_collapsible_boxes(),selection:e?ie(e):void 0,catalogueId:t==null?void 0:t.id,systemId:t==null?void 0:t.gameSystemId}},save_state(){if(this.catalogueComponent&&this.catalogueComponent.cat){const e=this.catalogueComponent.cat.id,t=Cr(),r=this.get_current_state();t.set_state(e,r)}},async load_state(e){this.catalogueComponent&&(Cr().set_state(e.catalogueId,e),this.mode=e.mode||"edit",await this.goto_catalogue(e.catalogueId,e.systemId)||(this.catalogueComponent.load_state(e),this.rerender_catalogue()))},put_state_in_history(e){if(this.historyStackPos<this.historyStack.length){const t=this.historyStack.length-this.historyStackPos;this.historyStack.splice(this.historyStackPos,t,e)}else this.historyStack.push(e);this.historyStackPos=this.historyStack.length},put_current_state_in_history(){this.catalogueComponent&&this.catalogueComponent.cat&&this.put_state_in_history(this.get_current_state())},can_back(){return this.historyStackPos>0},async back(){this.can_back()&&(this.historyStack[this.historyStackPos]=this.get_current_state(),this.historyStackPos-=1,this.load_state(this.historyStack[this.historyStackPos]))},can_forward(){if(this.historyStack[this.historyStack.length-1])return this.historyStackPos<this.historyStack.length-1},async forward(){this.can_forward()&&(this.historyStackPos+=1,this.load_state(this.historyStack[this.historyStackPos]))}}});export{ze as A,Op as B,Np as C,Lp as D,Df as E,Xo as F,xu as P,Rp as _,Tf as a,Aa as b,Jf as c,Ii as d,vr as e,kp as f,xr as g,ve as h,Ep as i,yo as j,Cr as k,yp as l,Bp as m,Tp as n,Ef as o,ya as p,kf as q,Kn as r,_i as s,Fp as t,Wn as u,Cp as v,$n as w,Of as x,xp as y,Mf as z};
//# sourceMappingURL=editorStore.eb1b3d69.js.map
