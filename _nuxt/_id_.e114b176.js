import{a as k,o as s,b as r,E as $,B as v,l as m,m as V,w as I,P as q,e as E,aG as T,Y as C,r as w,i as a,t as f,s as c,F as h,D as _,c as A,q as b,J as B,aH as Q,$ as N,h as F}from"./entry.5955b326.js";import{E as R,a as M,_ as O}from"./catalogue.9ca14fb7.js";import{N as j}from"./NodePath.639fa93f.js";import{_ as J}from"./right2.91afc9dd.js";const W={props:{collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},noboxindent:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},vertical:{type:Boolean,default:!1},titleCollapse:{type:Boolean,default:!0},id:{type:String,required:!1}},mounted(){this.id&&this.$route.hash&&this.$route.hash.substring(1)===this.id&&this.collapsed&&this.$nextTick(()=>{var e;this.collapseSwitch(),(e=this.$el)==null||e.scrollIntoView({block:"center"})})},data(){return{collapsed:!0,initiated:!1}},created(){(!this.collapsible||this.defcollapsed==!1)&&this.collapseSwitch()},computed:{dropdownSrc(){var p,n,i;let e=2;(i=(n=(p=this.$optionStore)==null?void 0:p.options)==null?void 0:n.appearence)!=null&&i.dropdownStyle&&(e=this.$optionStore.options.appearence.dropdownStyle);let l=[`/assets/icons/right${e}.png`,`/assets/icons/down${e}.png`],o=this.collapsed?0:1;return this.vertical&&(o=1-o),l[o]}},methods:{collapseSwitch(){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?(this.$emit("open"),this.$emit("change")):(this.$emit("close"),this.$emit("change"))},titleSwitch(){this.titleCollapse?this.collapseSwitch():this.$emit("titleClick")}},watch:{collapsible(){this.initiated=!0}}};const Y=["id"],x=["src"],P={key:1,class:"boxContent"};function U(e,l,o,p,n,i){return s(),r("div",{class:$([{box:!o.nobox&&!o.noboxindent,nobox:o.nobox,nocollapse:!o.collapsible,noboxindent:o.noboxindent,verticalbox:n.collapsed&&o.vertical},"collapsibleBox"]),id:o.id},[o.notitle?m("",!0):(s(),r("h3",{key:0,class:$([{arrowTitle:o.collapsible,normalTitle:!o.collapsible,collapsed:o.collapsible&&n.collapsed,titleClickCollapsible:o.collapsible&&!n.collapsed&&o.titleCollapse,titleClickEffect:n.collapsed||o.collapsible},o.title]),onClick:l[1]||(l[1]=(...u)=>i.titleSwitch&&i.titleSwitch(...u))},[o.collapsible?(s(),r("img",{key:0,src:i.dropdownSrc,class:"icon arrow",onClick:l[0]||(l[0]=v((...u)=>i.collapseSwitch&&i.collapseSwitch(...u),["stop"]))},null,8,x)):m("",!0),V(e.$slots,"title",{class:"title"},void 0,!0)],2)),n.initiated?I((s(),r("div",P,[V(e.$slots,"content",{},void 0,!0)],512)),[[q,!n.collapsed||!o.collapsible]]):m("",!0)],10,Y)}const D=k(W,[["render",U],["__scopeId","data-v-28dca463"]]),L=E({components:{EditableDiv:R},props:{arg:{type:Object,required:!0},args:{type:Array,required:!0},system:{type:T,required:!0},index:{type:Number,required:!0}},data(){return{value:this.getDefaultValue(Array.isArray(this.arg.type)?this.arg.type[0]:this.arg.type)}},methods:{catalogueName(e){return C(e).name},async getArgument(){const e=this.types[0],l=this.value;switch(e){case"catalogue[]":if(l==="All Catalogues"){await this.system.loadAll();const n=this.system.getAllLoadedCatalogues();return n.map(i=>i.processForEditor()),n}else{const n=this.system.getAllCatalogueFiles().map(u=>C(u)).find(u=>u.name===l),i=await this.system.loadCatalogue({targetId:n.id});return i.processForEditor(),i.imports.map(u=>u.processForEditor()),[i]}case"catalogue":const o=this.system.getAllCatalogueFiles().map(n=>C(n)).find(n=>n.name===l),p=await this.system.loadCatalogue({targetId:o.id});return p.processForEditor(),p.imports.map(n=>n.processForEditor()),p;default:return l}},async updateArgument(){const e=await this.getArgument();return this.args[this.index]=e,e},getDefaultValue(e){if(this.arg.default!==void 0)return this.arg.default;if(e==="catalogue[]")return"All Catalogues"}},computed:{types(){return Array.isArray(this.arg.type)?this.arg.type:[this.arg.type]}}}),X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=";const Z={class:"bold p-2px"},K={key:0},H={key:1,class:"gray"},G={style:{"white-space":"nowrap"}},z=a("img",{class:"mr-1 align-middle",src:X},null,-1),ee=a("img",{class:"mr-1 align-middle",src:M},null,-1),te={style:{"white-space":"nowrap"}},se=a("img",{class:"mr-1 align-middle",src:M},null,-1);function le(e,l,o,p,n,i){const u=O,g=w("EditableDiv");return s(),r("div",null,[a("span",Z,f(e.arg.name??e.arg.type),1),e.arg.optional?m("",!0):(s(),r("span",K,"*")),c(),e.arg.description?(s(),r("span",H,f(e.arg.description),1)):m("",!0),(s(!0),r(h,null,_(e.types,(y,d)=>(s(),r("div",null,[y==="catalogue[]"?(s(),A(u,{key:0,modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value=t),options:[{label:"All Catalogues"},...e.system.getAllCatalogueFiles()],valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[a("div",G,[t.label?(s(),r(h,{key:0},[z,c(f(t.label),1)],64)):(s(),r(h,{key:1},[ee,c(" "+f(e.catalogueName(t)),1)],64))])]),_:1},8,["modelValue","options","valueField","filterField"])):y==="catalogue"?(s(),A(u,{key:1,modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value=t),options:e.system.getAllCatalogueFiles(),valueField:t=>t.label??e.catalogueName(t),filterField:t=>t.label??e.catalogueName(t),class:"max-w-300px w-100%"},{option:b(({option:t})=>[a("div",te,[se,c(" "+f(t.name),1)])]),_:1},8,["modelValue","options","valueField","filterField"])):y==="string"?(s(),A(g,{key:2,modelValue:e.value,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value=t),spellcheck:"false",style:{"font-family":"monospace"}},null,8,["modelValue"])):m("",!0)]))),256))])}const oe=k(L,[["render",le]]),re=E({components:{ScriptArgument:oe,NodePath:j},props:{script:{type:Object,required:!0},system:{type:T,required:!0}},setup(){return{store:B()}},data(){return{result:null,args:[],running:!1}},methods:{debug(...e){console.log(...e)},isEntry(e){return e instanceof Q},isEntryWithDesc(e){return Array.isArray(e)&&e.length===2&&this.isEntry(e[0])},isEntryList(e){return e.find(l=>!this.isEntry(l)&&!this.isEntryWithDesc(l))?!1:e.length>0},async run(){this.result=null,this.running=!0,await new Promise(e=>setTimeout(e,1));try{const e=this.$refs.args?await Promise.all(this.$refs.args.map(l=>l.getArgument())):[];this.store.scripts.add_script_hooks(this.script),typeof this.script.run=="function"?this.result=await this.script.run(...e):this.script.hooks?this.result=`Added hooks: ${Object.keys(this.script.hooks)}`:this.result=null,console.log(this.script.name,this.result)}catch(e){console.error(e),this.result=e}finally{globalThis.$result=this.result,this.running=!1}},path(e){return N(e)},other_path(e){return N(e)}},computed:{outputArray(){return(Array.isArray(this.result)&&!this.isEntryList(this.result)?this.result:[this.result]).filter(e=>!(Array.isArray(e)&&e.length===0||e===null||e===void 0))}}});const ne=["disabled"],ae={key:0,class:"gray"},ie=a("img",{src:J},null,-1),ue=a("div",{class:"bold"},"Output:",-1),de={class:"output-element"},ce=["innerHTML"],pe={class:"node"},he={key:3},me={key:0},ge=a("span",{class:"gray"},"None",-1),ye=[ge];function fe(e,l,o,p,n,i){const u=w("ScriptArgument"),g=w("NodePath"),y=D;return s(),A(y,{class:"script mx-4px"},{title:b(()=>[c(f(e.script.name),1)]),content:b(()=>[(s(!0),r(h,null,_(e.script.arguments||[],(d,t)=>(s(),r("div",null,[F(u,{arg:d,args:e.args,system:e.system,index:t,ref_for:!0,ref:"args"},null,8,["arg","args","system","index"])]))),256)),a("div",null,[a("button",{class:"bouton my-10px",onClick:l[0]||(l[0]=(...d)=>e.run&&e.run(...d)),disabled:e.running},[e.running?(s(),r("span",ae,"...")):(s(),r(h,{key:1},[ie,c(" Run Script ")],64))],8,ne)]),e.result?(s(),r(h,{key:0},[ue,(s(!0),r(h,null,_(e.outputArray,d=>(s(),r("div",de,[["string","number"].includes(typeof d)?(s(),r("span",{key:0,class:"output-html",innerHTML:d},null,8,ce)):Array.isArray(d)&&e.isEntryList(d)?(s(!0),r(h,{key:1},_(d,t=>(s(),r("div",pe,[Array.isArray(t)?(s(),A(g,{key:0,path:e.path(t[0]),onClick:S=>e.store.goto(t[0]),class:"hover-darken cursor-pointer p-1px",text:t[1],onMouseup:v(S=>e.debug(t[0].editorTypeName,t[0]),["middle"])},null,8,["path","onClick","text","onMouseup"])):(s(),A(g,{key:1,path:e.path(t),onClick:S=>e.store.goto(t),class:"hover-darken cursor-pointer p-1px",onMouseup:v(S=>e.debug(t.editorTypeName,t),["middle"])},null,8,["path","onClick","onMouseup"]))]))),256)):e.isEntry(d)?(s(),A(g,{key:2,path:e.path(d),onClick:t=>e.store.goto(d),class:"hover-darken cursor-pointer p-1px",onMouseup:v(t=>e.debug(d.editorTypeName,d),["middle"])},null,8,["path","onClick","onMouseup"])):(s(),r("pre",he,"              "+f(JSON.stringify(d,null,2))+`
            `,1))]))),256)),e.outputArray.length==0?(s(),r("div",me,ye)):m("",!0)],64)):m("",!0)]),_:1})}const Ae=k(re,[["render",fe]]),be=E({components:{RunScript:Ae},setup(){return{store:B()}},data(){return{system:null,scripts:[...B().scripts.get_default_scripts()]}},async mounted(){this.system=null,this.system=await this.store.get_or_load_system(this.$route.params.id),this.scripts.push(...await this.store.scripts.get_scripts(this.system))},methods:{}}),_e={class:"h-full overflow-y-auto"},ve=a("div",{class:"info"},[a("pre",{style:{margin:"10px"}},[c("Note: this feature is not finished To add a new script: Create a folder named `scripts` in your data folder and\nadd a .js file with content like this:\n"),a("code",null,`
export default {
  name: "Display Selected",
  description: "Returns the currently selected node(s)",
  arguments: [
    {
      name: "catalogues",
      type: "catalogue[]"
    },
    {
      name: "query",
      type: "string"
      optional: true,
    },
  ],
  run(catalogues, query) {
    return [\`<span style="font-weight: bold">Selected nodes:</span>\`,$store.get_selections()]
  }
}
`),c(`
`),a("span",{class:"bold"},"Output:"),c(`
return one of or an array of: number | error | string | node[] | [node, string][]
Will render html

`),a("span",{class:"bold"},"Running scripts:"),c(`
Currently only supports running scripts manually, but may support running hooks in the future such as on paste, on change, on load, etc
You may interact with the editor using the store (global variable \`$store\`, also available in the console)
Available actions are in `),a("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"},"https://github.com/giloushaker/nr-editor/blob/master/stores/editorStore.ts"),c(`
Example scripts (in typescript but only js is supported for non-default scripts): `),a("a",{target:"_blank",href:"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"},"https://github.com/giloushaker/nr-editor/tree/master/default-scripts"),c(`
If you want to use imports you have to bundle them into one js file with rollup/webpack
If you want to read/write local files you can use the functions in the global \`$node\`
          `)])],-1);function we(e,l,o,p,n,i){const u=w("RunScript"),g=D;return s(),r("div",_e,[e.system?(s(!0),r(h,{key:0},_(e.scripts,y=>(s(),r("div",null,[F(u,{script:y,system:e.system},null,8,["script","system"])]))),256)):m("",!0),F(g,null,{title:b(()=>[c("Info")]),content:b(()=>[ve]),_:1})])}const Fe=k(be,[["render",we]]);export{Fe as default};
//# sourceMappingURL=_id_.e114b176.js.map
