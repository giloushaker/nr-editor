var go=Object.defineProperty;var mo=(e,t,r)=>t in e?go(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>(mo(e,typeof t!="symbol"?t+"":t,r),r);import{Z as Hs,$ as ue,a0 as Ge,a1 as yo,a2 as rn,a3 as Ao,a4 as tt,a5 as nn,j as ot,a6 as vo,a7 as Js,a8 as st,a9 as Ur,aa as wo,ab as bo,ac as Eo,ad as as,ae as ls,W as Kn,af as ko,A as lr,a as vt,o as k,b as S,i as T,t as W,x as N,F as oe,B as Re,m as G,w as sn,J as on,c as J,r as Er,M as _o,T as xo,q as De,C as Se,L as ut,p as at,h as lt,l as le,y as $s,z as ei,ag as Io,ah as Fe,X as ti,ai as Co,e as So,aj as cr,ak as ri,Y as ni,al as No,am as cs,an as To,ao as Lo}from"./entry.9f0aeb41.js";function Oo(e){if(!e.constraints)return e;const t=[];for(const n of e.constraints)if(n.type==="exactly"){const s={...n,id:n.id+"-min",type:"min"},i={...n,id:n.id+"-max",type:"max"};t.push(s,i)}else t.push(n);const r=Hs(e);return r.constraints=t,r}function Bo(e){if(!e.modifiers&&!e.modifierGroups||!e.constraintsIterator)return e;const t={};for(const i of e.constraintsIterator())i.type==="exactly"&&(t[i.id]=i);function r(i){const o=[];for(const l of i)if(l.field in t){const a={...l,field:l.field+"-min"},c={...l,field:l.field+"-max"};o.push(a,c)}else o.push(l);return o}function n(i){const o=[];for(const l of i){const a={...l};a.modifiers&&(a.modifiers=r(a.modifiers)),a.modifierGroups&&(a.modifierGroups=n(a.modifierGroups)),o.push(a)}return o}const s=Hs(e);return s.modifiers&&(s.modifiers=r(s.modifiers)),s.modifierGroups&&(s.modifierGroups=n(s.modifierGroups)),s}const Po=["modifiers","modifierGroups","constraints","entryLinks","categoryLinks","selectionEntries","selectionEntryGroups","infoLinks","infoGroups","rules","profiles"],si=["profile","rule","infoLink","infoGroup","selectionEntry","selectionEntryGroup","entryLink","profiles","rules","infoLinks","infoGroups","entryLinks","selectionEntries","selectionEntryLinks","selectionEntryGroups","categoryLinks","costTypes","profileTypes","characteristicTypes","categoryEntries","categories","forceEntries","forces","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","rules","rootRules","publications","catalogueLinks","constraints","characteristics","costs"],Go=["conditions","conditionGroups","modifiers","modifierGroups","repeats"],Un=new Set([...si,...Go]),Ro=new Set(si);function me(e){if(e.isCatalogue&&e.isCatalogue())return e;if(e.gameSystem)return e.gameSystem;if(e.catalogue)return e.catalogue;throw Error("getDataObject data argument is not a valid system or catalogue")}function us(e){if(e.isCatalogue&&e.isCatalogue()){if(e.id&&e.gameSystemId)return`${e.gameSystemId}-${e.id}`;if(e.id)return`${e.id}`}if(e.catalogue)return`${e.catalogue.gameSystemId}-${e.catalogue.id}`;if(e.gameSystem)return e.gameSystem.id;throw Error("getDataId data argument is not a valid system or catalogue")}class z{constructor(t){v(this,"id");v(this,"type");v(this,"subType");v(this,"shared");v(this,"import");v(this,"collective");v(this,"comment");v(this,"publicationId");v(this,"typeName");v(this,"typeId");v(this,"categoryEntryId");v(this,"profileTypes");v(this,"name");v(this,"hidden");v(this,"value");v(this,"page");v(this,"defaultAmount");v(this,"profiles");v(this,"rules");v(this,"infoLinks");v(this,"infoGroups");v(this,"publications");v(this,"costs");v(this,"selectionEntries");v(this,"selectionEntryGroups");v(this,"entryLinks");v(this,"categoryEntries");v(this,"categoryLinks");v(this,"forceEntries");v(this,"sharedSelectionEntryGroups");v(this,"sharedSelectionEntries");v(this,"sharedProfiles");v(this,"sharedRules");v(this,"sharedInfoGroups");v(this,"target");v(this,"modifiers");v(this,"modifierGroups");v(this,"constraints");v(this,"repeats");v(this,"conditions");v(this,"conditionGroups");v(this,"catalogue");v(this,"extra_constraints");v(this,"childs");v(this,"loaded");v(this,"collective_recursive");v(this,"limited_to_one");v(this,"associations");v(this,"associationConstraints");v(this,"flatten");return Object.setPrototypeOf(t,Object.getPrototypeOf(this))}get url(){return"%{main_catalogue|catalogue}/%{id}/%{getName}"}process(){this.loaded||(this.collective_recursive=this.isCollectiveRecursive(),this.limited_to_one=!this.canAmountBeAbove1(),this.loaded=!0)}toJson(){return dr(this)}getCatalogue(){return this.catalogue}getGameSystem(){return this.getCatalogue().getGameSystem()}get[Symbol.toStringTag](){return globalThis.isEditor?"Object":"ObjectNoObserve"}isGroup(){return!1}isForce(){return!1}isCatalogue(){return!1}isLink(){return!1}isCategory(){return!1}isRoster(){return!1}isQuantifiable(){return!1}isEntry(){return!1}isIdUnique(){return!1}isRule(){return!1}isProfile(){return!1}isInfoGroup(){return!1}isUnit(){for(const t of this.categoryLinks||[])if(t.primary)return!0;return!1}getId(){return this.id}getType(){return this.subType??this.type}getTypeName(){return this.typeName}getCategoryEntryId(){return this.categoryEntryId}getHidden(){return this.hidden}getPage(){return this.page}getName(){return this.name}getDefaultAmount(){return this.defaultAmount}isCollective(){return this.collective}isCollectiveRecursive(){const t=[...this.selectionsIterator()];for(;t.length;){const r=t.pop();if(!r.isCollective()&&!r.isGroup())return!1;t.push(...r.selectionsIterator())}return!0}isEmptyNode(){for(const t of Po)if(this[t]!==void 0)return!1;return!0}*forcesIterator(){}*associationsIterator(){this.associations&&(yield*this.associations)}*profilesIterator(){var t;for(const r of Qt(this))r.profiles&&(yield*r.profiles),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(n=>n.type==="profile").map(n=>n.target))}*rulesIterator(){var t;for(const r of Qt(this))r.rules&&(yield*r.rules),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(n=>n.type==="rule").map(n=>n.target))}*constraintsIterator(){this.constraints&&(yield*this.constraints)}*extraConstraintsIterator(){this.extra_constraints&&(yield*this.extra_constraints)}*modifierGroupsIterator(){this.modifierGroups&&(yield*this.modifierGroups)}*modifiersIterator(){this.modifiers&&(yield*this.modifiers)}*modifierGroupsIteratorRecursive(){yield this,this.isLink()&&(yield this.target);for(const t of this.modifierGroupsIterator())yield t,yield*kr(t.modifierGroups)}*selectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*localSelectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*nodesIterator(){this.isLink()&&(yield*this.target.nodesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.isLink()&&(yield*this.target.entriesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks),this.childs&&(yield*this.childs)}*iterateSelectionEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateSelectionEntriesWithRoot(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*iterateAllRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*categoryLinksIterator(){this.categoryLinks&&(yield*this.categoryLinks)}*infoLinksIterator(){this.infoLinks&&(yield*this.infoLinks)}*infoGroupsIterator(){this.infoGroups&&(yield*this.infoGroups)}*infoRulesIterator(){if(this.isForce()){const t=this.getGameSystem();t.rules&&(yield*t.rules);const r=this.main_catalogue;r.rules&&(yield*r.rules)}this.rules&&(yield*this.rules)}*infoProfilesIterator(){this.profiles&&(yield*this.profiles)}forEachCond(t,r=0){if(t(this,0)===void 0)for(const n of this.selectionsIterator())n.forEachCond(t,r+1)}forEach(t){t(this);for(const r of this.selectionsIterator())r.forEach(t)}forEachNode(t){t(this);for(const r of this.nodesIterator())r.forEachNode(t)}forEachNodeCb(t){const r=[this],n=new Set;for(;r.length;){const s=r.pop();if(!n.has(s.id)){if(n.add(s.id),t(s),s.childs){r.push(...s.childs);continue}if(s.target){const i=s.target;i.selectionEntries&&r.push(...i.selectionEntries),i.selectionEntryGroups&&r.push(...i.selectionEntryGroups),i.entryLinks&&r.push(...i.entryLinks)}s.selectionEntries&&r.push(...s.selectionEntries),s.selectionEntryGroups&&r.push(...s.selectionEntryGroups),s.entryLinks&&r.push(...s.entryLinks)}}}forEachObjectWhitelist(t,r=Un){const n=[this];for(;n.length;){const s=n.pop();for(const i in s){const o=s[i];if(r.has(i)&&ue(o))if(Array.isArray(o)){if(o.length&&ue(o[0]))for(let l=0;l<o.length;l++){const a=o[l];t(a,s),n.push(a)}}else t(o,s),n.push(o)}}}forEachObject(t,r=new Set){const n=[this];for(;n.length;){const s=n.pop();for(const i of Object.keys(s)){const o=s[i];if(!r.has(i)&&ue(o))if(Array.isArray(o)){if(o.length&&ue(o[0]))for(let l=o.length;l--;){const a=o[l];t(a,s),n.push(a)}}else t(o,s),n.push(o)}}}findOption(t){for(const r of this.selectionsIterator())if(t(r))return r}findOptionRecursive(t){const r=[...this.selectionsIterator()];for(;r.length;){const n=r.pop();if(t(n))return n}}getCosts(){return this.costs||[]}getPrimaryCategory(){for(const t of this.categoryLinks||[])if(t.primary)return t.targetId;return this.getCategoryEntryId()??Ue}getPrimaryCategoryLink(){for(const t of this.categoryLinks||[])if(t.primary)return t}getBoundConstraint(t){const r=Object.assign({},t);r.name=this.getName(),r.parent=this;const n=t.shared||this instanceof ii;r.childId=this.isLink()&&n?this.targetId:this.id,r.scope="self",r.modifiers=[];for(const s of this.modifiersIterator())(s.field===t.id||s.field==="hidden")&&r.modifiers.push(s);r.modifierGroups=[];for(const s of this.modifierGroupsIterator())e:for(const i of kr([s]))for(const o of i.modifiers||[])if(o.field===t.id||o.field==="hidden"){r.modifierGroups.push(s);break e}return r}getChildBoundConstraints(t){const r=[];for(const n of this.selectionsIterator())if(!(t&&n.isGroup())){for(const s of n.constraintsIterator())(s.type==="min"||s.type==="exactly")&&s.scope==="parent"&&r.push(n.getBoundConstraint(s));n.isGroup()&&r.push(...n.getChildBoundConstraints())}return r}canAmountBeAbove1(){const t=Ko(this.constraintsIterator(),[...this.modifierGroupsIterator(),{modifiers:[...this.modifiersIterator()]}]);return!t.length||t.includes(-1)?!0:Math.min(...t)>1}hasOption(t){let r;return this.forEachCond(n=>(n.getName()===t&&(r=!0),r)),!!r}}class Mr extends z{isEntry(){return!0}isQuantifiable(){return!0}isIdUnique(){return!0}}class Vr extends z{getDefaultSelectionEntryId(){return this.defaultSelectionEntryId}isGroup(){return!0}isIdUnique(){return!0}}class Vt extends z{constructor(){super(...arguments);v(this,"targetId")}isLink(){return!0}isGroup(){var r;return(r=this.target)==null?void 0:r.isGroup()}isCategory(){var r;return(r=this.target)==null?void 0:r.isCategory()}isQuantifiable(){var r;return(r=this.target)==null?void 0:r.isQuantifiable()}isEntry(){var r;return(r=this.target)==null?void 0:r.isEntry()}isIdUnique(){return!1}isProfile(){var r;return((r=this.target)==null?void 0:r.isProfile())||!1}isRule(){var r;return((r=this.target)==null?void 0:r.isRule())||!1}isInfoGroup(){var r;return((r=this.target)==null?void 0:r.isInfoGroup())||!1}isUnit(){if(this.target.isUnit())return!0;for(const r of this.categoryLinks||[])if(r.primary)return!0;return!1}getId(){return this.targetId}getType(){var r;return(r=this.target)==null?void 0:r.getType()}getPage(){var r;return this.page||((r=this.target)==null?void 0:r.page)}getHidden(){return this.target.hidden||this.hidden}getDefaultSelectionEntryId(){var r;return this.defaultSelectionEntryId||((r=this.target)==null?void 0:r.getDefaultSelectionEntryId())}getCategoryEntryId(){var r;return this.categoryEntryId??((r=this.target)==null?void 0:r.categoryEntryId)}get associationConstraints(){return this.target.associationConstraints}get associations(){var r;return(r=this.target)==null?void 0:r.associations}isCollective(){var r;return super.isCollective()||((r=this.target)==null?void 0:r.isCollective())}*extraConstraintsIterator(){yield*this.target.extraConstraintsIterator(),yield*super.extraConstraintsIterator()}*associationsIterator(){yield*this.target.associationsIterator(),yield*super.associationsIterator()}*rulesIterator(){yield*this.target.rulesIterator(),yield*super.rulesIterator()}*profilesIterator(){yield*this.target.profilesIterator(),yield*super.profilesIterator()}*constraintsIterator(){this.target&&(yield*this.target.constraintsIterator()),yield*super.constraintsIterator()}*modifierGroupsIterator(){yield*this.target.modifierGroupsIterator(),yield*super.modifierGroupsIterator()}*modifiersIterator(){yield*this.target.modifiersIterator(),yield*super.modifiersIterator()}*selectionsIterator(){yield*this.target.selectionsIterator(),yield*super.selectionsIterator()}*categoryLinksIterator(){yield*this.target.categoryLinksIterator(),yield*super.categoryLinksIterator()}*infoLinksIterator(){yield*this.target.infoLinksIterator(),yield*super.infoLinksIterator()}*infoGroupsIterator(){yield*this.target.infoGroupsIterator(),yield*super.infoGroupsIterator()}*infoRulesIterator(){yield*this.target.infoRulesIterator(),yield*super.infoRulesIterator()}*infoProfilesIterator(){yield*this.target.infoProfilesIterator(),yield*super.infoProfilesIterator()}getDefaultAmount(){return this.defaultAmount===void 0?this.target.defaultAmount:this.defaultAmount}getName(){var r;return((r=this.target)==null?void 0:r.name)||this.name}getParent(){return this.parent}getPrimaryCategory(){for(const r of this.categoryLinks||[])if(r.primary)return r.targetId;for(const r of this.target.categoryLinks||[])if(r.primary)return r.targetId;return this.getCategoryEntryId()??Ue}getPrimaryCategoryLink(){for(const r of this.categoryLinks||[])if(r.primary)return r;for(const r of this.target.categoryLinks||[])if(r.primary)return r}getCosts(){var n;const r={};if((n=this.target)!=null&&n.costs)for(const s of this.target.costs)r[s.typeId]=s;if(this.costs)for(const s of this.costs)r[s.typeId]=s;return Object.values(r)}}Vt.prototype.keyInfoCache={};class Fo extends Vt{getTypeName(){var t;return(t=this.target)==null?void 0:t.typeName}}class ii extends Vt{constructor(){super(...arguments);v(this,"primary");v(this,"main_catalogue")}get units(){return this.target.units}*selectionsIterator(){yield*this.target.units}isEmpty(){return this.target.isEmpty()}}const Ue="(No Category)",Qr="(Illegal Units)";class Lt extends z{constructor(){super(...arguments);v(this,"units");v(this,"main_catalogue")}isCategory(){return!0}*selectionsIterator(){yield*this.units}isEmpty(){return!this.units.length}isIdUnique(){return!this.isEmptyNode()}}class zr extends z{constructor(){super(...arguments);v(this,"categories");v(this,"forces");v(this,"main_catalogue")}isForce(){return!0}isEntry(){return!0}isIdUnique(){return!0}*selectionsIterator(){yield*this.categories,this.forces&&(yield*this.forces)}*rulesIterator(){var r;for(const n of Qt(this))n.rules&&(yield*n.rules),n.infoLinks&&(yield*(r=n.infoLinks)==null?void 0:r.filter(s=>s.type==="rule").map(s=>s.target));this.main_catalogue&&(yield*this.main_catalogue.rulesIterator())}generateForces(r){const n=[];for(const s of this.forceEntries||[]){const i=Ge(s);i.main_catalogue=this.main_catalogue;const o=[];for(const l of s.categoryLinks||[])l.targetId in r&&o.push(r[l.targetId]);i.categories=o,this.main_catalogue.index[i.id]=i,n.push(i)}return this.forces=n,n}isEmpty(){for(const r of this.categories)if(!r.isEmpty())return!1;return!0}*forcesIterator(){this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}}const Wr=1/0;function Ko(e,t){var s,i,o,l;const r=[];function n(a){r.push(a)}for(const a of e){const c=r.length;if(a.field!=="selections"||a.type!=="max")continue;if(a.value>1){n(a.value);continue}let u=a.value;for(const f of kr(t))for(const d of f.modifiers||[])if(d.field===a.id){if(d.type==="increment"){if((s=f.repeats)!=null&&s.length||(i=d.repeats)!=null&&i.length){n(Wr);continue}if(u+=d.value,u>1){n(u);continue}}if(d.type==="decrement"&&d.value<0){if((o=f.repeats)!=null&&o.length||(l=d.repeats)!=null&&l.length){n(Wr);continue}if(u-=d.value,u>1){n(u);continue}}if(d.type==="set"&&d.value>1){if(d.value===-1){n(Wr);continue}n(d.value)}}c===r.length&&n(u)}return r}class Uo extends z{}class Ot extends z{isProfile(){return!0}getTypeName(){return this.typeName}isIdUnique(){return!0}}class ds extends z{constructor(){super(...arguments);v(this,"originalValue")}getLabel(){var r;return this.catalogue?((r=this.catalogue.findOptionById(this.typeId))==null?void 0:r.getName())??this.typeId:this.typeId}getTypeName(){return this.getLabel()}getName(){return`${this.getLabel()} = ${this.$text}`}}class Dr extends z{isInfoGroup(){return!0}isIdUnique(){return!0}}const fs=new Set(["any","model","unit","upgrade"]);class He extends z{}class an extends He{}class Mn extends z{}class oi extends z{}class ur extends z{getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description}isRule(){return!0}isIdUnique(){return!0}}function*Qt(e){yield e;for(const t of e.infoGroups||[])yield*Qt(t);for(const t of e.infoLinks||[])t.type==="infoGroup"&&(yield*Qt(t.target))}function*kr(e){if(e)for(const t of e)yield t,yield*kr(t.modifierGroups)}const ai=new Set(["costTypes","costs","categoryEntries","forceEntries","sharedSelectionEntries","selectionEntries","sharedSelectionEntryGroups","selectionEntryGroups","entryLinks","infoLinks","categoryLinks","catalogueLinks","sharedProfiles","profiles","profileTypes","characteristics","characteristicTypes","sharedInfoGroups","infoGroups","sharedRules","rules","publications","associations","modifierGroups","modifiers","constraints","conditionGroups","conditions","repeats"]),wt=new Set([...ai,"defaultAmount","id","import","importRootEntries","name","hidden","field","scope","value","percentValue","shared","includeChildSelections","includeChildForces","childId","type","targetId","primary","typeId","collective","$text","page","typeName","defaultSelectionEntryId","revision","battleScribeVersion","authorName","authorContact","authorUrl","library","gameSystemId","gameSystemRevision","xmlns","readme","description","comment","publicationDate","publisher","publisherId","publisherUrl","shortName","repeats","roundUp","defaultCostLimit","publicationId","label","labelMembers","maxAssociationsPerMember","ids","min","max","of","flatten","sortIndex","subType","costTypeId","profileTypeId","characteristicTypeId","value"]);function ln(e,t=!1){const r={catalogue:void 0,gameSystem:void 0},n={...e};e.gameSystemId?(r.catalogue=n,r.catalogue.type="catalogue",delete r.gameSystem):(r.gameSystem=n,r.gameSystem.type="gameSystem",delete r.catalogue);const s=t?me(r):r;return JSON.stringify(s,(o,l)=>{if(!(Array.isArray(l)&&l.length===0)&&(l===n||wt.has(o)||isFinite(Number(o))))return ue(l)?Oo(Bo(l)):l})}function dr(e,t){return JSON.stringify(e,function(n,s){if(!(Array.isArray(s)&&s.length===0)&&(wt.has(n)||isFinite(Number(n))||t!=null&&t.has(n)))return s})}function Mo(e,t,r){const n=(r==null?void 0:r.forceArray)===!1;return e=Array.isArray(e)&&(e==null?void 0:e.length)===1&&n?e[0]:e,JSON.stringify(e,function(i,o){if(wt.has(i)||isFinite(Number(i))||t!=null&&t.has(i))return o},(r==null?void 0:r.formatted)===!0?2:void 0)}function fr(e,t,r=Un){for(const n in e)if(r.has(n)){const s=e[n];if(Array.isArray(s)&&s.length&&ue(s[0]))for(let i=0;i<s.length;i++){const o=s[i];t(o,e),fr(o,t,r)}}}const Vn=new Set(["force","roster","self","parent","ancestor","primary-category","force","roster","primary-catalogue"]),Vo=new Set(["any","unit","model","upgrade"]);function Qo(e,t){if(Vn.has(t))return!0;const n=e.catalogue.findOptionById(t);if(n&&(n.isForce()||n.isCategory()||n.isCatalogue()))return!0;const s=[e];for(;s.length;){const i=s.pop();if(i.id===t)return!0;i.parent&&s.push(i.parent)}return!1}function ct(e){return yo(e,r=>!(r instanceof Mn||r instanceof He||r instanceof oi))}function li(e,t){if(!e||!t)return;const r=e.getCatalogue();if(e.parent){const s=ct(e);if(s){for(const i of s.constraintsIterator())if(i.id===t)return i}}return r==null?void 0:r.findOptionById(t)}function qe(e,t){if(t===void 0)return"";if(e){if(t.startsWith("limit::"))return`limit::${qe(e,rn(t,"limit::"))}`;const r=e.catalogue||e,n=li(e,t);if(n){const i=n.type;if(i&&["min","max","exactly"].includes(i))return zo(e,n);if(n.name)return n.isCategory&&n.isCategory()?`${n.name}`:n.url?`${n.name}`:n.name}const s=r.manager;if(s){const i=r.manager.findOptionById(t)||s.getCatalogueInfo({targetId:t});return(i==null?void 0:i.name)||t}}return t}function hs(e,t,r=!1,n=qe){const s=t.type||"none",i=t.value===void 0?1:t.percentValue?`${t.value}%`:t.value,o=n(e,t.field),l=["selections","forces"].includes(o)?` ${o}`:` ${n(e,o)}`,a=n(e,t.childId||"")+(r?`(${t.childId||"any"})`:""),c=a&&l?"of ":"",u=n(e,t.scope),f=u===(e==null?void 0:e.getName())?"":`${u}`,d=t.includeChildSelections?" (recursive)":"",h=f?` in ${f}${d}`:"";switch(s){case"instanceOf":return`${f} is ${a}`;case"notInstanceOf":return`${f} is not ${a}`;case"atLeast":return`${i}+${l} ${c}${a}${h}`;case"greaterThan":return`${Number(i)+1}+${l} ${c}${a}${h}`;case"atMost":return`${i}${i===0?"":"-"}${l} ${c}${a}${h}`;case"lessThan":return`${Number(i)-1}${Number(i)-1===0?"":"-"}${l} ${c}${a}${h}`;case"equalTo":return`${i}${l} ${c}${a}${h}`;case"notEqualTo":return`not ${i}${l} ${c}${a}${h}`;case"none":return`${l} ${c}${a}${h}`;default:return`${s} ${i}${l} ${c}${a}${h}`}}function zo(e,t,r=qe){if(!Ao(e.constraintsIterator(),t))return t.id;const n=t.field==="selections"?"":` ${r(e,t.field)}`,s=t.scope==="parent"?"":`(${r(e,t.scope)})`,i=t.childId?` ${r(e,t.childId)}`:"";return`${t.type}${n}${i}${s}`}function Wo(e,t,r=qe){var n;return`${t.type} ${r(e,t.field)} ${r(e,(n=t.value)==null?void 0:n.toString())}`}typeof $toRaw>"u"&&(globalThis.$toRaw=function(e){return e});class Qn extends z{constructor(){super(...arguments);v(this,"targetId");v(this,"importRootEntries")}isLink(){return!1}}class ps extends z{constructor(){super(...arguments);v(this,"shortName");v(this,"publisher");v(this,"publicationDate");v(this,"publisherUrl")}}class _r extends z{constructor(){super(...arguments);v(this,"library");v(this,"revision");v(this,"gameSystemId");v(this,"gameSystemRevision");v(this,"authorContact");v(this,"authorName");v(this,"authorUrl");v(this,"battleScribeVersion");v(this,"costTypes");v(this,"catalogueLinks");v(this,"gameSystem");v(this,"initialized");v(this,"loaded_wiki");v(this,"loaded_editor");v(this,"imports");v(this,"importsWithEntries");v(this,"index");v(this,"unresolvedLinks",{});v(this,"forces");v(this,"categories");v(this,"units");v(this,"roster_constraints");v(this,"manager");v(this,"book");v(this,"short");v(this,"version");v(this,"nrversion");v(this,"lastUpdated");v(this,"costIndex");v(this,"fullFilePath");v(this,"errors")}init(r=!0){this.initialized||(this.initialized=!0,this.generateImports(r),this.resolveAllLinks(r),this.generateCostIndex())}process(){if(this.loaded)return;this.loaded=!0,this.init();const r=this.generateUnits(),n=this.generateCategories(r);this.categories=Object.values(n),this.generateForces(n),this.generateExtraConstraints()}processForWiki(r){if(this.loaded_wiki)return;this.loaded_wiki=!0,this.process();const n=r.rules||{};r.rules=n,this.imports.forEach(i=>{tt(i,"links",this)});function s(i,o){i.parent=o,i.target&&tt(i.target,"links",o),i instanceof ur&&(n[i.id]=i)}fr(this,s,Ro);for(const i of this.forces||[]){i.parent=this;for(const o of i.categories)o.parent=i}}processForEditor(){this.loaded_editor||(this.loaded_editor=!0,this.init(!1),this.gameSystem&&tt(this.gameSystem,"links",this),fr(this,(r,n)=>{if(r.parent=n,r.catalogue=this,r.links||(r.links=[]),r.other_links||(r.other_links=[]),r.target&&tt(r.target,"links",r),r.isProfile()&&!r.isLink()){const i=this.findOptionById(r.typeId);i&&tt(i,"links",r)}const s=r.value;if(s){const i=this.findOptionById(s);i&&tt(i,"other_links",r)}this.refreshErrors(r)},ai))}get url(){return"%{book}"}isCatalogue(){return!0}isGameSystem(){return this.gameSystemId===this.id||!this.gameSystemId}isIdUnique(){return!0}getCatalogue(){return this}getGameSystem(){return this.isGameSystem()?this:this.gameSystem}getSystemId(){return this.isGameSystem()?this.id:this.gameSystemId}addError(r,n){this.removeError(r,n.id),r.errors||(r.errors=[]),this.errors||(this.errors=[]),r.errors.push(n),this.errors.push(n)}onRemoveError(r,n=!0){if(this.errors){const s=this.errors.indexOf(r);s>=0&&this.errors.splice(s,1)}if(r.other&&n){const s=r.other;s.getCatalogue().removeError(s,"duplicate-id-1",!1),s.getCatalogue().removeError(s,"duplicate-id-2",!1)}}removeErrors(r){var n;(n=r.errors)==null||n.forEach(s=>this.onRemoveError(s)),r instanceof an&&r.catalogue.updateConstraint(r,!0),delete r.errors}removeError(r,n,s=!0){var i;(i=r.errors)!=null&&i.length&&(r.errors=r.errors.filter(o=>(o.id===n&&this.onRemoveError(o,s),o.id!==n)))}*iterateCategoryEntries(){for(const r of this.imports)for(const n of r.categoryEntries||[])yield n;this.categoryEntries&&(yield*this.categoryEntries)}*iterateCostTypes(){for(const r of this.imports)for(const n of r.costTypes||[])yield n;this.costTypes&&(yield*this.costTypes)}*forcesIterator(){for(const r of this.imports)for(const n of r.forceEntries||[])yield n;this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}*iterateProfileTypes(){for(const r of this.importsWithEntries)r.profileTypes&&(yield*r.profileTypes);this.profileTypes&&(yield*this.profileTypes)}*iteratePublications(){for(const r of this.imports)for(const n of r.publications||[])yield n;for(const r of this.publications||[])yield r}*iterateSelectionEntries(){for(const r of this.importsWithEntries){for(const n of r.sharedSelectionEntries||[])yield n;for(const n of r.sharedSelectionEntryGroups||[])yield n}this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllImported(){const r=["sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","categoryEntries"],n=["rules","entryLinks","profiles","infoGroups","selectionEntries","selectionEntryGroups"];for(const s of this.importsWithEntries)for(const i of n)for(const o of s[i]||[])o.import!==!1&&(yield o);for(const s of this.imports)for(const i of r)for(const o of s[i]||[])yield o;for(const s of n)for(const i of this[s]||[])yield i;for(const s of r)for(const i of this[s]||[])yield i}*iterateSelectionEntriesWithRoot(){for(const r of this.importsWithEntries){for(const n of r.selectionEntries||[])n.import!==!1&&(yield n);for(const n of r.entryLinks||[])n.import!==!1&&(yield n);for(const n of r.sharedSelectionEntries||[])yield n;for(const n of r.sharedSelectionEntryGroups||[])yield n}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllRootEntries(){for(const r of this.importsWithEntries){for(const n of r.selectionEntries||[])n.import!==!1&&(yield n);for(const n of r.entryLinks||[])n.import!==!1&&(yield n)}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.selectionEntries&&(yield*this.selectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}forEachNode(r){if(r(this),this.childs)for(const n of this.childs)n.forEachNode(r)}*selectionsIterator(){yield*this.forces}findOptionById(r){var i;const n=this.index[r];if(n)return n;const s=(i=this.imports.find(o=>r in o.index))==null?void 0:i.index[r];if(s)return s;if(this.manager&&r)return this.manager.getLoadedCatalogue(r)??this.manager.getCatalogueInfo({targetId:r})}findOptionByIdGlobal(r){var i;const n=this.index[r];if(n)return n;const s=(i=this.imports.find(o=>r in o.index))==null?void 0:i.index[r];if(s)return s;if(this.manager){const o=this.manager.findOptionById(r);return o||this.manager.getCatalogueInfo({targetId:r})}}findOptionsById(r){const n=[];for(const s of[this,...this.imports])for(const i of Object.values(s.index))i.id&&i.id===r&&n.push(i);return n}findOptionsByText(r){var i,o,l;if(!r||!r.trim()){const a=[];for(const c of[this,...this.imports])for(const u of Object.values(c.index))if(u.getName){if(u.isLink()&&u.target&&u.isCategory()&&!((i=u.parent)!=null&&i.isForce()))continue;a.push(u)}else console.log(u);return a}const n=[],s=nn(r);for(const a of[this,...this.imports])for(const c of Object.values(a.index)){const u=(o=c.getName)==null?void 0:o.call(c),f=c.id;if(u&&String(u).match(s)||f===r){if(c.isLink()&&c.target&&c.isCategory()&&!((l=c.parent)!=null&&l.isForce()))continue;n.push(c)}}return n}generateNonConflictingId(){for(;;){const r=ot();if(this.findOptionById(r)===void 0)return r}}generateCostIndex(){const r={};for(const n of this.imports)for(const s of n.costTypes||[])r[s.id]=s,this.index[s.id]=s;for(const n of this.costTypes||[])r[n.id]=n,this.index[n.id]=n;return this.costIndex=r,r}generateImports(r=!0){const n={},s={};this.gameSystem&&(this.gameSystem.init(r),n[this.gameSystem.id]=this.gameSystem,s[this.gameSystem.id]=this.gameSystem,this.gameSystem.import||(this.gameSystem.imports=[]));for(const i of this.catalogueLinks||[]){const o=i.target;if(o){o.init(r);for(const l of o.imports)s[l.id]=l;for(const l of o.importsWithEntries)n[l.id]=l;i.importRootEntries&&(n[o.id]=o),s[o.id]=o}}return this.imports=Object.values(s),this.importsWithEntries=Object.values(n),this.imports}generateForces(r){var s,i;const n=[];for(const o of this.forcesIterator()){const l=Ge(o);l.main_catalogue=this;const a=[];(i=(s=r[Ue])==null?void 0:s.units)!=null&&i.length&&a.push(r[Ue]);const c=new Set;for(const f of o.categoryLinks||[])if(f.targetId in r){const d=Ge(f);d.main_catalogue=this;const h=r[d.targetId];d.target=h,d.childs=h.childs;for(const m of d.childs)c.add(m.id);a.push(d)}for(const f of o.categoryEntries||[])if(f.id in r){const d=r[f.id],h=Ge(d);h.main_catalogue=this;for(const m of h.childs)c.add(m.id);a.push(h)}const u=this.units.filter(f=>!c.has(f.id));if(u.length){const f=Ge(r[Qr]);f.childs=u,f.units=u,a.push(f)}l.childs=a,l.categories=a,this.index[l.id]=l,l.forceEntries&&l.generateForces(r),n.push(l)}return this.forces=n,this.childs=n,n}generateCategories(r){const n={},s=new Set;for(const a of this.iterateCategoryEntries()){const c=Ge(a);c.main_catalogue=this;const u=r[c.id]||[];c.units=u,c.childs=u,this.index[a.id]=a,n[c.id]=c,s.add(c.id)}for(const a in r)if(!s.has(a)){const c=this.findOptionById(a);if(c){const u=Ge(c);u.main_catalogue=this;const f=r[u.id]||[];u.units=f,u.childs=f,this.index[c.id]=c,n[u.id]=u}}const i=r[Ue]||[],o={name:"Uncategorized",id:Ue,hidden:!1,units:i,childs:i,catalogue:this};n[Ue]=Object.setPrototypeOf(o,Lt.prototype);const l={name:"Illegal Units",id:Qr,hidden:!0,units:[],childs:[],catalogue:this};return n[Qr]=Object.setPrototypeOf(l,Lt.prototype),n}generateUnits(){const r=[];for(const i of this.importsWithEntries){const o=i.isGameSystem();for(const l of i.selectionEntries||[])(o||l.import!==!1)&&r.push(l);for(const l of i.entryLinks||[])(o||l.import!==!1)&&r.push(l)}for(const i of this.selectionEntries||[])r.push(i);for(const i of this.entryLinks||[])r.push(i);const n=vo(r,i=>i.getName());return this.units=n,Js(n,i=>i.getPrimaryCategory())}generateExtraConstraints(){const r={},n=[],s={},i=new Set,o={};function l(a,c,u){const f=c.target||c;for(const d of u){const h=`${d.id}::${c.id}`;switch(d.scope){case"parent":break;case"roster":r[h]=c.getBoundConstraint(d);break;case"force":n.push(c.getBoundConstraint(d));break;case"primary-category":case"primary-catalogue":break;default:if(i.has(d.scope)){st(s,d.scope,f.getBoundConstraint(d));break}const m=a.index[d.scope];if(m){const p=m.extra_constraints||[];p.push(c.getBoundConstraint(d)),m.extra_constraints=p;break}break}}}for(const a of this.forcesIteratorRecursive())i.add(a.id);for(const a of this.categories)i.add(a.id);for(const a of this.categories){l(this,a,a.constraintsIterator());const c={};a.forEachNodeCb(u=>{var f;if(u&&!u.isForce()&&(!u.isGroup()&&!u.extra_constraints&&(u.extra_constraints=u.getChildBoundConstraints(!0)),!(u.isCategory()&&u.isLink())&&!(!u.constraints&&!((f=u.target)!=null&&f.constraints)))){for(const d of u.constraintsIterator())if(d.type==="min"||d.type==="exactly"){const h=`${d.id}::${u.id}`;switch(d.scope){case"parent":break;case"roster":r[h]=u.getBoundConstraint(d);break;case"force":c[h]=u.getBoundConstraint(d);break;case"primary-category":case"primary-catalogue":break;default:if(i.has(d.scope)){st(s,d.scope,u.getBoundConstraint(d));break}const m=this.index[d.scope];if(m){const p=m.extra_constraints||[];p.push(u.getBoundConstraint(d)),m.extra_constraints=p;break}break}}}}),o[a.getId()]=Object.values(c)}for(const a of this.forcesIteratorRecursive()){const c=a.extra_constraints||[];c.push(...n),a.id in s&&c.push(...s[a.id]),c.length&&(a.extra_constraints=c);for(const u of a.categories)u.getId()in o&&c.push(...o[u.getId()]);c.length&&(a.extra_constraints=c)}for(const a of this.categories){const c=a.extra_constraints||[];a.id in s&&c.push(...s[a.id]),c.length&&(a.extra_constraints=c)}this.roster_constraints=Object.values(r)}async reload(r=this.manager){delete this.initialized,delete this.loaded,delete this.loaded_editor,delete this.index;const n=this.isGameSystem()?"gameSystem":"catalogue",s=await r.loadData({[n]:this});return this.processForEditor(),s}refreshErrors(r,n=!1){var s,i;r.isLink()?r.target?(this.removeError(r,"no-target"),Ur(this.unresolvedLinks,r.targetId,$toRaw(r)),Ur(this.manager.unresolvedLinks,r.targetId,$toRaw(r))):(this.addError(r,{source:r,severity:"error",msg:`(${r.editorTypeName}) ${r.name} has no target`,id:"no-target"}),!((s=this.unresolvedLinks[r.targetId])!=null&&s.includes($toRaw(r)))&&!n&&st(this.unresolvedLinks,r.targetId,$toRaw(r)),(i=this.manager.unresolvedLinks[r.targetId])!=null&&i.includes($toRaw(r))||st(this.manager.unresolvedLinks,r.targetId,$toRaw(r))):r.isProfile()?r.typeId?this.removeError(r,"no-profile-type"):this.addError(r,{source:r,severity:"error",msg:"Profile has no type",id:"no-profile-type"}):r instanceof He&&this.updateCondition(r)}addToIndex(r){var n,s,i,o,l,a;if(r.id){if(r.catalogue=this,(s=(n=this.manager)==null?void 0:n.settings)!=null&&s.globalDuplicateIdError){const c=this.manager.index;if(c[r.id]&&c[r.id]!==r&&(r.isIdUnique()||c[r.id].isIdUnique())){const u=c[r.id],f=u.getCatalogue(),d=this!==f;f&&d&&(f.addError(u,{source:u,severity:"error",msg:`Duplicate id ${r.id} ${r.getName()}`,id:"duplicate-id-1",other:r,extra:f.name}),f.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${u.getName()}`,id:"duplicate-id-2",other:u,extra:this.name})),this.addError(u,{source:u,severity:"error",msg:`Duplicate id ${r.id}  ${r.getName()}`,id:"duplicate-id-1",other:r,extra:d?f.name:void 0}),this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${u.getName()}`,id:"duplicate-id-2",other:u,extra:d?this.name:void 0})}c[r.id]=r}else if(this.index[r.id]&&this.index[r.id]!==r){const c=this.index[r.id];(r.isIdUnique()||c.isIdUnique()||r.getName()!==c.getName())&&(this.addError(c,{source:c,severity:"error",msg:`Duplicate id ${r.id} ${r.getName()}`,id:"duplicate-id-1",other:r}),this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${c.getName()}`,id:"duplicate-id-2",other:c}))}if(this.index[r.id]=r,this.unresolvedLinks&&this.unresolvedLinks[r.id])for(const c of[...this.unresolvedLinks[r.id]])c.isLink()?this.updateLink(c):this.refreshErrors(c);if((i=this.manager)!=null&&i.unresolvedLinks&&((o=this.manager.unresolvedLinks[r.id])!=null&&o.length))for(const c of[...this.manager.unresolvedLinks[r.id]])c.isLink()?(l=c.catalogue)==null||l.updateLink(c):(a=c.catalogue)==null||a.refreshErrors(c)}}removeFromIndex(r){r.id&&$toRaw(this.index[r.id])===$toRaw(r)&&delete this.index[r.id],this.removeErrors(r);for(const n of r.links||[])delete n.target,n.catalogue.refreshErrors(n);for(const n of r.other_links||[])n.catalogue.refreshErrors(n,!0)}getIndexes(){const r=[];r.push(this.index);for(const n of this.imports)r.push(n.index);return r}resolveAllLinks(r=!0){const n=[],s=[],i=[],o=[];this.index||(this.index=jo(),fr(this,(c,u)=>{this.addToIndex(c),c.publicationId&&s.push(c),c.isLink()&&(n.push(c),o.push(u)),Yo(c)&&i.push(c)},Un));const l=this.getIndexes(),a=Do(n,l,o,r);if(qo(s,l),Zo(i,l),!r){this.unresolvedLinks={};for(const c of a)st(this.unresolvedLinks,c.targetId,$toRaw(c)),delete c.target}}removeRef(r,n){n.links||(n.links=[]);const s=n.links.indexOf(r);s>=0&&n.links.splice(s,1)}addRef(r,n){n.links||(n.links=[]),n.links.indexOf(r)===-1&&n.links.push(r)}hasOtherRef(r,n){return n.other_links&&n.other_links.includes(r)}removeOtherRef(r,n){n.other_links||(n.other_links=[]);const s=n.other_links.indexOf(r);s>=0&&n.other_links.splice(s,1)}addOtherRef(r,n){n.other_links||(n.other_links=[]),n.other_links.indexOf(r)===-1&&n.other_links.push(r)}updateLink(r){if(r.target&&this.removeRef(r,r.target),r.target=ci(r.targetId,this.getIndexes()),r.target){this.addRef(r,r.target);const n=r.target.editorTypeName;n=="category"?delete r.type:r.type=n}return this.refreshErrors(r),r.target!==void 0}updateConstraint(r,n=!1){var o,l,a,c;const s=new Set,i=new Set;for(const u of((o=r.parent)==null?void 0:o.constraintsIterator())||[])n&&r===u||(s.has(u.id)?i.add(u.id):s.add(u.id));for(const u of((l=r.parent)==null?void 0:l.constraintsIterator())||[])n&&r===u||(i.has(u.id)?(a=u.catalogue)==null||a.addError(u,{id:"duplicate-constraint-id",msg:"Duplicate constraints id",source:r}):(c=u.catalogue)==null||c.removeError(u,"duplicate-constraint-id"))}updateCondition(r,n){if(r.scope){const i=ct(r);if(i&&!Qo(i,r.scope)?this.addError(r,{source:r,id:"invalid-scope",msg:`Invalid scope ${r.scope}`}):this.removeError(r,"invalid-scope"),r.scope&&!Vn.has(r.scope)){const o=this.findOptionById(r.scope);o&&o.getCatalogue().addOtherRef(r,o)}}if(r instanceof an)return this.updateConstraint(r);const s=["instanceOf","notInstanceOf"].includes(r.type);if(n&&!fs.has(n)){const i=s?this.findOptionByIdGlobal(n):this.findOptionById(n);i&&this.removeOtherRef(r,i)}if(r.childId){if(fs.has(r.childId)){this.removeError(r,"id-not-exist");return}const i=s?this.findOptionByIdGlobal(r.childId):this.findOptionById(r.childId);if(i){this.hasOtherRef(r,i)||this.addOtherRef(r,i),this.removeError(r,"id-not-exist"),Ur(this.manager.unresolvedLinks,r.childId,$toRaw(r));return}}this.addError(r,{source:r,severity:"warning",msg:"child id does not exist",id:"id-not-exist"}),wo(this.manager.unresolvedLinks,r.childId,$toRaw(r))}unlinkLink(r){r.target&&this.removeRef(r,r.target)}}function ci(e,t){for(const r of t)if(e in r)return r[e]}function Do(e=[],t,r,n=!0){e.length;let s=0;for(;e.length!==s;){const i=e,o=r;s=i.length,e=[],r=[];for(let l=0;l<i.length;l++){const a=i[l],c=o[l],u=a.targetId,f=ci(u,t);if(f){a.target=f;continue}e.push(a),r.push(c)}}if(e.length&&n)for(let i=0;i<e.length;i++){const o=e[i],l=r[i];for(const[a,c]of Object.entries(l))if(c===o&&delete l[a],Array.isArray(c))for(const u in c)c[u]===o&&c.splice(u,1)}return e}function qo(e=[],t){for(const r of e)for(const n of t)if(r.publicationId in n){r.publication=n[r.publicationId];break}}function Zo(e=[],t){for(const r of e){const n=r.childId;for(const s of t)if(n in s){r.childId=s[n].getId();break}}}function Yo(e){return e.shared!==!1&&e.childId!==void 0}let Xo=class{get[Symbol.toStringTag](){return"ObjectNoObserve"}};function jo(){return new Xo}function ui(e){return e.arrayBuffer?e.arrayBuffer():new Promise((t,r)=>{const n=new FileReader;n.addEventListener("loadend",()=>{t(n.result)}),n.addEventListener("error",r),n.readAsArrayBuffer(e)})}async function Ho(e){const t=await ui(e);return new Uint8Array(t)}function di(e){return typeof Blob<"u"&&e instanceof Blob}function zt(e){return typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer}const Jo=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function $o(e){return e.byteOffset===0&&e.byteLength===e.buffer.byteLength}class gs{constructor(t){this.typedArray=t instanceof ArrayBuffer||zt(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,r){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,r)}}class ms{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,r){const n=this.blob.slice(t,t+r),s=await ui(n);return new Uint8Array(s)}async sliceAsBlob(t,r,n=""){return this.blob.slice(t,t+r,n)}}function ea(e,t){var r=Uint8Array;if(e[0]==3&&e[1]==0)return t||new r(0);var n=ra,s=fi,i=ta,o=hi,l=t==null;l&&(t=new r(e.length>>>2<<3));for(var a=0,c=0,u=0,f=0,d=0,h=0,m=0,p=0,y=0,A,g;a==0;){if(a=n(e,y,1),c=n(e,y+1,2),y+=3,c==0){y&7&&(y+=8-(y&7));var w=(y>>>3)+4,_=e[w-4]|e[w-3]<<8;l&&(t=qr(t,p+_)),t.set(new r(e.buffer,e.byteOffset+w,_),p),y=w+_<<3,p+=_;continue}if(l&&(t=qr(t,p+(1<<17))),c==1&&(A=O.flmap,g=O.fdmap,h=512-1,m=32-1),c==2){u=s(e,y,5)+257,f=s(e,y+5,5)+1,d=s(e,y+10,4)+4,y+=14;for(var b=0;b<38;b+=2)O.itree[b]=0,O.itree[b+1]=0;for(var E=1,b=0;b<d;b++){var x=s(e,y+b*3,3);O.itree[(O.ordr[b]<<1)+1]=x,x>E&&(E=x)}y+=3*d,Bt(O.itree,E),Pt(O.itree,E,O.imap),A=O.lmap,g=O.dmap,y=i(O.imap,(1<<E)-1,u+f,e,y,O.ttree);var P=ys(O.ttree,0,u,O.ltree);h=(1<<P)-1;var C=ys(O.ttree,u,f,O.dtree);m=(1<<C)-1,Bt(O.ltree,P),Pt(O.ltree,P,A),Bt(O.dtree,C),Pt(O.dtree,C,g)}for(;;){var F=A[o(e,y)&h];y+=F&15;var R=F>>>4;if(!(R>>>8))t[p++]=R;else{if(R==256)break;var Y=p+R-254;if(R>264){var D=O.ldef[R-257];Y=p+(D>>>3)+s(e,y,D&7),y+=D&7}var M=g[o(e,y)&m];y+=M&15;var ke=M>>>4,fe=O.ddef[ke],X=(fe>>>4)+n(e,y,fe&15);for(y+=fe&15,l&&(t=qr(t,p+(1<<17)));p<Y;)t[p]=t[p++-X],t[p]=t[p++-X],t[p]=t[p++-X],t[p]=t[p++-X];p=Y}}}return t.length==p?t:t.slice(0,p)}function qr(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function ta(e,t,r,n,s,i){for(var o=fi,l=hi,a=0;a<r;){var c=e[l(n,s)&t];s+=c&15;var u=c>>>4;if(u<=15)i[a]=u,a++;else{var f=0,d=0;u==16?(d=3+o(n,s,2),s+=2,f=i[a-1]):u==17?(d=3+o(n,s,3),s+=3):u==18&&(d=11+o(n,s,7),s+=7);for(var h=a+d;a<h;)i[a]=f,a++}}return s}function ys(e,t,r,n){for(var s=0,i=0,o=n.length>>>1;i<r;){var l=e[i+t];n[i<<1]=0,n[(i<<1)+1]=l,l>s&&(s=l),i++}for(;i<o;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return s}function Bt(e,t){for(var r=e.length,n,s,i,o,l,a=O.bl_count,o=0;o<=t;o++)a[o]=0;for(o=1;o<r;o+=2)a[e[o]]++;var c=O.next_code;for(n=0,a[0]=0,s=1;s<=t;s++)n=n+a[s-1]<<1,c[s]=n;for(i=0;i<r;i+=2)l=e[i+1],l!=0&&(e[i]=c[l],c[l]++)}function Pt(e,t,r){for(var n=e.length,s=O.rev15,i=0;i<n;i+=2)if(e[i+1]!=0)for(var o=i>>1,l=e[i+1],a=o<<4|l,c=t-l,u=e[i]<<c,f=u+(1<<c);u!=f;){var d=s[u]>>>15-t;r[d]=a,u++}}function As(e,t){for(var r=O.rev15,n=15-t,s=0;s<e.length;s+=2){var i=e[s]<<t-e[s+1];e[s]=r[i]>>>n}}function fi(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function ra(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function hi(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}const O=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,O.rev15[t]=(r>>>16|r<<16)>>>17}function n(s,i,o){for(;i--!=0;)s.push(0,o)}for(var t=0;t<32;t++)O.ldef[t]=O.of0[t]<<3|O.exb[t],O.ddef[t]=O.df0[t]<<4|O.dxb[t];n(O.fltree,144,8),n(O.fltree,255-143,9),n(O.fltree,279-255,7),n(O.fltree,287-279,8),Bt(O.fltree,9),Pt(O.fltree,9,O.flmap),As(O.fltree,9),n(O.fdtree,32,5),Bt(O.fdtree,5),Pt(O.fdtree,5,O.fdmap),As(O.fdtree,5),n(O.itree,19,0),n(O.ltree,286,0),n(O.dtree,30,0),n(O.ttree,320,0)})();const vs={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}(),update:function(e,t,r,n){for(var s=0;s<n;s++)e=vs.table[(e^t[r+s])&255]^e>>>8;return e},crc:function(e,t,r){return vs.update(4294967295,e,t,r)^4294967295}};function na(e,t){return ea(e,t)}const ws={numWorkers:1,workerURL:"",useWorkers:!1};let sa=0;const hr=[];function Zr(e){return new Promise((t,r)=>{const n=new Worker(e);n.onmessage=s=>{s.data==="start"?(n.onerror=void 0,n.onmessage=void 0,t(n)):r(new Error(`unexpected message: ${s.data}`))},n.onerror=r})}function ia(e,t){return e.require?e.require(t):{}}(function(){if(Jo){const{Worker:e}=ia(module,"worker_threads");return{async createWorker(t){return new e(t)},addEventListener(t,r){t.on("message",n=>{r({target:t,data:n})})},async terminate(t){await t.terminate()}}}else return{async createWorker(e){try{return await Zr(e)}catch{console.warn("could not load worker:",e)}let t;try{const r=await fetch(e,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${e}`);t=await r.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const n=await Zr(e);return ws.workerURL=e,n}catch{console.warn("could not load worker via fetch:",e)}if(t!==void 0)try{e=`data:application/javascript;base64,${btoa(t)}`;const r=await Zr(e);return ws.workerURL=e,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}}})();function oa(e,t,r,n){const s=new Uint8Array(t);na(e,s),n(r?new Blob([s],{type:r}):s.buffer)}async function aa(){if(hr.length!==0)for(;hr.length;){const{src:e,uncompressedSize:t,type:r,resolve:n}=hr.shift();let s=e;di(e)&&(s=await Ho(e)),oa(s,t,r,n)}}function pi(e,t,r){return new Promise((n,s)=>{hr.push({src:e,uncompressedSize:t,type:r,resolve:n,reject:s,id:sa++}),aa()})}function la(e,t){const r=e&31,n=(e>>5&15)-1,s=(e>>9&127)+1980,i=0,o=(t&31)*2,l=t>>5&63,a=t>>11&31;return new Date(s,n,r,a,l,o,i)}class ca{constructor(t,r){this._reader=t,this._rawEntry=r,this.name=r.name,this.nameBytes=r.nameBytes,this.size=r.uncompressedSize,this.compressedSize=r.compressedSize,this.comment=r.comment,this.commentBytes=r.commentBytes,this.compressionMethod=r.compressionMethod,this.lastModDate=la(r.lastModFileDate,r.lastModFileTime),this.isDirectory=r.uncompressedSize===0&&r.name.endsWith("/"),this.encrypted=!!(r.generalPurposeBitFlag&1),this.externalFileAttributes=r.externalFileAttributes,this.versionMadeBy=r.versionMadeBy}async blob(t="application/octet-stream"){return await wa(this._reader,this._rawEntry,t)}async arrayBuffer(){return await va(this._reader,this._rawEntry)}async text(){const t=await this.arrayBuffer();return Gt(new Uint8Array(t))}async json(){const t=await this.text();return JSON.parse(t)}}const Yr=22,ua=65535,da=101010256,fa=101075792;async function mt(e,t,r){return await e.read(t,r)}async function cn(e,t,r,n){return e.sliceAsBlob?await e.sliceAsBlob(t,r,n):await e.read(t,r)}const ha={unsigned(){return 0}};function H(e,t){return e[t]+e[t+1]*256}function te(e,t){return e[t]+e[t+1]*256+e[t+2]*65536+e[t+3]*16777216}function Qe(e,t){return te(e,t)+te(e,t+4)*4294967296}const pa=new TextDecoder;function Gt(e,t){return zt(e.buffer)&&(e=new Uint8Array(e)),pa.decode(e)}async function ga(e,t){const r=Math.min(Yr+ua,t),n=t-r,s=await mt(e,n,r);for(let i=r-Yr;i>=0;--i){if(te(s,i)!==da)continue;const o=new Uint8Array(s.buffer,s.byteOffset+i,s.byteLength-i),l=H(o,4);if(l!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${l}`);const a=H(o,10),c=te(o,12),u=te(o,16),f=H(o,20),d=o.length-Yr;if(f!==d)throw new Error(`invalid comment length. expected: ${d}, actual: ${f}`);const h=new Uint8Array(o.buffer,o.byteOffset+22,f),m=Gt(h);return a===65535||u===4294967295?await ya(e,n+i,m,h):await gi(e,u,c,a,m,h)}throw new Error("could not find end of central directory. maybe not zip file")}const ma=117853008;async function ya(e,t,r,n){const s=t-20,i=await mt(e,s,20);if(te(i,0)!==ma)throw new Error("invalid zip64 end of central directory locator signature");const o=Qe(i,8),l=await mt(e,o,56);if(te(l,0)!==fa)throw new Error("invalid zip64 end of central directory record signature");const a=Qe(l,32),c=Qe(l,40),u=Qe(l,48);return gi(e,u,c,a,r,n)}const Aa=33639248;async function gi(e,t,r,n,s,i){let o=0;const l=await mt(e,t,r),a=[];for(let u=0;u<n;++u){const f=l.subarray(o,o+46),d=te(f,0);if(d!==Aa)throw new Error(`invalid central directory file header signature: 0x${d.toString(16)}`);const h={versionMadeBy:H(f,4),versionNeededToExtract:H(f,6),generalPurposeBitFlag:H(f,8),compressionMethod:H(f,10),lastModFileTime:H(f,12),lastModFileDate:H(f,14),crc32:te(f,16),compressedSize:te(f,20),uncompressedSize:te(f,24),fileNameLength:H(f,28),extraFieldLength:H(f,30),fileCommentLength:H(f,32),internalFileAttributes:H(f,36),externalFileAttributes:te(f,38),relativeOffsetOfLocalHeader:te(f,42)};if(h.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");o+=46;const m=l.subarray(o,o+h.fileNameLength+h.extraFieldLength+h.fileCommentLength);h.nameBytes=m.slice(0,h.fileNameLength),h.name=Gt(h.nameBytes);const p=h.fileNameLength+h.extraFieldLength,y=m.slice(h.fileNameLength,p);h.extraFields=[];let A=0;for(;A<y.length-3;){const w=H(y,A+0),_=H(y,A+2),b=A+4,E=b+_;if(E>y.length)throw new Error("extra field length exceeds extra field buffer size");h.extraFields.push({id:w,data:y.slice(b,E)}),A=E}if(h.commentBytes=m.slice(p,p+h.fileCommentLength),h.comment=Gt(h.commentBytes),o+=m.length,h.uncompressedSize===4294967295||h.compressedSize===4294967295||h.relativeOffsetOfLocalHeader===4294967295){const w=h.extraFields.find(E=>E.id===1);if(!w)throw new Error("expected zip64 extended information extra field");const _=w.data;let b=0;if(h.uncompressedSize===4294967295){if(b+8>_.length)throw new Error("zip64 extended information extra field does not include uncompressed size");h.uncompressedSize=Qe(_,b),b+=8}if(h.compressedSize===4294967295){if(b+8>_.length)throw new Error("zip64 extended information extra field does not include compressed size");h.compressedSize=Qe(_,b),b+=8}if(h.relativeOffsetOfLocalHeader===4294967295){if(b+8>_.length)throw new Error("zip64 extended information extra field does not include relative header offset");h.relativeOffsetOfLocalHeader=Qe(_,b),b+=8}}const g=h.extraFields.find(w=>w.id===28789&&w.data.length>=6&&w.data[0]===1&&te(w.data,1),ha.unsigned(h.nameBytes));if(g&&(h.fileName=Gt(g.data.slice(5))),h.compressionMethod===0){let w=h.uncompressedSize;if(h.generalPurposeBitFlag&1&&(w+=12),h.compressedSize!==w)throw new Error(`compressed size mismatch for stored file: ${h.compressedSize} != ${w}`)}a.push(h)}return{zip:{comment:s,commentBytes:i},entries:a.map(u=>new ca(e,u))}}async function mi(e,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const r=await mt(e,t.relativeOffsetOfLocalHeader,30),n=await e.getLength(),s=te(r,0);if(s!==67324752)throw new Error(`invalid local file header signature: 0x${s.toString(16)}`);const i=H(r,26),o=H(r,28),l=t.relativeOffsetOfLocalHeader+r.length+i+o;let a;if(t.compressionMethod===0)a=!1;else if(t.compressionMethod===8)a=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);const c=l,u=c+t.compressedSize;if(t.compressedSize!==0&&u>n)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${n}`);return{decompress:a,fileDataStart:c}}async function va(e,t){const{decompress:r,fileDataStart:n}=await mi(e,t);if(!r){const o=await mt(e,n,t.compressedSize);return $o(o)?o.buffer:o.slice().buffer}const s=await cn(e,n,t.compressedSize);return await pi(s,t.uncompressedSize)}async function wa(e,t,r){const{decompress:n,fileDataStart:s}=await mi(e,t);if(!n){const l=await cn(e,s,t.compressedSize,r);return di(l)?l:new Blob([zt(l.buffer)?new Uint8Array(l):l],{type:r})}const i=await cn(e,s,t.compressedSize);return await pi(i,t.uncompressedSize,r)}async function ba(e){let t;if(typeof Blob<"u"&&e instanceof Blob)t=new ms(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new gs(e);else if(zt(e)||zt(e.buffer))t=new gs(e);else if(typeof e=="string"){const n=await fetch(e);if(!n.ok)throw new Error(`failed http request ${e}, status: ${n.status}: ${n.statusText}`);const s=await n.blob();t=new ms(s)}else if(typeof e.getLength=="function"&&typeof e.read=="function")t=e;else throw new Error("unsupported source type");const r=await t.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await ga(t,r)}async function yi(e){const{zip:t,entries:r}=await ba(e);return{zip:t,entries:Object.fromEntries(r.map(n=>[n.name,n]))}}var zn={},Wn={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+r+"]*",s=new RegExp("^"+n+"$"),i=function(l,a){const c=[];let u=a.exec(l);for(;u;){const f=[];f.startIndex=a.lastIndex-u[0].length;const d=u.length;for(let h=0;h<d;h++)f.push(u[h]);c.push(f),u=a.exec(l)}return c},o=function(l){const a=s.exec(l);return!(a===null||typeof a>"u")};e.isExist=function(l){return typeof l<"u"},e.isEmptyObject=function(l){return Object.keys(l).length===0},e.merge=function(l,a,c){if(a){const u=Object.keys(a),f=u.length;for(let d=0;d<f;d++)c==="strict"?l[u[d]]=[a[u[d]]]:l[u[d]]=a[u[d]]}},e.getValue=function(l){return e.isExist(l)?l:""},e.isName=o,e.getAllMatches=i,e.nameRegexp=n})(Wn);const Dn=Wn,Ea={allowBooleanAttributes:!1,unpairedTags:[]};zn.validate=function(e,t){t=Object.assign({},Ea,t);const r=[];let n=!1,s=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=Es(e,i),i.err)return i}else if(e[i]==="<"){let o=i;if(i++,e[i]==="!"){i=ks(e,i);continue}else{let l=!1;e[i]==="/"&&(l=!0,i++);let a="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
`&&e[i]!=="\r";i++)a+=e[i];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),i--),!Ta(a)){let f;return a.trim().length===0?f="Invalid space after '<'.":f="Tag '"+a+"' is an invalid name.",q("InvalidTag",f,se(e,i))}const c=xa(e,i);if(c===!1)return q("InvalidAttr","Attributes for '"+a+"' have open quote.",se(e,i));let u=c.value;if(i=c.index,u[u.length-1]==="/"){const f=i-u.length;u=u.substring(0,u.length-1);const d=_s(u,t);if(d===!0)n=!0;else return q(d.err.code,d.err.msg,se(e,f+d.err.line))}else if(l)if(c.tagClosed){if(u.trim().length>0)return q("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",se(e,o));{const f=r.pop();if(a!==f.tagName){let d=se(e,f.tagStartPos);return q("InvalidTag","Expected closing tag '"+f.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+a+"'.",se(e,o))}r.length==0&&(s=!0)}}else return q("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",se(e,i));else{const f=_s(u,t);if(f!==!0)return q(f.err.code,f.err.msg,se(e,i-u.length+f.err.line));if(s===!0)return q("InvalidXml","Multiple possible root nodes found.",se(e,i));t.unpairedTags.indexOf(a)!==-1||r.push({tagName:a,tagStartPos:o}),n=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=ks(e,i);continue}else if(e[i+1]==="?"){if(i=Es(e,++i),i.err)return i}else break;else if(e[i]==="&"){const f=Sa(e,i);if(f==-1)return q("InvalidChar","char '&' is not expected.",se(e,i));i=f}else if(s===!0&&!bs(e[i]))return q("InvalidXml","Extra text at the end",se(e,i));e[i]==="<"&&i--}}else{if(bs(e[i]))continue;return q("InvalidChar","char '"+e[i]+"' is not expected.",se(e,i))}if(n){if(r.length==1)return q("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",se(e,r[0].tagStartPos));if(r.length>0)return q("InvalidXml","Invalid '"+JSON.stringify(r.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return q("InvalidXml","Start tag expected.",1);return!0};function bs(e){return e===" "||e==="	"||e===`
`||e==="\r"}function Es(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const n=e.substr(r,t-r);if(t>5&&n==="xml")return q("InvalidXml","XML declaration allowed only at the start of the document.",se(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function ks(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const ka='"',_a="'";function xa(e,t){let r="",n="",s=!1;for(;t<e.length;t++){if(e[t]===ka||e[t]===_a)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){s=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:s}}const Ia=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function _s(e,t){const r=Dn.getAllMatches(e,Ia),n={};for(let s=0;s<r.length;s++){if(r[s][1].length===0)return q("InvalidAttr","Attribute '"+r[s][2]+"' has no space in starting.",_t(r[s]));if(r[s][3]!==void 0&&r[s][4]===void 0)return q("InvalidAttr","Attribute '"+r[s][2]+"' is without value.",_t(r[s]));if(r[s][3]===void 0&&!t.allowBooleanAttributes)return q("InvalidAttr","boolean attribute '"+r[s][2]+"' is not allowed.",_t(r[s]));const i=r[s][2];if(!Na(i))return q("InvalidAttr","Attribute '"+i+"' is an invalid name.",_t(r[s]));if(!n.hasOwnProperty(i))n[i]=1;else return q("InvalidAttr","Attribute '"+i+"' is repeated.",_t(r[s]))}return!0}function Ca(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function Sa(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Ca(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function q(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function Na(e){return Dn.isName(e)}function Ta(e){return Dn.isName(e)}function se(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function _t(e){return e.startIndex+e[1].length}var qn={};const Ai={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},La=function(e){return Object.assign({},Ai,e)};qn.buildOptions=La;qn.defaultOptions=Ai;class Oa{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,[":@"]:t[":@"]}):this.child.push({[t.tagname]:t.child})}}var Ba=Oa;function Pa(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,s=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!i){if(s&&Fa(e,t))t+=7,[entityName,val,t]=Ga(e,t+1),val.indexOf("&")===-1&&(r[entityName]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&Ka(e,t))t+=8;else if(s&&Ua(e,t))t+=8;else if(s&&Ma(e,t))t+=9;else if(Ra)i=!0;else throw new Error("Invalid DOCTYPE");n++,o=""}else if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,n--):n--,n===0)break}else e[t]==="["?s=!0:o+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function Ga(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const n=e[t++];let s="";for(;t<e.length&&e[t]!==n;t++)s+=e[t];return[r,s,t]}function Ra(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function Fa(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function Ka(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function Ua(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Ma(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}var Va=Pa;const Qa=/^[-+]?0x[a-fA-F0-9]+$/,za=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Wa={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Da(e,t={}){if(t=Object.assign({},Wa,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&Qa.test(r))return Number.parseInt(r,16);{const n=za.exec(r);if(n){const s=n[1],i=n[2];let o=qa(n[3]);const l=n[4]||n[6];if(!t.leadingZeros&&i.length>0&&s&&r[2]!==".")return e;if(!t.leadingZeros&&i.length>0&&!s&&r[1]!==".")return e;{const a=Number(r),c=""+a;return c.search(/[eE]/)!==-1||l?t.eNotation?a:e:r.indexOf(".")!==-1?c==="0"&&o===""||c===o||s&&c==="-"+o?a:e:i?o===c||s+o===c?a:e:r===c||r===s+c?a:e}}else return e}}function qa(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var Za=Da;const Zn=Wn,xt=Ba,Ya=Va,Xa=Za;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,Zn.nameRegexp);let ja=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Ha,this.parseXml=rl,this.parseTextData=Ja,this.resolveNameSpace=$a,this.buildAttributesMap=tl,this.isItStopNode=ol,this.replaceEntitiesValue=sl,this.readStopNodeData=ll,this.saveTextToParentTag=il,this.addChild=nl}};function Ha(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Ja(e,t,r,n,s,i,o){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const l=this.options.tagValueProcessor(t,e,r,s,i);return l==null?e:typeof l!=typeof e||l!==e?l:this.options.trimValues?dn(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?dn(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function $a(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const el=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function tl(e,t,r){if(!this.options.ignoreAttributes&&typeof e=="string"){const n=Zn.getAllMatches(e,el),s=n.length,i={};for(let o=0;o<s;o++){const l=this.resolveNameSpace(n[o][1]);let a=n[o][4],c=this.options.attributeNamePrefix+l;if(l.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const u=this.options.attributeValueProcessor(l,a,t);u==null?i[c]=a:typeof u!=typeof a||u!==a?i[c]=u:i[c]=dn(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[c]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=i,o}return i}}const rl=function(e){e=e.replace(/\r\n?/g,`
`);const t=new xt("!xml");let r=t,n="",s="";for(let i=0;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){const l=ze(e,">",i,"Closing Tag is not closed.");let a=e.substring(i+2,l).trim();if(this.options.removeNSPrefix){const f=a.indexOf(":");f!==-1&&(a=a.substr(f+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&(n=this.saveTextToParentTag(n,r,s));const c=s.substring(s.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let u=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(u=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):u=s.lastIndexOf("."),s=s.substring(0,u),r=this.tagsNodeStack.pop(),n="",i=l}else if(e[i+1]==="?"){let l=un(e,i,!1,"?>");if(!l)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,s),!(this.options.ignoreDeclaration&&l.tagName==="?xml"||this.options.ignorePiTags)){const a=new xt(l.tagName);a.add(this.options.textNodeName,""),l.tagName!==l.tagExp&&l.attrExpPresent&&(a[":@"]=this.buildAttributesMap(l.tagExp,s,l.tagName)),this.addChild(r,a,s)}i=l.closeIndex+1}else if(e.substr(i+1,3)==="!--"){const l=ze(e,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(i+4,l-2);n=this.saveTextToParentTag(n,r,s),r.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}i=l}else if(e.substr(i+1,2)==="!D"){const l=Ya(e,i);this.docTypeEntities=l.entities,i=l.i}else if(e.substr(i+1,2)==="!["){const l=ze(e,"]]>",i,"CDATA is not closed.")-2,a=e.substring(i+9,l);if(n=this.saveTextToParentTag(n,r,s),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]);else{let c=this.parseTextData(a,r.tagname,s,!0,!1,!0);c==null&&(c=""),r.add(this.options.textNodeName,c)}i=l+2}else{let l=un(e,i,this.options.removeNSPrefix),a=l.tagName,c=l.tagExp,u=l.attrExpPresent,f=l.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,s,!1));const d=r;if(d&&this.options.unpairedTags.indexOf(d.tagname)!==-1&&(r=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),a!==t.tagname&&(s+=s?"."+a:a),this.isItStopNode(this.options.stopNodes,s,a)){let h="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)i=l.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)i=l.closeIndex;else{const p=this.readStopNodeData(e,a,f+1);if(!p)throw new Error(`Unexpected end of ${a}`);i=p.i,h=p.tagContent}const m=new xt(a);a!==c&&u&&(m[":@"]=this.buildAttributesMap(c,s,a)),h&&(h=this.parseTextData(h,a,s,!0,u,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),m.add(this.options.textNodeName,h),this.addChild(r,m,s)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const h=new xt(a);a!==c&&u&&(h[":@"]=this.buildAttributesMap(c,s,a)),this.addChild(r,h,s),s=s.substr(0,s.lastIndexOf("."))}else{const h=new xt(a);this.tagsNodeStack.push(r),a!==c&&u&&(h[":@"]=this.buildAttributesMap(c,s,a)),this.addChild(r,h,s),r=h}n="",i=f}}else n+=e[i];return t.child};function nl(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}const sl=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function il(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function ol(e,t,r){const n="*."+r;for(const s in e){const i=e[s];if(n===i||t===i)return!0}return!1}function al(e,t,r=">"){let n,s="";for(let i=t;i<e.length;i++){let o=e[i];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===r[0])if(r[1]){if(e[i+1]===r[1])return{data:s,index:i}}else return{data:s,index:i};else o==="	"&&(o=" ");s+=o}}function ze(e,t,r,n){const s=e.indexOf(t,r);if(s===-1)throw new Error(n);return s+t.length-1}function un(e,t,r,n=">"){const s=al(e,t+1,n);if(!s)return;let i=s.data;const o=s.index,l=i.search(/\s/);let a=i,c=!0;if(l!==-1&&(a=i.substr(0,l).replace(/\s\s*$/,""),i=i.substr(l+1)),r){const u=a.indexOf(":");u!==-1&&(a=a.substr(u+1),c=a!==s.data.substr(u+1))}return{tagName:a,tagExp:i,closeIndex:o,attrExpPresent:c}}function ll(e,t,r){const n=r;let s=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const i=ze(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(s--,s===0))return{tagContent:e.substring(n,r),i};r=i}else if(e[r+1]==="?")r=ze(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=ze(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=ze(e,"]]>",r,"StopNode is not closed.")-2;else{const i=un(e,r,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&s++,r=i.closeIndex)}}function dn(e,t,r){if(t&&typeof e=="string"){const n=e.trim();return n==="true"?!0:n==="false"?!1:Xa(e,r)}else return Zn.isExist(e)?e:""}var cl=ja,vi={};function ul(e,t){return wi(e,t)}function wi(e,t,r){let n;const s={};for(let i=0;i<e.length;i++){const o=e[i],l=dl(o);let a="";if(r===void 0?a=l:a=r+"."+l,l===t.textNodeName)n===void 0?n=o[l]:n+=""+o[l];else{if(l===void 0)continue;if(o[l]){let c=wi(o[l],t,a);const u=hl(c,t);o[":@"]?fl(c,o[":@"],a,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),s[l]!==void 0&&s.hasOwnProperty(l)?(Array.isArray(s[l])||(s[l]=[s[l]]),s[l].push(c)):t.isArray(l,a,u)?s[l]=[c]:s[l]=c}}}return typeof n=="string"?n.length>0&&(s[t.textNodeName]=n):n!==void 0&&(s[t.textNodeName]=n),s}function dl(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function fl(e,t,r,n){if(t){const s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){const l=s[o];n.isArray(l,r+"."+l,!0,!0)?e[l]=[t[l]]:e[l]=t[l]}}}function hl(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}vi.prettify=ul;const{buildOptions:pl}=qn,gl=cl,{prettify:ml}=vi,yl=zn;let Al=class{constructor(t){this.externalEntities={},this.options=pl(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const i=yl.validate(t,r);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const n=new gl(this.options);n.addExternalEntities(this.externalEntities);const s=n.parseXml(t);return this.options.preserveOrder||s===void 0?s:ml(s,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};var vl=Al;const wl=`
`;function bl(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=wl),bi(e,t,"",r)}function bi(e,t,r,n){let s="",i=!1;for(let o=0;o<e.length;o++){const l=e[o],a=El(l);let c="";if(r.length===0?c=a:c=`${r}.${a}`,a===t.textNodeName){let m=l[a];kl(c,t)||(m=t.tagValueProcessor(a,m),m=Ei(m,t)),i&&(s+=n),s+=m,i=!1;continue}else if(a===t.cdataPropName){i&&(s+=n),s+=`<![CDATA[${l[a][0][t.textNodeName]}]]>`,i=!1;continue}else if(a===t.commentPropName){s+=n+`<!--${l[a][0][t.textNodeName]}-->`,i=!0;continue}else if(a[0]==="?"){const m=xs(l[":@"],t),p=a==="?xml"?"":n;let y=l[a][0][t.textNodeName];y=y.length!==0?" "+y:"",s+=p+`<${a}${y}${m}?>`,i=!0;continue}let u=n;u!==""&&(u+=t.indentBy);const f=xs(l[":@"],t),d=n+`<${a}${f}`,h=bi(l[a],t,c,u);t.unpairedTags.indexOf(a)!==-1?t.suppressUnpairedNode?s+=d+">":s+=d+"/>":(!h||h.length===0)&&t.suppressEmptyNode?s+=d+"/>":h&&h.endsWith(">")?s+=d+`>${h}${n}</${a}>`:(s+=d+">",h&&n!==""&&(h.includes("/>")||h.includes("</"))?s+=n+t.indentBy+h+n:s+=h,s+=`</${a}>`),i=!0}return s}function El(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function xs(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){let s=t.attributeValueProcessor(n,e[n]);s=Ei(s,t),s===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${s}"`}return r}function kl(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function Ei(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}var _l=bl;const xl=_l,Il={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Oe(e){this.options=Object.assign({},Il,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Nl),this.processTextOrObjNode=Cl,this.options.format?(this.indentate=Sl,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Oe.prototype.build=function(e){return this.options.preserveOrder?xl(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)};Oe.prototype.j2x=function(e,t){let r="",n="";for(let s in e)if(!(typeof e[s]>"u"))if(e[s]===null)s[0]==="?"?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)n+=this.buildTextValNode(e[s],s,"",t);else if(typeof e[s]!="object"){const i=this.isAttribute(s);if(i)r+=this.buildAttrPairStr(i,""+e[s]);else if(s===this.options.textNodeName){let o=this.options.tagValueProcessor(s,""+e[s]);n+=this.replaceEntitiesValue(o)}else n+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const i=e[s].length;let o="";for(let l=0;l<i;l++){const a=e[s][l];typeof a>"u"||(a===null?s[0]==="?"?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:typeof a=="object"?this.options.oneListGroup?o+=this.j2x(a,t+1).val:o+=this.processTextOrObjNode(a,s,t):o+=this.buildTextValNode(a,s,"",t))}this.options.oneListGroup&&(o=this.buildObjectNode(o,s,"",t)),n+=o}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const i=Object.keys(e[s]),o=i.length;for(let l=0;l<o;l++)r+=this.buildAttrPairStr(i[l],""+e[s][i[l]])}else n+=this.processTextOrObjNode(e[s],s,t);return{attrStr:r,val:n}};Oe.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function Cl(e,t,r){const n=this.j2x(e,r+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}Oe.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return t[0]==="?"&&(i="?",s=""),r&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+i+">"+e+s:this.options.commentPropName!==!1&&t===this.options.commentPropName&&i.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+s}};Oe.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t};Oe.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),s===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+s+"</"+t+this.tagEndChar}};Oe.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function Sl(e){return this.options.indentBy.repeat(e)}function Nl(e){return e.startsWith(this.options.attributeNamePrefix)?e.substr(this.attrPrefixLen):!1}var Tl=Oe;const Ll=zn,Ol=vl,Bl=Tl;var ki={XMLParser:Ol,XMLValidator:Ll,XMLBuilder:Bl};const Pl={catalogueLinks:{allowedChildrens:[]},publications:{allowedChildrens:[]},costTypes:{allowedChildrens:[]},profileTypes:{allowedChildrens:["characteristicTypes"]},categoryEntries:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},categoryLinks:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},forceEntries:{allowedChildrens:["forceEntries","categoryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","costs"]},entryLinks:{allowedChildrens:"type"},selectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},selectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},associations:{allowedChildrens:["constraints","modifiers","modifierGroups"]},sharedRules:{allowedChildrens:["modifiers","modifierGroups"]},rule:{allowedChildrens:["modifiers","modifierGroups"]},rules:{allowedChildrens:["modifiers","modifierGroups"]},profile:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},profiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},sharedProfiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},infoGroup:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},sharedInfoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoLinks:{allowedChildrens:"type"},modifiers:{allowedChildrens:["conditions","conditionGroups","repeats"]},modifierGroups:{allowedChildrens:["modifiers","modifierGroups","conditions","conditionGroups","repeats"]},conditions:{allowedChildrens:[]},conditionGroups:{allowedChildrens:["conditions","conditionGroups"]},catalogue:{allowedChildrens:["catalogueLinks","publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]},gameSystem:{allowedChildrens:["publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]}},Ze={categories:"category",catalogueLinks:"catalogueLink",categoryEntries:"categoryEntry",categoryLinks:"categoryLink",characteristics:"characteristic",characteristicTypes:"characteristicType",conditions:"condition",conditionGroups:"conditionGroup",constraints:"constraint",costs:"cost",costLimits:"costLimit",costTypes:"costType",entryLinks:"entryLink",forceEntries:"forceEntry",infoGroups:"infoGroup",infoLinks:"infoLink",forces:"force",modifiers:"modifier",modifierGroups:"modifierGroup",profiles:"profile",profileTypes:"profileType",publications:"publication",repeats:"repeat",rules:"rule",selections:"selection",selectionEntries:"selectionEntry",selectionEntryGroups:"selectionEntryGroup",sharedInfoGroups:"infoGroup",sharedProfiles:"profile",sharedRules:"rule",sharedSelectionEntries:"selectionEntry",sharedSelectionEntryGroups:"selectionEntryGroup",associations:"association"},Gr=new Set(["description","readme","comment"]),Is=/&(?:amp|lt|gt|quot|#39|apos);/g,Gl={"&amp;":"&","&apos;":"'","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Cs=e=>Is.test(e)?e.replace(Is,t=>Gl[t]):e,Yn={};for(const e in Ze)Yn[Ze[e]]=e;const yt={};for(const[e,t]of Object.entries(Pl))typeof t.allowedChildrens=="string"?yt[e]=t.allowedChildrens:yt[e]=new Set(t.allowedChildrens);function Rl(e){const t={allowBooleanAttributes:!0,ignoreAttributes:!1,attributeNamePrefix:"",textNodeName:"$text",parseAttributeValue:!0,processEntities:!1,parseTagValue:!1,ignoreDeclaration:!0,alwaysCreateTextNode:!0,isArray:(r,n,s,i)=>!i&&r in Yn,attributeValueProcessor:(r,n)=>Cs(n),tagValueProcessor:(r,n)=>Cs(n)};return new ki.XMLParser(t).parse(e)}async function rf(e,t){const r=await yi(e),n={};console.log("unzipping folder",r,"path",t);for(const s in r.entries){const i=r.entries[s];if(i.isDirectory)continue;const o=rn(rn(s,t),"/");if(o.startsWith("."))continue;const l=_i(o)?await i.arrayBuffer():await i.text();n[o]=l}return n}async function Fl(e){if(typeof e=="string"){var t=new TextEncoder;e=t.encode(e)}const r=await yi(e);for(const n of Object.values(r.entries))return await n.text();throw"unzipFile failed: No Entries"}const Kl=["gstz","zip","catz"],Ul=["gst","gstz","xml","zip","cat","catz","json"];function nf(e){const t=e.lastIndexOf(".");return t===-1?e:e.substring(0,t)}function Rr(e){return e.split(".").pop().toLowerCase()}function _i(e){const t=Rr(e);return Kl.includes(t)}function Ml(e){const t=Rr(e);return!!Ul.includes(t)}const Ss={sharedRules:"shareRule",sharedProfiles:"sharedProfile",sharedInfoGroups:"sharedInfoGroup",sharedSelectionEntries:"sharedSelectionEntry",sharedSelectionEntryGroups:"sharedSelectionEntryGroup"};function fn(e){var t,r;for(let n in e)if(e[n]==="")delete e[n];else if(Ze[n]&&e[n])if(n in Ss){const s=e[n][Ze[n]],i=e[n][Ss[n]];e[n]=[...Array.isArray(s)?s:[],...Array.isArray(i)?i:[]],(t=e[n])==null||t.forEach(fn)}else{const s=e[n][Ze[n]];Array.isArray(s)?(e[n]=s,(r=e[n])==null||r.forEach(fn)):ue(e[n])&&delete e[n]}else Gr.has(n)&&(e[n]=e[n].$text??"");return e}function xi(e,t){const r=yt[t],n=typeof r=="string"?yt[e[r]]:r;for(let s in e)s in Ze&&Array.isArray(e[s])&&(n&&!n.has(s)?delete e[s]:e[s].forEach(i=>xi(i,s)))}const Ns=new Set;function Ii(e,t){let r=yt[t];if(typeof r=="string"){const n=e[r];if(n){const s=zl(n);if(typeof s!="string"||s===r)return Ns;r=yt[s]}}return r||Ns}function Ts(e){const t=Rl(e);fn(me(t));const r=t.catalogue?"catalogue":"gameSystem";t.catalogue?(t.playable=1,t.id=bo(t.catalogue.id),t.include=[1e3]):(t.playable=0,t.id=1e3);const n=t[r];return t.name=n.name,t.short=Eo(n.name),t.playable=!n.library,t.version=n.battleScribeVersion,t.nrversion=n.revision,t}async function Vl(e,t){switch(t=Rr(t),t){case"xml":case"cat":case"gst":return Ts(e);case"zip":case"catz":case"gstz":return Ts(await Fl(e));case"json":return JSON.parse(e);default:throw new Error("Extension not supported "+t)}}function Ql(e){return Ze[e]}function zl(e){return Yn[e]}const Ci=new Set(["?xml","$text","_"]);function Wl(e){for(const[t,r]of Object.entries(e))Gr.has(t)?e[t]=Array.isArray(r)?r:[r]:Array.isArray(r)&&!Ci.has(t)&&(e[t]=[{[Ql(t)]:r}])}function Dl(e){return as(e,t=>{typeof t=="object"&&Wl(t)}),as(e,t=>{if(typeof t=="object")for(const[r,n]of Object.entries(t))Array.isArray(n)||Ci.has(r)||Gr.has(r)||ue(n)||(t[`_${r}`]=n,delete t[r])}),e}function ql(e){const t=JSON.parse(ln(e));Dl(t);const r={textNodeName:"$text",format:!0,attributeNamePrefix:"_",ignoreAttributes:!1,suppressBooleanAttributes:!1,suppressEmptyNode:!0};return t.gameSystem&&(t.gameSystem._xmlns="http://www.battlescribe.net/schema/gameSystemSchema"),t.catalogue&&(t.catalogue._xmlns="http://www.battlescribe.net/schema/catalogueSchema"),`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
`+new ki.XMLBuilder(r).build(t)}const Si=[{type:"publications",name:"Publications",icon:"publication.png"},{type:"costTypes",name:"Cost Types",icon:"cost.png"},{type:"profileTypes",name:"Profile Types",icon:"profileType.png"},{type:"categoryEntries",name:"Category Entries",icon:"category.png"},{type:"forceEntries",name:"Force Entries",icon:"force.png"},{type:"sharedSelectionEntries",name:"Shared Selection Entries",icon:"selectionEntryLink.png"},{type:"sharedSelectionEntryGroups",name:"Shared Selection Entry Groups",icon:"shared_groups.png"},{type:"sharedProfiles",name:"Shared Profiles",icon:"shared_profiles.png"},{type:"sharedRules",name:"Shared Rules",icon:"shared_rules.png"},{type:"sharedInfoGroups",name:"Shared Info Groups",icon:"infoGroup.png"},{type:"rules",links:"infoLinks",name:"Root Rules",icon:"rule.png"},{type:"selectionEntries",links:"entryLinks",name:"Root Selection Entries",icon:"selectionEntry.png"}],Zl=[{type:"catalogueLinks",name:"Catalogue Links",icon:"catalogueLink.png"},...Si];function Ke(e,t){switch(e){case"selectionEntry":return"Entry";case"selectionEntryGroup":return"Group";case"selectionEntryLink":return"Entry (link)";case"selectionEntryGroupLink":return"Group (link)";case"force":return"Force";case"category":return"Category";case"categoryLink":return"Category (link)";case"catalogueLink":return"Catalogue (link)";case"publication":return"Publication";case"costType":return"Cost Type";case"costs":return"Cost";case"link":return"Link";case"profileType":return"Profile Type";case"profile":return"Profile";case"rule":return"Rule";case"infoLink":return"Info (link)";case"infoGroup":return"Info Group";case"profileLink":return"Profile";case"ruleLink":return"Rule (link)";case"infoGroupLink":return"Info Group (link)";case"characteristic":return"Characteristic";case"characteristicType":return"Characteristic Type";case"constraint":return"Constraint";case"condition":return"Condition";case"modifier":return"Modifier";case"modifierGroup":return"Modifier Group";case"repeat":return"Repeat";case"conditionGroup":return"Condition Group";case"catalogue":return"Catalogue";case"gameSystem":return"Game System";default:return console.warn("unknown getTypeLabel key",e),e}}function Ie(e,t){switch(e){case"selectionEntries":return"selectionEntry";case"selectionEntryGroups":return"selectionEntryGroup";case"sharedSelectionEntries":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntry";case"sharedSelectionEntryGroups":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntryGroup";case"entryLinks":return t!=null&&t.target?t.target.editorTypeName+"Link":"link";case"forceEntries":return"force";case"categoryEntries":return"category";case"categoryLinks":return"categoryLink";case"catalogueLinks":return"catalogueLink";case"publications":return"publication";case"costTypes":return"costType";case"costs":return"cost";case"profileTypes":return"profileType";case"profiles":return"profile";case"rules":return"rule";case"characteristics":return"characteristic";case"characteristicTypes":return"characteristicType";case"sharedProfiles":return"profile";case"sharedRules":return"rule";case"sharedInfoGroups":return"infoGroup";case"infoLinks":return t?`${t.type||"info"}Link`:"infoLink";case"infoGroups":return"infoGroup";case"associations":return"association";case"constraints":return"constraint";case"conditions":return"condition";case"modifiers":return"modifier";case"modifierGroups":return"modifierGroup";case"repeats":return"repeat";case"conditionGroups":return"conditionGroup";case"catalogue":case"gameSystem":return e;default:return console.warn("unknown getTypeName key",e),e}}function Yl(e,t=!0,r=!0){var o,l,a,c,u;const n=e.parentKey,s=[];switch(n){case"infoLinks":["profiles","sharedProfiles"].includes((o=e.target)==null?void 0:o.parentKey)&&r&&s.push(e.target.typeName);break;case"sharedProfiles":case"profiles":r&&s.push(e.typeName);break;case"selectionEntries":case"sharedSelectionEntries":e.isEntry()&&e.getType()!=="upgrade"&&r&&s.push(e.getType());break;case"entryLinks":e.target&&e.isEntry()&&e.getType()!=="upgrade"&&r&&s.push(e.getType());break;case"modifierGroups":s.push(`(${(((l=e.modifiers)==null?void 0:l.length)||0)+(((a=e.modifierGroups)==null?void 0:a.length)||0)})`);break}const i=(((c=e.links)==null?void 0:c.length)??0)+(((u=e.other_links)==null?void 0:u.length)??0);if(i){const f=i===1?"":"s";s.push(`(${i||0} ref${f})`)}return e.comment&&e.comment[0]&&s.push("# "+e.comment),e.isCollective&&e.isCollective()&&s.push("(collective)"),s.join(" ")}function dt(e){const t=e.parentKey;switch(t){case"selectionEntries":case"sharedSelectionEntries":case"selectionEntryGroups":case"sharedSelectionEntryGroups":case"entryLinks":case"forceEntries":case"categoryLinks":case"categoryEntries":case"sharedInfoGroups":case"infoGroups":case"catalogueLinks":case"publications":case"profileTypes":case"catalogue":case"gameSystem":case"rules":case"sharedRules":case"costs":case"costTypes":case"sharedProfiles":case"profiles":case"characteristics":case"characteristicTypes":return e.getName();case"modifiers":return Wo(ct(e),e);case"repeats":{const r=e,n=ct(e);return n||console.error("no parent for repeat",e),`Repeat ${r.repeats} times for every ${r.value} ${qe(n,r.field)} in ${qe(n,r.scope)} of ${r.childId?qe(n,r.childId):" any"}`}case"conditions":return hs(ct(e),e);case"constraints":return hs(ct(e),e);case"modifierGroups":return"Modify...";case"conditionGroups":return`${e.type.toUpperCase()}`;case"infoLinks":return e.target?dt(e.target):e.getName();case"associations":return`${e.label}`;default:return console.log(t,e),t}}function xr(e,t){t(e);const r=[e];for(;r.length;){const n=r.pop();for(const s of Object.keys(n)){if(!wt.has(s)||Gr.has(s))continue;const i=n[s];if(i&&Array.isArray(i))for(const o of i)r.push(o),t(o,s,n)}}}function Xl(e){const t=e.parent;if(t){const r=t[e.parentKey],n=r.indexOf(e);n!==-1&&r.splice(n,1)}}async function er(e,t){const r=e.catalogue;xr(e,(n,s,i)=>{if(r.removeFromIndex(n),n.isLink&&n.isLink()&&(r.unlinkLink(n),delete n.target),n instanceof Ot&&n.typeId){const o=n.catalogue.findOptionById(n.typeId);o&&n.catalogue.removeRef(n,o)}if(n instanceof He){const o=n.scope,l=n.childId;if(!Vn.has(o)){const a=n.catalogue.findOptionById(n.scope);a&&n.catalogue.removeOtherRef(n,a)}if(!Vo.has(l)){const a=n.catalogue.findOptionById(n.childId);a&&n.catalogue.removeOtherRef(n,a)}}delete n.parent,delete n.catalogue}),t&&e instanceof Qn&&await r.reload(t)}async function It(e,t,r,n){let s=!1;for(const i of Array.isArray(e)?e:[e])xr(i,(o,l,a)=>{if(ue(o)){if(o.parent=a||r,o.catalogue=t,t.addToIndex(o),o.isLink()&&t.updateLink(o),o instanceof Ot&&o.typeId){const c=o.catalogue.findOptionById(o.typeId);c&&o.catalogue.addRef(o,c)}o instanceof Qn&&o.targetId&&(s=!0),t.refreshErrors(o)}});s&&r&&await(r.catalogue||r).reload(n)}function _e(e){if(!e.parent&&!e.isCatalogue())return[{id:e.id,key:e.parentKey,index:0}];const t=[];for(;e.parent;){const r=e.parent||e.catalogue;t.push({key:e.parentKey,index:r[e.parentKey].indexOf(e),id:e.id}),e=e.parent}return t.reverse(),t}function sf(e){if(!e.parent&&!e.isCatalogue())return[{id:e.id,key:e.parentKey,index:0}];const t=[];do{const r=e.parent||e.catalogue;r?t.push({name:e.getName(),type:e.editorTypeName,label:e.getTypeName(),display:dt(e),key:e.parentKey,index:r[e.parentKey].indexOf(e),id:e.id}):t.push({name:e.getName(),display:dt(e),type:"catalogue",key:"catalogue",id:e.id,index:0}),e=e.parent}while(e);return t.reverse(),t}function Ls(e,t,r){let n=e;for(let o=0;o<t.length-1;o++){const l=t[o];n=n[l.key][l.index]}const s=t[t.length-1];return n[s.key]||(n[s.key]=[]),n[s.key].splice(s.index,0,r),n}function jl(e,t){let r=e;for(const n of t){if(r=r[n.key],!r)return;r=r[n.index]}return r}function Xr(e,t){let r=e;const n=t[t.length-1];for(const o of t)o!==n&&(r=r[o.key][o.index]);const i=r[n.key].splice(n.index,1)[0];if(!i)throw new Error("popAtEntryPath failed");return i}function Os(e,t){const r={};xr(t,(n,s,i)=>{if(n.id){const o=n.id,l=e.generateNonConflictingId();n.id=l,r[o]=l}}),xr(t,(n,s,i)=>{n instanceof He&&(n.scope in r&&(n.scope=r[n.scope]),n.childId in r&&(n.childId=r[n.childId])),n instanceof Mn&&n.field in r&&(n.field=r[n.field])})}function Hl(e,t,r){if(e.isCatalogue()){if(r)switch(t){case"sharedRules":case"rules":return["sharedRules","rules"].includes(r)?r:"";case"sharedProfiles":case"profiles":return["sharedProfiles","profiles"].includes(r)?r:"";case"sharedInfoGroups":case"infoGroups":return["sharedInfoGroups","infoGroups"].includes(r)?r:"";case"sharedSelectionEntries":case"selectionEntries":return["sharedSelectionEntries","selectionEntries"].includes(r)?r:"";case"sharedSelectionEntryGroups":case"selectionEntryGroups":return["sharedSelectionEntryGroups","selectionEntryGroups"].includes(r)?r:"";default:return t}}else switch(t){case"sharedRules":return"rules";case"sharedProfiles":return"profiles";case"sharedInfoGroups":return"infoGroups";case"sharedSelectionEntries":return"selectionEntries";case"sharedSelectionEntryGroups":return"selectionEntryGroups";default:return t}return t}class Jl{get[Symbol.toStringTag](){return"ObjectNoObserve"}}function $l(){return new Jl}const ec={};function tc(e,t,r){if(t in e)return e[t];const n=class extends z{get parentKey(){return t}get editorTypeName(){return Ie(t,this)}toString(){return`${this.editorTypeName} - ${this.getName()}`}};return n.prototype.parentKey,Object.setPrototypeOf(n.prototype,Object.getPrototypeOf(r)),e[t]=n.prototype,n.prototype}function rc(e,t,r){Object.setPrototypeOf(r,tc(e,t,r))}const pr={"*":z.prototype,catalogue:_r.prototype,catalogueLinks:Qn.prototype,gameSystem:_r.prototype,forceEntries:zr.prototype,forces:zr.prototype,force:zr.prototype,categoryEntries:Lt.prototype,category:Lt.prototype,categories:Lt.prototype,link:Vt.prototype,infoLinks:Fo.prototype,categoryLinks:ii.prototype,entry:Mr.prototype,selectionEntries:Mr.prototype,entryLinks:Vt.prototype,sharedSelectionEntries:Mr.prototype,group:Vr.prototype,selectionEntryGroups:Vr.prototype,sharedSelectionEntryGroups:Vr.prototype,sharedRules:ur.prototype,rules:ur.prototype,rule:ur.prototype,profileTypes:Uo.prototype,sharedProfiles:Ot.prototype,profiles:Ot.prototype,profile:Ot.prototype,characteristics:ds.prototype,characteristic:ds.prototype,characteristicTypes:z.prototype,characteristicType:z.prototype,sharedInfoGroups:Dr.prototype,infoGroups:Dr.prototype,infoGroup:Dr.prototype,publications:ps.prototype,publication:ps.prototype,repeats:He.prototype,conditions:He.prototype,constraints:an.prototype,modifiers:Mn.prototype,modifierGroups:oi.prototype};Object.values(pr);function nc(e){return e in pr?pr[e]:pr["*"]}function hn(e,t){const r=nc(t);return r&&(Object.setPrototypeOf(e,r),e.post_init&&e.post_init(),globalThis.isEditor&&rc(e.keyInfoCache||ec,t,e)),e}function St(e){const t=[e];for(;t.length;){const r=t.pop();for(const n of Object.keys(r)){const s=r[n];if(ue(s))if(Array.isArray(s)){if(s.length&&ue(s[0]))for(let i=s.length;i--;){const o=s[i];ls(o)&&(hn(o,n),t.push(o))}}else ls(s)&&(hn(s,n),t.push(s))}}}const Bs=Kn("catalogues",{state:()=>({dict:{},version:1}),persist:{storage:globalThis.localStorage},actions:{get(e){return e in this.dict||(this.dict[e]={}),this.dict[e]},setEdited(e,t){this.get(e).edited=t},getEdited(e){return this.get(e).edited},setErrors(e,t){this.get(e).errors=t},getErrors(e){return this.get(e).errors},getDependents(e){return this.get(e).dependents},updateCatalogue(e){var s;const t=e.id,r=e.gameSystemId||e.id,n=(s=e.catalogueLinks)==null?void 0:s.map(i=>({targetId:i.targetId===r?r:`${r}-${i.targetId}`,sourceId:t===r?r:`${r}-${t}`,importRootEntries:i.importRootEntries,sourceName:e.name}));e.gameSystemId&&(n==null||n.push({targetId:e.gameSystemId,sourceId:t,importRootEntries:!0,sourceName:e.name})),this.setDependencies(t,n)},setDependencies(e,t){var n;const r=(n=this.get(e))==null?void 0:n.dependencies;if(r)for(const s of r)this.removeDependent(s.targetId,s);if(t)for(const s of t)this.addDependent(s.targetId,s);this.get(e).dependencies=t||[]},setDependents(e,t){this.get(e).dependents=t},addDependent(e,t){const r=this.get(e);r.dependents||(r.dependents=[]),r.dependents.push(t)},removeDependent(e,t){var n;const r=(n=this.get(e))==null?void 0:n.dependents;if(r){const s=r.findIndex(i=>i.sourceId===t.sourceId);s>=0&&r.splice(s,1)}}}});function Ni(e){return e.replaceAll("\\","/").split("/").slice(0,-1).join("/")}function Ti(e){const t=e.replaceAll("\\","/").split("/");return t[t.length-1]}async function sc(e){return electron?await electron.invoke("getFolderFiles",e):[]}async function of(e){if(electron)try{const t=[];if(!await electron.invoke("isDirectory",e))return[];const n=await electron.invoke("readdirSync",e);for(const s of n){const i=`${e}/${s}`;try{if(await electron.invoke("isDirectory",i)){const l={name:s,path:i};t.push(l)}}catch(o){console.error("Error reading dir:",i,o);continue}}return t}catch(t){throw console.error("Error:",t),t}}async function Ps(e,t){if(!electron)return;const r=Ni(e);await electron.invoke("mkdirSync",r,{recursive:!0}),await electron.invoke("writeFileSync",e,t)}async function af(e){if(electron)return await electron.invoke("unlinkSync",e)}async function lf(e){if(electron)return electron.invoke("showOpenDialog",e)}async function cf(e){if(electron)return electron.invoke("showMessageBoxSync",e)}async function uf(){if(electron)return electron.invoke("closeWindow")}async function df(e){if(electron)return await electron.invoke("getPath",e)}async function ic(e){electron&&await electron.invoke("mkdirSync",e,{recursive:!0})}let Gs=!1;const Rs={};async function oc(e,t){electron&&(Gs||(Gs=!0,electron.on("fileChanged",(r,n,s)=>{const i=Rs[n];i&&i(n,s)})),await electron.invoke("chokidarWatchFile",e),Rs[e]=t)}async function ac(e){return electron?await electron.invoke("getFolderRemote",e):null}const lc={props:{errors:{type:Array,default:[]},showNumber:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1}},data(){return{show:!1}},methods:{display(){if(!this.clickable)return;this.show=!0;const e=()=>{this.show=!1};addEventListener("click",e,{capture:!0,once:!0})},errorToText(e){return ko(e.msg)},errorExtraText(e){return e.extra},getErrorImage(e){let t=e.severity==="warning",r=!e.severity||e.severity==="error",n=!e.severity||e.severity==="info";return r?"assets/icons/error_exclamation.png":t?"assets/icons/warning_exclamation.png":n?"assets/icons/info_exclamation.png":"assets/icons/error_exclamation.png"},gotoError(e){const t=$t();e.source?t.goto(e.source):console.warn("Couldn't goto error: no source attached"),this.show=!1}},computed:{computedShowNumber(){return!(this.showNumber===!1||this.showNumber===void 0||this.showNumber===null)},getImage(){let e=this.errors.find(n=>n.severity==="warning"),t=this.errors.find(n=>!n.severity||n.severity==="error"),r=this.errors.find(n=>!n.severity||n.severity==="info");return t?"assets/icons/error_exclamation.png":e?"assets/icons/warning_exclamation.png":r?"assets/icons/info_exclamation.png":"assets/icons/error_exclamation.png"},numErrors(){var e;return((e=this.errors)==null?void 0:e.length)||0},errorText(){return lr(this.errors||[],e=>e.msg).map(e=>`• ${this.errorToText(e)}
`).join("").trim()}}};const cc=["title"],uc=["src"],dc={key:0,class:"ml-4px align-middle"},fc={key:0,class:"fixed bg text"},hc=["onClick"],pc=["src"],gc={key:0,class:"grey"};function mc(e,t,r,n,s,i){return i.numErrors?(k(),S("span",{key:0,class:"cursor-pointer my-auto",title:i.errorText},[T("span",{onClick:t[0]||(t[0]=o=>i.display()),class:"gap-4px"},[T("img",{src:i.getImage,class:"my-auto align-text-bottom"},null,8,uc),i.computedShowNumber?(k(),S("span",dc,W(i.numErrors),1)):N("",!0)]),s.show?(k(),S("div",fc,[(k(!0),S(oe,null,Re(r.errors,o=>(k(),S("div",{onClick:l=>i.gotoError(o),class:"border py-3px px-10px hover-darken"},[T("img",{src:i.getErrorImage(o),class:"my-auto align-text-bottom"},null,8,pc),G(" "+W(i.errorToText(o))+" ",1),i.errorExtraText(o)?(k(),S("span",gc,W(i.errorExtraText(o)),1)):N("",!0)],8,hc))),256))])):N("",!0)],8,cc)):N("",!0)}const yc=vt(lc,[["render",mc],["__scopeId","data-v-63518030"]]);const Ac={},vc={style:{width:"100%",height:"0px","text-align":"left",margin:"0",padding:"0"}};function wc(e,t){return k(),S("hr",vc)}const Li=vt(Ac,[["render",wc],["__scopeId","data-v-43dd2251"]]),ft=Kn("editor-ui",{state:()=>({catalogues:{}}),persist:{storage:globalThis.localStorage},actions:{collapse_level(e){var t;if(e>=0){const r=`depth-${e} collapsible-box opened`,n=document.documentElement.getElementsByClassName(r);if(n!=null&&n.length)for(const s of n)(t=ce(s))==null||t.close()}},collapse_all(){this.collapse_level(1),this.collapse_level(0)},collapse_deepest(){const e="collapsible-box opened",t=document.documentElement.getElementsByClassName(e);let r=-1;if(t!=null&&t.length)for(const n of t)n.classList.forEach(s=>{s.startsWith("depth-")&&(r=Math.max(r,parseInt(s.split("-")[1])))});this.collapse_level(r)},set_state(e,t){function r(i,o,l=0){const a=`depth-${l} collapsible-box opened`,c=i.getElementsByClassName(a);if(c!=null&&c.length)for(const u of c){const f=Ve(ce(u)),d=f.parentKey,h=f.parent;let m=o;if(h){const p=h[d];if(!p||!Array.isArray(p))continue;const y=p.indexOf(f);d in o||(o[d]={});const A=o[d];y in A||(A[y]={}),m=A[y]}else{const p=[...u.classList].filter(y=>wt.has(y));for(const y of p)o[y]={},o[y][0]={},m=o[y][0]}r(u,m,l+1)}}const n={};r(document.documentElement,n);const s={...t,open:n};return this.$state.catalogues[e]=s,n},get_data(e){const t=this.$state.catalogues[e];return t||{}},get_root(e,t){let r=this.$state.catalogues[e];return!(!r||(r=r.open[t],!r))},get(e,t){if(!t.length)return!1;let r=this.$state.catalogues[e];if(!r)return!1;let n=r.open[t[0].key];if(!n||(n=n[0],!n))return!1;for(const s of t){const i=n[s.key];if(!i)return!1;const o=i[s.index];if(!o)return!1;n=o}return!0}}}),bc={name:"ContextMenu",data(){return{left:100,top:100,bottom:100,right:100,width:200,height:200,visible:!1,isDown:!1,isRight:!1,payload:void 0}},props:{modelValue:{type:Boolean,default:!0}},methods:{do_update(e){var r,n;if(this.width=((r=this.el)==null?void 0:r.clientWidth)||this.width,this.height=((n=this.el)==null?void 0:n.clientHeight)||this.height,this.top=e.clientY,this.left=e.clientX,this.avoid){const s=this.avoid,i=s.offsetLeft;this.left=i+s.offsetWidth;var t=e.target.getBoundingClientRect();this.top=t.top-1}this.left=Math.min(this.left,window.innerWidth-this.width)+2,this.top=Math.min(this.top,window.innerHeight-7-this.height),this.bottom=window.innerHeight-this.top,this.right=window.innerWidth-this.left},update(e){e.preventDefault(),this.do_update(e),this.$nextTick(()=>{this.do_update(e)})},show(e,t){this.payload=t,this.visible=!0,this.update(e),this.$emit("update:modelValue",!0)},close(){this.visible=!1,this.$emit("update:modelValue",!1)}},mounted(){addEventListener("click",this.close,{capture:!0}),addEventListener("contextmenu",this.close,{capture:!0}),addEventListener("scroll",this.close,{capture:!0})},unmounted(){addEventListener("click",this.close,{capture:!0}),removeEventListener("contextmenu",this.close,{capture:!0}),removeEventListener("scroll",this.close,{capture:!0})},computed:{el(){return this.$refs["context-menu"]},style(){const e={};return e.top=`${this.top}px`,e.left=`${this.left}px`,e},avoid(){var e;return(e=this.$el.parentElement)==null?void 0:e.closest(".context-menu")}}};function Ec(e,t,r,n,s,i){return sn((k(),J(xo,{to:"#dialogs"},[sn(T("li",{ref:"context-menu",class:"context-menu",style:_o(i.style)},[Er(e.$slots,"default",{payload:s.payload})],4),[[on,s.visible]])],512)),[[on,s.visible]])}const Oi=vt(bc,[["render",Ec]]),kc={name:"EditorCollapsibleBox",props:{payload:{},collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},titleCollapse:{type:Boolean,default:!0},group:{type:Array,required:!0},modelValue:{default:!0},altclickable:{default:!1},vshow:{default:!1,type:Boolean}},data(){return{collapsed:!0,initiated:this.vshow,selected:!1,alt:!1}},created(){this.defcollapsed==!1&&this.collapseSwitch()},setup(){return{store:$t()}},mounted(){var e;addEventListener("keydown",this.handleKeyDown),addEventListener("keyup",this.handleKeyUp),this.$el.vnode=this,(e=this.group)==null||e.push(this),this.init(this.payload)},updated(){this.$el.vnode=this},unmounted(){var e;if(removeEventListener("keydown",this.handleKeyDown),removeEventListener("keyup",this.handleKeyUp),this.group&&Array.isArray(this.group)){const t=this.group.indexOf(this);t!==-1&&((e=this.group)==null||e.splice(t,1))}},watch:{payload(e){this.init(e)},collapsed(e){e!==this.modelValue&&this.$emit("update:modelValue",e)},modelValue(e){e!=this.collapsed&&(this.collapsed=e)}},computed:{dropdownSrc(){let e=2,t=[`assets/icons/right${e}.png`,`assets/icons/down${e}.png`],r=this.collapsed?0:1;return t[r]},hide(){return!this.collapsible},nocollapse(){return!this.collapsible},box(){return!this.nobox},opened(){return this.collapsible&&!this.collapsed}},methods:{cut(){console.log("cut")},copy(){console.log("copy")},paste(){console.log("paste")},init(e){var t;if((e==null?void 0:e.select)!==void 0){if(e.select){const r=(t=this.$parent)==null?void 0:t.$parent;r.open&&r.open(),this.store.do_select(null,this,this.group),this.store.scrollto(Ve(this))}e==null||delete e.select}},select(){this.selected=!0,this.store.select(this,()=>this.unselect(),this.payload)},unselect(){this.selected=!1},open(){this.initiated=!0,this.collapsed&&(this.collapsed=!1,this.$emit("open"))},async open_recursive(){var t;this.open(),await this.$nextTick();const e=this.$el;if(e)for(const r of e.getElementsByClassName("collapsible-box"))await((t=ce(r))==null?void 0:t.open_recursive())},close(){this.initiated=!0,this.collapsed||(this.collapsed=!0,this.$emit("close"))},async close_recursive(){var t;const e=this.$el;if(e)for(const r of e.getElementsByClassName("collapsible-box"))(t=ce(r))==null||t.close_recursive();await this.$nextTick(),this.close()},do_select(e){this.store.do_select(e,this,this.group),this.$el.focus()},do_rightcllick_select(e){this.store.do_rightclick_select(e,this,this.group)},async collapseSwitch(e){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?e?await this.open_recursive():this.open():e?await this.close_recursive():this.close()},handleKeyDown(e){e.key==="Alt"&&(this.alt=!0,e.preventDefault())},handleKeyUp(e){e.key==="Alt"&&(this.alt=!1,e.preventDefault())}}};const _c=["src"],xc={key:1,class:"content"};function Ic(e,t,r,n,s,i){return k(),S("div",{class:De([{box:i.box,nobox:r.nobox,nocollapse:i.nocollapse,collapsed:s.collapsed,opened:i.opened},"collapsible-box"]),onContextmenu:t[8]||(t[8]=(...o)=>i.do_rightcllick_select&&i.do_rightcllick_select(...o))},[r.notitle?N("",!0):(k(),S("h3",{key:0,class:De(["title hover-darken",{selected:s.selected,arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&s.collapsed,alt:s.alt&&r.altclickable}]),onClick:[t[1]||(t[1]=Se((...o)=>i.do_select&&i.do_select(...o),["stop"])),t[2]||(t[2]=Se(o=>e.$emit("ctrlclick"),["ctrl","stop"])),t[3]||(t[3]=Se(o=>e.$emit("altclick"),["alt","stop"]))],onDblclick:t[4]||(t[4]=o=>i.collapseSwitch(o.shiftKey)),onPaste:t[5]||(t[5]=(...o)=>i.paste&&i.paste(...o)),onCopy:t[6]||(t[6]=(...o)=>i.paste&&i.paste(...o)),onCut:t[7]||(t[7]=(...o)=>i.paste&&i.paste(...o))},[T("div",{class:"arrow-wrap",onClick:t[0]||(t[0]=Se(o=>i.collapseSwitch(o.shiftKey),["stop"]))},[T("img",{class:De([{hide:i.hide},"arrow icon"]),src:i.dropdownSrc},null,10,_c)]),Er(e.$slots,"title",{},void 0,!0)],34)),s.initiated?sn((k(),S("div",xc,[Er(e.$slots,"content",{},void 0,!0)],512)),[[on,!s.collapsed||!r.collapsible]]):N("",!0)],34)}const Bi=vt(kc,[["render",Ic],["__scopeId","data-v-af097471"]]),Cc={name:"CatalogueEntry",components:{ContextMenu:Oi,EditorCollapsibleBox:Bi},setup(){return{store:$t(),state:ft(),settings:ut()}},props:{depth:{type:Number,default:0},label:{type:String,required:!0},catalogue:{type:Object,required:!0},path:{type:Array},item:{type:Object}},data(){return{groups:{},contextmenuopen:!1,open:!1,open_categories:void 0,name:""}},mounted(){if(this.catalogue){this.catalogue.processForEditor();const e=[...this.path||[],{key:`label-${this.label}`,index:0}];this.open=this.state.get(this.catalogue.id,e)}},methods:{menu(e){return{show:(t,r)=>{this.contextmenuopen=!0,this.$nextTick(()=>{var n;(n=this.$refs[e])==null||n.show(t,r)})},close:(t,r)=>{var n;(n=this.$refs[e])==null||n.close(t,r),this.contextmenuopen=!1}}}},computed:{contextmenu(){return this.menu("contextmenu")},nestedcontextmenu(){return this.menu("nestedcontextmenu")}}},Sc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhT8TRRFFJClELLZQGw2IilhqFESIEKKCV+HuxsRAdg27ERtLwVaw8Gi8ChtrbS1sBUHwALG1sVK0kbD+sxEShAgODPPxZt5j5g0EDrOm5Vb3gGXnncRYVJuZndNqX6ihnma6COmmmxuOx2NUHJ93VKn1NqKy+N9oTC65JlRpwkNmzskLLwoPrOVzineFw+aynhQ+E+525ILCD0o3ivyqOO1zQGWGnanEiHBYWEuXsVHG5rJjCfcLtyctW/IDM0VOKl5XbGVXzZ97qhc2LNnTk0qX2cYY40wQR8NglQxZ8kRktUVxSch+tIK/1ffHxWWIK4MpjlFWsNB9P+oPfnfrpvp6i0kNUah59rz3DqjdhsKW530deV7hGIJPcGmX/CuHMPgh+lZJaz+Apg04vyppxg5cbELLY053dF8KygykUvB2Kt80C6EbqJ8v9vazz8k9TElXsWvY24fOtGQvVHh3XXlvf57x+yP6DVyYcp4hKAl2AAAA5FBMVEVVWVszNTY1NzdKSktaWlpJTE5HSEhTU1NVVVVUVFRSUlIpKitRUVFNTU1PT08kJSY9PT1HR0fu7u7ExMRGRkZNUFI8PD1JSUlzc3N0dHSurq7q6uptbW02OTpMTEygoKDS0tJcXFw0NDV5eXnf399wcHAzMzQcHh5WVlbc3Ny3t7caGxxHS0wdHh/n5+fFxcUjJCUsLS1KSkrDw8OxsbE7OztBQUFQUFBDQ0M8PDzH0NMKCgpeXl5dXV1ZWVlCQkKnrrJSVlcBAQEICAkSExMcHR0bHBwREhLL1Nizu7+vt7oAAABxoPDUAAAATHRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////8Ano3kzAAAAAlwSFlzAAAuIgAALiIBquLdkgAAALlJREFUKFNNyGkXgUAAheGhiJqpRLLvlCXGUJItspT+//9xmuS4H+55zwMiOpDJpEU/y7Ask6VJIZfnCkU+n/uBAJEoIiikIMklRVHKFVn6glrVavVGs1VVvxC1OxB2e/123BSiARyOxhOaCejGdFbQaSYwNzrImNOMYWFyaLlCvLlIAK8JQZst0sgax4AtyyY7xxE1e2/hCLgH2yEcezydeeJcDi7wrjf//pAEAT9f/u3qgSB8/y0MPiLnM6aRQB6+AAAAAElFTkSuQmCC",Pi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8ziBhJZiFZ3AVKUUKyZCgpahqjxmPh3jtmqLl3pntHNpbKVll4bLwWNtZsLWyVUh4lWxsrYiNd/3NHzaRGOXU6v75zvq9zvgPBg4xpuZU9YNl5JzYW0RIzs1r1M1XU0Ugtnbrp5oaj0QnKjo9bAmq96VZZ/G/UJxddEwKa8JCZc/LCC8IDq/mc4h3hsLmkJ4VPhbscuaDwvdKNAr8oTvscVJlhJx4bEQ4La+kSNkrYXHIs4X7htqRlS34wUeCk4jXFVmbF/LmnemFo0Z6eUrrMVsYYZ5IoGgYrLJMhT7estiguMdmPlPG3+P6ouAxxLWOKY5QsFrrvR/3B727dVF9vISkUgaonz3trh+ot+Nr0vM9Dz/s6gopHuLCL/uwBDL6LvlnU2vahYR3OLouasQ3nG9D8kNMd3ZcqZAZTKXg9kW+agaZrqJ0r9Pazz/EdxKWriSvY3YOOtGTPl3l3TWlvf57x+yPyDUN6cpTX8RfMAAAAmVBMVEVAQUE9PT1YWFg9Pj5VVVVUVFQrKytZWVkpKSpERERRUVFQUFBDQ0NYWVo+Pz9TU1NSUlI4OTlXV1cgISFdXV04ODk4ODhRUlMhIiInJycuLi5KSkpJSUkoKCk7OztBQUE8PDzj5ugLCwtaWlpeXl5CQkK/wcNdX18BAQEJCQkUFRUfICAuLy8fHx8TFBTn6uzNz9HIyswAAABWGAQaAAAAM3RSTlP//////////////////////////////////////////////////////////////////wBxnr2OAAAACXBIWXMAAC4hAAAuIQEHW/z/AAAAmUlEQVQoU03MyRKCMBBF0RDSBBUICMgQAUFlUBTM/3+clbRF+TZ96yyaKBzZAo9FqYWFYDMGYJtEcDgD6pg04O72DA6eu4GP4G+gAsEgDEwiqOgIEdYP4gRiLITU4nBKTWrIcqGfhnmGUJRSajjLstBQ1XWD0FzqSpG2azwprreEh9K7dy3ph3F6PN15rl7vaRx6sqyfv63LF52MIsEsSTP4AAAAAElFTkSuQmCC";const Gi=e=>($s("data-v-d9d40e67"),e=e(),ei(),e),Nc=Gi(()=>T("img",{src:Sc},null,-1)),Tc={class:"gray"},Lc=Gi(()=>T("img",{class:"pr-4px",src:Pi},null,-1)),Oc={class:"gray"};function Bc(e,t,r,n,s,i){const o=at("EditorCollapsibleBox"),l=Li,a=at("ContextMenu");return k(),S("div",{class:"item unselectable",onContextmenu:t[3]||(t[3]=Se((...c)=>i.contextmenu.show&&i.contextmenu.show(...c),["stop"]))},[lt(o,{nobox:"",group:[],collapsible:!0,class:De([`depth-${r.depth}`,`label-${r.label}`]),vshow:""},{title:le(()=>[Nc,T("span",Tc,W(r.label),1)]),content:le(()=>[Er(e.$slots,"default",{},void 0,!0)]),_:3},8,["class"]),s.contextmenuopen?(k(),J(a,{key:0,modelValue:s.contextmenuopen,"onUpdate:modelValue":t[2]||(t[2]=c=>s.contextmenuopen=c),ref:"contextmenu"},{default:le(({payload:c})=>{var u;return[r.item?(k(),S(oe,{key:0},[r.item?(k(),S("div",{key:0,onClick:t[0]||(t[0]=f=>n.store.goto(r.item))}," Goto "+W(r.item.getName()),1)):N("",!0),lt(l),T("div",{onClick:t[1]||(t[1]=f=>{var d,h;return n.store.create_child("sharedProfiles",r.catalogue,{typeName:(d=r.item)==null?void 0:d.getName(),typeId:(h=r.item)==null?void 0:h.getId()})})},[Lc,G(" Profile "),T("span",Oc," ("+W((u=r.item)==null?void 0:u.getName())+")",1)])],64)):N("",!0)]}),_:1},8,["modelValue"])):N("",!0)],32)}const Pc=vt(Cc,[["render",Bc],["__scopeId","data-v-d9d40e67"]]);function Gc(e){return Math.round(e*100)/100}function Rc(e){let t="";e=ti(e,r=>r.name);for(const r of e)if(r.value!=0){let n="";r.name.length!=0&&(n=" "+r.name),t=`${t}<span class='cost'>${Gc(r.value)}${n}</span>`}return t.length==0?t:`<span class="costList">${t}</span>`}const Fs={link:1,selectionEntry:1,entryLink:1,selectionEntryGroup:2,entryGroupLink:2,constraint:3,forceEntry:4,profile:5,rule:6,infoGroup:7,infoLink:8,modifier:9,modifierGroup:10,categoryLink:11,association:12},Fc=new Set(["force"]),Kc=new Set(["modifierGroups","conditionGroups"]),Uc=new Set(["characteristicTypes","characteristics","costs"]),Mc={name:"CatalogueEntry",components:{ContextMenu:Oi,EditorCollapsibleBox:Bi,CatalogueLabel:Pc},setup(){return{store:$t(),state:ft(),settings:ut()}},props:{item:{type:Object,required:!0},group:{type:Array},forceShowRecursive:{type:Boolean,default:!1},showImported:{type:Boolean},imported:{type:Boolean},depth:{type:Number,default:0},noType:{type:Boolean,default:!1}},data(){return{groups:{},contextmenuopen:!1,open:!1,open_categories:void 0,name:""}},mounted(){if(this.catalogue&&(this.catalogue.processForEditor(),!this.imported&&(this.open=Kc.has(this.item.parentKey)||this.state.get(this.catalogue.id,_e(this.item)),this.item.isCatalogue()))){const e=new Set;for(const t of this.categories)this.state.get_root(this.catalogue.id,t.type)&&e.add(t.type);this.open_categories=e}},watch:{"scope.name"(e){this.name=dt(this.item)},_name:{immediate:!0,handler(e){this.name=e}}},methods:{escapeXml:Io,getTypeName:Ie,getTypeLabel:Ke,getName:dt,getNameExtra:Yl,key(e){return e.id?e.id:(e.$id||(e.$id=`temp-${ot()}`),e.$id)},should_be_grouped(e){return e==="sharedProfiles"},should_be_open(e){var t;return(t=this.open_categories)==null?void 0:t.has(e)},sortable(e){return this.settings.sort==="none"?!1:e?Fc.has(e.editorTypeName)===!1:!0},get_group(e){return e in this.groups||(this.groups[e]=[]),this.groups[e]},ref_count(e){var t;switch(e.editorTypeName){case"category":default:return(t=e.links)==null?void 0:t.length}},async onctrlclick(){this.store.can_follow(this.item)?await this.store.follow(this.item):this.imported?await this.store.goto(this.item):(this.item.links||this.item.other_links)&&(this.store.mode="references")},debug(){console.log(this.item.name,this.item.editorTypeName,Fe(this.item)),globalThis.$debugOption=this.item,globalThis.$debugElement=this},hasRootLink(e,t){var r;return(r=e.entryLinks)==null?void 0:r.find(n=>n.targetId===t.id)},getTypedArray(e,t,r){if(!t)return;const n=t,s=e[n];if(s&&Array.isArray(s))for(const i of s)this.filter_child(i)&&r.push({item:i,type:t});if(this.showImported){const o=["selectionEntries","selectionEntryLinks","rules"].includes(t)?e.importsWithEntries:e.imports;for(const l of o){const a=l[n],c=l.isGameSystem();if(a&&Array.isArray(a))for(const u of a)this.filter_child(u)&&(!c&&u.import===!1||r.push({item:u,type:t,imported:!0}))}}},allowed(e){if(Array.isArray(e)){for(const t of e)if(this.allowedChildren.has(t))return!0;return!1}return this.allowedChildren.has(e)},filter_child(e){return!(!this.forceShow&&this.store.filter&&e.showInEditor!==!0)},sorted(e){if(!this.sortable(this.item))return e;switch(this.settings.sort){default:case"asc":return lr(e,s=>s.item.getName()||"");case"desc":return ti(e,s=>s.item.getName()||"");case"type":return lr(e,s=>(s.item.isProfile()?s.item.getTypeName():s.item.getType())||"")}},grouped(e){return lr(this.sorted(e),t=>{var r,n;return Fs[((n=(r=t.item)==null?void 0:r.target)==null?void 0:n.editorTypeName)??t.item.editorTypeName]??1e3})},groupBy:Js,menu(e){return{show:(t,r)=>{this.contextmenuopen=!0,this.$nextTick(()=>{var n;(n=this.$refs[e])==null||n.show(t,r)})},close:(t,r)=>{var n;(n=this.$refs[e])==null||n.close(t,r),this.contextmenuopen=!1}}},get_field(e){return this.item[e]},get_target_field(e){if(this.item.target)return this.item.target[e]},hideType(e){if(e==="categoryLinks"&&!this.item.isForce()||Uc.has(e))return!0}},computed:{order(){return Fs},_name(){return dt(this.item)},scope(){const e=this.item;if(e.scope){const t=li(e,e.scope);if(t)return Co(t)}},costs(){var n;const e=[],t=this.item.getCatalogue(),r=this.item.getCosts();for(const s of r){const i=((n=t.findOptionById(s.typeId))==null?void 0:n.name)||s.name||s.typeId;i&&e.push({name:i,value:s.value,typeId:s.typeId})}return Rc(e)},childId(){return this.item.childId},child(){if(this.childId)return this.item.getCatalogue().findOptionById(this.childId)},link(){return this.item},iscollapsible(){return this.mixedChildren.length>0},contextmenu(){return this.menu("contextmenu")},nestedcontextmenu(){return this.menu("nestedcontextmenu")},catalogue(){return this.item.getCatalogue()},catalogues(){return this.catalogue.imports},allowedChildren(){return Ii(this.item,this.item.parentKey)},forceShow(){return this.item.showChildsInEditor||this.forceShowRecursive},mixedChildren(){const e=[];for(const t of this.allowedChildren){if(this.hideType(t))continue;const r=this.get_field(t);if(r!=null&&r.length)for(const n of r)this.filter_child(n)&&e.push({type:t,item:n})}if(this.item.isLink()&&this.item.target){const t=[];for(const r of this.allowedChildren){if(this.hideType(r))continue;const n=this.get_target_field(r);if(n!=null&&n.length)for(const s of n)this.filter_child(s)&&t.push({type:r,item:s,imported:!0})}return[...this.grouped(t),...this.grouped(e)]}return this.grouped(e)},categories(){return this.item.isCatalogue()?this.item.isGameSystem()?Si:Zl:[]},groupedCategories(){return this.categories.map(e=>{const t=[];return e.type&&this.getTypedArray(this.item,e.type,t),e.links&&this.getTypedArray(this.item,e.links,t),{...e,items:this.grouped(t)}})}}},Vc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TiyIVBzOICGaoThbEijhqFYpQIdQKrTqYXD+hSUOS4uIouBYc/FisOrg46+rgKgiCHyCuLk6KLlLi/5JCixgPjvvx7t7j7h0gNCpMs7omAE23zVQiLmWyq1L3K0IYgYgYJIVZxpwsJ+E7vu4R4OtdlGf5n/tz9OXyFgMCEvEsM0ybeIN4etM2OO8Ti6yk5IjPicdNuiDxI9dVj984F10WeKZoplPzxCKxVOxgtYNZydSIp4gjOU2nfCHjcY7zFmetUmOte/IXhvP6yjLXaQ4jgUUsQYYEFTWUUYGNKK06KRZStB/38Q+5fplcKrnKYORYQBUaFNcP/ge/u7UKsUkvKRwHQi+O8zEKdO8CzbrjfB87TvMECD4DV3rbX20AM5+k19ta5Ajo3wYurtuaugdc7gCDT4ZiKq4UpCkUCsD7GX1TFhi4BXrXvN5a+zh9ANLUVfIGODgExoqUve7z7p7O3v490+rvB80rcsuoyXg3AAAABmJLR0QA6AAAAADh5zdhAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5wUfFDQeXQWMGwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAG9SURBVCjPhdO/a1NRFMDx7733PfOiFcGhErUoBm1DwFH8DwQnR90KLiI4aAbd/DNsQVCHLh0EqyA4uPofBDMphaRU0FgiLcm75xyH9xrNj9IzHt6Xz708rqOch62nttvrMrh2j+PmwpmEV09uueRwsdvrcvf+Kpc3NljY3iZ4jy0vo60Wp6pVTlYqZFlGlqY8X3sJwDje6XXZXF/n9qWbrNbrALz+XeXLp58z8vcfS5OxqdFsNjmx72A4BCB1VWq12kSYpinfujtTsSmqihfBYix2oyHtdnsibjQamNpkrFrEQeM4rjhYWVkZh51Op/jOdDYWEZKYY5YD4OOIwWAwjr33iAgmc+QYI0Fy1Ao5iZFYnuJwYoyoynw5xBxzhRw0R0TGoXOukHX62CLEGEmiw1wpaz5flqNkdYTElXKckAFEBJ2WpZSDOh5n13HOcWf4da5sEmdjEWHt7A1k8SIhBF74KpX/ZDMr5HLn/8URVWXhapMkSQghkC7Vx/9fVTGz4np5eefNj5/t4GCfZ48eoKok3pNl2ZEvynvP8M+AN28/WDIaDdnr9zlXO8+7rfcs/rpy7JOsnY7s9fv8Bc0zE6+cxDjNAAAAAElFTkSuQmCC",Qc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQCAYAAAAiYZ4HAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bi1IqIu0g4pChumhBVMRRq1CECqFWaNXB5NIvaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIq4uToouU+L+k0CLGg+N+vLv3uHsH+BsVpppd44CqWUY6mRCyuVWh+xVBhNCPUUQkZupzopiC5/i6h4+vd3Ge5X3uz9Gr5E0G+ATiWaYbFvEG8fSmpXPeJ46ykqQQnxOPGXRB4keuyy6/cS467OeZUSOTnieOEgvFDpY7mJUMlXiKOKaoGuX7sy4rnLc4q5Uaa92TvzCc11aWuU5zCEksYgkiBMiooYwKLMRp1Ugxkab9hId/0PGL5JLJVQYjxwKqUCE5fvA/+N2tWZiccJPCCSD4Ytsfw0D3LtCs2/b3sW03T4DAM3Cltf3VBjDzSXq9rcWOgL5t4OK6rcl7wOUOMPCkS4bkSAGa/kIBeD+jb8oBkVsgtOb21trH6QOQoa5SN8DBITBSpOx1j3f3dPb275lWfz9cmHKeGGO3IgAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFChE0NOeyIIsAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB2klEQVQoz43SP2gUURDH8e+83WVFOa5USKF1QMiZaGfAExH/9dYKIlZ2gkGtDATstBEEqzT2kkJDRNBCJVxOzUEakzvRkCLNbS532Z0Zi1tP04gDw6vefH4MIy8W33jW3+VfdezwEepTNQGIu70drl44z54quSq5GeqOuwPQaDT49vMHix+X/ezJExLcHTND8xzNc/b6fXZ3dsiyjG63S5ZlXLt8cfQpNjMECCIkUfQnR1FQmLG9vc2T+XkAltbXic2cIMK5l8d5dekzH1ZWqFarHB0bg6KgXq/j7lQqFRZeLxGrGyLC0pWvmDunJycxd3LVfRKAuhF7Galx9w4Ts3N8arVI05Rer0eappgZaZpSqVRwM2JTJYgwNfcIM+PU+DjmPupclX6eE4lgqoRCh8Lt5wkhBN43m7TabVobG3zf3CSJIg4kCUkUUWgpiAiPryvuwnSthpntU5IoIgphKJgpAtyfmUFEeNdsstrpsLy2NpKCyDCSKbGWwsPZWRyYnpjAf0//SxJAVQmqQ+HWs4AAbxsNvrTbrHY6dLa2CCKjVlXiwWAAwNMb4C6cqdVwwMp7MncoVz8YDIizLBtdg5ST3B0p3wBYCEgIZFlGnDjcvPeA/6nqwUP8AtTWMEb6wHGvAAAAAElFTkSuQmCC",zc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bS0UqIlYQ6ZChOlkQFXHUKhShQqgVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4B/kaFqWbXOKBqlpFOJoRsblUIvSKIMPoRxaDETH1OFFPwHF/38PH1Ls6zvM/9OXqVvMkAn0A8y3TDIt4gnt60dM77xBFWkhTic+Ixgy5I/Mh12eU3zkWH/TwzYmTS88QRYqHYwXIHs5KhEk8RxxRVo3x/1mWF8xZntVJjrXvyF4bz2soy12lGkcQiliBCgIwayqjAQpxWjRQTadpPePiHHb9ILplcZTByLKAKFZLjB/+D392ahckJNymcAIIvtv0xAoR2gWbdtr+Pbbt5AgSegSut7a82gJlP0uttLXYE9G0DF9dtTd4DLneAoSddMiRHCtD0FwrA+xl9Uw4YuAV61tzeWvs4fQAy1FXqBjg4BEaLlL3u8e7uzt7+PdPq7wdBJ3KT7BaVSwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDBEdBk5IsTwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACx0lEQVQ4y42O309TBxiGn3N6qKZGNLqwhUSIFhDMUFwXb2pxJoyIAv7elmXJdsHlZvA/8G7ZrpbMu91oYtAbo0QzhSYGGtivokB7Ss85LS1VxFFKtRBSjrbn88rGxbjwJe/N9+R58yps8OLpjJhPnvznt22LZ2PyTGpObo2ExBGpRETk1khIXBuR448z9B5pZ2xigsFgkJelEnW1tcQzGdT/k2OzaYnNpek90k65XGapUOCbk6dZKhQAcBzn/QV6MiV6OsXJo59h2zaOCC1eLw8tg30NDZWC98oDw0FZF5H5+XkJDQ7Ks4UFKb56JXapJCURGRgOip5MyTsLoolZmUomOP15BwuZDLGxMYrFIpFQiHK5jOpycWNomNbde/i4YY+ivS1HrKRMWiZnj3fxOJlEHx2tMF9HB+5Nm7j++z3aGptobfQqAJWCaSshE0acL3q6SZsmU8FgRT7U1cVH9fVcu3MXX3Mz+5salDdMBZg0LQnHYpzr6WY2HufR0BCO4+A4Dr7OTnZ5vVy7Pcgne/dyoKlReXu1MmmYEtZ1vjx7hjnDID4yUoH1Ph+pTIbR8T/w1tUR8PuJRiLYtk11dTWHAwFcbYH2S1+dP0c2myUVCuF2u3G73TQHAkzrOtUeD2e6T2AZJuPj43g2b6a35wTlUonpqWl4OBOXywM35IWIRE1THty8KbFEQlZE5Ou+PjGMhFzovyiRqCX5fFEiUUsu9F8Uw0jIjz/9LErueUHST+cZDYfp++5bstksH9bU8NuVqzydmeF45ym2bt3C/ft3yb/IsWP7Bxw71s3q6hp//vUAZTGXl7W1NXTD4JFp0P/D9/zy62Uaa2sprqwS/udvFEXB4/HQdvAg0UiE4vo6iqLg9/tRnmVzsri4SH55mX9zS0xaFp+2tLBz23bslzaqqlKlVaFpGlXuKjSXhqZpuDQNVVV5DQyKeoiSxZAyAAAAAElFTkSuQmCC",Wc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgjN9BzCj0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABnElEQVQoz42SsWoiURSGv5m5OIVplsQBky67ICisi6QQ3GreQRBsrHwEn8GHEMTCQiufIFVIsQRcd8Bml7XJFuvsIJoE1Lkzs8XEYSaaxB9ucbn3+8899/wKwM3d92Dh2Pi+j+/7vCVVVVFVlQ+nGb5efVEEgGP/5ar4GSNzxjGa2/+4m/wIDQGklEfDAEbmDCllzMB1o0NN0xBC7C3P8wDodDrEGQFEfSuKEl2Ma7vdkkql6Pf7zOdz4kzCIAgCgISJlBJd1xkMBiwWC8rlcsJADYFw0263GY1GaJrGZrNhvV6j6zrD4ZDlckk+n8c0TeKMiFcsFAqMx2Nc16VarQLQ7XZxHIdSqUSlUoletmNCAz/cmKaJ4zhMp1N6vR6r1QrbthOVI4NnJmzheSTpdJpGo0E2m8WyLGazGblcjlqttvexXnyML9PXbDYxDINisUi9Xj+YhcQUdr8fV6vVejNMO0YFCICJZR2dxIllsSupXN9+C37/+smf+3s8T0YRfU1CCDRNkL045/LjJ5TbsRU8PT5woIt3lT454T+zOsZSlUjWPwAAAABJRU5ErkJggg==",Dc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgiC+YHR/sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABwUlEQVQoz42TT4vaQBjGfzHBSw6rt+2lhLL04lFY+h1aevPup/CqIH4D2YJ4Fbsbqv1Da6nXYi+ibL3YdruoZHXXSzaVVMgkmR7SFcU27A/eyzDPM8+8844CcDmZyevrBUEQEAYhcSTUBKqqcnj4gEfGQ0UDmM+veHx0RDqd4j7Y9i3fLy4iQwAhxL3FAOl0CiHErsEdqqqiadpeBUEAQL1eZ1ujAYRhdG9FUTYbt/E8j2QySaPRYLlcsq3ZMZBSAmxMbNvGsizCMKTf77NarTAMg8FgwGI+53IyiwTv3n+QQghZLpelaZpSCCEdx5G9Xk/G8bn3RWrbJ2YyGYbDIUIIcrkcQRDQ7XY5OXlBu92iWq2iaRphGJLNZlmv1ygAr9qv5fNnT3FdF9M0mU6nGIaBZVkUi8X/vsbHT92oB77vA6DrOvl8nlqtxmg0wvO82ASbhjdPz6QQYqcqlYoslUqxPWi/eRv14F8UCgU6nU5sgs38NE/P5Pn5170UrVYrNkGj+VIq3378lOPxmOl0gu/7+H9dXdflZnmDc+vsTGoiEX2mg9QBx8dPUGZXC7la/doM0R3r32tc191b30bXdf4AswSDFyrGAhMAAAAASUVORK5CYII=",Ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9Tix9UOlhBikOG6mRBVMRRq1CECqFWaNXB5PoJTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/5cUWsR4cNyPd/ced+8AoVFhqtk1DqiaZaQScTGTXRW7XxHAIHoRQkRmpj4nSUl4jq97+Ph6F+NZ3uf+HP25vMkAn0g8y3TDIt4gnt60dM77xGFWknPE58RjBl2Q+JHristvnIsOCzwzbKRT88RhYrHYwUoHs5KhEk8RR3OqRvlCxuUc5y3OaqXGWvfkLwzmtZVlrtMcRgKLWIIEEQpqKKMCCzFaNVJMpGg/7uGPOH6JXAq5ymDkWEAVKmTHD/4Hv7s1C5MTblIwDgRebPtjBOjeBZp12/4+tu3mCeB/Bq60tr/aAGY+Sa+3tegRENoGLq7bmrIHXO4AQ0+6bMiO5KcpFArA+xl9UxYYuAX61tzeWvs4fQDS1FXyBjg4BEaLlL3u8e6ezt7+PdPq7wcvuHKMRIsU1QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFFQkWEGZMN3sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABVElEQVQoz93Ry0oCARjF8f/kpC0mZYoupJZWWhSouUopy0fQxxF9kagXKNpEtLZVQajdFl28kVp2mRFGiS4zTLsiqkXLOtvf4nx8B/58BID84bHZaNTRX/V3ELtFnE4XAD9ZOBQQhINcwaxUyng9Y/TJMlarFcMweFAUcvkCAOG50BcrV6p4veMI6xubptvt5PjoiPOLS3TDYGR4CFmWP53aarW4bt4iWixM+X0EgkFqtQZdWltDkiQUVSWVzgAQjUZYXFwgkUiQTCaJx+PEYjEAUukMiqoiSRJaW0NYWV0zPaPj1Os17pU7NE1Df3n+9mGi1YbdbmegfxCXy031qoywtb1j7u/tMTsTwuPx4XDIPD52KJXOODnNA/xo85EIwmW5au5ms1ycn/H0/NHcY7MxMTkJQKlY/GL+qWmWlpcR6jdNs9PuoBv6r/YXLSJSr8Q/yBspXJbfdFchHAAAAABJRU5ErkJggg==",qc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgeFvbyUt0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABKElEQVQoz6XPMUtCcRSG8eeCqR8ktKEaJYMw/QYtFUQQFFREUIM4GEEYRAkN0dQSQQWFIBQ4lSlKBA1SLQ2B9BlsuH/v9ZwGtYQIC9/5HH48VuX1TQGMbbORiLO9m8bn9wOwvrKEiqIoIoKK0B8IshZPYLUfy8UCL89PDA4NMzYepds8ba2YvyW5lSK1mSQ0Esbn97O6uICKoKqIKiqCiHB0ctoUS4U7spnL1hFMTE4Rica6i4X8DdMzs4TCozzcl8ldXxGJxlien/tSRAWVZuvx+cV343/nAZot7YaOlk5FWq2NRoOzTLZH8beWtiIiOI5D3RiMMeTyxR7Ej1qN/b0d3qvVH4rruhjbxhhDvV7HdR0CwQHSB4dYpceKGmMj8jfYsqDP6+UTS3LlTs6Kx84AAAAASUVORK5CYII=",Zc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAABuElEQVQ4T32Tu04CQRSGf9gLEKQgYmQN2qACNhpNCBSAPoKXRHoqtcWeh6A0EtGChMZoY7QwitGEgpcwoBJvhSD3cWcYUbKjXzKZ//xz2TNnZ/AfyysrhDYeCjHz3kAkEiHu8XHQRjW3DZh4P0QkGmWLKYT01z5VqyhcXxvmCzN4fXmBLMs8AtPUE2HYIBCYI5qmodFocAdMu91uNsatAYYN5hcWuDIiGhPWIBqLkTGXCxaLBTabjXm1Wh1b2ztMfzM5NcWVgFA4TBKJhF7Dv7m5vSMSn29AVpTUzPQ0rFYrksldxOObSKfTKJVKKBaL6PV6qNU/xUcIhcJEUWR4vV5kMhnuGjk7v8BQBqtr66TZbKZ8s7Ps7JIkweFw/JNB/ScDn89HaNE8Hg+LqVZVFblcjsUijk9O+xn4/QHico2yRXptoCgKuzxUO53OPzN4e3+H6b7ySPwzXgSDQZjN5sGvo32r1UI+n2dfE3GQPYTp8qpA9vf3cJTNsorbR0Zgt9uhKiq7Jb1uF+1OB512m21IW0ePF5eWsLa+AdND9ZlUymW09Qm/odf3o/ZBXxN3hpH0I2raBL4ARzrLEHEzjREAAAAASUVORK5CYII=",Yc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAPCAYAAADUFP50AAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAH9SURBVDhPnZJPaBNBFMa//ZPNpgHT0HartRD/IKJSRIoFLd5VPEmPBgQtXgqCnooIohRE8CBe9CZCTx48evGioKlKpCGiFUWxNmnS3eomNNnN7mafM2NZXNKTD37L8L3ve7MzjIQt6vrDdbIaJNaDGQm3Lg30+GLC5bsrdPRgGsfG0hgZUoVWNQMUyi28+9jCvaujvRtN31yirz/bFAQB+b4fg2u8xz2b9r81deUNff7eJNd1yXEcmsy/iLGwWBc97uFenpH5Z+JQGqOGAjYdbDryZ3YIThzZhmaziYXSmuhxDz8KL+Xk9DO6OLUPmbQEIhLsz2nIGSF+VBoolH4hNxxie38btt3AQDaFmnzqhrxccbFrpA9hGMLzPJimhWq1huevV/HgSRUTYwYunN0NWVbZUGA4q4BnZFXtA5jgOB1Ylo1OJ4CiJHDnsQ1JSmFuZg9c14OqagJip+MZeW9uEF+W22i1PBbQkEjogsL8cYHndSONs2oBPCM/vT8uvSz60PUUNC0ZcXqmIvhXSybZwDLAM+JWi0syzAYPpqLJup4RxHZbT6L8TRO3GlV+9je9/+BQve5QrebQxkYg4GuuvS216RzzbNrjT443xg9omDycwE6D/QyzrZhdvFr0UfzkY/52NvL3vj1W56+ZtGYrYm30d/FobmhL338U8AdLygpqJt/tXAAAAABJRU5ErkJggg==",Xc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAIwSURBVDhPdVNLaBNRFD3jTJs0iQnWtqC2uLEWUlxIUBBxWQjqRigoaNxoEQSRKiIuKqILQRA/hIiCCwviDxoURLGCiJLGT6AhUGvTJjYfpTGdNGknE83n+uZlNASTA3eYuee8e+57746ABhi5vUjpLPH3DpuAS8fWNtTVJU9eTdA2uxk7tpixvlPiue8/S5gIKfg0peDG6e6GRTB0cZpm43kqlUpULBbrQstpnKbR5TUMnvpAX6M5KhQKpKoq7XS9rQv/5ALnNI2m1ZdhlfbY3m9Gd5cI5gLmAtfedTx2bbUil8vBH0xxTtNo27p8Z5IXEJ1DL+joYC9sZgFExKNvYyva27KIz89BTi/AZpCh5uKIRqMwSSvwB+bgfXTzAuy7vbSYWSFZlimVSlE4PEvBYIiue56wOs3x3jdBkiSZANaEqv5CNruMSqUCUWzB83dLsG8ah8dzC17vGNxuN5iY8w6Hg+lVCPtOBOjskR60m1Te8l9EIjNwOgf0r//x8tV49Z6v3E3SgYEWlMtlTmg4fv4Nhl0dTZ3TcqYq3H/mBwVCy5RMLlEikeGx5/Dj6uaawPv0Gf2bGNe5DA0fNGJDJzsC1r3P9xoWi6GpcyyR1FfqOMQKXBtV6GPwN90bHdM9GuP+g4c159DUF4p8S+PztBEzcQti82EUlRiMrQrWtMno6SrBZjVitdUKSRTRu7mv9mNEYwk2mnnelppXoShK3ekLggCD0QCTycyuUhtM4A+OzZgJPZUHrgAAAABJRU5ErkJggg==",jc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=",Hc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAAzElEQVQ4T2NkwAIWLFiw6+hzX1col8FacvPuhIQENyiXMAAZENfw9D+IhgpRF6A4O7/r2n9DsVO7V5zSc40wu4RBn39l5jqxTAurV8FOhTKxAgx5ZAGjkO3/oUysAFkerE/Tez08UIi1GUSD9DEou67+D8IgQRiNCyCrA2Gm//8ZGWqjv+4GCcJoXABZHUgfilNV3DbhtRlZHsOLxPoZBpigNBisPsDhClKgH3gCHIjoNEgeqpSGAGSTbfwD0tM2SINj8sv/MIzdAAYGAB1Xk+VGE8P2AAAAAElFTkSuQmCC",Jc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB+UlEQVQ4T5WTz2sTQRTHv7M/6iH4m7aXTTZnqY1E1JBSsChW1KJSYijiwZN4Lo1/giZetHhWiaHaH9aoNbEHtb8sCagtChWTNNAt9eaWellpDs+ZaSwGbZJ+4PFm38z77O7sDkOdTM68p59ra3LcdfZMRZ9SzlUZe5WmHboG/yEfrCWrXN0GbycmaWp6inK5bxSNxahcrqDmk9g/bOzetROp9DhuRCKbr/F4cIhGk8+ltKbE+eVgfb2EtmAAN29FZVP8UYLa24JwHEeuqSkplUoyVldtnDzRgTt3+ylw7AgWFr5ifm5Orqn6dVKvx+n7ygpMjwGXy4WGBp1XGZasZWQyWdyORWX/lpKxVJosy0JrywFMz8zCtu3yzAZ/BIL/SpIvXtKyEBxswfznL/B6vTjfdW7LG/6zJyOjz6hYLMLX6sOHj59gGEZVgaBCMjj8lIqLiwgcDWI2k4Hh9qD74oWqAsGmZODJEBUKeXQcP413E29gmibCoe6aAoGUxBMDlM/l+ZkI8Z8qCQ8X9IRDdQkEysN4ggr5AsKXrmJ4JAGTb+KVyz11CwSst6+Prl+L4P6De2hubsSpzk4oigLGQ+S/Q1V5nW2MGWMyN+7bw5g4A9lsFm63G37/YSiqCk3joWo8a1B56PwEy2tdlzUxrygql6po2r+X/QZc4Kt8vjU1QAAAAABJRU5ErkJggg==",$c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8zyKORhVGSxV0MK0pIlgwlRU1j1AwW7r1jhpp7TfeObCyVrbLw2HgtbKzZWtgqpTxKtjZWxEa6/ueOmkmNcup0fn3nfF/nfAeCBznTcqt7wLILTnwsqiVTM1rtMzW0UE8Tbbrp5odjsQkqjo9bAmq96VZZ/G80phdcEwKa8JCZdwrC88IDq4W84h3hsLmop4VPhbscuaDwvdKNIr8ozvocVJlhJxEfEQ4La9kyNsrYXHQs4X7hSNqyJT+YLHJa8ZpiK7di/txTvTC0YE9PKV1mO2OMM0kMDYMVlshRoFtWWxSXuOxHK/jbfH9MXIa4ljDFMcoyFrrvR/3B727dTF9vMSkUhZonz3vrgNot+Nr0vM9Dz/s6gqpHuLBL/uUDGHwXfbOkRfahaR3OLkuasQ3nG9D6kNcd3ZeqZAYzGXg9kW9KQfM1NMwWe/vZ5/gOEtLVxBXs7kFnVrLnKry7rry3P8/4/RH9Bi+4coweluJpAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB7klEQVQ4T5WSS0xTQRSG/zu33fFYGdJF17BS08tGE3YGFuICmgrojkCIC8FECjtIWAnIrilNMGgAeRRtCyVo7A6Npg12oeHVEjHlsS4p5XVJjzPDhZRAbuo3i3PmzPyTf+aMggJxd3WTkWJwoP9Sx4xoihA7nfV40dFuVP4DIV76ukSJxAblu7jAYkRTSkuKMfJm9Ir1i8MKusLpqY7HLuelSMSO9udyrSAHuq7j4CAjD+FQa0szVlfX5JppFwKhOcpm9mX+6/eKjPk0PXlqZDewsPiJXg8NkRnfvv+gGx2E5sO0nUqhpLgINpsNXu8wgsEAPB4PLBYLcrkcNE1DJnt4/QofAkFKcXGlQ0N4IYyB/lfGynU+f4lANXLJzOxH+rv1B/fvVWFuPmRUCZ2dbjQ2NkgH8XgcsVhMusge5jmYnPbTFhdXP6iFf3YcDq0S8Z/Lpg74Vc//wdjEJCUTSTx66JLi23fuoqnBJQ+PRCKoq6sXqXTg8/n4m3gRjUZle/FubIJ6evtofX1PflUxl7s5Ym7G+6lpUl663fSsrQujbz0oK7uF6poaMMaQTqexuZnE7s4Ojk9OoCiKrIsohqC8ogLK1IyfhB273Q4Hf3mmqrxVKs70MxwdH0FlKqxWK68zGcVc5a1U+T7GGP4BgBQJdqV6GiMAAAAASUVORK5CYII=",eu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSkWqDhYp4hCwOlkQFXHUKhShQqgVWnUwufRDaNKQtLg4Cq4FBz8Wqw4uzro6uAqC4AeIo5OToouU+L+k0CLGg+N+vLv3uHsHCPUS06zAGKDpFTOViIuZ7IoYfEUAEfSgH0Mys4xZSUrCc3zdw8fXuxjP8j735+hWcxYDfCLxDDPMCvE68dRmxeC8TxxmRVklPiceNemCxI9cV1x+41xwWOCZYTOdmiMOE4uFNlbamBVNjXiSOKpqOuULGZdVzluctVKVNe/JXxjK6ctLXKc5iAQWsAgJIhRUsYESKojRqpNiIUX7cQ//gOOXyKWQawOMHPMoQ4Ps+MH/4He3Vn5i3E0KxYGOF9v+GAaCu0CjZtvfx7bdOAH8z8CV3vKX68D0J+m1lhY9Anq3gYvrlqbsAZc7QOTJkE3Zkfw0hXweeD+jb8oCfbdA16rbW3Mfpw9AmrpK3gAHh8BIgbLXPN7d2d7bv2ea/f0AZphyovX12KAAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfmBBgOKgbgcs+YAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAzFJREFUOMuVlWtMFGcUht8Ztt1lZmFwZlmWXXZZkF0tEW1TI02s2kvU/miJicaUeMFoURtquDRYTdqGhhAjRkNL0ia9gReIrRVawRQjmqz+MsbourUlbUkI7sLOfLNovKS2Ro+/WGbKboBJ5s98532+c857cgZEhBv7D9rivuA+vXKNSESYyxtp2WFVg4FGdV25nYiA29uarJri7mQQY0xReu9vXGWfLexiS5NVz8n9RocYZRbpl/tvrsiG6vSsZxBuMwhRBiGqyfKZeytfE2aC/bl/3/MJr+u7SR2DEE14Cutw7dtfOSbP22s80CSpj214PSsd7LeP662ay9Vh1MRF5xeRtnYLiAgNoS2cruR+qBsCmJTdx8pXTCv/yieNNt1b0KkZYlV3YfuNjs4MIkIyEKFD0HIdDcZb9eyc/sSqsmSmQ427bczpOmqMUeX8tqHWpowkx3h79NjbmHDk1Zqgotz/6K2XskZ2VlrVIv8JU5kF8z+/2laXYWRM68/aB+dxx6Hs0Q1GMUk6q3r93UbYmE0+3Nt9iv+/PmXTK4+v5nRBqTH2VIc4lVm+70i4d4BPpU07FruadnFqib/OZBSEaNzhODxyqJ9Pp+OR5ql5LGdydx++QgBn/P6c/m+pZeADKZ0uJfCPvR+JzpOnjkJ/+CoAIgAcOA4AnuJJWWaIdccWlsmptBwRmWH1taLSdfL7DPZgOQEgAOSe18U/fTSM+D+fTsZZeD7yX6m4yRmJT5gAxvqHq6oEtaj4tMnN0iWtPw528USEiSLvexqEWNIoi3ROe7lYTmnK37U1dtVd8JMRNu4qaPk6HE4agOvt0Is91cwAZYI0OFoWVEzAa9XvZ2l5bhNsbOGiAz9Ebk5z82LPu5zqd29nEKcyzcwZHF0WyCUi4NZnrXZVVnpMo1Hob/750vW0o9HXcZNTS/K3GzPVefuFkaWL8hAv9lUktwyE6FjJC80N2h1+xn0IAgt4qiZ7qkGIxRYE6rF56BYSLs8ODUJ0fPGLzV9duszPemP/fpxjQe9WDWJszOc7WD16jAcR4Z3QAW68fEn5l3+p/Fx/AYGWIEbeWLa8gsIcEeEZsTM0Y8K17+YAAAAASUVORK5CYII=";const U=e=>($s("data-v-67849361"),e=e(),ei(),e),tu={class:"head"},ru=U(()=>T("img",{src:Vc},null,-1)),nu={key:0,class:"gray"},su={class:"typeIcon-wrapper"},iu=["src"],ou={class:"typeIcon-wrapper"},au=["src"],lu={key:0,class:"gray"},cu=["innerHTML"],uu={key:0,class:"gray"},du={class:"gray"},fu={class:"gray"},hu={key:0,class:"gray"},pu=["onClick"],gu=["src"],mu=["src"],yu=["src"],Au=U(()=>T("img",{class:"pr-4px",src:Qc},null,-1)),vu=U(()=>T("img",{class:"pr-4px",src:zc},null,-1)),wu=U(()=>T("img",{class:"pr-4px",src:Wc},null,-1)),bu=U(()=>T("img",{class:"pr-4px",src:Dc},null,-1)),Eu=U(()=>T("img",{class:"pr-4px",src:Ri},null,-1)),ku=U(()=>T("img",{class:"pr-4px",src:Pi},null,-1)),_u=U(()=>T("img",{class:"pr-4px",src:qc},null,-1)),xu=U(()=>T("img",{class:"pr-4px",src:Zc},null,-1)),Iu=U(()=>T("img",{class:"pr-4px",src:Ri},null,-1)),Cu=U(()=>T("img",{class:"pr-4px",src:Yc},null,-1)),Su=U(()=>T("img",{class:"pr-4px",src:Xc},null,-1)),Nu=U(()=>T("img",{class:"pr-4px",src:jc},null,-1)),Tu=U(()=>T("img",{class:"pr-4px",src:Hc},null,-1)),Lu=U(()=>T("img",{class:"pr-4px",src:Jc},null,-1)),Ou=U(()=>T("img",{class:"pr-4px",src:$c},null,-1)),Bu=U(()=>T("span",{class:"gray absolute right-5px"},"Ctrl+X",-1)),Pu=U(()=>T("span",{class:"gray absolute right-5px"},"Ctrl+C",-1)),Gu=U(()=>T("span",{class:"gray absolute right-5px"},"Ctrl+V",-1)),Ru=U(()=>T("span",{class:"gray absolute right-5px"},"Ctrl+D",-1)),Fu=U(()=>T("span",null," Move Up ",-1)),Ku=[Fu],Uu=U(()=>T("span",null," Move Down ",-1)),Mu=[Uu],Vu=U(()=>T("span",null," Move To ",-1)),Qu=U(()=>T("span",{class:"absolute right-5px"},"❯",-1)),zu=[Vu,Qu],Wu=["onClick"],Du={key:0,class:"gray"},qu=U(()=>T("img",{class:"w-12px pr-4px",src:eu},null,-1)),Zu=U(()=>T("span",{class:"gray absolute right-5px"},"Del",-1));function Yu(e,t,r,n,s,i){const o=at("EditorCollapsibleBox"),l=at("CatalogueEntry",!0),a=at("CatalogueLabel"),c=yc,u=Li,f=at("ContextMenu");return k(),S("div",{class:"item unselectable",onMouseup:t[32]||(t[32]=Se((...d)=>i.debug&&i.debug(...d),["middle","stop"])),onContextmenu:t[33]||(t[33]=Se((...d)=>i.contextmenu.show&&i.contextmenu.show(...d),["stop"]))},[r.item.editorTypeName==="catalogue"||r.item.editorTypeName==="gameSystem"?(k(),S(oe,{key:0},[T("div",tu,[lt(o,{payload:i.catalogue,nobox:"",group:[],collapsible:!1},{title:le(()=>[ru,G(" "+W(i.catalogue.name)+" ",1),i.getNameExtra(i.catalogue)?(k(),S("span",nu," "+W(i.getNameExtra(i.catalogue)),1)):N("",!0)]),content:le(()=>[]),_:1},8,["payload"])]),(k(!0),S(oe,null,Re(i.groupedCategories,d=>(k(),J(o,{key:d.type,altclickable:n.store.can_follow(r.item)||r.imported,onAltclick:i.onctrlclick,collapsible:d.items.length>0,group:i.get_group("entries"),payload:d.type,onContextmenu:Se(h=>i.contextmenu.show(h,d.type),["stop"]),class:De([d.type,d.links,`depth-${r.depth}`]),nobox:"",defcollapsed:!i.should_be_open(d.type)},{title:le(()=>[T("span",null,[T("span",su,[T("img",{class:"typeIcon",src:`assets/bsicons/${d.icon}`},null,8,iu)]),G(" "+W(d.name),1)])]),content:le(()=>[i.should_be_grouped(d.type)?(k(!0),S(oe,{key:0},Re(i.groupBy(d.items,h=>h.item.typeName||"Untyped"),h=>(k(),J(a,{label:h[0].item.typeName??"Untyped",depth:r.depth+1,catalogue:i.catalogue,item:i.catalogue.findOptionById(h[0].item.typeId)},{default:le(()=>[(k(!0),S(oe,null,Re(h,m=>(k(),J(l,{key:i.key(m.item),item:m.item,group:i.get_group(d.type),forceShowRecursive:i.forceShow,imported:m.imported,depth:r.depth+2,noType:""},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:2},1032,["label","depth","catalogue","item"]))),256)):(k(!0),S(oe,{key:1},Re(d.items,h=>(k(),J(l,{key:i.key(h.item),item:h.item,group:i.get_group(d.type),forceShowRecursive:i.forceShow,imported:h.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:2},1032,["altclickable","onAltclick","collapsible","group","payload","onContextmenu","class","defcollapsed"]))),128))],64)):(k(),J(o,{key:1,altclickable:n.store.can_follow(r.item)||r.imported,onAltclick:i.onctrlclick,collapsible:i.mixedChildren&&i.mixedChildren.length>0,empty:!i.mixedChildren||i.mixedChildren.length==0,group:r.group||[],payload:r.item,class:De([r.item.parentKey,`depth-${r.depth}`]),defcollapsed:!s.open,nobox:""},{title:le(()=>[T("span",null,[T("span",ou,[T("img",{class:"typeIcon",src:`assets/bsicons/${r.item.editorTypeName}.png`},null,8,au)]),lt(c,{errors:r.item.errors},null,8,["errors"]),T("span",{class:De({imported:r.imported,filtered:r.item.highlight})},W(s.name),3),i.getNameExtra(r.item,!0,!r.noType)?(k(),S("span",lu," "+W(i.getNameExtra(r.item,!0,!r.noType)),1)):N("",!0),i.costs?(k(),S("span",{key:1,class:"ml-10px",innerHTML:i.costs},null,8,cu)):N("",!0)])]),content:le(()=>[(k(!0),S(oe,null,Re(i.mixedChildren,d=>(k(),J(l,{key:i.key(d.item),item:d.item,group:i.get_group("default"),forceShowRecursive:i.forceShow,imported:r.imported||d.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:1},8,["altclickable","onAltclick","collapsible","empty","group","payload","class","defcollapsed"])),s.contextmenuopen?(k(),J(f,{key:2,modelValue:s.contextmenuopen,"onUpdate:modelValue":t[31]||(t[31]=d=>s.contextmenuopen=d),ref:"contextmenu"},{default:le(({payload:d})=>{var h,m,p,y,A;return[!d&&r.item?(k(),S(oe,{key:0},[n.store.can_follow(r.item)?(k(),S("div",{key:0,onClick:t[0]||(t[0]=g=>n.store.follow(i.link))},[G(" Follow "),i.link.target.getCatalogue()!==r.item.getCatalogue()?(k(),S("span",uu,"  ["+W(((h=i.link.target.getCatalogue())==null?void 0:h.getName())||i.link.target.getName())+"] ",1)):N("",!0)])):N("",!0),r.imported?(k(),S("div",{key:1,onClick:t[1]||(t[1]=g=>n.store.goto(r.item))},[G(" Goto "),T("span",du,"  ("+W((m=r.item.getCatalogue())==null?void 0:m.getName())+") ",1)])):N("",!0),r.item.isProfile()&&r.item.typeId&&r.item.getCatalogue().findOptionById(r.item.typeId)?(k(),S("div",{key:2,onClick:t[2]||(t[2]=g=>n.store.goto(r.item.getCatalogue().findOptionById(r.item.typeId)))},[G(" Goto "+W(r.item.typeName)+" ",1),T("span",fu,"  ["+W(r.item.getCatalogue().findOptionById(r.item.typeId).getCatalogue().getName())+"] ",1)])):N("",!0),i.child&&n.store.can_goto(i.child)?(k(),S("div",{key:3,onClick:t[3]||(t[3]=g=>n.store.goto(i.child))},[G(" Goto "+W(i.child.getName())+" ",1),r.item.getCatalogue()!==i.child.getCatalogue()?(k(),S("span",hu,"  ["+W(i.child.getCatalogue().getName())+"] ",1)):N("",!0)])):N("",!0),(p=r.item.links)!=null&&p.length||(y=r.item.other_links)!=null&&y.length?(k(),S("div",{key:4,onClick:t[4]||(t[4]=g=>n.store.mode="references")}," References ("+W(r.item.links?r.item.links.length:0)+") ",1)):N("",!0),r.item.isLink()||r.item.links||r.imported?(k(),J(u,{key:5})):N("",!0)],64)):N("",!0),d?(k(),S(oe,{key:1},[T("div",{onClick:g=>n.store.create(d)},[T("img",{class:"pr-4px",src:`assets/bsicons/${i.getTypeName(d)}.png`},null,8,gu),G(" "+W(i.getTypeLabel(i.getTypeName(d))),1)],8,pu),d==="selectionEntries"?(k(),S("div",{key:0,onClick:t[5]||(t[5]=g=>n.store.create("entryLinks",{type:"selectionEntry"}))},[T("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,mu),G(" Link ")])):N("",!0),d==="rules"?(k(),S("div",{key:1,onClick:t[6]||(t[6]=g=>n.store.create("infoLinks",{type:"profile"}))},[T("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,yu),G(" Link ")])):N("",!0),lt(u)],64)):(k(),S(oe,{key:2},[i.allowed("forceEntries")?(k(),S("div",{key:0,onClick:t[7]||(t[7]=g=>n.store.create("forceEntries"))},[Au,G(" Force ")])):N("",!0),i.allowed("categoryLinks")&&r.item.isForce()?(k(),S("div",{key:1,onClick:t[8]||(t[8]=g=>n.store.create("categoryLinks"))},[vu,G(" Category ")])):N("",!0),i.allowed(["forces","categoryLinks"])?(k(),J(u,{key:2})):N("",!0),i.allowed("selectionEntries")?(k(),S("div",{key:3,onClick:t[9]||(t[9]=g=>n.store.create("selectionEntries"))},[wu,G(" Entry ")])):N("",!0),i.allowed("selectionEntryGroups")?(k(),S("div",{key:4,onClick:t[10]||(t[10]=g=>n.store.create("selectionEntryGroups"))},[bu,G(" Group ")])):N("",!0),i.allowed("entryLinks")?(k(),S("div",{key:5,onClick:t[11]||(t[11]=g=>n.store.create("entryLinks",{type:"selectionEntry"}))},[Eu,G(" Link ")])):N("",!0),i.allowed(["selectionEntries","selectionEntryGroups","entryLinks"])?(k(),J(u,{key:6})):N("",!0),i.allowed("profiles")?(k(),S("div",{key:7,onClick:t[12]||(t[12]=g=>n.store.create_child("profiles",r.item))},[ku,G(" Profile ")])):N("",!0),i.allowed("rules")?(k(),S("div",{key:8,onClick:t[13]||(t[13]=g=>n.store.create("rules"))},[_u,G(" Rule ")])):N("",!0),i.allowed("infoGroups")?(k(),S("div",{key:9,onClick:t[14]||(t[14]=g=>n.store.create("infoGroups"))},[xu,G(" Info Group ")])):N("",!0),i.allowed("infoLinks")?(k(),S("div",{key:10,onClick:t[15]||(t[15]=g=>n.store.create("infoLinks",{type:"profile"}))},[Iu,G(" Info Link ")])):N("",!0),i.allowed(["profiles","rules","infoGroups","infoLinks"])?(k(),J(u,{key:11})):N("",!0),i.allowed("conditions")?(k(),S("div",{key:12,onClick:t[16]||(t[16]=g=>n.store.create("conditions"))},[Cu,G(" Condition ")])):N("",!0),i.allowed("conditionGroups")?(k(),S("div",{key:13,onClick:t[17]||(t[17]=g=>n.store.create("conditionGroups"))},[Su,G(" Condition Group ")])):N("",!0),i.allowed("repeats")?(k(),S("div",{key:14,onClick:t[18]||(t[18]=g=>n.store.create("repeats"))},[Nu,G(" Repeat ")])):N("",!0),i.allowed(["conditions","conditionGroups","repeats"])?(k(),J(u,{key:15})):N("",!0),i.allowed("constraints")?(k(),S("div",{key:16,onClick:t[19]||(t[19]=g=>n.store.create_child("constraints",r.item))},[Tu,G(" Constraint ")])):N("",!0),i.allowed("modifiers")?(k(),S("div",{key:17,onClick:t[20]||(t[20]=g=>n.store.create("modifiers"))},[Lu,G(" Modifier ")])):N("",!0),i.allowed("modifierGroups")?(k(),S("div",{key:18,onClick:t[21]||(t[21]=g=>n.store.create("modifierGroups"))},[Ou,G(" Modifier Group ")])):N("",!0),i.allowed(["constraints","modifiers","modifierGroups"])?(k(),J(u,{key:19})):N("",!0)],64)),d?N("",!0):(k(),S("div",{key:3,onClick:t[22]||(t[22]=(...g)=>n.store.cut&&n.store.cut(...g))},[G("Cut"),Bu])),d?N("",!0):(k(),S("div",{key:4,onClick:t[23]||(t[23]=(...g)=>n.store.copy&&n.store.copy(...g))},[G("Copy"),Pu])),T("div",{onClick:t[24]||(t[24]=(...g)=>n.store.paste&&n.store.paste(...g))},[G("Paste"),Gu]),d?N("",!0):(k(),S("div",{key:5,onClick:t[25]||(t[25]=(...g)=>n.store.duplicate&&n.store.duplicate(...g))},[G("Duplicate"),Ru])),i.sortable(r.item.parent)?N("",!0):(k(),S("div",{key:6,onClick:t[26]||(t[26]=g=>n.store.move_up(r.item))},Ku)),i.sortable(r.item.parent)?N("",!0):(k(),S("div",{key:7,onClick:t[27]||(t[27]=g=>n.store.move_down(r.item))},Mu)),!d&&((A=n.store.get_move_targets(r.item))!=null&&A.length)?(k(),S(oe,{key:8},[T("div",{onMouseover:t[28]||(t[28]=(...g)=>i.nestedcontextmenu.show&&i.nestedcontextmenu.show(...g))},zu,32),lt(f,{ref:"nestedcontextmenu"},{default:le(()=>[(k(!0),S(oe,null,Re(n.store.get_move_targets(r.item),g=>(k(),S("div",{onClick:w=>n.store.move(r.item,i.catalogue,g.target,g.type)},W(g.target.name)+" - "+W(g.type),9,Wu))),256))]),_:1},512)],64)):N("",!0),r.item.parentKey==="sharedSelectionEntries"?(k(),S("div",{key:9,onClick:t[29]||(t[29]=g=>n.store.create_child("entryLinks",i.catalogue,{targetId:r.item.id,type:"selectionEntry",name:r.item.getName()}))},[G(" Add Root Link"),i.hasRootLink(i.catalogue,r.item)?(k(),S("span",Du," (already has one)")):N("",!0)])):N("",!0),d?N("",!0):(k(),J(u,{key:10})),d?N("",!0):(k(),S("div",{key:11,onClick:t[30]||(t[30]=g=>n.store.remove())},[qu,G("Remove"),Zu]))]}),_:1},8,["modelValue"])):N("",!0)],32)}const Xu=vt(Mc,[["render",Yu],["__scopeId","data-v-67849361"]]),Fi={showImported:!1,ignoreProfilesRules:!1,filter:"",scroll:0,selection:void 0,mode:"edit"},ff=So({components:{CatalogueEntry:Xu},emits:["scrolltop"],setup(){return{store:$t(),uistate:ft(),settings:ut()}},data(){return{...Fi,...this.defaults,shouldScrollTo:void 0,shouldScrollToElement:void 0}},async mounted(){this.load(),addEventListener("keydown",this.keydown),addEventListener("copy",this.copy),addEventListener("paste",this.paste),addEventListener("cut",this.cut)},unmounted(){removeEventListener("keydown",this.keydown),removeEventListener("copy",this.copy),removeEventListener("paste",this.paste),removeEventListener("cut",this.cut)},props:{catalogue:{type:Object,required:!0},defaults:{type:Object,default:{}}},methods:{onscroll(e){this.scroll=e.target.scrollTop},load(){this.$nextTick(async()=>{if(this.shouldScrollTo=this.scroll,this.selection)try{let e=jl(this.catalogue,this.selection);const t=this.selection[this.selection.length-1];if(!e&&t.id&&(e=this.catalogue.findOptionById(t.id)),e){const r=await this.store.open(e);r&&(await ce(r).do_select(),this.store.mode=this.defaults.mode,this.shouldScrollToElement=r)}}catch(e){console.error(e)}})},async set_scroll(e){const t=this.$refs.scrollable;t&&(t.scrollTop=e),this.$nextTick(async()=>{const r=this.$refs.scrollable;r&&(r.scrollTop=e)})},async scroll_to(e){e.scrollIntoView({block:"nearest",inline:"center"}),this.$nextTick(async()=>{e.scrollIntoView({block:"nearest",inline:"center"})})},should_capture_copy(e){var t;return!((t=getSelection())!=null&&t.toString())},should_capture_paste(e){var r,n;const t=(((r=e.target)==null?void 0:r.tagName)||"").toLowerCase();return!(["input"].includes(t)||(n=e.target)!=null&&n.isContentEditable||this.$route.name!=="catalogue")},async cut(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.cut(e))},async copy(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.copy(e))},async paste(e){this.should_capture_paste(e)&&(e.preventDefault(),await this.store.paste(e))},async keydown(e){var n,s;if(this.$route.name!=="catalogue"||!e.target)return;const t=(s=(n=e.target)==null?void 0:n.tagName)==null?void 0:s.toLowerCase(),r=e.key.toLowerCase();e.ctrlKey&&r==="f"&&(e.preventDefault(),this.$refs["editor-searchbox"].focus()),r==="escape"&&(this.$refs["editor-searchbox"].blur(),this.store.filter="",this.store.update_catalogue_search(this.catalogue,this.filterData)),t==="body"&&(e.ctrlKey&&r==="z"&&(e.preventDefault(),await this.store.undo()),e.ctrlKey&&r==="y"&&(e.preventDefault(),await this.store.redo()),e.ctrlKey&&r==="d"&&(e.preventDefault(),await this.store.duplicate()),e.ctrlKey&&r==="l"&&(e.preventDefault(),await this.store.pasteLink()),r==="delete"&&(e.preventDefault(),await this.store.remove()))},async update(e){const{filter:t,ignoreProfilesRules:r}=e,n=this.store.filtered;for(const s of n)delete s.showInEditor,delete s.showChildsInEditor,delete s.highlight,cr(s,i=>{delete i.showInEditor,delete s.showChildsInEditor});if(t.length>1){this.store.set_filter(t),this.store.filtered=this.catalogue.findOptionsByText(t),r&&(this.store.filtered=this.store.filtered.filter(s=>!s.isProfile()&&!s.isRule()&&!s.isInfoGroup()));for(const s of this.store.filtered)this.store.show(s);if(await ri(),this.store.filtered.length<300){for(const s of this.store.filtered)if(s.parent)try{await this.store.open(s,!1,!0)}catch{continue}}}else this.store.set_filter(""),this.store.filtered=[]}},computed:{filterData(){return{filter:this.filter.trim(),ignoreProfilesRules:this.ignoreProfilesRules}}},watch:{filterData:{handler(e){this.update(e)},immediate:!0},showImported:{immediate:!0,handler(e){e&&this.catalogue.imports.map(t=>t.processForEditor())}},shouldScrollTo(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.set_scroll(e)})},shouldScrollToElement(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.scroll_to(e)})}}});const V=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Z=Object.keys,ee=Array.isArray;function ne(e,t){return typeof t!="object"||Z(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||V.Promise||(V.Promise=Promise);const Wt=Object.getPrototypeOf,ju={}.hasOwnProperty;function ae(e,t){return ju.call(e,t)}function At(e,t){typeof t=="function"&&(t=t(Wt(e))),(typeof Reflect>"u"?Z:Reflect.ownKeys)(t).forEach(r=>{we(e,r,t[r])})}const Ki=Object.defineProperty;function we(e,t,r,n){Ki(e,t,ne(r&&ae(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function ht(e){return{from:function(t){return e.prototype=Object.create(t.prototype),we(e.prototype,"constructor",e),{extend:At.bind(null,e.prototype)}}}}const Hu=Object.getOwnPropertyDescriptor;function Xn(e,t){let r;return Hu(e,t)||(r=Wt(e))&&Xn(r,t)}const Ju=[].slice;function Ir(e,t,r){return Ju.call(e,t,r)}function Ui(e,t){return t(e)}function Nt(e){if(!e)throw new Error("Assertion Failed")}function Mi(e){V.setImmediate?setImmediate(e):setTimeout(e,0)}function Vi(e,t){return e.reduce((r,n,s)=>{var i=t(n,s);return i&&(r[i[0]]=i[1]),r},{})}function be(e,t){if(ae(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,s=t.length;n<s;++n){var i=be(e,t[n]);r.push(i)}return r}var o=t.indexOf(".");if(o!==-1){var l=e[t.substr(0,o)];return l===void 0?void 0:be(l,t.substr(o+1))}}function de(e,t,r){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Nt(typeof r!="string"&&"length"in r);for(var n=0,s=t.length;n<s;++n)de(e,t[n],r[n])}else{var i=t.indexOf(".");if(i!==-1){var o=t.substr(0,i),l=t.substr(i+1);if(l==="")r===void 0?ee(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r;else{var a=e[o];a&&ae(e,o)||(a=e[o]={}),de(a,l,r)}}else r===void 0?ee(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Qi(e){var t={};for(var r in e)ae(e,r)&&(t[r]=e[r]);return t}const $u=[].concat;function zi(e){return $u.apply([],e)}const Wi="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(zi([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>V[e]),ed=Wi.map(e=>V[e]);Vi(Wi,e=>[e,!0]);let Ce=null;function jt(e){Ce=typeof WeakMap<"u"&&new WeakMap;const t=pn(e);return Ce=null,t}function pn(e){if(!e||typeof e!="object")return e;let t=Ce&&Ce.get(e);if(t)return t;if(ee(e)){t=[],Ce&&Ce.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(pn(e[r]))}else if(ed.indexOf(e.constructor)>=0)t=e;else{const i=Wt(e);for(var s in t=i===Object.prototype?{}:Object.create(i),Ce&&Ce.set(e,t),e)ae(e,s)&&(t[s]=pn(e[s]))}return t}const{toString:td}={};function gn(e){return td.call(e).slice(8,-1)}const mn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",rd=typeof mn=="symbol"?function(e){var t;return e!=null&&(t=e[mn])&&t.apply(e)}:function(){return null},it={};function Ae(e){var t,r,n,s;if(arguments.length===1){if(ee(e))return e.slice();if(this===it&&typeof e=="string")return[e];if(s=rd(e)){for(r=[];!(n=s.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const jn=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var pe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Di(e,t){pe=e,qi=t}var qi=()=>!0;const nd=!new Error("").stack;function et(){if(nd)try{throw et.arguments,new Error}catch(e){return e}return new Error}function yn(e,t){var r=e.stack;return r?(t=t||0,r.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),r.split(`
`).slice(t).filter(qi).map(n=>`
`+n).join("")):""}var Zi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Hn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Zi),sd={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function pt(e,t){this._e=et(),this.name=e,this.message=t}function Yi(e,t){return e+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,n,s)=>s.indexOf(r)===n).join(`
`)}function Cr(e,t,r,n){this._e=et(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Yi(e,t)}function Rt(e,t){this._e=et(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=Yi(e,t)}ht(pt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+yn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),ht(Cr).from(pt),ht(Rt).from(pt);var Jn=Hn.reduce((e,t)=>(e[t]=t+"Error",e),{});const id=pt;var B=Hn.reduce((e,t)=>{var r=t+"Error";function n(s,i){this._e=et(),this.name=r,s?typeof s=="string"?(this.message=`${s}${i?`
 `+i:""}`,this.inner=i||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=sd[t]||r,this.inner=null)}return ht(n).from(id),e[t]=n,e},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var Ks=Zi.reduce((e,t)=>(e[t+"Error"]=B[t],e),{}),gr=Hn.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=B[t]),e),{});function K(){}function Dt(e){return e}function od(e,t){return e==null||e===Dt?t:function(r){return t(e(r))}}function Je(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ad(e,t){return e===K?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Je(n,this.onsuccess):n),s&&(this.onerror=this.onerror?Je(s,this.onerror):s),i!==void 0?i:r}}function ld(e,t){return e===K?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Je(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Je(n,this.onerror):n)}}function cd(e,t){return e===K?t:function(r){var n=e.apply(this,arguments);ne(r,n);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?Je(s,this.onsuccess):s),i&&(this.onerror=this.onerror?Je(i,this.onerror):i),n===void 0?o===void 0?void 0:o:ne(n,o)}}function ud(e,t){return e===K?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function $n(e,t){return e===K?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return r.then(function(){return t.apply(n,i)})}return t.apply(this,arguments)}}gr.ModifyError=Cr,gr.DexieError=pt,gr.BulkError=Rt;var qt={};const[An,Sr,vn]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Wt(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Wt(t),e]})(),Xi=Sr&&Sr.then,mr=An&&An.constructor,es=!!vn;var wn=!1,dd=vn?()=>{vn.then(tr)}:V.setImmediate?setImmediate.bind(null,tr):V.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{tr(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(tr,0)},Ft=function(e,t){Tt.push([e,t]),Nr&&(dd(),Nr=!1)},bn=!0,Nr=!0,Ye=[],yr=[],En=null,kn=Dt,gt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ms,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Ms(e[0],e[1])}catch{}})}},L=gt,Tt=[],Xe=0,Ar=[];function I(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=K,this._lib=!1;var t=this._PSD=L;if(pe&&(this._stackHolder=et(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==qt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&xn(this,this._value))}this._state=null,this._value=null,++t.ref,Hi(this,e)}const _n={get:function(){var e=L,t=Tr;function r(n,s){var i=!e.global&&(e!==L||t!==Tr);const o=i&&!Ee();var l=new I((a,c)=>{ts(this,new ji(Lr(n,e,i,o),Lr(s,e,i,o),a,c,e))});return pe&&eo(l,this),l}return r.prototype=qt,r},set:function(e){we(this,"then",e&&e.prototype===qt?_n:{get:function(){return e},set:_n.set})}};function ji(e,t,r,n,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=s}function Hi(e,t){try{t(r=>{if(e._state===null){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ht();r&&typeof r.then=="function"?Hi(e,(s,i)=>{r instanceof I?r._then(s,i):r.then(s,i)}):(e._state=!0,e._value=r,Ji(e)),n&&Jt()}},xn.bind(null,e))}catch(r){xn(e,r)}}function xn(e,t){if(yr.push(t),e._state===null){var r=e._lib&&Ht();t=kn(t),e._state=!1,e._value=t,pe&&t!==null&&typeof t=="object"&&!t._promise&&function(n,s,i){try{n.apply(null,i)}catch(o){s&&s(o)}}(()=>{var n=Xn(t,"stack");t._promise=e,we(t,"stack",{get:()=>wn?n&&(n.get?n.get.apply(t):n.value):e.stack})}),function(n){Ye.some(s=>s._value===n._value)||Ye.push(n)}(e),Ji(e),r&&Jt()}}function Ji(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)ts(e,t[r]);var s=e._PSD;--s.ref||s.finalize(),Xe===0&&(++Xe,Ft(()=>{--Xe==0&&rs()},[]))}function ts(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Xe,Ft(fd,[r,e,t])}else e._listeners.push(t)}function fd(e,t,r){try{En=t;var n,s=t._value;t._state?n=e(s):(yr.length&&(yr=[]),n=e(s),yr.indexOf(s)===-1&&function(i){for(var o=Ye.length;o;)if(Ye[--o]._value===i._value)return void Ye.splice(o,1)}(t)),r.resolve(n)}catch(i){r.reject(i)}finally{En=null,--Xe==0&&rs(),--r.psd.ref||r.psd.finalize()}}function $i(e,t,r){if(t.length===r)return t;var n="";if(e._state===!1){var s,i,o=e._value;o!=null?(s=o.name||"Error",i=o.message||o,n=yn(o,0)):(s=o,i=""),t.push(s+(i?": "+i:"")+n)}return pe&&((n=yn(e._stackHolder,2))&&t.indexOf(n)===-1&&t.push(n),e._prev&&$i(e._prev,t,r)),t}function eo(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function tr(){Ht()&&Jt()}function Ht(){var e=bn;return bn=!1,Nr=!1,e}function Jt(){var e,t,r;do for(;Tt.length>0;)for(e=Tt,Tt=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(Tt.length>0);bn=!0,Nr=!0}function rs(){var e=Ye;Ye=[],e.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var t=Ar.slice(0),r=t.length;r;)t[--r]()}function rr(e){return new I(qt,!1,e)}function Q(e,t){var r=L;return function(){var n=Ht(),s=L;try{return Te(r,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{Te(s,!1),n&&Jt()}}}At(I.prototype,{then:_n,_then:function(e,t){ts(this,new ji(null,null,e,t,L))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,n=>n instanceof t?r(n):rr(n)):this.then(null,n=>n&&n.name===t?r(n):rr(n))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),rr(t)))},stack:{get:function(){if(this._stack)return this._stack;try{wn=!0;var e=$i(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{wn=!1}}},timeout:function(e,t){return e<1/0?new I((r,n)=>{var s=setTimeout(()=>n(new B.Timeout(t)),e);this.then(r,n).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&we(I.prototype,Symbol.toStringTag,"Dexie.Promise"),gt.env=to(),At(I,{all:function(){var e=Ae.apply(null,arguments).map(nr);return new I(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach((s,i)=>I.resolve(s).then(o=>{e[i]=o,--n||t(e)},r))})},resolve:e=>{if(e instanceof I)return e;if(e&&typeof e.then=="function")return new I((r,n)=>{e.then(r,n)});var t=new I(qt,!0,e);return eo(t,En),t},reject:rr,race:function(){var e=Ae.apply(null,arguments).map(nr);return new I((t,r)=>{e.map(n=>I.resolve(n).then(t,r))})},PSD:{get:()=>L,set:e=>L=e},totalEchoes:{get:()=>Tr},newPSD:Ne,usePSD:Et,scheduler:{get:()=>Ft,set:e=>{Ft=e}},rejectionMapper:{get:()=>kn,set:e=>{kn=e}},follow:(e,t)=>new I((r,n)=>Ne((s,i)=>{var o=L;o.unhandleds=[],o.onunhandled=i,o.finalize=Je(function(){(function(l){function a(){l(),Ar.splice(Ar.indexOf(a),1)}Ar.push(a),++Xe,Ft(()=>{--Xe==0&&rs()},[])})(()=>{this.unhandleds.length===0?s():i(this.unhandleds[0])})},o.finalize),e()},t,r,n))}),mr&&(mr.allSettled&&we(I,"allSettled",function(){const e=Ae.apply(null,arguments).map(nr);return new I(t=>{e.length===0&&t([]);let r=e.length;const n=new Array(r);e.forEach((s,i)=>I.resolve(s).then(o=>n[i]={status:"fulfilled",value:o},o=>n[i]={status:"rejected",reason:o}).then(()=>--r||t(n)))})}),mr.any&&typeof AggregateError<"u"&&we(I,"any",function(){const e=Ae.apply(null,arguments).map(nr);return new I((t,r)=>{e.length===0&&r(new AggregateError([]));let n=e.length;const s=new Array(n);e.forEach((i,o)=>I.resolve(i).then(l=>t(l),l=>{s[o]=l,--n||r(new AggregateError(s))}))})}));const $={awaits:0,echoes:0,id:0};var hd=0,vr=[],jr=0,Tr=0,pd=0;function Ne(e,t,r,n){var s=L,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++pd;var o=gt.env;i.env=es?{Promise:I,PromiseProp:{value:I,configurable:!0,writable:!0},all:I.all,race:I.race,allSettled:I.allSettled,any:I.any,resolve:I.resolve,reject:I.reject,nthen:Us(o.nthen,i),gthen:Us(o.gthen,i)}:{},t&&ne(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=Et(i,e,r,n);return i.ref===0&&i.finalize(),l}function bt(){return $.id||($.id=++hd),++$.awaits,$.echoes+=100,$.id}function Ee(){return!!$.awaits&&(--$.awaits==0&&($.id=0),$.echoes=100*$.awaits,!0)}function nr(e){return $.echoes&&e&&e.constructor===mr?(bt(),e.then(t=>(Ee(),t),t=>(Ee(),j(t)))):e}function gd(e){++Tr,$.echoes&&--$.echoes!=0||($.echoes=$.id=0),vr.push(L),Te(e,!0)}function md(){var e=vr[vr.length-1];vr.pop(),Te(e,!1)}function Te(e,t){var r=L;if((t?!$.echoes||jr++&&e===L:!jr||--jr&&e===L)||ro(t?gd.bind(null,e):md),e!==L&&(L=e,r===gt&&(gt.env=to()),es)){var n=gt.env.Promise,s=e.env;Sr.then=s.nthen,n.prototype.then=s.gthen,(r.global||e.global)&&(Object.defineProperty(V,"Promise",s.PromiseProp),n.all=s.all,n.race=s.race,n.resolve=s.resolve,n.reject=s.reject,s.allSettled&&(n.allSettled=s.allSettled),s.any&&(n.any=s.any))}}function to(){var e=V.Promise;return es?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(V,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Sr.then,gthen:e.prototype.then}:{}}function Et(e,t,r,n,s){var i=L;try{return Te(e,!0),t(r,n,s)}finally{Te(i,!1)}}function ro(e){Xi.call(An,e)}function Lr(e,t,r,n){return typeof e!="function"?e:function(){var s=L;r&&bt(),Te(t,!0);try{return e.apply(this,arguments)}finally{Te(s,!1),n&&ro(Ee)}}}function Us(e,t){return function(r,n){return e.call(this,Lr(r,t),Lr(n,t))}}(""+Xi).indexOf("[native code]")===-1&&(bt=Ee=K);function Ms(e,t){var r;try{r=t.onuncatched(e)}catch{}if(r!==!1)try{var n,s={promise:t,reason:e};if(V.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),ne(n,s)):V.CustomEvent&&ne(n=new CustomEvent("unhandledrejection",{detail:s}),s),n&&V.dispatchEvent&&(dispatchEvent(n),!V.PromiseRejectionEvent&&V.onunhandledrejection))try{V.onunhandledrejection(n)}catch{}pe&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var j=I.reject;function In(e,t,r,n){if(e.idbdb&&(e._state.openComplete||L.letThrough||e._vip)){var s=e._createTransaction(t,r,e._dbSchema);try{s.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Jn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>In(e,t,r,n))):j(i)}return s._promise(t,(i,o)=>Ne(()=>(L.trans=s,n(i,o,s)))).then(i=>s._completion.then(()=>i))}if(e._state.openComplete)return j(new B.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return j(new B.DatabaseClosed);e.open().catch(K)}return e._state.dbReadyPromise.then(()=>In(e,t,r,n))}const We=String.fromCharCode(65535),ge="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Kt=[],Fr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),yd=Fr,Ad=Fr,no=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function $e(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const so={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function sr(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=jt(t))[e],t)}class vd{_trans(t,r,n){const s=this._tx||L.trans,i=this.name;function o(a,c,u){if(!u.schema[i])throw new B.NotFound("Table "+i+" not part of transaction");return r(u.idbtrans,u)}const l=Ht();try{return s&&s.db===this.db?s===L.trans?s._promise(t,o,n):Ne(()=>s._promise(t,o,n),{trans:s,transless:L.transless||L}):In(this.db,t,[this.name],o)}finally{l&&Jt()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:t}).then(s=>this.hook.reading.fire(s))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(ee(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=Z(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&r.every(u=>c.keyPath.indexOf(u)>=0)&&c.keyPath.every(u=>r.indexOf(u)>=0))[0];if(n&&this.db._maxKey!==We)return this.where(n.name).equals(n.keyPath.map(c=>t[c]));!n&&pe&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function o(c,u){try{return i.cmp(c,u)===0}catch{return!1}}const[l,a]=r.reduce(([c,u],f)=>{const d=s[f],h=t[f];return[c||d,c||!d?$e(u,d&&d.multi?m=>{const p=be(m,f);return ee(p)&&p.some(y=>o(h,y))}:m=>o(h,be(m,f))):u]},[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(a):n?this.filter(a):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,ee(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const r=n=>{if(!n)return n;const s=Object.create(t.prototype);for(var i in n)if(ae(n,i))try{s[i]=n[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t}defineClass(){return this.mapToClass(function(t){ne(this,t)})}add(t,r){const{auto:n,keyPath:s}=this.schema.primKey;let i=t;return s&&n&&(i=sr(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:r!=null?[r]:null,values:[i]})).then(o=>o.numFailures?I.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{de(t,s,o)}catch{}return o})}update(t,r){if(typeof t!="object"||ee(t))return this.where(":id").equals(t).modify(r);{const n=be(t,this.schema.primKey.keyPath);if(n===void 0)return j(new B.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?Z(r).forEach(s=>{de(t,s,r[s])}):r(t,{value:t,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(t,r){const{auto:n,keyPath:s}=this.schema.primKey;let i=t;return s&&n&&(i=sr(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:r!=null?[r]:null})).then(o=>o.numFailures?I.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{de(t,s,o)}catch{}return o})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?I.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:so})).then(t=>t.numFailures?I.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(n=>n.map(s=>this.hook.reading.fire(s))))}bulkAdd(t,r,n){const s=Array.isArray(r)?r:void 0,i=(n=n||(s?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&s)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let u=a&&l?t.map(sr(a)):t;return this.core.mutate({trans:o,type:"add",keys:s,values:u,wantResults:i}).then(({numFailures:f,results:d,lastResult:h,failures:m})=>{if(f===0)return i?d:h;throw new Rt(`${this.name}.bulkAdd(): ${f} of ${c} operations failed`,m)})})}bulkPut(t,r,n){const s=Array.isArray(r)?r:void 0,i=(n=n||(s?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&s)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let u=a&&l?t.map(sr(a)):t;return this.core.mutate({trans:o,type:"put",keys:s,values:u,wantResults:i}).then(({numFailures:f,results:d,lastResult:h,failures:m})=>{if(f===0)return i?d:h;throw new Rt(`${this.name}.bulkPut(): ${f} of ${c} operations failed`,m)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:t})).then(({numFailures:n,lastResult:s,failures:i})=>{if(n===0)return s;throw new Rt(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,i)})}}function Ut(e){var t={},r=function(l,a){if(a){for(var c=arguments.length,u=new Array(c-1);--c;)u[c-1]=arguments[c];return t[l].subscribe.apply(null,u),e}if(typeof l=="string")return t[l]};r.addEventType=i;for(var n=1,s=arguments.length;n<s;++n)i(arguments[n]);return r;function i(l,a,c){if(typeof l=="object")return o(l);a||(a=ud),c||(c=K);var u={subscribers:[],fire:c,subscribe:function(f){u.subscribers.indexOf(f)===-1&&(u.subscribers.push(f),u.fire=a(u.fire,f))},unsubscribe:function(f){u.subscribers=u.subscribers.filter(function(d){return d!==f}),u.fire=u.subscribers.reduce(a,c)}};return t[l]=r[l]=u,u}function o(l){Z(l).forEach(function(a){var c=l[a];if(ee(c))i(a,l[a][0],l[a][1]);else{if(c!=="asap")throw new B.InvalidArgument("Invalid event config");var u=i(a,Dt,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];u.subscribers.forEach(function(h){Mi(function(){h.apply(null,d)})})})}})}}function Ct(e,t){return ht(t).from({prototype:e}),t}function rt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Hr(e,t){e.filter=$e(e.filter,t)}function Jr(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>$e(n(),t()):t,e.justLimit=r&&!n}function wr(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Vs(e,t,r){const n=wr(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function ir(e,t,r,n){const s=e.replayFilter?$e(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(l,a,c)=>{if(!s||s(a,c,d=>a.stop(d),d=>a.fail(d))){var u=a.primaryKey,f=""+u;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(u)),ae(i,f)||(i[f]=!0,t(l,a,c))}};return Promise.all([e.or._iterate(o,r),Qs(Vs(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Qs(Vs(e,n,r),$e(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Qs(e,t,r,n){var s=Q(n?(i,o,l)=>r(n(i),o,l):r);return e.then(i=>{if(i)return i.start(()=>{var o=()=>i.continue();t&&!t(i,l=>o=l,l=>{i.stop(l),o=K},l=>{i.fail(l),o=K})||s(i.value,i,l=>o=l),o()})})}function re(e,t){try{const r=zs(e),n=zs(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(s,i){const o=s.length,l=i.length,a=o<l?o:l;for(let c=0;c<a;++c)if(s[c]!==i[c])return s[c]<i[c]?-1:1;return o===l?0:o<l?-1:1}(Ws(e),Ws(t));case"Array":return function(s,i){const o=s.length,l=i.length,a=o<l?o:l;for(let c=0;c<a;++c){const u=re(s[c],i[c]);if(u!==0)return u}return o===l?0:o<l?-1:1}(e,t)}}catch{}return NaN}function zs(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const r=gn(e);return r==="ArrayBuffer"?"binary":r}function Ws(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class wd{_read(t,r){var n=this._ctx;return n.error?n.table._trans(null,j.bind(null,n.error)):n.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,j.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=$e(r.algorithm,t)}_iterate(t,r){return ir(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&ne(n,t),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(n=>ir(r,t,n,r.table.core))}count(t){return this._read(r=>{const n=this._ctx,s=n.table.core;if(rt(n,!0))return s.count({trans:r,query:{index:wr(n,s.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var i=0;return ir(n,()=>(++i,!1),r,s).then(()=>i)}).then(t)}sortBy(t,r){const n=t.split(".").reverse(),s=n[0],i=n.length-1;function o(c,u){return u?o(c[n[u]],u-1):c[s]}var l=this._ctx.dir==="next"?1:-1;function a(c,u){var f=o(c,i),d=o(u,i);return f<d?-l:f>d?l:0}return this.toArray(function(c){return c.sort(a)}).then(r)}toArray(t){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&rt(n,!0)&&n.limit>0){const{valueMapper:s}=n,i=wr(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(({result:o})=>s?o.map(s):o)}{const s=[];return ir(n,i=>s.push(i),r,n.table.core).then(()=>s)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,rt(r)?Jr(r,()=>{var n=t;return(s,i)=>n===0||(n===1?(--n,!1):(i(()=>{s.advance(n),n=0}),!1))}):Jr(r,()=>{var n=t;return()=>--n<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Jr(this._ctx,()=>{var r=t;return function(n,s,i){return--r<=0&&s(i),r>=0}},!0),this}until(t,r){return Hr(this._ctx,function(n,s,i){return!t(n.value)||(s(i),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,n;return Hr(this._ctx,function(s){return t(s.value)}),r=this._ctx,n=t,r.isMatch=$e(r.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,s){t(s.key,s)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,s){t(s.primaryKey,s)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(s,i){n.push(i.key)}).then(function(){return n}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&rt(r,!0)&&r.limit>0)return this._read(s=>{var i=wr(r,r.table.core.schema);return r.table.core.query({trans:s,values:!1,limit:r.limit,query:{index:i,range:r.range}})}).then(({result:s})=>s).then(t);r.keysOnly=!r.isMatch;var n=[];return this.each(function(s,i){n.push(i.primaryKey)}).then(function(){return n}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var n={};return Hr(this._ctx,function(s){var i=s.primaryKey.toString(),o=ae(n,i);return n[i]=!0,!o}),this}modify(t){var r=this._ctx;return this._write(n=>{var s;if(typeof t=="function")s=t;else{var i=Z(t),o=i.length;s=function(p){for(var y=!1,A=0;A<o;++A){var g=i[A],w=t[g];be(p,g)!==w&&(de(p,g,w),y=!0)}return y}}const l=r.table.core,{outbound:a,extractKey:c}=l.schema.primaryKey,u=this.db._options.modifyChunkSize||200,f=[];let d=0;const h=[],m=(p,y)=>{const{failures:A,numFailures:g}=y;d+=p-g;for(let w of Z(A))f.push(A[w])};return this.clone().primaryKeys().then(p=>{const y=A=>{const g=Math.min(u,p.length-A);return l.getMany({trans:n,keys:p.slice(A,A+g),cache:"immutable"}).then(w=>{const _=[],b=[],E=a?[]:null,x=[];for(let C=0;C<g;++C){const F=w[C],R={value:jt(F),primKey:p[A+C]};s.call(R,R.value,R)!==!1&&(R.value==null?x.push(p[A+C]):a||re(c(F),c(R.value))===0?(b.push(R.value),a&&E.push(p[A+C])):(x.push(p[A+C]),_.push(R.value)))}const P=rt(r)&&r.limit===1/0&&(typeof t!="function"||t===$r)&&{index:r.index,range:r.range};return Promise.resolve(_.length>0&&l.mutate({trans:n,type:"add",values:_}).then(C=>{for(let F in C.failures)x.splice(parseInt(F),1);m(_.length,C)})).then(()=>(b.length>0||P&&typeof t=="object")&&l.mutate({trans:n,type:"put",keys:E,values:b,criteria:P,changeSpec:typeof t!="function"&&t}).then(C=>m(b.length,C))).then(()=>(x.length>0||P&&t===$r)&&l.mutate({trans:n,type:"delete",keys:x,criteria:P}).then(C=>m(x.length,C))).then(()=>p.length>A+g&&y(A+u))})};return y(0).then(()=>{if(f.length>0)throw new Cr("Error modifying one or more objects",f,d,h);return p.length})})})}delete(){var t=this._ctx,r=t.range;return rt(t)&&(t.isPrimKey&&!Ad||r.type===3)?this._write(n=>{const{primaryKey:s}=t.table.core.schema,i=r;return t.table.core.count({trans:n,query:{index:s,range:i}}).then(o=>t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(({failures:l,lastResult:a,results:c,numFailures:u})=>{if(u)throw new Cr("Could not delete some values",Object.keys(l).map(f=>l[f]),o-u);return o-u}))}):this.modify($r)}}const $r=(e,t)=>t.value=null;function bd(e,t){return e<t?-1:e===t?0:1}function Ed(e,t){return e>t?-1:e===t?0:1}function ie(e,t,r){var n=e instanceof oo?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function nt(e){return new e.Collection(e,()=>io("")).limit(0)}function kd(e,t,r,n,s,i){for(var o=Math.min(e.length,n.length),l=-1,a=0;a<o;++a){var c=t[a];if(c!==n[a])return s(e[a],r[a])<0?e.substr(0,a)+r[a]+r.substr(a+1):s(e[a],n[a])<0?e.substr(0,a)+n[a]+r.substr(a+1):l>=0?e.substr(0,l)+t[l]+r.substr(l+1):null;s(e[a],c)<0&&(l=a)}return o<n.length&&i==="next"?e+r.substr(e.length):o<e.length&&i==="prev"?e.substr(0,r.length):l<0?null:e.substr(0,l)+n[l]+r.substr(l+1)}function or(e,t,r,n){var s,i,o,l,a,c,u,f=r.length;if(!r.every(p=>typeof p=="string"))return ie(e,"String expected.");function d(p){s=function(A){return A==="next"?g=>g.toUpperCase():g=>g.toLowerCase()}(p),i=function(A){return A==="next"?g=>g.toLowerCase():g=>g.toUpperCase()}(p),o=p==="next"?bd:Ed;var y=r.map(function(A){return{lower:i(A),upper:s(A)}}).sort(function(A,g){return o(A.lower,g.lower)});l=y.map(function(A){return A.upper}),a=y.map(function(A){return A.lower}),c=p,u=p==="next"?"":n}d("next");var h=new e.Collection(e,()=>xe(l[0],a[f-1]+n));h._ondirectionchange=function(p){d(p)};var m=0;return h._addAlgorithm(function(p,y,A){var g=p.key;if(typeof g!="string")return!1;var w=i(g);if(t(w,a,m))return!0;for(var _=null,b=m;b<f;++b){var E=kd(g,w,l[b],a[b],o,c);E===null&&_===null?m=b+1:(_===null||o(_,E)>0)&&(_=E)}return y(_!==null?function(){p.continue(_+u)}:A),!1}),h}function xe(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function io(e){return{type:1,lower:e,upper:e}}class oo{get Collection(){return this._ctx.table.db.Collection}between(t,r,n,s){n=n!==!1,s=s===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(n||s)&&(!n||!s)?nt(this):new this.Collection(this,()=>xe(t,r,!n,!s))}catch{return ie(this,ge)}}equals(t){return t==null?ie(this,ge):new this.Collection(this,()=>io(t))}above(t){return t==null?ie(this,ge):new this.Collection(this,()=>xe(t,void 0,!0))}aboveOrEqual(t){return t==null?ie(this,ge):new this.Collection(this,()=>xe(t,void 0,!1))}below(t){return t==null?ie(this,ge):new this.Collection(this,()=>xe(void 0,t,!1,!0))}belowOrEqual(t){return t==null?ie(this,ge):new this.Collection(this,()=>xe(void 0,t))}startsWith(t){return typeof t!="string"?ie(this,"String expected."):this.between(t,t+We,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):or(this,(r,n)=>r.indexOf(n[0])===0,[t],We)}equalsIgnoreCase(t){return or(this,(r,n)=>r===n[0],[t],"")}anyOfIgnoreCase(){var t=Ae.apply(it,arguments);return t.length===0?nt(this):or(this,(r,n)=>n.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=Ae.apply(it,arguments);return t.length===0?nt(this):or(this,(r,n)=>n.some(s=>r.indexOf(s)===0),t,We)}anyOf(){const t=Ae.apply(it,arguments);let r=this._cmp;try{t.sort(r)}catch{return ie(this,ge)}if(t.length===0)return nt(this);const n=new this.Collection(this,()=>xe(t[0],t[t.length-1]));n._ondirectionchange=i=>{r=i==="next"?this._ascending:this._descending,t.sort(r)};let s=0;return n._addAlgorithm((i,o,l)=>{const a=i.key;for(;r(a,t[s])>0;)if(++s,s===t.length)return o(l),!1;return r(a,t[s])===0||(o(()=>{i.continue(t[s])}),!1)}),n}notEqual(t){return this.inAnyRange([[-(1/0),t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=Ae.apply(it,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ie(this,ge)}const r=t.reduce((n,s)=>n?n.concat([[n[n.length-1][1],s]]):[[-(1/0),s]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const n=this._cmp,s=this._ascending,i=this._descending,o=this._min,l=this._max;if(t.length===0)return nt(this);if(!t.every(g=>g[0]!==void 0&&g[1]!==void 0&&s(g[0],g[1])<=0))return ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);const a=!r||r.includeLowers!==!1,c=r&&r.includeUppers===!0;let u,f=s;function d(g,w){return f(g[0],w[0])}try{u=t.reduce(function(g,w){let _=0,b=g.length;for(;_<b;++_){const E=g[_];if(n(w[0],E[1])<0&&n(w[1],E[0])>0){E[0]=o(E[0],w[0]),E[1]=l(E[1],w[1]);break}}return _===b&&g.push(w),g},[]),u.sort(d)}catch{return ie(this,ge)}let h=0;const m=c?g=>s(g,u[h][1])>0:g=>s(g,u[h][1])>=0,p=a?g=>i(g,u[h][0])>0:g=>i(g,u[h][0])>=0;let y=m;const A=new this.Collection(this,()=>xe(u[0][0],u[u.length-1][1],!a,!c));return A._ondirectionchange=g=>{g==="next"?(y=m,f=s):(y=p,f=i),u.sort(d)},A._addAlgorithm((g,w,_)=>{for(var b=g.key;y(b);)if(++h,h===u.length)return w(_),!1;return!!function(E){return!m(E)&&!p(E)}(b)||(this._cmp(b,u[h][1])===0||this._cmp(b,u[h][0])===0||w(()=>{f===s?g.continue(u[h][0]):g.continue(u[h][1])}),!1)}),A}startsWithAnyOf(){const t=Ae.apply(it,arguments);return t.every(r=>typeof r=="string")?t.length===0?nt(this):this.inAnyRange(t.map(r=>[r,r+We])):ie(this,"startsWithAnyOf() only works with strings")}}function he(e){return Q(function(t){return Zt(t),e(t.target.error),!1})}function Zt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Le=Ut(null,"storagemutated");class _d{_lock(){return Nt(!L.global),++this._reculock,this._reculock!==1||L.global||(L.lockOwnerFor=this),this}_unlock(){if(Nt(!L.global),--this._reculock==0)for(L.global||(L.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Et(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&L.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(Nt(!this.idbtrans),!t&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new B.DatabaseClosed(n);case"MissingAPIError":throw new B.MissingAPI(n.message,n);default:throw new B.OpenFailed(n)}if(!this.active)throw new B.TransactionInactive;return Nt(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Q(s=>{Zt(s),this._reject(t.error)}),t.onabort=Q(s=>{Zt(s),this.active&&this._reject(new B.Abort(t.error)),this.active=!1,this.on("abort").fire(s)}),t.oncomplete=Q(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Le.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,n){if(t==="readwrite"&&this.mode!=="readwrite")return j(new B.ReadOnly("Transaction is readonly"));if(!this.active)return j(new B.TransactionInactive);if(this._locked())return new I((i,o)=>{this._blockedFuncs.push([()=>{this._promise(t,r,n).then(i,o)},L])});if(n)return Ne(()=>{var i=new I((o,l)=>{this._lock();const a=r(o,l,this);a&&a.then&&a.then(o,l)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new I((i,o)=>{var l=r(i,o,this);l&&l.then&&l.then(i,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const n=I.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var s=r.idbtrans.objectStore(r.storeNames[0]);(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(s.get(-1/0).onsuccess=o)})()}var i=r._waitingFor;return new I((o,l)=>{n.then(a=>r._waitingQueue.push(Q(o.bind(null,a))),a=>r._waitingQueue.push(Q(l.bind(null,a)))).finally(()=>{r._waitingFor===i&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(ae(r,t))return r[t];const n=this.schema[t];if(!n)throw new B.NotFound("Table "+t+" not part of transaction");const s=new this.db.Table(t,n,this);return s.core=this.db.core.table(t),r[t]=s,s}}function Cn(e,t,r,n,s,i,o){return{name:e,keyPath:t,unique:r,multi:n,auto:s,compound:i,src:(r&&!o?"&":"")+(n?"*":"")+(s?"++":"")+ao(t)}}function ao(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function lo(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Vi(r,n=>[n.name,n])}}let Yt=e=>{try{return e.only([[]]),Yt=()=>[[]],[[]]}catch{return Yt=()=>We,We}};function Sn(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>be(r,t)}(e):t=>be(t,e)}function Ds(e){return[].slice.call(e)}let xd=0;function Mt(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function Id(e,t,r){function n(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:u,lowerOpen:f,upperOpen:d}=a;return c===void 0?u===void 0?null:t.upperBound(u,!!d):u===void 0?t.lowerBound(c,!!f):t.bound(c,u,!!f,!!d)}const{schema:s,hasGetAll:i}=function(a,c){const u=Ds(a.objectStoreNames);return{schema:{name:a.name,tables:u.map(f=>c.objectStore(f)).map(f=>{const{keyPath:d,autoIncrement:h}=f,m=ee(d),p=d==null,y={},A={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:m,keyPath:d,autoIncrement:h,unique:!0,extractKey:Sn(d)},indexes:Ds(f.indexNames).map(g=>f.index(g)).map(g=>{const{name:w,unique:_,multiEntry:b,keyPath:E}=g,x={name:w,compound:ee(E),keyPath:E,unique:_,multiEntry:b,extractKey:Sn(E)};return y[Mt(E)]=x,x}),getIndexByKeyPath:g=>y[Mt(g)]};return y[":id"]=A.primaryKey,d!=null&&(y[Mt(d)]=A.primaryKey),A})},hasGetAll:u.length>0&&"getAll"in c.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),o=s.tables.map(a=>function(c){const u=c.name;return{name:u,schema:c,mutate:function({trans:f,type:d,keys:h,values:m,range:p}){return new Promise((y,A)=>{y=Q(y);const g=f.objectStore(u),w=g.keyPath==null,_=d==="put"||d==="add";if(!_&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:b}=h||m||{length:1};if(h&&m&&h.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(b===0)return y({numFailures:0,failures:{},results:[],lastResult:void 0});let E;const x=[],P=[];let C=0;const F=Y=>{++C,Zt(Y)};if(d==="deleteRange"){if(p.type===4)return y({numFailures:C,failures:P,results:[],lastResult:void 0});p.type===3?x.push(E=g.clear()):x.push(E=g.delete(n(p)))}else{const[Y,D]=_?w?[m,h]:[m,null]:[h,null];if(_)for(let M=0;M<b;++M)x.push(E=D&&D[M]!==void 0?g[d](Y[M],D[M]):g[d](Y[M])),E.onerror=F;else for(let M=0;M<b;++M)x.push(E=g[d](Y[M])),E.onerror=F}const R=Y=>{const D=Y.target.result;x.forEach((M,ke)=>M.error!=null&&(P[ke]=M.error)),y({numFailures:C,failures:P,results:d==="delete"?h:x.map(M=>M.result),lastResult:D})};E.onerror=Y=>{F(Y),R(Y)},E.onsuccess=R})},getMany:({trans:f,keys:d})=>new Promise((h,m)=>{h=Q(h);const p=f.objectStore(u),y=d.length,A=new Array(y);let g,w=0,_=0;const b=x=>{const P=x.target;A[P._pos]=P.result,++_===w&&h(A)},E=he(m);for(let x=0;x<y;++x)d[x]!=null&&(g=p.get(d[x]),g._pos=x,g.onsuccess=b,g.onerror=E,++w);w===0&&h(A)}),get:({trans:f,key:d})=>new Promise((h,m)=>{h=Q(h);const p=f.objectStore(u).get(d);p.onsuccess=y=>h(y.target.result),p.onerror=he(m)}),query:function(f){return d=>new Promise((h,m)=>{h=Q(h);const{trans:p,values:y,limit:A,query:g}=d,w=A===1/0?void 0:A,{index:_,range:b}=g,E=p.objectStore(u),x=_.isPrimaryKey?E:E.index(_.name),P=n(b);if(A===0)return h({result:[]});if(f){const C=y?x.getAll(P,w):x.getAllKeys(P,w);C.onsuccess=F=>h({result:F.target.result}),C.onerror=he(m)}else{let C=0;const F=y||!("openKeyCursor"in x)?x.openCursor(P):x.openKeyCursor(P),R=[];F.onsuccess=Y=>{const D=F.result;return D?(R.push(y?D.value:D.primaryKey),++C===A?h({result:R}):void D.continue()):h({result:R})},F.onerror=he(m)}})}(i),openCursor:function({trans:f,values:d,query:h,reverse:m,unique:p}){return new Promise((y,A)=>{y=Q(y);const{index:g,range:w}=h,_=f.objectStore(u),b=g.isPrimaryKey?_:_.index(g.name),E=m?p?"prevunique":"prev":p?"nextunique":"next",x=d||!("openKeyCursor"in b)?b.openCursor(n(w),E):b.openKeyCursor(n(w),E);x.onerror=he(A),x.onsuccess=Q(P=>{const C=x.result;if(!C)return void y(null);C.___id=++xd,C.done=!1;const F=C.continue.bind(C);let R=C.continuePrimaryKey;R&&(R=R.bind(C));const Y=C.advance.bind(C),D=()=>{throw new Error("Cursor not stopped")};C.trans=f,C.stop=C.continue=C.continuePrimaryKey=C.advance=()=>{throw new Error("Cursor not started")},C.fail=Q(A),C.next=function(){let M=1;return this.start(()=>M--?this.continue():this.stop()).then(()=>this)},C.start=M=>{const ke=new Promise((X,Be)=>{X=Q(X),x.onerror=he(Be),C.fail=Be,C.stop=kt=>{C.stop=C.continue=C.continuePrimaryKey=C.advance=D,X(kt)}}),fe=()=>{if(x.result)try{M()}catch(X){C.fail(X)}else C.done=!0,C.start=()=>{throw new Error("Cursor behind last entry")},C.stop()};return x.onsuccess=Q(X=>{x.onsuccess=fe,fe()}),C.continue=F,C.continuePrimaryKey=R,C.advance=Y,fe(),ke},y(C)},A)})},count({query:f,trans:d}){const{index:h,range:m}=f;return new Promise((p,y)=>{const A=d.objectStore(u),g=h.isPrimaryKey?A:A.index(h.name),w=n(m),_=w?g.count(w):g.count();_.onsuccess=Q(b=>p(b.target.result)),_.onerror=he(y)})}}}(a)),l={};return o.forEach(a=>l[a.name]=a),{stack:"dbcore",transaction:e.transaction.bind(e),table(a){if(!l[a])throw new Error(`Table '${a}' not found`);return l[a]},MIN_KEY:-1/0,MAX_KEY:Yt(t),schema:s}}function Nn({_novip:e},t){const r=t.db,n=function(s,i,{IDBKeyRange:o,indexedDB:l},a){return{dbcore:function(u,f){return f.reduce((d,{create:h})=>({...d,...h(d)}),u)}(Id(i,o,a),s.dbcore)}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach(s=>{const i=s.name;e.core.schema.tables.some(o=>o.name===i)&&(s.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=s.core))})}function Or({_novip:e},t,r,n){r.forEach(s=>{const i=n[s];t.forEach(o=>{const l=Xn(o,s);(!l||"value"in l&&l.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?we(o,s,{get(){return this.table(s)},set(a){Ki(this,s,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new e.Table(s,i))})})}function Tn({_novip:e},t){t.forEach(r=>{for(let n in r)r[n]instanceof e.Table&&delete r[n]})}function Cd(e,t){return e._cfg.version-t._cfg.version}function Sd(e,t,r,n){const s=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,s);i.create(r),i._completion.catch(n);const o=i._reject.bind(i),l=L.transless||L;Ne(()=>{L.trans=i,L.transless=l,t===0?(Z(s).forEach(a=>{en(r,a,s[a].primKey,s[a].indexes)}),Nn(e,r),I.follow(()=>e.on.populate.fire(i)).catch(o)):function({_novip:a},c,u,f){const d=[],h=a._versions;let m=a._dbSchema=On(a,a.idbdb,f),p=!1;function y(){return d.length?I.resolve(d.shift()(u.idbtrans)).then(y):I.resolve()}return h.filter(A=>A._cfg.version>=c).forEach(A=>{d.push(()=>{const g=m,w=A._cfg.dbschema;Bn(a,g,f),Bn(a,w,f),m=a._dbSchema=w;const _=co(g,w);_.add.forEach(E=>{en(f,E[0],E[1].primKey,E[1].indexes)}),_.change.forEach(E=>{if(E.recreate)throw new B.Upgrade("Not yet support for changing primary key");{const x=f.objectStore(E.name);E.add.forEach(P=>Ln(x,P)),E.change.forEach(P=>{x.deleteIndex(P.name),Ln(x,P)}),E.del.forEach(P=>x.deleteIndex(P))}});const b=A._cfg.contentUpgrade;if(b&&A._cfg.version>c){Nn(a,f),u._memoizedTables={},p=!0;let E=Qi(w);_.del.forEach(F=>{E[F]=g[F]}),Tn(a,[a.Transaction.prototype]),Or(a,[a.Transaction.prototype],Z(E),E),u.schema=E;const x=jn(b);let P;x&&bt();const C=I.follow(()=>{if(P=b(u),P&&x){var F=Ee.bind(null,null);P.then(F,F)}});return P&&typeof P.then=="function"?I.resolve(P):C.then(()=>P)}}),d.push(g=>{(!p||!yd)&&function(w,_){[].slice.call(_.db.objectStoreNames).forEach(b=>w[b]==null&&_.db.deleteObjectStore(b))}(A._cfg.dbschema,g),Tn(a,[a.Transaction.prototype]),Or(a,[a.Transaction.prototype],a._storeNames,a._dbSchema),u.schema=a._dbSchema})}),y().then(()=>{var A,g;g=f,Z(A=m).forEach(w=>{g.db.objectStoreNames.contains(w)||en(g,w,A[w].primKey,A[w].indexes)})})}(e,t,i,r).catch(o)})}function co(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const s=e[n],i=t[n];if(s){const o={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!Fr)o.recreate=!0,r.change.push(o);else{const l=s.idxByName,a=i.idxByName;let c;for(c in l)a[c]||o.del.push(c);for(c in a){const u=l[c],f=a[c];u?u.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}}else r.add.push([n,i])}return r}function en(e,t,r,n){const s=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(i=>Ln(s,i)),s}function Ln(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function On(e,t,r){const n={};return Ir(t.objectStoreNames,0).forEach(s=>{const i=r.objectStore(s);let o=i.keyPath;const l=Cn(ao(o),o||"",!1,!1,!!i.autoIncrement,o&&typeof o!="string",!0),a=[];for(let u=0;u<i.indexNames.length;++u){const f=i.index(i.indexNames[u]);o=f.keyPath;var c=Cn(f.name,o,!!f.unique,!!f.multiEntry,!1,o&&typeof o!="string",!1);a.push(c)}n[s]=lo(s,l,a)}),n}function Bn({_novip:e},t,r){const n=r.db.objectStoreNames;for(let s=0;s<n.length;++s){const i=n[s],o=r.objectStore(i);e._hasGetAll="getAll"in o;for(let l=0;l<o.indexNames.length;++l){const a=o.indexNames[l],c=o.index(a).keyPath,u=typeof c=="string"?c:"["+Ir(c).join("+")+"]";if(t[i]){const f=t[i].idxByName[u];f&&(f.name=a,delete t[i].idxByName[u],t[i].idxByName[a]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&V.WorkerGlobalScope&&V instanceof V.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Nd{_parseStoresSpec(t,r){Z(t).forEach(n=>{if(t[n]!==null){var s=t[n].split(",").map((o,l)=>{const a=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Cn(a,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),ee(c),l===0)}),i=s.shift();if(i.multi)throw new B.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),r[n]=lo(n,i,s)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?ne(this._cfg.storesSource,t):t;const n=r._versions,s={};let i={};return n.forEach(o=>{ne(s,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(s,i)}),r._dbSchema=i,Tn(r,[r._allTables,r,r.Transaction.prototype]),Or(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],Z(i),i),r._storeNames=Z(i),this}upgrade(t){return this._cfg.contentUpgrade=$n(this._cfg.contentUpgrade||K,t),this}}function ns(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new je("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function ss(e){return e&&typeof e.databases=="function"}function Pn(e){return Ne(function(){return L.letThrough=!0,e()})}function Td(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function Ld(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?j(t.dbOpenError):e);pe&&(t.openCanceller._stackHolder=et()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function s(){if(t.openCanceller!==n)throw new B.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,o=null,l=!1;return I.race([n,(typeof navigator>"u"?I.resolve():Td()).then(()=>new I((a,c)=>{if(s(),!r)throw new B.MissingAPI;const u=e.name,f=t.autoSchema?r.open(u):r.open(u,Math.round(10*e.verno));if(!f)throw new B.MissingAPI;f.onerror=he(c),f.onblocked=Q(e._fireOnBlocked),f.onupgradeneeded=Q(d=>{if(o=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=Zt,o.abort(),f.result.close();const m=r.deleteDatabase(u);m.onsuccess=m.onerror=Q(()=>{c(new B.NoSuchDatabase(`Database ${u} doesnt exist`))})}else{o.onerror=he(c);var h=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;l=h<1,e._novip.idbdb=f.result,Sd(e,h/10,o,c)}},c),f.onsuccess=Q(()=>{o=null;const d=e._novip.idbdb=f.result,h=Ir(d.objectStoreNames);if(h.length>0)try{const p=d.transaction((m=h).length===1?m[0]:m,"readonly");t.autoSchema?function({_novip:y},A,g){y.verno=A.version/10;const w=y._dbSchema=On(0,A,g);y._storeNames=Ir(A.objectStoreNames,0),Or(y,[y._allTables],Z(w),w)}(e,d,p):(Bn(e,e._dbSchema,p),function(y,A){const g=co(On(0,y.idbdb,A),y._dbSchema);return!(g.add.length||g.change.some(w=>w.add.length||w.change.length))}(e,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Nn(e,p)}catch{}var m;Kt.push(e),d.onversionchange=Q(p=>{t.vcFired=!0,e.on("versionchange").fire(p)}),d.onclose=Q(p=>{e.on("close").fire(p)}),l&&function({indexedDB:p,IDBKeyRange:y},A){!ss(p)&&A!=="__dbnames"&&ns(p,y).put({name:A}).catch(K)}(e._deps,u),a()},c)}))]).then(()=>(s(),t.onReadyBeingFired=[],I.resolve(Pn(()=>e.on.ready.fire(e.vip))).then(function a(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce($n,K);return t.onReadyBeingFired=[],I.resolve(Pn(()=>c(e.vip))).then(a)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(a=>{t.dbOpenError=a;try{o&&o.abort()}catch{}return n===t.openCanceller&&e._close(),j(a)}).finally(()=>{t.openComplete=!0,i()})}function Gn(e){var t=i=>e.next(i),r=s(t),n=s(i=>e.throw(i));function s(i){return o=>{var l=i(o),a=l.value;return l.done?a:a&&typeof a.then=="function"?a.then(r,n):ee(a)?Promise.all(a).then(r,n):r(a)}}return s(t)()}function Od(e,t,r){var n=arguments.length;if(n<2)throw new B.InvalidArgument("Too few arguments");for(var s=new Array(n-1);--n;)s[n-1]=arguments[n];r=s.pop();var i=zi(s);return[e,i,r]}function uo(e,t,r,n,s){return I.resolve().then(()=>{const i=L.transless||L,o=e._createTransaction(t,r,e._dbSchema,n),l={trans:o,transless:i};if(n)o.idbtrans=n.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(f){return f.name===Jn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>uo(e,t,r,null,s))):j(f)}const a=jn(s);let c;a&&bt();const u=I.follow(()=>{if(c=s.call(o,o),c)if(a){var f=Ee.bind(null,null);c.then(f,f)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Gn(c))},l);return(c&&typeof c.then=="function"?I.resolve(c).then(f=>o.active?f:j(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(f=>(n&&o._resolve(),o._completion.then(()=>f))).catch(f=>(o._reject(f),j(f)))})}function ar(e,t,r){const n=ee(e)?e.slice():[e];for(let s=0;s<r;++s)n.push(t);return n}const Bd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,s={},i=[];function o(u,f,d){const h=Mt(u),m=s[h]=s[h]||[],p=u==null?0:typeof u=="string"?1:u.length,y=f>0,A={...d,isVirtual:y,keyTail:f,keyLength:p,extractKey:Sn(u),unique:!y&&d.unique};return m.push(A),A.isPrimaryKey||i.push(A),p>1&&o(p===2?u[0]:u.slice(0,p-1),f+1,d),m.sort((g,w)=>g.keyTail-w.keyTail),A}const l=o(n.primaryKey.keyPath,0,n.primaryKey);s[":id"]=[l];for(const u of n.indexes)o(u.keyPath,0,u);function a(u){const f=u.query.index;return f.isVirtual?{...u,query:{index:f,range:(d=u.query.range,h=f.keyTail,{type:d.type===1?2:d.type,lower:ar(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,h),lowerOpen:!0,upper:ar(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,h),upperOpen:!0})}}:u;var d,h}return{...r,schema:{...n,primaryKey:l,indexes:i,getIndexByKeyPath:function(u){const f=s[Mt(u)];return f&&f[0]}},count:u=>r.count(a(u)),query:u=>r.query(a(u)),openCursor(u){const{keyTail:f,isVirtual:d,keyLength:h}=u.query.index;return d?r.openCursor(a(u)).then(m=>m&&function(p){return Object.create(p,{continue:{value:function(A){A!=null?p.continue(ar(A,u.reverse?e.MAX_KEY:e.MIN_KEY,f)):u.unique?p.continue(p.key.slice(0,h).concat(u.reverse?e.MIN_KEY:e.MAX_KEY,f)):p.continue()}},continuePrimaryKey:{value(A,g){p.continuePrimaryKey(ar(A,e.MAX_KEY,f),g)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const A=p.key;return h===1?A[0]:A.slice(0,h)}},value:{get:()=>p.value}})}(m)):r.openCursor(u)}}}}}};function is(e,t,r,n){return r=r||{},n=n||"",Z(e).forEach(s=>{if(ae(t,s)){var i=e[s],o=t[s];if(typeof i=="object"&&typeof o=="object"&&i&&o){const l=gn(i);l!==gn(o)?r[n+s]=t[s]:l==="Object"?is(i,o,r,n+s+"."):i!==o&&(r[n+s]=t[s])}else i!==o&&(r[n+s]=t[s])}else r[n+s]=void 0}),Z(t).forEach(s=>{ae(e,s)||(r[n+s]=t[s])}),r}const Pd={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema;return{...r,mutate(i){const o=L.trans,{deleting:l,creating:a,updating:c}=o.table(t).hook;switch(i.type){case"add":if(a.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"put":if(a.fire===K&&c.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"delete":if(l.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"deleteRange":if(l.fire===K)break;return o._promise("readwrite",()=>function(d){return f(d.trans,d.range,1e4)}(i),!0)}return r.mutate(i);function u(d){const h=L.trans,m=d.keys||function(p,y){return y.type==="delete"?y.keys:y.keys||y.values.map(p.extractKey)}(n,d);if(!m)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:m}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(p,y,A){return y.type==="add"?Promise.resolve([]):p.getMany({trans:y.trans,keys:A,cache:"immutable"})}(r,d,m).then(p=>{const y=m.map((A,g)=>{const w=p[g],_={onerror:null,onsuccess:null};if(d.type==="delete")l.fire.call(_,A,w,h);else if(d.type==="add"||w===void 0){const b=a.fire.call(_,A,d.values[g],h);A==null&&b!=null&&(A=b,d.keys[g]=A,n.outbound||de(d.values[g],n.keyPath,A))}else{const b=is(w,d.values[g]),E=c.fire.call(_,b,A,w,h);if(E){const x=d.values[g];Object.keys(E).forEach(P=>{ae(x,P)?x[P]=E[P]:de(x,P,E[P])})}}return _});return r.mutate(d).then(({failures:A,results:g,numFailures:w,lastResult:_})=>{for(let b=0;b<m.length;++b){const E=g?g[b]:m[b],x=y[b];E==null?x.onerror&&x.onerror(A[b]):x.onsuccess&&x.onsuccess(d.type==="put"&&p[b]?d.values[b]:E)}return{failures:A,results:g,numFailures:w,lastResult:_}}).catch(A=>(y.forEach(g=>g.onerror&&g.onerror(A)),Promise.reject(A)))})}function f(d,h,m){return r.query({trans:d,values:!1,query:{index:n,range:h},limit:m}).then(({result:p})=>u({type:"delete",keys:p,trans:d}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):p.length<m?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...h,lower:p[p.length-1],lowerOpen:!0},m)))}}}}})};function fo(e,t,r){try{if(!t||t.keys.length<e.length)return null;const n=[];for(let s=0,i=0;s<t.keys.length&&i<e.length;++s)re(t.keys[s],e[i])===0&&(n.push(r?jt(t.values[s]):t.values[s]),++i);return n.length===e.length?n:null}catch{return null}}const Gd={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const s=fo(n.keys,n.trans._cache,n.cache==="clone");return s?I.resolve(s):r.getMany(n).then(i=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?jt(i):i},i))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function os(e){return!("from"in e)}const ye=function(e,t){if(!this){const r=new ye;return e&&"d"in e&&ne(r,e),r}ne(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Xt(e,t,r){const n=re(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(os(e))return ne(e,{from:t,to:r,d:1});const s=e.l,i=e.r;if(re(r,e.from)<0)return s?Xt(s,t,r):e.l={from:t,to:r,d:1,l:null,r:null},qs(e);if(re(t,e.to)>0)return i?Xt(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},qs(e);re(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),re(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;s&&!e.l&&Br(e,s),i&&o&&Br(e,i)}function Br(e,t){os(t)||function r(n,{from:s,to:i,l:o,r:l}){Xt(n,s,i),o&&r(n,o),l&&r(n,l)}(e,t)}function Rd(e,t){const r=Rn(t);let n=r.next();if(n.done)return!1;let s=n.value;const i=Rn(e);let o=i.next(s.from),l=o.value;for(;!n.done&&!o.done;){if(re(l.from,s.to)<=0&&re(l.to,s.from)>=0)return!0;re(s.from,l.from)<0?s=(n=r.next(l.from)).value:l=(o=i.next(s.from)).value}return!1}function Rn(e){let t=os(e)?null:{s:0,n:e};return{next(r){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&re(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||re(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function qs(e){var t,r;const n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),s=n>1?"r":n<-1?"l":"";if(s){const i=s==="r"?"l":"r",o={...e},l=e[s];e.from=l.from,e.to=l.to,e[s]=l[s],o[s]=l[i],e[i]=o,o.d=Zs(o)}e.d=Zs(e)}function Zs({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}At(ye.prototype,{add(e){return Br(this,e),this},addKey(e){return Xt(this,e,e),this},addKeys(e){return e.forEach(t=>Xt(this,t,t)),this},[mn](){return Rn(this)}});const Fd={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new ye(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const s=e.table(n),{schema:i}=s,{primaryKey:o}=i,{extractKey:l,outbound:a}=o,c={...s,mutate:d=>{const h=d.trans,m=h.mutatedParts||(h.mutatedParts={}),p=E=>{const x=`idb://${t}/${n}/${E}`;return m[x]||(m[x]=new ye)},y=p(""),A=p(":dels"),{type:g}=d;let[w,_]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const b=d.trans._cache;return s.mutate(d).then(E=>{if(ee(w)){g!=="delete"&&(w=E.results),y.addKeys(w);const x=fo(w,b);x||g==="add"||A.addKeys(w),(x||_)&&function(P,C,F,R){function Y(D){const M=P(D.name||"");function ke(X){return X!=null?D.extractKey(X):null}const fe=X=>D.multiEntry&&ee(X)?X.forEach(Be=>M.addKey(Be)):M.addKey(X);(F||R).forEach((X,Be)=>{const kt=F&&ke(F[Be]),Kr=R&&ke(R[Be]);re(kt,Kr)!==0&&(kt!=null&&fe(kt),Kr!=null&&fe(Kr))})}C.indexes.forEach(Y)}(p,i,x,_)}else if(w){const x={from:w.lower,to:w.upper};A.add(x),y.add(x)}else y.add(r),A.add(r),i.indexes.forEach(x=>p(x.name).add(r));return E})}},u=({query:{index:d,range:h}})=>{var m,p;return[d,new ye((m=h.lower)!==null&&m!==void 0?m:e.MIN_KEY,(p=h.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},f={get:d=>[o,new ye(d.key)],getMany:d=>[o,new ye().addKeys(d.keys)],count:u,query:u,openCursor:u};return Z(f).forEach(d=>{c[d]=function(h){const{subscr:m}=L;if(m){const p=_=>{const b=`idb://${t}/${n}/${_}`;return m[b]||(m[b]=new ye)},y=p(""),A=p(":dels"),[g,w]=f[d](h);if(p(g.name||"").add(w),!g.isPrimaryKey){if(d!=="count"){const _=d==="query"&&a&&h.values&&s.query({...h,values:!1});return s[d].apply(this,arguments).then(b=>{if(d==="query"){if(a&&h.values)return _.then(({result:x})=>(y.addKeys(x),b));const E=h.values?b.result.map(l):b.result;h.values?y.addKeys(E):A.addKeys(E)}else if(d==="openCursor"){const E=b,x=h.values;return E&&Object.create(E,{key:{get:()=>(A.addKey(E.primaryKey),E.key)},primaryKey:{get(){const P=E.primaryKey;return A.addKey(P),P}},value:{get:()=>(x&&y.addKey(E.primaryKey),E.value)}})}return b})}A.add(r)}}return s[d].apply(this,arguments)}}),c}}}};class je{constructor(t,r){this._middlewares={},this.verno=0;const n=je.dependencies;this._options=r={addons:je.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:s}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:K,dbReadyPromise:null,cancelOpen:K,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new I(l=>{i.dbReadyResolve=l}),i.openCanceller=new I((l,a)=>{i.cancelOpen=a}),this._state=i,this.name=t,this.on=Ut(this,"populate","blocked","versionchange","close",{ready:[$n,K]}),this.on.ready.subscribe=Ui(this.on.ready.subscribe,l=>(a,c)=>{je.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||I.resolve().then(a),c&&l(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),c&&l(a);else{l(a);const f=this;c||l(function d(){f.on.ready.unsubscribe(a),f.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,Ct(wd.prototype,function(l,a){this.db=o;let c=so,u=null;if(a)try{c=a()}catch(m){u=m}const f=l._ctx,d=f.table,h=d.hook.reading.fire;this._ctx={table:d,index:f.index,isPrimKey:!f.index||d.schema.primKey.keyPath&&f.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:f.or,valueMapper:h!==Dt?h:null}})),this.Table=function(l){return Ct(vd.prototype,function(a,c,u){this.db=l,this._tx=u,this.name=a,this.schema=c,this.hook=l._allTables[a]?l._allTables[a].hook:Ut(null,{creating:[ad,K],reading:[od,Dt],updating:[cd,K],deleting:[ld,K]})})}(this),this.Transaction=function(l){return Ct(_d.prototype,function(a,c,u,f,d){this.db=l,this.mode=a,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=Ut(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new I((h,m)=>{this._resolve=h,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var m=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):m&&this.idbtrans&&this.idbtrans.abort(),j(h)})})}(this),this.Version=function(l){return Ct(Nd.prototype,function(a){this.db=l,this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return Ct(oo.prototype,function(a,c,u){this.db=l,this._ctx={table:a,index:c===":id"?null:c,or:u};const f=l._deps.indexedDB;if(!f)throw new B.MissingAPI;this._cmp=this._ascending=f.cmp.bind(f),this._descending=(d,h)=>f.cmp(h,d),this._max=(d,h)=>f.cmp(d,h)>0?d:h,this._min=(d,h)=>f.cmp(d,h)<0?d:h,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Yt(r.IDBKeyRange),this._createTransaction=(l,a,c,u)=>new this.Transaction(l,a,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=l=>{this.on("blocked").fire(l),Kt.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(l))},this.use(Bd),this.use(Pd),this.use(Fd),this.use(Gd),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(l=>l(this))}version(t){if(isNaN(t)||t<.1)throw new B.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var n=r.filter(s=>s._cfg.version===t)[0];return n||(n=new this.Version(t),r.push(n),r.sort(Cd),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||L.letThrough||this._vip)?t():new I((r,n)=>{if(this._state.openComplete)return n(new B.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new B.DatabaseClosed);this.open().catch(K)}this._state.dbReadyPromise.then(r,n)}).then(t)}use({stack:t,create:r,level:n,name:s}){s&&this.unuse({stack:t,name:s});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:r,level:n??10,name:s}),i.sort((o,l)=>o.level-l.level),this}unuse({stack:t,name:r,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(s=>n?s.create!==n:!!r&&s.name!==r)),this}open(){return Ld(this)}_close(){const t=this._state,r=Kt.indexOf(this);if(r>=0&&Kt.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new I(n=>{t.dbReadyResolve=n}),t.openCanceller=new I((n,s)=>{t.cancelOpen=s})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new B.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new I((n,s)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Q(()=>{(function({indexedDB:l,IDBKeyRange:a},c){!ss(l)&&c!=="__dbnames"&&ns(l,a).delete(c).catch(K)})(this._deps,this.name),n()}),o.onerror=he(s),o.onblocked=this._fireOnBlocked};if(t)throw new B.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Z(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Od.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,n){let s=L.trans;s&&s.db===this&&t.indexOf("!")===-1||(s=null);const i=t.indexOf("?")!==-1;let o,l;t=t.replace("!","").replace("?","");try{if(l=r.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),t=="r"||t==="readonly")o="readonly";else{if(t!="rw"&&t!="readwrite")throw new B.InvalidArgument("Invalid transaction mode: "+t);o="readwrite"}if(s){if(s.mode==="readonly"&&o==="readwrite"){if(!i)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&l.forEach(c=>{if(s&&s.storeNames.indexOf(c)===-1){if(!i)throw new B.SubTransaction("Table "+c+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(u,f)=>{f(c)}):j(c)}const a=uo.bind(null,this,o,l,s,n);return s?s._promise(o,a,"lock"):L.trans?Et(L.transless,()=>this._whenReady(a)):this._whenReady(a)}table(t){if(!ae(this._allTables,t))throw new B.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Kd=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Ud{constructor(t){this._subscribe=t}subscribe(t,r,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:n})}[Kd](){return this}}function ho(e,t){return Z(t).forEach(r=>{Br(e[r]||(e[r]=new ye),t[r])}),e}function Md(e){return new Ud(t=>{const r=jn(e);let n=!1,s={},i={};const o={get closed(){return n},unsubscribe:()=>{n=!0,Le.storagemutated.unsubscribe(u)}};t.start&&t.start(o);let l=!1,a=!1;function c(){return Z(i).some(d=>s[d]&&Rd(s[d],i[d]))}const u=d=>{ho(s,d),c()&&f()},f=()=>{if(l||n)return;s={};const d={},h=function(m){r&&bt();const p=()=>Ne(e,{subscr:m,trans:null}),y=L.trans?Et(L.transless,p):p();return r&&y.then(Ee,Ee),y}(d);a||(Le("storagemutated",u),a=!0),l=!0,Promise.resolve(h).then(m=>{l=!1,n||(c()?f():(s={},i=d,t.next&&t.next(m)))},m=>{l=!1,t.error&&t.error(m),o.unsubscribe()})};return f(),o})}let Fn;try{Fn={indexedDB:V.indexedDB||V.mozIndexedDB||V.webkitIndexedDB||V.msIndexedDB,IDBKeyRange:V.IDBKeyRange||V.webkitIDBKeyRange}}catch{Fn={indexedDB:null,IDBKeyRange:null}}const Pe=je;function br(e){let t=ve;try{ve=!0,Le.storagemutated.fire(e)}finally{ve=t}}At(Pe,{...gr,delete:e=>new Pe(e,{addons:[]}).delete(),exists:e=>new Pe(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:r}){return ss(t)?Promise.resolve(t.databases()).then(n=>n.map(s=>s.name).filter(s=>s!=="__dbnames")):ns(t,r).toCollection().primaryKeys()}(Pe.dependencies).then(e)}catch{return j(new B.MissingAPI)}},defineClass:()=>function(e){ne(this,e)},ignoreTransaction:e=>L.trans?Et(L.transless,e):e(),vip:Pn,async:function(e){return function(){try{var t=Gn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:I.resolve(t)}catch(r){return j(r)}}},spawn:function(e,t,r){try{var n=Gn(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:I.resolve(n)}catch(s){return j(s)}},currentTransaction:{get:()=>L.trans||null},waitFor:function(e,t){const r=I.resolve(typeof e=="function"?Pe.ignoreTransaction(e):e).timeout(t||6e4);return L.trans?L.trans.waitFor(r):r},Promise:I,debug:{get:()=>pe,set:e=>{Di(e,e==="dexie"?()=>!0:no)}},derive:ht,extend:ne,props:At,override:Ui,Events:Ut,on:Le,liveQuery:Md,extendObservabilitySet:ho,getByKeyPath:be,setByKeyPath:de,delByKeyPath:function(e,t){typeof t=="string"?de(e,t,void 0):"length"in t&&[].map.call(t,function(r){de(e,r,void 0)})},shallowClone:Qi,deepClone:jt,getObjectDiff:is,cmp:re,asap:Mi,minKey:-(1/0),addons:[],connections:Kt,errnames:Jn,dependencies:Fn,semVer:"3.2.3",version:"3.2.3".split(".").map(e=>parseInt(e)).reduce((e,t,r)=>e+t/Math.pow(10,2*r))}),Pe.maxKey=Yt(Pe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Le("storagemutated",e=>{if(!ve){let t;Fr?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),ve=!0,dispatchEvent(t),ve=!1}}),addEventListener("x-storagemutated-1",({detail:e})=>{ve||br(e)}));let ve=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel("x-storagemutated-1");typeof e.unref=="function"&&e.unref(),Le("storagemutated",t=>{ve||e.postMessage(t)}),e.onmessage=t=>{t.data&&br(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Le("storagemutated",t=>{try{ve||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key==="x-storagemutated-1"){const r=JSON.parse(t.newValue);r&&br(r.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type==="x-storagemutated-1"&&br(t.changedParts)})}I.rejectionMapper=function(e,t){if(!e||e instanceof pt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ks[e.name])return e;var r=new Ks[e.name](t||e.message,e);return"stack"in e&&we(r,"stack",{get:function(){return this.inner.stack}}),r},Di(pe,no);class Vd extends je{constructor(){super("nr-editor");v(this,"catalogues");v(this,"systems");this.version(5).stores({catalogues:"id, content.catalogue.id, content.catalogue.gameSystemId",systems:"id"})}}const Me=new Vd;function hf(e){const t=/^(?:(http(s?)?:\/\/)?github.com\/)?([^\/]+)\/([^\/]+)$/,r=e.match(t);if(!r)return null;const[,n="https://",s,i,o]=r;return!i||!o?null:`https://github.com/${i}/${o}`}function po(e){const t=/^(?:https?:\/\/)?(?:www\.)?github\.com\/([^/]+)\/([^/]+)(?:\/)?$/,r=e.match(t);if(!r)throw new Error("Invalid GitHub URL format: "+e);const[,n,s]=r;return{githubUrl:e,githubRepo:`${n}/${s}`,githubOwner:n,githubName:s}}const Qd="https://github.com/octocat/hello-world",zd=po(Qd);console.log(zd);async function Ys(e,t){try{const r=e.split("/"),n=r[r.length-2],s=r[r.length-1].replace(".git",""),i=`https://api.github.com/repos/${n}/${s}/contents/${encodeURIComponent(t)}`;console.log(`Querying github api at ${i}`);const o=await $fetch(i,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});if(!o||!(o!=null&&o.download_url))throw new Error("No download_url found");console.log(`Downloading file at ${o==null?void 0:o.download_url}`);const l=await $fetch(o.download_url,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});return console.log(`Downloaded file, length: ${l.length}`),l}catch(r){throw r}}async function Wd(e,t,r){try{return await Ys(e,t)}catch(n){if(!r)throw n;return await Ys(e,r)}}async function Dd(e,t){if(t.fullFilePath)try{const r=Ti(t.fullFilePath),n=r.endsWith("z")?ni(r,"z"):void 0,s=await Wd(e.githubUrl,r,n),i=/revision="(\d+)"/,o=s.match(i);if(o){const l=(Number(o[1])||0)+1;return console.log(`Revision of ${t.name}: ${t.revision} -> ${l}`),l}}catch(r){console.error(r)}return t.revision||1}function Xs(e,t){if(e)return e[t]||e["*"]}async function Pr(e,t,r,n){if(!t.catalogue&&!t.gameSystem)throw Error("invalid loadBsData argument: no .catalogue or .gameSystem in data");const s=t.catalogue?"catalogue":"gameSystem",i=s==="gameSystem",o=s==="catalogue",l=t[s],a=l;if(a.loaded||a.loaded_editor)return a;St(l);const c=hn(l,s);if(c.manager=e,o){const f={targetId:c.gameSystemId},d=e.getLoadedCatalogue(f,r);if(d)c.gameSystem=d;else{const h=await e.getData(f,r),m=e.getLoadedCatalogue(f,r);m?c.gameSystem=m:c.gameSystem=await Pr(e,h,r)}}const u=[];for(const f of(c==null?void 0:c.catalogueLinks)||[]){if(!f.targetId){console.warn(`invalid link: no targetId in link: ${f}, found in ${l.name}`);continue}if(f.targetId===c.id){f.target=c;continue}const d=e.getLoadedCatalogue(f,r);if(d){f.target=d;continue}const h=e.getData(f,r).then(m=>{const p=e.getLoadedCatalogue(f,r);if(p){f.target=p;return}return Pr(e,m,r).then(y=>f.target=y)});u.push(h)}return await Promise.all(u),i&&e.addLoadedSystem(c),o&&e.addLoadedCatalogue(c),c}class qd{constructor(){v(this,"catalogues",{});v(this,"unresolvedLinks");v(this,"settings")}async getData(t,r){throw new Error("Method not implemented.")}getCatalogueInfo(t){}findOptionById(t){}getLoadedCatalogue(t,r){const n=typeof t=="string"?t:t.targetId||t.name,s=Xs(r,n)||"default",i=this.catalogues[n];return i?i[s]:void 0}addLoadedCatalogue(t,r){const n=Xs(r,t.id)||"default";this.catalogues[t.name]||(this.catalogues[t.name]={}),this.catalogues[t.id]||(this.catalogues[t.id]={}),this.catalogues[t.name][n]=t,this.catalogues[t.id][n]=t}addLoadedSystem(t,r){return this.addLoadedCatalogue(t,r)}unloadAll(){this.catalogues={}}async loadData(t,r){const n=await Pr(this,t,r);return n.process(),n}async loadCatalogue(t,r,n){const s=this.getLoadedCatalogue(t,r);if(s&&!n)return s;const i=await this.getData(t,r);if(i)return await this.loadData(i,r);throw Error(`Couldn't load catalogue: couldn't getData ${t}`)}}class js extends qd{constructor(){super(...arguments);v(this,"gameSystem",null);v(this,"catalogueFiles",$l());v(this,"allLoaded");v(this,"loadedCatalogues",{});v(this,"github");v(this,"unresolvedLinks",{});v(this,"index",{})}async loadData(r,n){return await Pr(this,r,n)}findOptionById(r){for(const n of Object.values(this.loadedCatalogues))if(n.index&&n.index[r])return n.index[r]}unloadAll(){super.unloadAll(),this.loadedCatalogues={};for(const r of this.getAllCatalogueFiles()){const n=me(r);delete n.loaded,delete n.loaded_editor}delete this.allLoaded}async loadAll(r){var i,o;let n=Object.values(this.catalogueFiles).length+1,s=0;if(this.allLoaded||console.log("Loading all catalogues in",(o=(i=this.gameSystem)==null?void 0:i.gameSystem)==null?void 0:o.name),this.gameSystem){r&&await r(s,n,`Loading ${this.gameSystem.gameSystem.name}`),(await this.loadCatalogue({targetId:this.gameSystem.gameSystem.id})).processForEditor(),s++;for(const a of Object.values(this.catalogueFiles))r&&await r(s,n,`Loading ${a.catalogue.name}`),(await this.loadCatalogue({targetId:a.catalogue.id})).processForEditor(),s++,r&&await r(s,n,`Loading ${a.catalogue.name}`)}this.allLoaded=!0}getLoadedCatalogue(r,n){const s=r.targetId||r.name;return this.loadedCatalogues[s]}addLoadedCatalogue(r,n){this.loadedCatalogues[r.id]=r}getAllLoadedCatalogues(){var n;return((n=this.gameSystem)==null?void 0:n.gameSystem.id)?Object.values(this.loadedCatalogues):[]}getId(){var r;return(r=this.gameSystem)==null?void 0:r.gameSystem.id}getCatalogueInfo(r){var n,s;if(((n=this.gameSystem)==null?void 0:n.gameSystem.id)===r.targetId)return(s=this.gameSystem)==null?void 0:s.gameSystem;for(const i of Object.values(this.catalogueFiles))if(i.catalogue.id===r.targetId)return i.catalogue}getAllCatalogueFiles(){return[...this.gameSystem?[this.gameSystem]:[],...Object.values(this.catalogueFiles)]}setSystem(r){this.gameSystem=r}setCatalogue(r){const n=r.catalogue.id;this.catalogueFiles[n]=r}removeCatalogue(r){for(const[n,s]of Object.entries(this.catalogueFiles))s.catalogue.id===r.catalogue.id&&delete this.catalogueFiles[n]}async getData(r,n){var l;if(r.targetId==((l=this.gameSystem)==null?void 0:l.gameSystem.id))return this.gameSystem;if(r.targetId in this.catalogueFiles)return this.catalogueFiles[r.targetId];const s=await Me.catalogues.get({"content.catalogue.id":r.targetId});if(s)return s.content;const i=await Me.systems.get(r.targetId);if(i)return i.content;const o=r.name?`name ${r.name}`:`id ${r.targetId}`;throw Error(`Couldn't import catalogue with ${o}, perhaps it wasnt uploaded?`)}}const Zd=!1;function ce(e){return e.vnode}function Ve(e){const t=e.$parent;if(t.item)return t.item;const r=t.$parent;return r.item?r.item:r.$parent.item}function Yd(e){e.isSaving=!0}function Xd(e){if(e.isSaving){e.isSaving=!1;return}e.isChangedOnDisk=!0}function jd(e){e.isChangedOnDisk&&(e.isChangedOnDisk=!1),e.isSaving===void 0&&(e.isSaving=!1)}const tn=new Set(["select","showInEditor","showChildsInEditor"]),$t=Kn("editor",{state:()=>({selections:[],selectedElementGroup:null,selectedElement:null,selectedItem:null,filter:"",filterRegex:RegExp(""),filtered:[],undoStack:[],undoStackPos:-1,historyStack:[],historyStackPos:0,clipboard:[],mode:"edit",clipboardmode:"json",gameSystems:{},gameSystemsLoaded:!1,unsavedChanges:{},unsavedCount:0}),actions:{async create_system(e,t,r){console.log("Creating system with name:",e);const n=`sys-${ot()}`,s=this.get_system(n),i=t?`${ni(t.replaceAll("\\","/"),"/")}/${e}`:"";if(electron){if(!i)throw new Error("No folder specified");ic(i)}const o={gameSystem:{id:n,name:e,battleScribeVersion:"2.03",revision:1,categoryEntries:[{name:"Default Category",id:"default-category"}],forceEntries:[{name:"Default Force",hidden:!1,id:"default-force",categoryLinks:[{name:"Default Category",hidden:!1,id:"default-force-category-link",targetId:"default-category"}]}],selectionEntries:[{type:"upgrade",import:!0,name:"Default Root Entry",hidden:!1,id:"default-entry",categoryLinks:[{targetId:"default-category",id:"default-category-link",primary:!0,name:"Default Category",hidden:!1}]}]}};return i&&(o.gameSystem.fullFilePath=`${i}/${e}.${r||"gst"}`),s.setSystem(o),this.get_catalogue_state(o).incremented=!0,this.saveCatalogue(o),s},saveCatalogueInDb(e){const t=ln(e);!!!e.gameSystemId?Me.systems.put({content:JSON.parse(t),path:e.fullFilePath,id:e.id}):Me.catalogues.put({content:JSON.parse(t),path:e.fullFilePath,id:`${e.gameSystemId}-${e.id}`})},async saveCatalogueInFiles(e){const t=e.fullFilePath;if(!t){console.error(`No path included in the catalogue ${e.name} to save at`);return}const r=Rr(t);if(t.endsWith(".json")){const n=ln(e);await Ps(t,n)}else{const n=ql(e),s=_i(r),o=Ti(t).replace(".gstz",".gst").replace(".catz",".cat"),l=s?await No(o,n,"uint8array"):n;await Ps(t,l)}},saveCatalogue(e){const t=this.get_catalogue_state(e),r=me(e);Yd(t),electron?this.saveCatalogueInFiles(r):this.saveCatalogueInDb(r),jd(t)},async load_systems_from_folder(e,t){var l,a;if(!globalThis.electron)throw new Error("Not running in electron");const r=await sc(e);if(!(r!=null&&r.length))return;console.log("Loading",r.length,"files",r);const n=[],s=[],i=[],o=r.filter(c=>Ml(c.name));for(const c of o){t&&await t(s.length,o.length,c.path);const u=await Vl(c.data,c.name.endsWith("json")?"json":"xml"),f=(l=u==null?void 0:u.gameSystem)==null?void 0:l.id,d=(a=u==null?void 0:u.catalogue)==null?void 0:a.id,h=me(u);if(h.fullFilePath=c.path.replaceAll("\\","/"),f){const m=this.get_system(f);m.setSystem(cs(u)),i.push(m),n.push(f)}if(d){const m=this.get_system(u.catalogue.gameSystemId);m.catalogueFiles[d]=cs(u)}s.push(u)}t&&await t(s.length,o.length);for(const c of i)t&&await t(0,0,"Checking for github integration"),await this.load_system(c);return n},async load_systems_from_db(e=!1){if(!this.gameSystemsLoaded&&!e){this.gameSystemsLoaded=!0;let t=await Me.systems.offset(0).keys();for(let r of t)r in this.gameSystems||this.load_system_from_db(r)}},async load_system_from_db(e){const t=await Me.systems.get(e),r=t==null?void 0:t.content;if(!r)throw new Error("System not found "+e);r.gameSystem.fullFilePath||(r.gameSystem.fullFilePath=t.path);const n=await Me.catalogues.where({"content.catalogue.gameSystemId":e}),s=this.get_system(r.gameSystem.id);s.setSystem(r);for(let{content:i,path:o}of await n.toArray()){const l=i.catalogue.id;i.catalogue.fullFilePath||(i.catalogue.fullFilePath=o),s.catalogueFiles[l]=To(i)}this.load_system(s,!0)},async load_system(e,t=!1){var r,n;if(e.gameSystem){const s=Bs();if(await e.unloadAll(),!t)for(const a of e.getAllCatalogueFiles()){const c=this.get_catalogue_state(a);c&&(c.changed=!1,c.unsaved=!1,c.isChangedOnDisk=!1),s.updateCatalogue(me(a)),s.setEdited(me(a).id,!1)}const i=e.gameSystem.gameSystem.publications,o=i==null?void 0:i.find(a=>{var c;return((c=a.name)==null?void 0:c.trim().toLowerCase())==="github"}),l=e.gameSystem.gameSystem.fullFilePath;if(l&&Zd)try{const a=await ac(Ni(l));a&&a!=="origin"&&(console.log("remote:",a),e.github={...po(a),discovered:!0})}catch(a){console.error(a)}o&&o.publisherUrl&&(e.github={githubUrl:o.publisherUrl},o.shortName&&o.shortName.includes("/")&&(e.github.githubRepo=o.shortName,e.github.githubOwner=(r=o.shortName)==null?void 0:r.split("/")[0],e.github.githubName=(n=o.shortName)==null?void 0:n.split("/")[1]))}for(const s of e.getAllCatalogueFiles()){const i=me(s);i.fullFilePath&&oc(i.fullFilePath,()=>{this.on_file_changed(s)})}},on_file_changed(e){console.log(me(e).name,"changed"),Xd(this.get_catalogue_state(e))},async get_or_load_system(e){return e in this.gameSystems||(this.gameSystems[e]=new js,await this.load_system_from_db(e)),this.gameSystems[e]},get_system(e){if(!(e in this.gameSystems)){const t=new js;t.settings=ut(),this.gameSystems[e]=t}return this.gameSystems[e]},delete_system(e){delete this.gameSystems[e]},get_catalogue_state(e){const t=us(e);return this.unsavedChanges[t]||(this.unsavedChanges[t]={changed:!1,unsaved:!1}),this.unsavedChanges[t]},set_catalogue_changed(e,t=!0){const r=this.get_catalogue_state(e);t?(r.changed=!0,r.unsaved||(this.unsavedCount+=1,r.unsaved=t)):r.unsaved=t},async save_catalogue(e,t,r){const n=this.get_catalogue_state(t),s=t.revision;r==="github"&&e.github&&(t.revision=await Dd(e.github,t)),r==="yes"&&!(n!=null&&n.incremented)&&(t.revision=t.revision?t.revision+1:1,n.incremented=!0),r==="no"&&(n.incremented=!0),this.saveCatalogue(t);const i=Bs(),o=us(t);return i.updateCatalogue(t),i.setEdited(o,!0),n!=null&&n.unsaved&&(this.unsavedCount--,n.unsaved=!1),t.revision!==s},async prompt_revision(e){const t=ut(),r=e instanceof _r?e.manager:e;for(const n of e instanceof _r?[e]:r.getAllLoadedCatalogues()){const s=this.get_catalogue_state(n);if(s!=null&&s.unsaved&&!s.incremented)return r.github&&t.githubAutoIncrement&&!navigator.onLine?await(globalThis.customPrompt&&globalThis.customPrompt({html:`<span>Would you like to increase the revision of this catalogue?<span><br/>
    <span class="gray">Note: This is shown because Github cannot be accessed as your are offline</span>`,cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no":r.github&&t.githubAutoIncrement?"github":r.github?await(globalThis.customPrompt&&globalThis.customPrompt({html:"<span>Would you like to increase the revision of this catalogue?<span><br/>",cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no":await(globalThis.customPrompt&&globalThis.customPrompt({html:`<span>Would you like to increase the revision of this catalogue?<span><br/>
    <span class="gray">Note: You can enable automatic revision increments by integrating with GitHub.<br/>This can be achieved by adding a publication in the GameSystem named "GitHub" with the repository's GitHub URL as the Publication URL.`,cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no"}},async save_all(e){var n,s,i;let t=!1,r=0;ut();try{for(const o of Object.values(this.gameSystems)){if(e&&((s=(n=o.gameSystem)==null?void 0:n.gameSystem)==null?void 0:s.id)!==e)continue;const l=await this.prompt_revision(o);for(const a of o.getAllLoadedCatalogues())(i=this.get_catalogue_state(a))!=null&&i.unsaved&&await this.save_catalogue(o,a,l)&&(r+=1)}}catch(o){notify({text:`Failed to save: ${o.name}: ${o.message}`,type:"error"}),t=!0}return r&&notify(`Incremented ${r} catalogue's revision`),t},set_filter(e){this.$state.filter=e,this.filterRegex=nn(e)},init(e){this.catalogueComponent=e,globalThis.$store=this,globalThis.$search=t=>{var r;return this.system_search((r=this.catalogueComponent)==null?void 0:r.systemFiles,{filter:t})}},rerender_catalogue(){this.catalogueComponent&&(this.catalogueComponent.key+=1)},unselect(e){const t=[],r=[];for(const n of this.selections)e===void 0||Fe(n.obj)===Fe(e)?r.push(n):t.push(n);this.selections=t;for(const n of r)n.onunselected&&n.onunselected(),n.obj===this.selectedItem&&(this.selectedItem=null)},is_selected(e){return this.selections.find(t=>t.obj===e)!==void 0},select(e,t,r){this.is_selected(e)||this.selections.push({obj:e,onunselected:t,payload:r})},do_select(e,t,r){const n=Array.isArray(r)?r:[r],s=this.selectedElementGroup,i=this.selectedElement;if(this.selectedElement=t,this.selectedElementGroup=r,e!=null&&e.shiftKey&&Fe(r)===Fe(s)){const o=n.findIndex(u=>u===Fe(i)),l=n.findIndex(u=>u===Fe(this.selectedElement)),a=Math.min(o,l),c=Math.max(o,l);for(let u=a;u<=c;u++)n[u].select();return}!(e!=null&&e.ctrlKey)&&!(e!=null&&e.metaKey)&&this.unselect(),e!=null&&e.ctrlKey&&this.is_selected(t)?this.unselect(t):(t.select(),this.selectedItem=t,this.mode="edit")},do_rightclick_select(e,t,r){this.is_selected(t)||this.do_select(e,t,r)},get_selections(){return this.selections.map(e=>Ve(e.obj))},get_selections_with_payload(){return this.selections.map(e=>({obj:Ve(e.obj),payload:e.payload}))},get_selected(){return this.selectedItem&&Ve(this.selectedItem)},async do_action(e,t,r){let n;try{n=await r()}catch(s){console.error(s);return}if(this.undoStackPos<this.undoStack.length){const s=this.undoStack.length-this.undoStackPos-1;this.undoStack.splice(this.undoStackPos+1,s,{type:e,undo:t,redo:r})}else this.undoStack.push({type:e,undo:t,redo:r});return this.undoStackPos+=1,n},async set_clipboard(e,t){if(this.clipboardmode==="json"){const r=e.map(s=>({parentKey:s.parentKey,...s})),n=Mo(r,new Set(["parentKey"]),{forceArray:!1,formatted:!0});t!=null&&t.clipboardData?t.clipboardData.setData("text/plain",n):await navigator.clipboard.writeText(n)}else this.clipboard=e},async get_clipboard(e){if(this.clipboardmode==="json")if(e!=null&&e.clipboardData){const t=e.clipboardData.getData("text/plain");return t?JSON.parse(t):[]}else{const t=await navigator.clipboard.readText();return JSON.parse(t)}return this.clipboard},can_undo(){return!!this.undoStack[this.undoStackPos]},async undo(){if(!this.can_undo())return;const e=this.undoStack[this.undoStackPos];e&&(await e.undo(),this.undoStackPos--)},can_redo(){return!!this.undoStack[this.undoStackPos+1]},async redo(){if(!this.can_redo())return;const e=this.undoStack[this.undoStackPos+1];e&&(await e.redo(),this.undoStackPos++)},async cut(e){await this.set_clipboard(this.get_selections(),e),this.remove()},async copy(e){await this.set_clipboard(this.get_selections(),e)},async paste(e){this.add(await this.get_clipboard(e))},async pasteLink(e){const t=await this.get_clipboard(e);if(!t.parentKey||Array.isArray(t))return;const n=this.get_selections()[0];if(!n)return;const s=n.getCatalogue().findOptionById(t.id);if(s){const i={parentKey:s.isGroup()||s.isEntry()?"entryLinks":"infoLinks",targetId:s.id,id:ot(),type:s.editorTypeName,name:s.getName(),hidden:s.hidden,select:!0};this.add(i)}},async duplicate(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let n=[];const s=async()=>{n=[];for(const o of e){const l=JSON.parse(dr(o,tn));if(!o.parent)continue;const a=o.parent[o.parentKey];if(!Array.isArray(a))throw new Error(`Couldn't duplicate: parent[${o.parentKey}] is not an array`);St({[o.parentKey]:l}),Os(t,l),a.push(l),await It(l,t,o.parent,this.get_system(r)),n.push(l)}},i=()=>{for(const o of n)Xr(t,_e(o)),er(o)};await this.do_action("dupe",i,s),this.set_catalogue_changed(t,!0)},async remove(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let n=[];for(const a of e)a.catalogue===t&&n.push(a);let s=[],i=[];const o=async()=>{const a=n,c=this.get_system(r);i=[],s=[];for(const u of a){const f=_e(u),d=Xr(t,f);i.push(d),s.push(f),await er(d,c)}i.reverse(),s.reverse()},l=async()=>{for(const[a,c]of Lo(s,i)){const u=Ls(t,a,c);await It(c,t,u,this.get_system(r))}};await this.do_action("remove",l,o),this.set_catalogue_changed(t,!0),this.unselect()},async add(e,t,r){let n=[];if(r?(r=Array.isArray(r)?r:[r],n=r.map(f=>({obj:f}))):n=this.get_selections_with_payload(),!n.length){console.error("Couldn't add: no selection or parent(s) provided");return}const s=Array.isArray(e)?e:[e];if(!s.length){console.error("Couldn't add: no data provided");return}const i=n[0].obj.getCatalogue(),o=i.getSystemId();let l=[];const a=async()=>{var f;l=[];for(const d of n){const h=d.obj,m=d.payload;await this.open(h,!0);for(const p of s){const y=Hl(h,t||p.parentKey,m);if(!y){console.warn("Couldn't create",t||p.parentKey,"in",m);continue}h[y]||(h[y]=[]);const A=h[y];if(!Array.isArray(A))continue;if(!((f=Ii(h,h.parentKey))!=null&&f.has(y))){console.warn("Couldn't add",y,"to a",h.parentKey,"because it is not allowed");continue}const g=p instanceof z?dr(p,tn):JSON.stringify(p),w=JSON.parse(g);xi(w,y),delete w.parentKey,St({[y]:w}),Os(i,w),this.filtered.push(w),w.showChildsInEditor=!0;let _=w;for(;_;)_.showInEditor=!0,_=_.parent;A.push(w),await It(w,i,h,this.get_system(o)),l.push(w)}}return l[0]},c=()=>{for(const f of l)Xr(i,_e(f)),er(f)},u=await this.do_action("add",c,a);return this.set_catalogue_changed(i,!0),u},open_selected(){for(const e of this.selections)e.obj.open()},get_initial_object(e,t){switch(e){case"costTypes":return{name:`New ${Ke(Ie(e))}`,defaultCostLimit:-1};case"repeats":return{value:1,repeats:1,field:"selections",scope:"parent",childId:"any",shared:!0,roundUp:!1};case"constraints":{const s=(t==null?void 0:t.parentKey)==="associations",i={type:"min",value:1,field:t!=null&&t.isForce()?"forces":"selections",scope:"parent",shared:!0};return s&&(i.childId="any"),i}case"conditions":return{type:"atLeast",value:1,field:"selections",scope:"parent",childId:"any",shared:!0};case"modifiers":return{type:"set",value:!0,field:"hidden"};case"modifierGroups":case"conditionGroups":return{type:"and"};case"sharedSelectionEntries":case"selectionEntries":return{type:"upgrade",import:!0,name:`New ${Ke(Ie(e))}`,hidden:!1};case"entryLinks":return{import:!0,name:`New ${Ke(Ie(e))}`,hidden:!1};case"associations":return{min:1,max:1,scope:"roster",includeChildSelections:!1,of:"any",ids:[],label:"Association",labelMembers:"Unit",hidden:!1};case"sharedProfiles":case"profiles":const r=t==null?void 0:t.getCatalogue().iterateProfileTypes().next().value;return{name:(!t||t!=null&&t.isCatalogue()||t==null?void 0:t.getName())||"New Profile",typeId:r==null?void 0:r.id,typeName:r==null?void 0:r.name,hidden:!1};case"catalogueLinks":return{type:"catalogue",name:`New ${Ke(Ie(e))}`};case"categoryLinks":return{type:"category",name:`New ${Ke(Ie(e))}`,hidden:!1};default:return{name:`New ${Ke(Ie(e))}`,hidden:!1}}},async create(e,t){const r={...this.get_initial_object(e),select:!0,...t};["modifiers","conditions","modifierGroups","conditionGroups"].includes(e)||(r.id=ot()),await this.add(r,e),this.open_selected()},async create_child(e,t,r){const n={...this.get_initial_object(e,t),id:ot(),select:!0,...r};await this.add(n,e,t),this.open_selected()},can_move(e){return!e.isLink()},get_move_targets(e){const t=e.catalogue;if(!t||e.isLink())return;const r=[];if(!e.parentKey.startsWith("shared")&&this.move_to_key(e,"shared")?r.push({target:t,type:"shared"}):e.parentKey.startsWith("shared")&&this.move_to_key(e,"root")&&r.push({target:t,type:"root"}),this.move_to_key(e,"shared"))for(const n of t.imports)r.push({target:n,type:"shared"});if(this.move_to_key(e,"root"))for(const n of t.imports)r.push({target:n,type:"root"});return r},move_to_key(e,t){if(t==="shared")switch(e.editorTypeName){case"infoGroup":return"sharedInfoGroups";case"rule":return"sharedRules";case"profile":return"sharedProfiles";case"selectionEntry":return"sharedSelectionEntries";case"selectionEntryGroup":return"sharedSelectionEntryGroups";default:return""}switch(e.editorTypeName){case"infoGroup":return"infoGroups";case"rule":return"rules";case"profile":return"profiles";case"selectionEntry":return"selectionEntries";case"selectionEntryGroup":return"";default:return e.parentKey}},async move(e,t,r,n){await(async()=>{const i=this.move_to_key(e,n);if(!i){console.error("Could not find key for move",e.editorTypeName,n);return}const o=e.parent,l=_e(e);Xl(e),er(e);const a=JSON.parse(dr(e,tn));St({[i]:a}),r[i]||(r[i]=[]),r[i].push(a),await It(a,r,r,this.get_system(r.getSystemId()));const u=["rule","infoGroup","profile","selectionEntry","selectionEntryGroup"].includes(e.editorTypeName),f=!e.parentKey.startsWith("shared");if(u&&f){const d={targetId:a.id,id:t.generateNonConflictingId(),type:e.editorTypeName,name:e.getName(),hidden:e.hidden,select:!0};e.isEntry()&&(d.collective=e.collective);const h=e.isGroup()||e.isEntry()?"entryLinks":"infoLinks";St({[h]:d}),l[l.length-1].key=h,Ls(t,l,d),await It(d,t,o,this.get_system(t.getSystemId()))}})(),this.set_catalogue_changed(t,!0),this.set_catalogue_changed(r,!0)},async open(e,t,r){var c;let n=document.getElementById("editor-entries");if(!n)return;async function s(u){const f=ce(u);f.open(),await f.$nextTick()}async function i(u){const f=ce(u);f.close(),await f.$nextTick()}const o=_e(e);if(!(o!=null&&o.length))return;if(n=n.getElementsByClassName(`depth-0 ${o[0].key}`)[0],!n){r!==!0&&console.error("Couldn't find root element for",o[0].key,"in",e.catalogue.getName());return}await s(n);const l=[];cr(e,u=>{l.push(u)}),l.pop(),l.reverse(),l.push(e),l[0].parentKey==="sharedProfiles"&&l.unshift({parentKey:`label-${l[0].typeName??"Untyped"}`});const a=l[l.length-1];for(let u=0;u<l.length;u++){const f=l[u],d=n.getElementsByClassName(`depth-${u+1} ${f.parentKey}`),h=f.parentKey.startsWith("label-")?d[0]:[...d].find(m=>Ve(ce(m))===f);h||r!==!0&&console.error("Couldn't find path to",e.getName(),e,"parent:",(c=e.parent)==null?void 0:c.getName()),h&&(n=h),f!==a&&await s(n),f===a&&(t===!1?await i(n):t===!0&&await s(n))}return n},async goto_catalogue(e,t){var o,l,a;const r=this.$router;if(!r)throw new Error("Cannot follow link to another catalogue without $router set");const s=((o=r.currentRoute)==null?void 0:o.query)??((a=(l=r.currentRoute)==null?void 0:l.value)==null?void 0:a.query),i=(s==null?void 0:s.id)||(s==null?void 0:s.systemId);return e!==i?(r.push({name:"catalogue",query:{systemId:t||e,id:e}}),this.$nextTick=new Promise((c,u)=>{this.$nextTickResolve=c}),await this.$nextTick,!0):!1},async show(e,t=!0){this.filtered.includes(e)||this.filtered.push(e),e.showInEditor=!0,e.showChildsInEditor=!0,t&&(e.highlight=!0),cr(e,r=>{r.showInEditor=!0})},async goto(e){const t=e.getCatalogue();this.put_current_state_in_history();const r=ft();r.get_data(t.id).selection=_e(e),await this.goto_catalogue(t.id,t.gameSystemId),this.show(e,!1),await this.scrollto(e)},async scrollto(e){const t=await this.open(e);if(t){const r=ce(t);this.do_select(null,r,r),t.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}else setTimeout(async()=>{const r=await this.open(e);if(r){const n=ce(r);this.do_select(null,n,n),r.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}},50)},can_goto(e){return e?typeof e=="object"&&e instanceof z:!1},can_follow(e){return!!(e!=null&&e.target)},async follow(e){e!=null&&e.target&&await this.goto(e.target)},async move_up(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>0){const n=t.splice(r,1)[0];t.splice(r-1,0,n)}}},async move_down(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>=0&&r<t.length-1){const n=t.splice(r,1)[0];t.splice(r+1,0,n)}}},get_leftpanel_open_collapsible_boxes(){function e(r,n,s=0){const i=`depth-${s} collapsible-box opened`,o=r.getElementsByClassName(i);if(o!=null&&o.length)for(const l of o){const a=Ve(ce(l)),c=a.parentKey,u=a.parent;if(u){const f=u[c];if(!f||!Array.isArray(f))continue;const d=f.indexOf(a);c in n||(n[c]={}),d in n[c]||(n[c][d]={}),e(l,n[c][d],s+1)}else{const f=[...l.classList].filter(d=>wt.has(d)||d.startsWith("label-"));for(const d of f)n[d]={},n[d][0]={};e(l,n[f[0]][0],s+1)}}}const t={};return e(document.documentElement,t),t},get_leftpanel_state(){if(!this.catalogueComponent)return{};const e={},t=this.catalogueComponent.$refs.leftpanel;for(const r of Object.keys(Fi))e[r]=t[r];return e},get_current_state(){var r;const e=this.get_selected(),t=(r=this.catalogueComponent)==null?void 0:r.cat;return{...this.get_leftpanel_state(),mode:this.mode,open:this.get_leftpanel_open_collapsible_boxes(),selection:e?_e(e):void 0,catalogueId:t==null?void 0:t.id,systemId:t==null?void 0:t.gameSystemId}},save_state(){if(this.catalogueComponent&&this.catalogueComponent.cat){const e=this.catalogueComponent.cat.id,t=ft(),r=this.get_current_state();t.set_state(e,r)}},async load_state(e){this.catalogueComponent&&(ft().set_state(e.catalogueId,e),this.mode=e.mode||"edit",await this.goto_catalogue(e.catalogueId,e.systemId)||(this.catalogueComponent.load_state(e),this.rerender_catalogue()))},put_state_in_history(e){if(this.historyStackPos<this.historyStack.length){const t=this.historyStack.length-this.historyStackPos;this.historyStack.splice(this.historyStackPos,t,e)}else this.historyStack.push(e);this.historyStackPos=this.historyStack.length},put_current_state_in_history(){this.catalogueComponent&&this.catalogueComponent.cat&&this.put_state_in_history(this.get_current_state())},can_back(){return this.historyStackPos>0},async back(){this.can_back()&&(this.historyStack[this.historyStackPos]=this.get_current_state(),this.historyStackPos-=1,this.load_state(this.historyStack[this.historyStackPos]))},can_forward(){if(this.historyStack[this.historyStack.length-1])return this.historyStackPos<this.historyStack.length-1},async forward(){this.can_forward()&&(this.historyStackPos+=1,this.load_state(this.historyStack[this.historyStackPos]))},async update_catalogue_search(e,t){const{filter:r,ignoreProfilesRules:n}=t,s=this.filtered;for(const i of s)delete i.showInEditor,delete i.showChildsInEditor,delete i.highlight,cr(i,o=>{delete o.showInEditor,delete i.showChildsInEditor});if(this.filter.length<=1){this.set_filter(""),this.filtered=[];return}this.set_filter(r),this.filtered=e.findOptionsByText(r),n&&(this.filtered=this.filtered.filter(i=>!i.isProfile()&&!i.isRule()&&!i.isInfoGroup()));for(const i of this.filtered)this.show(i);if(await ri(),this.filtered.length<300){for(const i of this.filtered)if(i.parent)try{await this.open(i,!1,!0)}catch{continue}}},async system_search(e,t,r=1e3){const n=[],{filter:s}=t;if(!s)return null;const i=nn(s);let o=!1;await e.loadAll();for(const a of e.getAllLoadedCatalogues())if(a.forEachObjectWhitelist((c,u)=>{var p;if(n.length>=r||c.isLink()&&c.target&&c.isCategory()&&!(u!=null&&u.isForce()))return;const f=(p=c.getName)==null?void 0:p.call(c),d=c.$text,h=c.description,m=c.id;(m===s||f&&String(f).match(i)||m===s||d&&String(d).match(i)||h&&String(h).match(i))&&n.push(c)}),n.length>=r){o=!0;break}console.log("Search for",`"${s}"`,"found",n.length,"results");const l={};for(const a of n)st(l,a.catalogue.name,a);return{grouped:l,all:n,more:o}}}});export{Ti as A,af as B,Oi as C,Ni as D,Me as E,lf as F,of as G,df as H,sc as I,Uo as P,ff as _,yc as a,dt as b,Hc as c,Ri as d,ct as e,Yc as f,Yl as g,me as h,Jc as i,sf as j,Bs as k,ft as l,Dd as m,cf as n,uf as o,Ml as p,_i as q,Vl as r,hn as s,Rr as t,$t as u,hf as v,rf as w,us as x,ql as y,nf as z};
//# sourceMappingURL=editorStore.25d443e0.js.map
