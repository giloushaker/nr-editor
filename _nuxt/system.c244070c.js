import{a as S,_ as w}from"./CreateSystem.22769f41.js";import{F as C,k as I,u as x,x as p,E as _,G as y,H as h}from"./editorStore.3020636b.js";import{a as F,o as l,b as d,F as m,m as g,e as B,L as E,A,i,t as f,h as u,B as D,c as L,q as N,y as P,z as R}from"./entry.a6511128.js";import{_ as k}from"./Loading.65e4aabc.js";const T={emits:["selected"],data(){return{uploading:!1}},computed:{electron(){return!!globalThis.electron}},methods:{async popFileInput(){var e;if(!globalThis.electron)throw new Error("SelectFile is for use in electron app only");try{this.uploading=!0;const t=await C({properties:["openDirectory"]});(e=t==null?void 0:t.filePaths)!=null&&e.length&&this.$emit("selected",t.filePaths)}catch(t){console.error(t)}finally{this.uploading=!1}}}};const U=["disabled"],V={key:1};function j(e,t,o,a,s,n){return n.electron?(l(),d("button",{key:0,onClick:t[0]||(t[0]=(...r)=>n.popFileInput&&n.popFileInput(...r)),class:"bouton",disabled:s.uploading},[s.uploading?(l(),d(m,{key:1},[g(" ... ")],64)):(l(),d(m,{key:0},[g("Set Working Folder")],64))],8,U)):(l(),d("span",V,"<SelectFolder> is only available in electron app"))}const z=F(T,[["render",j],["__scopeId","data-v-e706e417"]]),W=B({components:{CreateSystem:S,Loading:k},head(){return{title:"NR-Editor"}},data(){return{loading:!0,systems:[],progress:0,progress_max:0,progress_msg:"",error_msg:""}},setup(){return{cataloguesStore:I(),store:x(),settings:E()}},methods:{async selectedFolder(e){this.settings.systemsFolder=Array.isArray(e)?e[0]:e,this.update()},async selected(e){if(electron){this.loading=!0,this.progress_msg="";const t=await this.store.load_systems_from_folder(e.path,async(o,a,s)=>(this.progress=o,this.progress_max=a,this.progress_msg=s?s.replaceAll("\\","/").split("/").slice(-1)[0]:"",new Promise(r=>setTimeout(r,1))));this.loading=!1,t!=null&&t.length&&this.$router.push(`/?id=${t.join(",")}`)}},async uploaded(e){console.log("Uploaded",e.length,"files",e);const t=e.filter(s=>s.gameSystem),o=[];for(const s of t){const n=s.gameSystem.id;o.push(n);const r=p(s);this.store.get_system(n).setSystem(s),electron||_.systems.put({content:s,id:r}),this.cataloguesStore.updateCatalogue(s.gameSystem),this.cataloguesStore.setEdited(r,!1)}const a=e.filter(s=>s.catalogue);for(const s of a){const n=s.catalogue.gameSystemId;this.store.get_system(n).setCatalogue(s),electron||_.catalogues.put({content:s,id:p(s)}),this.cataloguesStore.updateCatalogue(s.catalogue),this.cataloguesStore.setEdited(p(s),!1)}this.$router.push(`/?id=${o.join(",")}`)},onBeforeRouteUpdate(){console.log("update"),this.update()},onBeforeRouteEnter(){console.log("update")},async update(e){try{const t=[];if(electron)if(this.settings.systemsFolder){const o=await y(this.settings.systemsFolder);o&&t.push(...o)}else{const o=await h("home"),a=await y(`${o}/BattleScribe/data`);a&&t.push(...a)}this.systems=A(t,o=>o.name),this.systems.forEach(o=>{var a,s;o.highlight=o.name===((s=(a=e==null?void 0:e.gameSystem)==null?void 0:a.gameSystem)==null?void 0:s.name)})}finally{this.loading=!1}}},async mounted(){if(!this.settings.systemsFolder){const e=await h("home");this.settings.systemsFolder=`${e}/BattleScribe/data`}await this.update()}});const q=e=>(P("data-v-dd2cd820"),e=e(),R(),e),G={key:0,class:"scrollable"},H={class:"mt-10px p-10px"},O={class:"workdir"},Y={class:"boutons"},J=q(()=>i("p",null,"You can open a system by clicking any of the systems in your working folder, listed below, or click Load System to load a system outside this folder.",-1)),K={class:"p-10px"},M=["onClick"];function Q(e,t,o,a,s,n){const r=w,b=z,v=S,$=k;return e.loading?(l(),L($,{key:1,progress_msg:e.progress_msg,progress_max:e.progress_max,progress:e.progress},null,8,["progress_msg","progress_max","progress"])):(l(),d("div",G,[i("div",H,[i("div",null,[g("Working Folder: "),i("span",O,f(e.settings.systemsFolder),1)]),i("div",Y,[u(r,{onUploaded:e.uploaded},null,8,["onUploaded"]),u(b,{onSelected:e.selectedFolder},null,8,["onSelected"]),u(v,{onCreated:e.update},null,8,["onCreated"]),i("button",{class:"bouton",onClick:t[0]||(t[0]=c=>e.update())}," Refresh ")]),J]),i("div",K,[(l(!0),d(m,null,D(e.systems,c=>(l(),d("div",{class:N(["item p-2px mt-2px cursor-pointer",{highlight:c.highlight}]),onClick:X=>e.selected(c)},f(c.name),11,M))),256))])]))}const oe=F(W,[["render",Q],["__scopeId","data-v-dd2cd820"]]);export{oe as default};
//# sourceMappingURL=system.c244070c.js.map
