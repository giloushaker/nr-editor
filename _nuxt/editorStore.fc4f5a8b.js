var oo=Object.defineProperty;var ao=(e,t,r)=>t in e?oo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>(ao(e,typeof t!="symbol"?t+"":t,r),r);import{Z as Hn,$ as le,a0 as Pe,a1 as lo,a2 as ts,a3 as co,a4 as $e,a5 as rs,j as It,a6 as uo,a7 as fo,a8 as rt,a9 as Fr,aa as ho,ab as po,ac as go,ad as an,ae as ln,W as Fs,af as mo,D as or,a as qt,o as I,b as S,i as O,t as j,x as T,F as de,A as bt,m as G,w as ss,H as ns,c as ne,r as is,L as yo,T as Ao,q as it,I as Me,K as xt,ag as vo,ah as Ge,X as Jn,ai as wo,p as Kr,h as Ht,l as ke,y as bo,z as Eo,e as ko,aj as ar,ak as $n,Y as ei,al as _o,am as cn,an as Io,ao as xo}from"./entry.cc75e21c.js";function Co(e){if(!e.constraints)return e;const t=[];for(const s of e.constraints)if(s.type==="exactly"){const n={...s,id:s.id+"-min",type:"min"},i={...s,id:s.id+"-max",type:"max"};t.push(n,i)}else t.push(s);const r=Hn(e);return r.constraints=t,r}function So(e){if(!e.modifiers&&!e.modifierGroups||!e.constraintsIterator)return e;const t={};for(const i of e.constraintsIterator())i.type==="exactly"&&(t[i.id]=i);function r(i){const o=[];for(const l of i)if(l.field in t){const a={...l,field:l.field+"-min"},c={...l,field:l.field+"-max"};o.push(a,c)}else o.push(l);return o}function s(i){const o=[];for(const l of i){const a={...l};a.modifiers&&(a.modifiers=r(a.modifiers)),a.modifierGroups&&(a.modifierGroups=s(a.modifierGroups)),o.push(a)}return o}const n=Hn(e);return n.modifiers&&(n.modifiers=r(n.modifiers)),n.modifierGroups&&(n.modifierGroups=s(n.modifierGroups)),n}const No=["modifiers","modifierGroups","constraints","entryLinks","categoryLinks","selectionEntries","selectionEntryGroups","infoLinks","infoGroups","rules","profiles"],ti=["profile","rule","infoLink","infoGroup","selectionEntry","selectionEntryGroup","entryLink","profiles","rules","infoLinks","infoGroups","entryLinks","selectionEntries","selectionEntryLinks","selectionEntryGroups","categoryLinks","costTypes","profileTypes","characteristicTypes","categoryEntries","categories","forceEntries","forces","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","rules","rootRules","publications","catalogueLinks","constraints","characteristics","costs"],To=["conditions","conditionGroups","modifiers","modifierGroups","repeats"],Ks=new Set([...ti,...To]),Lo=new Set(ti);function ge(e){if(e.isCatalogue&&e.isCatalogue())return e;if(e.gameSystem)return e.gameSystem;if(e.catalogue)return e.catalogue;throw Error("getDataObject data argument is not a valid system or catalogue")}function un(e){if(e.isCatalogue&&e.isCatalogue()){if(e.id&&e.gameSystemId)return`${e.gameSystemId}-${e.id}`;if(e.id)return`${e.id}`}if(e.catalogue)return`${e.catalogue.gameSystemId}-${e.catalogue.id}`;if(e.gameSystem)return e.gameSystem.id;throw Error("getDataId data argument is not a valid system or catalogue")}class W{constructor(t){v(this,"id");v(this,"type");v(this,"shared");v(this,"import");v(this,"collective");v(this,"comment");v(this,"publicationId");v(this,"typeName");v(this,"typeId");v(this,"categoryEntryId");v(this,"profileTypes");v(this,"name");v(this,"hidden");v(this,"value");v(this,"page");v(this,"defaultAmount");v(this,"profiles");v(this,"rules");v(this,"infoLinks");v(this,"infoGroups");v(this,"publications");v(this,"costs");v(this,"selectionEntries");v(this,"selectionEntryGroups");v(this,"entryLinks");v(this,"categoryEntries");v(this,"categoryLinks");v(this,"forceEntries");v(this,"sharedSelectionEntryGroups");v(this,"sharedSelectionEntries");v(this,"sharedProfiles");v(this,"sharedRules");v(this,"sharedInfoGroups");v(this,"target");v(this,"modifiers");v(this,"modifierGroups");v(this,"constraints");v(this,"repeats");v(this,"conditions");v(this,"conditionGroups");v(this,"catalogue");v(this,"extra_constraints");v(this,"childs");v(this,"loaded");v(this,"collective_recursive");v(this,"limited_to_one");v(this,"associations");v(this,"associationConstraints");v(this,"noAlphabeticalSort");return Object.setPrototypeOf(t,Object.getPrototypeOf(this))}get url(){return"%{main_catalogue|catalogue}/%{id}/%{getName}"}process(){this.loaded||(this.collective_recursive=this.isCollectiveRecursive(),this.limited_to_one=!this.canAmountBeAbove1(),this.loaded=!0)}toJson(){return cr(this)}getCatalogue(){return this.catalogue}getGameSystem(){return this.getCatalogue().getGameSystem()}get[Symbol.toStringTag](){return globalThis.isEditor?"Object":"ObjectNoObserve"}isGroup(){return!1}isForce(){return!1}isCatalogue(){return!1}isLink(){return!1}isCategory(){return!1}isRoster(){return!1}isQuantifiable(){return!1}isEntry(){return!1}isIdUnique(){return!1}isRule(){return!1}isProfile(){return!1}isInfoGroup(){return!1}isUnit(){for(const t of this.categoryLinks||[])if(t.primary)return!0;return!1}getId(){return this.id}getType(){return this.type}getTypeName(){return this.typeName}getCategoryEntryId(){return this.categoryEntryId}getHidden(){return this.hidden}getPage(){return this.page}getName(){return this.name}getDefaultAmount(){return this.defaultAmount}isCollective(){return this.collective}isCollectiveRecursive(){const t=[...this.selectionsIterator()];for(;t.length;){const r=t.pop();if(!r.isCollective()&&!r.isGroup())return!1;t.push(...r.selectionsIterator())}return!0}isEmptyNode(){for(const t of No)if(this[t]!==void 0)return!1;return!0}*forcesIterator(){}*associationsIterator(){this.associations&&(yield*this.associations)}*profilesIterator(){var t;for(const r of Ut(this))r.profiles&&(yield*r.profiles),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(s=>s.type==="profile").map(s=>s.target))}*rulesIterator(){var t;for(const r of Ut(this))r.rules&&(yield*r.rules),r.infoLinks&&(yield*(t=r.infoLinks)==null?void 0:t.filter(s=>s.type==="rule").map(s=>s.target))}*constraintsIterator(){this.constraints&&(yield*this.constraints)}*extraConstraintsIterator(){this.extra_constraints&&(yield*this.extra_constraints)}*modifierGroupsIterator(){this.modifierGroups&&(yield*this.modifierGroups)}*modifiersIterator(){this.modifiers&&(yield*this.modifiers)}*modifierGroupsIteratorRecursive(){yield this,this.isLink()&&(yield this.target);for(const t of this.modifierGroupsIterator())yield t,yield*wr(t.modifierGroups)}*selectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*localSelectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*nodesIterator(){this.isLink()&&(yield*this.target.nodesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.isLink()&&(yield*this.target.entriesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks),this.childs&&(yield*this.childs)}*iterateSelectionEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateSelectionEntriesWithRoot(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*iterateAllRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*categoryLinksIterator(){this.categoryLinks&&(yield*this.categoryLinks)}*infoLinksIterator(){this.infoLinks&&(yield*this.infoLinks)}*infoGroupsIterator(){this.infoGroups&&(yield*this.infoGroups)}*infoRulesIterator(){if(this.isForce()){const t=this.getGameSystem();t.rules&&(yield*t.rules);const r=this.main_catalogue;r.rules&&(yield*r.rules)}this.rules&&(yield*this.rules)}*infoProfilesIterator(){this.profiles&&(yield*this.profiles)}forEachCond(t,r=0){if(t(this,0)===void 0)for(const s of this.selectionsIterator())s.forEachCond(t,r+1)}forEach(t){t(this);for(const r of this.selectionsIterator())r.forEach(t)}forEachNode(t){t(this);for(const r of this.nodesIterator())r.forEachNode(t)}forEachNodeCb(t){const r=[this],s=new Set;for(;r.length;){const n=r.pop();if(!s.has(n.id)){if(s.add(n.id),t(n),n.childs){r.push(...n.childs);continue}if(n.target){const i=n.target;i.selectionEntries&&r.push(...i.selectionEntries),i.selectionEntryGroups&&r.push(...i.selectionEntryGroups),i.entryLinks&&r.push(...i.entryLinks)}n.selectionEntries&&r.push(...n.selectionEntries),n.selectionEntryGroups&&r.push(...n.selectionEntryGroups),n.entryLinks&&r.push(...n.entryLinks)}}}forEachObjectWhitelist(t,r=Ks){const s=[this];for(;s.length;){const n=s.pop();for(const i in n){const o=n[i];if(r.has(i)&&le(o))if(Array.isArray(o)){if(o.length&&le(o[0]))for(let l=0;l<o.length;l++){const a=o[l];t(a,n),s.push(a)}}else t(o,n),s.push(o)}}}forEachObject(t,r=new Set){const s=[this];for(;s.length;){const n=s.pop();for(const i of Object.keys(n)){const o=n[i];if(!r.has(i)&&le(o))if(Array.isArray(o)){if(o.length&&le(o[0]))for(let l=o.length;l--;){const a=o[l];t(a,n),s.push(a)}}else t(o,n),s.push(o)}}}findOption(t){for(const r of this.selectionsIterator())if(t(r))return r}findOptionRecursive(t){const r=[...this.selectionsIterator()];for(;r.length;){const s=r.pop();if(t(s))return s}}getCosts(){return this.costs||[]}getPrimaryCategory(){for(const t of this.categoryLinks||[])if(t.primary)return t.targetId;return this.getCategoryEntryId()??Fe}getPrimaryCategoryLink(){for(const t of this.categoryLinks||[])if(t.primary)return t}getBoundConstraint(t){const r=Object.assign({},t);r.name=this.getName(),r.parent=this;const s=t.shared||this instanceof ri;r.childId=this.isLink()&&s?this.targetId:this.id,r.scope="self",r.modifiers=[];for(const n of this.modifiersIterator())(n.field===t.id||n.field==="hidden")&&r.modifiers.push(n);r.modifierGroups=[];for(const n of this.modifierGroupsIterator())e:for(const i of wr([n]))for(const o of i.modifiers||[])if(o.field===t.id||o.field==="hidden"){r.modifierGroups.push(n);break e}return r}getChildBoundConstraints(t){const r=[];for(const s of this.selectionsIterator())if(!(t&&s.isGroup())){for(const n of s.constraintsIterator())(n.type==="min"||n.type==="exactly")&&n.scope==="parent"&&r.push(s.getBoundConstraint(n));s.isGroup()&&r.push(...s.getChildBoundConstraints())}return r}canAmountBeAbove1(){const t=Bo(this.constraintsIterator(),[...this.modifierGroupsIterator(),{modifiers:[...this.modifiersIterator()]}]);return!t.length||t.includes(-1)?!0:Math.min(...t)>1}hasOption(t){let r;return this.forEachCond(s=>(s.getName()===t&&(r=!0),r)),!!r}}class Ur extends W{isEntry(){return!0}isQuantifiable(){return!0}isIdUnique(){return!0}}class Mr extends W{getDefaultSelectionEntryId(){return this.defaultSelectionEntryId}isGroup(){return!0}isIdUnique(){return!0}}class Kt extends W{constructor(){super(...arguments);v(this,"targetId")}isLink(){return!0}isGroup(){var r;return(r=this.target)==null?void 0:r.isGroup()}isCategory(){var r;return(r=this.target)==null?void 0:r.isCategory()}isQuantifiable(){var r;return(r=this.target)==null?void 0:r.isQuantifiable()}isEntry(){var r;return(r=this.target)==null?void 0:r.isEntry()}isIdUnique(){return!1}isProfile(){var r;return((r=this.target)==null?void 0:r.isProfile())||!1}isRule(){var r;return((r=this.target)==null?void 0:r.isRule())||!1}isInfoGroup(){var r;return((r=this.target)==null?void 0:r.isInfoGroup())||!1}isUnit(){if(this.target.isUnit())return!0;for(const r of this.categoryLinks||[])if(r.primary)return!0;return!1}getId(){return this.targetId}getType(){var r;return(r=this.target)==null?void 0:r.type}getPage(){var r;return this.page||((r=this.target)==null?void 0:r.page)}getHidden(){return this.target.hidden||this.hidden}getDefaultSelectionEntryId(){var r;return this.defaultSelectionEntryId||((r=this.target)==null?void 0:r.getDefaultSelectionEntryId())}getCategoryEntryId(){var r;return this.categoryEntryId??((r=this.target)==null?void 0:r.categoryEntryId)}get associationConstraints(){return this.target.associationConstraints}get associations(){var r;return(r=this.target)==null?void 0:r.associations}isCollective(){return super.isCollective()||this.target.isCollective()}*extraConstraintsIterator(){yield*this.target.extraConstraintsIterator(),yield*super.extraConstraintsIterator()}*associationsIterator(){yield*this.target.associationsIterator(),yield*super.associationsIterator()}*rulesIterator(){yield*this.target.rulesIterator(),yield*super.rulesIterator()}*profilesIterator(){yield*this.target.profilesIterator(),yield*super.profilesIterator()}*constraintsIterator(){this.target&&(yield*this.target.constraintsIterator()),yield*super.constraintsIterator()}*modifierGroupsIterator(){yield*this.target.modifierGroupsIterator(),yield*super.modifierGroupsIterator()}*modifiersIterator(){yield*this.target.modifiersIterator(),yield*super.modifiersIterator()}*selectionsIterator(){yield*this.target.selectionsIterator(),yield*super.selectionsIterator()}*categoryLinksIterator(){yield*this.target.categoryLinksIterator(),yield*super.categoryLinksIterator()}*infoLinksIterator(){yield*this.target.infoLinksIterator(),yield*super.infoLinksIterator()}*infoGroupsIterator(){yield*this.target.infoGroupsIterator(),yield*super.infoGroupsIterator()}*infoRulesIterator(){yield*this.target.infoRulesIterator(),yield*super.infoRulesIterator()}*infoProfilesIterator(){yield*this.target.infoProfilesIterator(),yield*super.infoProfilesIterator()}getDefaultAmount(){return this.defaultAmount===void 0?this.target.defaultAmount:this.defaultAmount}getName(){var r;return((r=this.target)==null?void 0:r.name)||this.name}getParent(){return this.parent}getPrimaryCategory(){for(const r of this.categoryLinks||[])if(r.primary)return r.targetId;for(const r of this.target.categoryLinks||[])if(r.primary)return r.targetId;return this.getCategoryEntryId()??Fe}getPrimaryCategoryLink(){for(const r of this.categoryLinks||[])if(r.primary)return r;for(const r of this.target.categoryLinks||[])if(r.primary)return r}getCosts(){var s;const r={};if((s=this.target)!=null&&s.costs)for(const n of this.target.costs)r[n.typeId]=n;if(this.costs)for(const n of this.costs)r[n.typeId]=n;return Object.values(r)}}Kt.prototype.keyInfoCache={};class Oo extends Kt{getTypeName(){var t;return(t=this.target)==null?void 0:t.typeName}}class ri extends Kt{constructor(){super(...arguments);v(this,"primary");v(this,"main_catalogue")}get units(){return this.target.units}*selectionsIterator(){yield*this.target.units}isEmpty(){return this.target.isEmpty()}}const Fe="(No Category)",Qr="(Illegal Units)";class Ct extends W{constructor(){super(...arguments);v(this,"units");v(this,"main_catalogue")}isCategory(){return!0}*selectionsIterator(){yield*this.units}isEmpty(){return!this.units.length}isIdUnique(){return!this.isEmptyNode()}}class Vr extends W{constructor(){super(...arguments);v(this,"categories");v(this,"forces");v(this,"main_catalogue")}isForce(){return!0}isEntry(){return!0}isIdUnique(){return!0}*selectionsIterator(){yield*this.categories,this.forces&&(yield*this.forces)}*rulesIterator(){var r;for(const s of Ut(this))s.rules&&(yield*s.rules),s.infoLinks&&(yield*(r=s.infoLinks)==null?void 0:r.filter(n=>n.type==="rule").map(n=>n.target));this.main_catalogue&&(yield*this.main_catalogue.rulesIterator())}generateForces(r){const s=[];for(const n of this.forceEntries||[]){const i=Pe(n);i.main_catalogue=this.main_catalogue;const o=[];for(const l of n.categoryLinks||[])l.targetId in r&&o.push(r[l.targetId]);i.categories=o,this.main_catalogue.index[i.id]=i,s.push(i)}return this.forces=s,s}isEmpty(){for(const r of this.categories)if(!r.isEmpty())return!1;return!0}*forcesIterator(){this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}}const Wr=1/0;function Bo(e,t){var n,i,o,l;const r=[];function s(a){r.push(a)}for(const a of e){const c=r.length;if(a.field!=="selections"||a.type!=="max")continue;if(a.value>1){s(a.value);continue}let u=a.value;for(const d of wr(t))for(const f of d.modifiers||[])if(f.field===a.id){if(f.type==="increment"){if((n=d.repeats)!=null&&n.length||(i=f.repeats)!=null&&i.length){s(Wr);continue}if(u+=f.value,u>1){s(u);continue}}if(f.type==="decrement"&&f.value<0){if((o=d.repeats)!=null&&o.length||(l=f.repeats)!=null&&l.length){s(Wr);continue}if(u-=f.value,u>1){s(u);continue}}if(f.type==="set"&&f.value>1){if(f.value===-1){s(Wr);continue}s(f.value)}}c===r.length&&s(u)}return r}class Po extends W{}class St extends W{isProfile(){return!0}getTypeName(){return this.typeName}isIdUnique(){return!0}}class dn extends W{constructor(){super(...arguments);v(this,"originalValue")}getLabel(){var r;return this.catalogue?((r=this.catalogue.findOptionById(this.typeId))==null?void 0:r.getName())??this.typeId:this.typeId}getTypeName(){return this.getLabel()}getName(){return`${this.getLabel()} = ${this.$text}`}}class zr extends W{isInfoGroup(){return!0}isIdUnique(){return!0}}const fn=new Set(["any","model","unit","upgrade","mount","crew"]);class Xe extends W{}class os extends Xe{}class Us extends W{}class si extends W{}class lr extends W{getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description}isRule(){return!0}isIdUnique(){return!0}}function*Ut(e){yield e;for(const t of e.infoGroups||[])yield*Ut(t);for(const t of e.infoLinks||[])t.type==="infoGroup"&&(yield*Ut(t.target))}function*wr(e){if(e)for(const t of e)yield t,yield*wr(t.modifierGroups)}const ni=new Set(["costTypes","costs","categoryEntries","forceEntries","sharedSelectionEntries","selectionEntries","sharedSelectionEntryGroups","selectionEntryGroups","entryLinks","infoLinks","categoryLinks","catalogueLinks","sharedProfiles","profiles","profileTypes","characteristics","characteristicTypes","sharedInfoGroups","infoGroups","sharedRules","rules","publications","associations","modifierGroups","modifiers","constraints","conditionGroups","conditions","repeats"]),ht=new Set([...ni,"defaultAmount","id","import","importRootEntries","name","hidden","field","scope","value","percentValue","shared","includeChildSelections","includeChildForces","childId","type","targetId","primary","typeId","collective","$text","page","typeName","defaultSelectionEntryId","revision","battleScribeVersion","authorName","authorContact","authorUrl","library","gameSystemId","gameSystemRevision","xmlns","readme","description","comment","publicationDate","publisher","publisherId","publisherUrl","shortName","repeats","roundUp","defaultCostLimit","publicationId","label","labelMembers","maxAssociationsPerMember","ids","min","max","of","noAlphabeticalSort","costTypeId","profileTypeId","characteristicTypeId","value"]);function as(e,t=!1){const r={catalogue:void 0,gameSystem:void 0},s={...e};e.gameSystemId?(r.catalogue=s,r.catalogue.type="catalogue",delete r.gameSystem):(r.gameSystem=s,r.gameSystem.type="gameSystem",delete r.catalogue);const n=t?ge(r):r;return JSON.stringify(n,(o,l)=>{if(!(Array.isArray(l)&&l.length===0)&&(l===s||ht.has(o)||isFinite(Number(o))))return le(l)?Co(So(l)):l})}function cr(e,t){return JSON.stringify(e,function(s,n){if(!(Array.isArray(n)&&n.length===0)&&(ht.has(s)||isFinite(Number(s))||t!=null&&t.has(s)))return n})}function Go(e,t,r){const s=(r==null?void 0:r.forceArray)===!1;return e=Array.isArray(e)&&(e==null?void 0:e.length)===1&&s?e[0]:e,JSON.stringify(e,function(i,o){if(ht.has(i)||isFinite(Number(i))||t!=null&&t.has(i))return o},(r==null?void 0:r.formatted)===!0?2:void 0)}function ur(e,t,r=Ks){for(const s in e)if(r.has(s)){const n=e[s];if(Array.isArray(n)&&n.length&&le(n[0]))for(let i=0;i<n.length;i++){const o=n[i];t(o,e),ur(o,t,r)}}}const Ms=new Set(["force","roster","self","parent","ancestor","primary-category","force","roster","primary-catalogue"]),Ro=new Set(["any","unit","model","upgrade"]);function Fo(e,t){if(Ms.has(t))return!0;const s=e.catalogue.findOptionById(t);if(s&&(s.isForce()||s.isCategory()||s.isCatalogue()))return!0;const n=[e];for(;n.length;){const i=n.pop();if(i.id===t)return!0;i.parent&&n.push(i.parent)}return!1}function nt(e){return lo(e,r=>!(r instanceof Us||r instanceof Xe||r instanceof si))}function ii(e,t){if(!e||!t)return;const r=e.getCatalogue();if(e.parent){const n=nt(e);if(n){for(const i of n.constraintsIterator())if(i.id===t)return i}}return r==null?void 0:r.findOptionById(t)}function ze(e,t){if(t===void 0)return"";if(e){if(t.startsWith("limit::"))return`limit::${ze(e,ts(t,"limit::"))}`;const r=e.catalogue||e,s=ii(e,t);if(s){const i=s.type;if(i&&["min","max","exactly"].includes(i))return Ko(e,s);if(s.name)return s.isCategory&&s.isCategory()?`${s.name}`:s.url?`${s.name}`:s.name}const n=r.manager;if(n){const i=r.manager.findOptionById(t)||n.getCatalogueInfo({targetId:t});return(i==null?void 0:i.name)||t}}return t}function hn(e,t,r=!1,s=ze){const n=t.type||"none",i=t.value===void 0?1:t.percentValue?`${t.value}%`:t.value,o=s(e,t.field),l=["selections","forces"].includes(o)?` ${o}`:` ${s(e,o)}`,a=s(e,t.childId||"")+(r?`(${t.childId||"any"})`:""),c=a&&l?"of ":"",u=s(e,t.scope),d=u===(e==null?void 0:e.getName())?"":`${u}`,f=t.includeChildSelections?" (recursive)":"",h=d?` in ${d}${f}`:"";switch(n){case"instanceOf":return`${d} is ${a}`;case"notInstanceOf":return`${d} is not ${a}`;case"atLeast":return`${i}+${l} ${c}${a}${h}`;case"greaterThan":return`${Number(i)+1}+${l} ${c}${a}${h}`;case"atMost":return`${i}${i===0?"":"-"}${l} ${c}${a}${h}`;case"lessThan":return`${Number(i)-1}${Number(i)-1===0?"":"-"}${l} ${c}${a}${h}`;case"equalTo":return`${i}${l} ${c}${a}${h}`;case"notEqualTo":return`not ${i}${l} ${c}${a}${h}`;case"none":return`${l} ${c}${a}${h}`;default:return`${n} ${i}${l} ${c}${a}${h}`}}function Ko(e,t,r=ze){if(!co(e.constraintsIterator(),t))return t.id;const s=t.field==="selections"?"":` ${r(e,t.field)}`,n=t.scope==="parent"?"":`(${r(e,t.scope)})`,i=t.childId?` ${r(e,t.childId)}`:"";return`${t.type}${s}${i}${n}`}function Uo(e,t,r=ze){var s;return`${t.type} ${r(e,t.field)} ${r(e,(s=t.value)==null?void 0:s.toString())}`}typeof $toRaw>"u"&&(globalThis.$toRaw=function(e){return e});class Qs extends W{constructor(){super(...arguments);v(this,"targetId");v(this,"importRootEntries")}isLink(){return!1}}class pn extends W{constructor(){super(...arguments);v(this,"shortName");v(this,"publisher");v(this,"publicationDate");v(this,"publisherUrl")}}class br extends W{constructor(){super(...arguments);v(this,"library");v(this,"revision");v(this,"gameSystemId");v(this,"gameSystemRevision");v(this,"authorContact");v(this,"authorName");v(this,"authorUrl");v(this,"battleScribeVersion");v(this,"costTypes");v(this,"catalogueLinks");v(this,"gameSystem");v(this,"initialized");v(this,"loaded_wiki");v(this,"loaded_editor");v(this,"imports");v(this,"importsWithEntries");v(this,"index");v(this,"unresolvedLinks",{});v(this,"forces");v(this,"categories");v(this,"units");v(this,"roster_constraints");v(this,"manager");v(this,"book");v(this,"short");v(this,"version");v(this,"nrversion");v(this,"lastUpdated");v(this,"costIndex");v(this,"fullFilePath");v(this,"errors")}init(r=!0){this.initialized||(this.initialized=!0,this.generateImports(r),this.resolveAllLinks(r),this.generateCostIndex())}process(){if(this.loaded)return;this.loaded=!0,this.init();const r=this.generateUnits(),s=this.generateCategories(r);this.categories=Object.values(s),this.generateForces(s),this.generateExtraConstraints()}processForWiki(r){if(this.loaded_wiki)return;this.loaded_wiki=!0,this.process();const s=r.rules||{};r.rules=s,this.imports.forEach(i=>{$e(i,"links",this)});function n(i,o){i.parent=o,i.target&&$e(i.target,"links",o),i instanceof lr&&(s[i.id]=i)}ur(this,n,Lo);for(const i of this.forces||[]){i.parent=this;for(const o of i.categories)o.parent=i}}processForEditor(){this.loaded_editor||(this.loaded_editor=!0,this.init(!1),this.gameSystem&&$e(this.gameSystem,"links",this),ur(this,(r,s)=>{if(r.parent=s,r.catalogue=this,r.links||(r.links=[]),r.other_links||(r.other_links=[]),r.target&&$e(r.target,"links",r),r.isProfile()&&!r.isLink()){const i=this.findOptionById(r.typeId);i&&$e(i,"links",r)}const n=r.value;if(n){const i=this.findOptionById(n);i&&$e(i,"other_links",r)}this.refreshErrors(r)},ni))}get url(){return"%{book}"}isCatalogue(){return!0}isGameSystem(){return this.gameSystemId===this.id||!this.gameSystemId}isIdUnique(){return!0}getCatalogue(){return this}getGameSystem(){return this.isGameSystem()?this:this.gameSystem}getSystemId(){return this.isGameSystem()?this.id:this.gameSystemId}addError(r,s){this.removeError(r,s.id),r.errors||(r.errors=[]),this.errors||(this.errors=[]),r.errors.push(s),this.errors.push(s)}onRemoveError(r,s=!0){if(this.errors){const n=this.errors.indexOf(r);n>=0&&this.errors.splice(n,1)}if(r.other&&s){const n=r.other;n.getCatalogue().removeError(n,"duplicate-id-1",!1),n.getCatalogue().removeError(n,"duplicate-id-2",!1)}}removeErrors(r){var s;(s=r.errors)==null||s.forEach(n=>this.onRemoveError(n)),r instanceof os&&r.catalogue.updateConstraint(r,!0),delete r.errors}removeError(r,s,n=!0){var i;(i=r.errors)!=null&&i.length&&(r.errors=r.errors.filter(o=>(o.id===s&&this.onRemoveError(o,n),o.id!==s)))}*iterateCategoryEntries(){for(const r of this.imports)for(const s of r.categoryEntries||[])yield s;this.categoryEntries&&(yield*this.categoryEntries)}*iterateCostTypes(){for(const r of this.imports)for(const s of r.costTypes||[])yield s;this.costTypes&&(yield*this.costTypes)}*forcesIterator(){for(const r of this.imports)for(const s of r.forceEntries||[])yield s;this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const r of this.forces)yield r,yield*r.forcesIteratorRecursive()}*iterateProfileTypes(){for(const r of this.importsWithEntries)r.profileTypes&&(yield*r.profileTypes);this.profileTypes&&(yield*this.profileTypes)}*iteratePublications(){for(const r of this.imports)for(const s of r.publications||[])yield s;for(const r of this.publications||[])yield r}*iterateSelectionEntries(){for(const r of this.importsWithEntries){for(const s of r.sharedSelectionEntries||[])yield s;for(const s of r.sharedSelectionEntryGroups||[])yield s}this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllImported(){const r=["sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","categoryEntries"],s=["rules","entryLinks","profiles","infoGroups","selectionEntries","selectionEntryGroups"];for(const n of this.importsWithEntries)for(const i of s)for(const o of n[i]||[])o.import!==!1&&(yield o);for(const n of this.imports)for(const i of r)for(const o of n[i]||[])yield o;for(const n of s)for(const i of this[n]||[])yield i;for(const n of r)for(const i of this[n]||[])yield i}*iterateSelectionEntriesWithRoot(){for(const r of this.importsWithEntries){for(const s of r.selectionEntries||[])s.import!==!1&&(yield s);for(const s of r.entryLinks||[])s.import!==!1&&(yield s);for(const s of r.sharedSelectionEntries||[])yield s;for(const s of r.sharedSelectionEntryGroups||[])yield s}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllRootEntries(){for(const r of this.importsWithEntries){for(const s of r.selectionEntries||[])s.import!==!1&&(yield s);for(const s of r.entryLinks||[])s.import!==!1&&(yield s)}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.selectionEntries&&(yield*this.selectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}forEachNode(r){if(r(this),this.childs)for(const s of this.childs)s.forEachNode(r)}*selectionsIterator(){yield*this.forces}findOptionById(r){var i;const s=this.index[r];if(s)return s;const n=(i=this.imports.find(o=>r in o.index))==null?void 0:i.index[r];if(n)return n;if(this.manager&&r)return this.manager.getLoadedCatalogue(r)??this.manager.getCatalogueInfo({targetId:r})}findOptionByIdGlobal(r){var i;const s=this.index[r];if(s)return s;const n=(i=this.imports.find(o=>r in o.index))==null?void 0:i.index[r];if(n)return n;if(this.manager){const o=this.manager.findOptionById(r);return o||this.manager.getCatalogueInfo({targetId:r})}}findOptionsById(r){const s=[];for(const n of[this,...this.imports])for(const i of Object.values(n.index))i.id&&i.id===r&&s.push(i);return s}findOptionsByText(r){var i,o,l;if(!r||!r.trim()){const a=[];for(const c of[this,...this.imports])for(const u of Object.values(c.index))if(u.getName){if(u.isLink()&&u.target&&u.isCategory()&&!((i=u.parent)!=null&&i.isForce()))continue;a.push(u)}else console.log(u);return a}const s=[],n=rs(r);for(const a of[this,...this.imports])for(const c of Object.values(a.index)){const u=(o=c.getName)==null?void 0:o.call(c),d=c.id;if(u&&String(u).match(n)||d===r){if(c.isLink()&&c.target&&c.isCategory()&&!((l=c.parent)!=null&&l.isForce()))continue;s.push(c)}}return s}generateNonConflictingId(){for(;;){const r=It();if(this.findOptionById(r)===void 0)return r}}generateCostIndex(){const r={};for(const s of this.imports)for(const n of s.costTypes||[])r[n.id]=n,this.index[n.id]=n;for(const s of this.costTypes||[])r[s.id]=s,this.index[s.id]=s;return this.costIndex=r,r}generateImports(r=!0){const s={},n={};this.gameSystem&&(this.gameSystem.init(r),s[this.gameSystem.id]=this.gameSystem,n[this.gameSystem.id]=this.gameSystem,this.gameSystem.import||(this.gameSystem.imports=[]));for(const i of this.catalogueLinks||[]){const o=i.target;if(o){o.init(r);for(const l of o.imports)n[l.id]=l;for(const l of o.importsWithEntries)s[l.id]=l;i.importRootEntries&&(s[o.id]=o),n[o.id]=o}}return this.imports=Object.values(n),this.importsWithEntries=Object.values(s),this.imports}generateForces(r){var n,i;const s=[];for(const o of this.forcesIterator()){const l=Pe(o);l.main_catalogue=this;const a=[];(i=(n=r[Fe])==null?void 0:n.units)!=null&&i.length&&a.push(r[Fe]);const c=new Set;for(const d of o.categoryLinks||[])if(d.targetId in r){const f=Pe(d);f.main_catalogue=this;const h=r[f.targetId];f.target=h,f.childs=h.childs;for(const m of f.childs)c.add(m.id);a.push(f)}for(const d of o.categoryEntries||[])if(d.id in r){const f=r[d.id],h=Pe(f);h.main_catalogue=this;for(const m of h.childs)c.add(m.id);a.push(h)}const u=this.units.filter(d=>!c.has(d.id));if(u.length){const d=Pe(r[Qr]);d.childs=u,d.units=u,a.push(d)}l.childs=a,l.categories=a,this.index[l.id]=l,l.forceEntries&&l.generateForces(r),s.push(l)}return this.forces=s,this.childs=s,s}generateCategories(r){const s={},n=new Set;for(const a of this.iterateCategoryEntries()){const c=Pe(a);c.main_catalogue=this;const u=r[c.id]||[];c.units=u,c.childs=u,this.index[a.id]=a,s[c.id]=c,n.add(c.id)}for(const a in r)if(!n.has(a)){const c=this.findOptionById(a);if(c){const u=Pe(c);u.main_catalogue=this;const d=r[u.id]||[];u.units=d,u.childs=d,this.index[c.id]=c,s[u.id]=u}}const i=r[Fe]||[],o={name:"Uncategorized",id:Fe,hidden:!1,units:i,childs:i,catalogue:this};s[Fe]=Object.setPrototypeOf(o,Ct.prototype);const l={name:"Illegal Units",id:Qr,hidden:!0,units:[],childs:[],catalogue:this};return s[Qr]=Object.setPrototypeOf(l,Ct.prototype),s}generateUnits(){const r=[];for(const i of this.importsWithEntries){const o=i.isGameSystem();for(const l of i.selectionEntries||[])(o||l.import!==!1)&&r.push(l);for(const l of i.entryLinks||[])(o||l.import!==!1)&&r.push(l)}for(const i of this.selectionEntries||[])r.push(i);for(const i of this.entryLinks||[])r.push(i);const s=uo(r,i=>i.getName());return this.units=s,fo(s,i=>i.getPrimaryCategory())}generateExtraConstraints(){const r={},s=[],n={},i=new Set,o={};function l(a,c,u){const d=c.target||c;for(const f of u){const h=`${f.id}::${c.id}`;switch(f.scope){case"parent":break;case"roster":r[h]=c.getBoundConstraint(f);break;case"force":s.push(c.getBoundConstraint(f));break;case"primary-category":case"primary-catalogue":break;default:if(i.has(f.scope)){rt(n,f.scope,d.getBoundConstraint(f));break}const m=a.index[f.scope];if(m){const g=m.extra_constraints||[];g.push(c.getBoundConstraint(f)),m.extra_constraints=g;break}break}}}for(const a of this.forcesIteratorRecursive())i.add(a.id);for(const a of this.categories)i.add(a.id);for(const a of this.categories){l(this,a,a.constraintsIterator());const c={};a.forEachNodeCb(u=>{var d;if(u&&!u.isForce()&&(!u.isGroup()&&!u.extra_constraints&&(u.extra_constraints=u.getChildBoundConstraints(!0)),!(u.isCategory()&&u.isLink())&&!(!u.constraints&&!((d=u.target)!=null&&d.constraints)))){for(const f of u.constraintsIterator())if(f.type==="min"||f.type==="exactly"){const h=`${f.id}::${u.id}`;switch(f.scope){case"parent":break;case"roster":r[h]=u.getBoundConstraint(f);break;case"force":c[h]=u.getBoundConstraint(f);break;case"primary-category":case"primary-catalogue":break;default:if(i.has(f.scope)){rt(n,f.scope,u.getBoundConstraint(f));break}const m=this.index[f.scope];if(m){const g=m.extra_constraints||[];g.push(u.getBoundConstraint(f)),m.extra_constraints=g;break}break}}}}),o[a.getId()]=Object.values(c)}for(const a of this.forcesIteratorRecursive()){const c=a.extra_constraints||[];c.push(...s),a.id in n&&c.push(...n[a.id]),c.length&&(a.extra_constraints=c);for(const u of a.categories)u.getId()in o&&c.push(...o[u.getId()]);c.length&&(a.extra_constraints=c)}for(const a of this.categories){const c=a.extra_constraints||[];a.id in n&&c.push(...n[a.id]),c.length&&(a.extra_constraints=c)}this.roster_constraints=Object.values(r)}async reload(r=this.manager){delete this.initialized,delete this.loaded,delete this.loaded_editor,delete this.index;const s=this.isGameSystem()?"gameSystem":"catalogue",n=await r.loadData({[s]:this});return this.processForEditor(),n}refreshErrors(r,s=!1){var n,i;r.isLink()?r.target?(this.removeError(r,"no-target"),Fr(this.unresolvedLinks,r.targetId,$toRaw(r)),Fr(this.manager.unresolvedLinks,r.targetId,$toRaw(r))):(this.addError(r,{source:r,severity:"error",msg:`(${r.editorTypeName}) ${r.name} has no target`,id:"no-target"}),!((n=this.unresolvedLinks[r.targetId])!=null&&n.includes($toRaw(r)))&&!s&&rt(this.unresolvedLinks,r.targetId,$toRaw(r)),(i=this.manager.unresolvedLinks[r.targetId])!=null&&i.includes($toRaw(r))||rt(this.manager.unresolvedLinks,r.targetId,$toRaw(r))):r.isProfile()?r.typeId?this.removeError(r,"no-profile-type"):this.addError(r,{source:r,severity:"error",msg:"Profile has no type",id:"no-profile-type"}):r instanceof Xe&&this.updateCondition(r)}addToIndex(r){var s,n,i,o,l,a;if(r.id){if(r.catalogue=this,(n=(s=this.manager)==null?void 0:s.settings)!=null&&n.globalDuplicateIdError){const c=this.manager.index;if(c[r.id]&&c[r.id]!==r&&(r.isIdUnique()||c[r.id].isIdUnique())){const u=c[r.id],d=u.getCatalogue(),f=this!==d;d&&f&&(d.addError(u,{source:u,severity:"error",msg:`Duplicate id ${r.id} ${r.getName()}`,id:"duplicate-id-1",other:r,extra:d.name}),d.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${u.getName()}`,id:"duplicate-id-2",other:u,extra:this.name})),this.addError(u,{source:u,severity:"error",msg:`Duplicate id ${r.id}  ${r.getName()}`,id:"duplicate-id-1",other:r,extra:f?d.name:void 0}),this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${u.getName()}`,id:"duplicate-id-2",other:u,extra:f?this.name:void 0})}c[r.id]=r}else if(this.index[r.id]&&this.index[r.id]!==r){const c=this.index[r.id];(r.isIdUnique()||c.isIdUnique()||r.getName()!==c.getName())&&(this.addError(c,{source:c,severity:"error",msg:`Duplicate id ${r.id} ${r.getName()}`,id:"duplicate-id-1",other:r}),this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${r.id} ${c.getName()}`,id:"duplicate-id-2",other:c}))}if(this.index[r.id]=r,this.unresolvedLinks&&this.unresolvedLinks[r.id])for(const c of[...this.unresolvedLinks[r.id]])c.isLink()?this.updateLink(c):this.refreshErrors(c);if((i=this.manager)!=null&&i.unresolvedLinks&&((o=this.manager.unresolvedLinks[r.id])!=null&&o.length))for(const c of[...this.manager.unresolvedLinks[r.id]])c.isLink()?(l=c.catalogue)==null||l.updateLink(c):(a=c.catalogue)==null||a.refreshErrors(c)}}removeFromIndex(r){r.id&&$toRaw(this.index[r.id])===$toRaw(r)&&delete this.index[r.id],this.removeErrors(r);for(const s of r.links||[])delete s.target,s.catalogue.refreshErrors(s);for(const s of r.other_links||[])s.catalogue.refreshErrors(s,!0)}getIndexes(){const r=[];r.push(this.index);for(const s of this.imports)r.push(s.index);return r}resolveAllLinks(r=!0){const s=[],n=[],i=[],o=[];this.index||(this.index=Do(),ur(this,(c,u)=>{this.addToIndex(c),c.publicationId&&n.push(c),c.isLink()&&(s.push(c),o.push(u)),Wo(c)&&i.push(c)},Ks));const l=this.getIndexes(),a=Mo(s,l,o,r);if(Qo(n,l),Vo(i,l),!r){this.unresolvedLinks={};for(const c of a)rt(this.unresolvedLinks,c.targetId,$toRaw(c)),delete c.target}}removeRef(r,s){s.links||(s.links=[]);const n=s.links.indexOf(r);n>=0&&s.links.splice(n,1)}addRef(r,s){s.links||(s.links=[]),s.links.indexOf(r)===-1&&s.links.push(r)}hasOtherRef(r,s){return s.other_links&&s.other_links.includes(r)}removeOtherRef(r,s){s.other_links||(s.other_links=[]);const n=s.other_links.indexOf(r);n>=0&&s.other_links.splice(n,1)}addOtherRef(r,s){s.other_links||(s.other_links=[]),s.other_links.indexOf(r)===-1&&s.other_links.push(r)}updateLink(r){if(r.target&&this.removeRef(r,r.target),r.target=oi(r.targetId,this.getIndexes()),r.target){this.addRef(r,r.target);const s=r.target.editorTypeName;s=="category"?delete r.type:r.type=s}return this.refreshErrors(r),r.target!==void 0}updateConstraint(r,s=!1){var o,l,a,c;const n=new Set,i=new Set;for(const u of((o=r.parent)==null?void 0:o.constraintsIterator())||[])s&&r===u||(n.has(u.id)?i.add(u.id):n.add(u.id));for(const u of((l=r.parent)==null?void 0:l.constraintsIterator())||[])s&&r===u||(i.has(u.id)?(a=u.catalogue)==null||a.addError(u,{id:"duplicate-constraint-id",msg:"Duplicate constraints id",source:r}):(c=u.catalogue)==null||c.removeError(u,"duplicate-constraint-id"))}updateCondition(r,s){if(r.scope){const i=nt(r);if(i&&!Fo(i,r.scope)?this.addError(r,{source:r,id:"invalid-scope",msg:`Invalid scope ${r.scope}`}):this.removeError(r,"invalid-scope"),r.scope&&!Ms.has(r.scope)){const o=this.findOptionById(r.scope);o&&o.getCatalogue().addOtherRef(r,o)}}if(r instanceof os)return this.updateConstraint(r);const n=["instanceOf","notInstanceOf"].includes(r.type);if(s&&!fn.has(s)){const i=n?this.findOptionByIdGlobal(s):this.findOptionById(s);i&&this.removeOtherRef(r,i)}if(r.childId){if(fn.has(r.childId)){this.removeError(r,"id-not-exist");return}const i=n?this.findOptionByIdGlobal(r.childId):this.findOptionById(r.childId);if(i){this.hasOtherRef(r,i)||this.addOtherRef(r,i),this.removeError(r,"id-not-exist"),Fr(this.manager.unresolvedLinks,r.childId,$toRaw(r));return}}this.addError(r,{source:r,severity:"warning",msg:"child id does not exist",id:"id-not-exist"}),ho(this.manager.unresolvedLinks,r.childId,$toRaw(r))}unlinkLink(r){r.target&&this.removeRef(r,r.target)}}function oi(e,t){for(const r of t)if(e in r)return r[e]}function Mo(e=[],t,r,s=!0){e.length;let n=0;for(;e.length!==n;){const i=e,o=r;n=i.length,e=[],r=[];for(let l=0;l<i.length;l++){const a=i[l],c=o[l],u=a.targetId,d=oi(u,t);if(d){a.target=d;continue}e.push(a),r.push(c)}}if(e.length&&s)for(let i=0;i<e.length;i++){const o=e[i],l=r[i];for(const[a,c]of Object.entries(l))if(c===o&&delete l[a],Array.isArray(c))for(const u in c)c[u]===o&&c.splice(u,1)}return e}function Qo(e=[],t){for(const r of e)for(const s of t)if(r.publicationId in s){r.publication=s[r.publicationId];break}}function Vo(e=[],t){for(const r of e){const s=r.childId;for(const n of t)if(s in n){r.childId=n[s].getId();break}}}function Wo(e){return e.shared!==!1&&e.childId!==void 0}let zo=class{get[Symbol.toStringTag](){return"ObjectNoObserve"}};function Do(){return new zo}function ai(e){return e.arrayBuffer?e.arrayBuffer():new Promise((t,r)=>{const s=new FileReader;s.addEventListener("loadend",()=>{t(s.result)}),s.addEventListener("error",r),s.readAsArrayBuffer(e)})}async function Zo(e){const t=await ai(e);return new Uint8Array(t)}function li(e){return typeof Blob<"u"&&e instanceof Blob}function Mt(e){return typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer}const qo=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function Yo(e){return e.byteOffset===0&&e.byteLength===e.buffer.byteLength}class gn{constructor(t){this.typedArray=t instanceof ArrayBuffer||Mt(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,r){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,r)}}class mn{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,r){const s=this.blob.slice(t,t+r),n=await ai(s);return new Uint8Array(n)}async sliceAsBlob(t,r,s=""){return this.blob.slice(t,t+r,s)}}function Xo(e,t){var r=Uint8Array;if(e[0]==3&&e[1]==0)return t||new r(0);var s=Ho,n=ci,i=jo,o=ui,l=t==null;l&&(t=new r(e.length>>>2<<3));for(var a=0,c=0,u=0,d=0,f=0,h=0,m=0,g=0,y=0,p,A;a==0;){if(a=s(e,y,1),c=s(e,y+1,2),y+=3,c==0){y&7&&(y+=8-(y&7));var w=(y>>>3)+4,k=e[w-4]|e[w-3]<<8;l&&(t=Dr(t,g+k)),t.set(new r(e.buffer,e.byteOffset+w,k),g),y=w+k<<3,g+=k;continue}if(l&&(t=Dr(t,g+(1<<17))),c==1&&(p=L.flmap,A=L.fdmap,h=512-1,m=32-1),c==2){u=n(e,y,5)+257,d=n(e,y+5,5)+1,f=n(e,y+10,4)+4,y+=14;for(var b=0;b<38;b+=2)L.itree[b]=0,L.itree[b+1]=0;for(var E=1,b=0;b<f;b++){var _=n(e,y+b*3,3);L.itree[(L.ordr[b]<<1)+1]=_,_>E&&(E=_)}y+=3*f,Nt(L.itree,E),Tt(L.itree,E,L.imap),p=L.lmap,A=L.dmap,y=i(L.imap,(1<<E)-1,u+d,e,y,L.ttree);var P=yn(L.ttree,0,u,L.ltree);h=(1<<P)-1;var C=yn(L.ttree,u,d,L.dtree);m=(1<<C)-1,Nt(L.ltree,P),Tt(L.ltree,P,p),Nt(L.dtree,C),Tt(L.dtree,C,A)}for(;;){var F=p[o(e,y)&h];y+=F&15;var R=F>>>4;if(!(R>>>8))t[g++]=R;else{if(R==256)break;var q=g+R-254;if(R>264){var z=L.ldef[R-257];q=g+(z>>>3)+n(e,y,z&7),y+=z&7}var M=A[o(e,y)&m];y+=M&15;var Ee=M>>>4,ue=L.ddef[Ee],Y=(ue>>>4)+s(e,y,ue&15);for(y+=ue&15,l&&(t=Dr(t,g+(1<<17)));g<q;)t[g]=t[g++-Y],t[g]=t[g++-Y],t[g]=t[g++-Y],t[g]=t[g++-Y];g=q}}}return t.length==g?t:t.slice(0,g)}function Dr(e,t){var r=e.length;if(t<=r)return e;var s=new Uint8Array(Math.max(r<<1,t));return s.set(e,0),s}function jo(e,t,r,s,n,i){for(var o=ci,l=ui,a=0;a<r;){var c=e[l(s,n)&t];n+=c&15;var u=c>>>4;if(u<=15)i[a]=u,a++;else{var d=0,f=0;u==16?(f=3+o(s,n,2),n+=2,d=i[a-1]):u==17?(f=3+o(s,n,3),n+=3):u==18&&(f=11+o(s,n,7),n+=7);for(var h=a+f;a<h;)i[a]=d,a++}}return n}function yn(e,t,r,s){for(var n=0,i=0,o=s.length>>>1;i<r;){var l=e[i+t];s[i<<1]=0,s[(i<<1)+1]=l,l>n&&(n=l),i++}for(;i<o;)s[i<<1]=0,s[(i<<1)+1]=0,i++;return n}function Nt(e,t){for(var r=e.length,s,n,i,o,l,a=L.bl_count,o=0;o<=t;o++)a[o]=0;for(o=1;o<r;o+=2)a[e[o]]++;var c=L.next_code;for(s=0,a[0]=0,n=1;n<=t;n++)s=s+a[n-1]<<1,c[n]=s;for(i=0;i<r;i+=2)l=e[i+1],l!=0&&(e[i]=c[l],c[l]++)}function Tt(e,t,r){for(var s=e.length,n=L.rev15,i=0;i<s;i+=2)if(e[i+1]!=0)for(var o=i>>1,l=e[i+1],a=o<<4|l,c=t-l,u=e[i]<<c,d=u+(1<<c);u!=d;){var f=n[u]>>>15-t;r[f]=a,u++}}function An(e,t){for(var r=L.rev15,s=15-t,n=0;n<e.length;n+=2){var i=e[n]<<t-e[n+1];e[n]=r[i]>>>s}}function ci(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function Ho(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function ui(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}const L=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(var e=32768,t=0;t<e;t++){var r=t;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,L.rev15[t]=(r>>>16|r<<16)>>>17}function s(n,i,o){for(;i--!=0;)n.push(0,o)}for(var t=0;t<32;t++)L.ldef[t]=L.of0[t]<<3|L.exb[t],L.ddef[t]=L.df0[t]<<4|L.dxb[t];s(L.fltree,144,8),s(L.fltree,255-143,9),s(L.fltree,279-255,7),s(L.fltree,287-279,8),Nt(L.fltree,9),Tt(L.fltree,9,L.flmap),An(L.fltree,9),s(L.fdtree,32,5),Nt(L.fdtree,5),Tt(L.fdtree,5,L.fdmap),An(L.fdtree,5),s(L.itree,19,0),s(L.ltree,286,0),s(L.dtree,30,0),s(L.ttree,320,0)})();const vn={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,s=0;s<8;s++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}(),update:function(e,t,r,s){for(var n=0;n<s;n++)e=vn.table[(e^t[r+n])&255]^e>>>8;return e},crc:function(e,t,r){return vn.update(4294967295,e,t,r)^4294967295}};function Jo(e,t){return Xo(e,t)}const wn={numWorkers:1,workerURL:"",useWorkers:!1};let $o=0;const dr=[];function Zr(e){return new Promise((t,r)=>{const s=new Worker(e);s.onmessage=n=>{n.data==="start"?(s.onerror=void 0,s.onmessage=void 0,t(s)):r(new Error(`unexpected message: ${n.data}`))},s.onerror=r})}function ea(e,t){return e.require?e.require(t):{}}(function(){if(qo){const{Worker:e}=ea(module,"worker_threads");return{async createWorker(t){return new e(t)},addEventListener(t,r){t.on("message",s=>{r({target:t,data:s})})},async terminate(t){await t.terminate()}}}else return{async createWorker(e){try{return await Zr(e)}catch{console.warn("could not load worker:",e)}let t;try{const r=await fetch(e,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${e}`);t=await r.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const s=await Zr(e);return wn.workerURL=e,s}catch{console.warn("could not load worker via fetch:",e)}if(t!==void 0)try{e=`data:application/javascript;base64,${btoa(t)}`;const r=await Zr(e);return wn.workerURL=e,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}}})();function ta(e,t,r,s){const n=new Uint8Array(t);Jo(e,n),s(r?new Blob([n],{type:r}):n.buffer)}async function ra(){if(dr.length!==0)for(;dr.length;){const{src:e,uncompressedSize:t,type:r,resolve:s}=dr.shift();let n=e;li(e)&&(n=await Zo(e)),ta(n,t,r,s)}}function di(e,t,r){return new Promise((s,n)=>{dr.push({src:e,uncompressedSize:t,type:r,resolve:s,reject:n,id:$o++}),ra()})}function sa(e,t){const r=e&31,s=(e>>5&15)-1,n=(e>>9&127)+1980,i=0,o=(t&31)*2,l=t>>5&63,a=t>>11&31;return new Date(n,s,r,a,l,o,i)}class na{constructor(t,r){this._reader=t,this._rawEntry=r,this.name=r.name,this.nameBytes=r.nameBytes,this.size=r.uncompressedSize,this.compressedSize=r.compressedSize,this.comment=r.comment,this.commentBytes=r.commentBytes,this.compressionMethod=r.compressionMethod,this.lastModDate=sa(r.lastModFileDate,r.lastModFileTime),this.isDirectory=r.uncompressedSize===0&&r.name.endsWith("/"),this.encrypted=!!(r.generalPurposeBitFlag&1),this.externalFileAttributes=r.externalFileAttributes,this.versionMadeBy=r.versionMadeBy}async blob(t="application/octet-stream"){return await ga(this._reader,this._rawEntry,t)}async arrayBuffer(){return await pa(this._reader,this._rawEntry)}async text(){const t=await this.arrayBuffer();return Lt(new Uint8Array(t))}async json(){const t=await this.text();return JSON.parse(t)}}const qr=22,ia=65535,oa=101010256,aa=101075792;async function ut(e,t,r){return await e.read(t,r)}async function ls(e,t,r,s){return e.sliceAsBlob?await e.sliceAsBlob(t,r,s):await e.read(t,r)}const la={unsigned(){return 0}};function H(e,t){return e[t]+e[t+1]*256}function ee(e,t){return e[t]+e[t+1]*256+e[t+2]*65536+e[t+3]*16777216}function Qe(e,t){return ee(e,t)+ee(e,t+4)*4294967296}const ca=new TextDecoder;function Lt(e,t){return Mt(e.buffer)&&(e=new Uint8Array(e)),ca.decode(e)}async function ua(e,t){const r=Math.min(qr+ia,t),s=t-r,n=await ut(e,s,r);for(let i=r-qr;i>=0;--i){if(ee(n,i)!==oa)continue;const o=new Uint8Array(n.buffer,n.byteOffset+i,n.byteLength-i),l=H(o,4);if(l!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${l}`);const a=H(o,10),c=ee(o,12),u=ee(o,16),d=H(o,20),f=o.length-qr;if(d!==f)throw new Error(`invalid comment length. expected: ${f}, actual: ${d}`);const h=new Uint8Array(o.buffer,o.byteOffset+22,d),m=Lt(h);return a===65535||u===4294967295?await fa(e,s+i,m,h):await fi(e,u,c,a,m,h)}throw new Error("could not find end of central directory. maybe not zip file")}const da=117853008;async function fa(e,t,r,s){const n=t-20,i=await ut(e,n,20);if(ee(i,0)!==da)throw new Error("invalid zip64 end of central directory locator signature");const o=Qe(i,8),l=await ut(e,o,56);if(ee(l,0)!==aa)throw new Error("invalid zip64 end of central directory record signature");const a=Qe(l,32),c=Qe(l,40),u=Qe(l,48);return fi(e,u,c,a,r,s)}const ha=33639248;async function fi(e,t,r,s,n,i){let o=0;const l=await ut(e,t,r),a=[];for(let u=0;u<s;++u){const d=l.subarray(o,o+46),f=ee(d,0);if(f!==ha)throw new Error(`invalid central directory file header signature: 0x${f.toString(16)}`);const h={versionMadeBy:H(d,4),versionNeededToExtract:H(d,6),generalPurposeBitFlag:H(d,8),compressionMethod:H(d,10),lastModFileTime:H(d,12),lastModFileDate:H(d,14),crc32:ee(d,16),compressedSize:ee(d,20),uncompressedSize:ee(d,24),fileNameLength:H(d,28),extraFieldLength:H(d,30),fileCommentLength:H(d,32),internalFileAttributes:H(d,36),externalFileAttributes:ee(d,38),relativeOffsetOfLocalHeader:ee(d,42)};if(h.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");o+=46;const m=l.subarray(o,o+h.fileNameLength+h.extraFieldLength+h.fileCommentLength);h.nameBytes=m.slice(0,h.fileNameLength),h.name=Lt(h.nameBytes);const g=h.fileNameLength+h.extraFieldLength,y=m.slice(h.fileNameLength,g);h.extraFields=[];let p=0;for(;p<y.length-3;){const w=H(y,p+0),k=H(y,p+2),b=p+4,E=b+k;if(E>y.length)throw new Error("extra field length exceeds extra field buffer size");h.extraFields.push({id:w,data:y.slice(b,E)}),p=E}if(h.commentBytes=m.slice(g,g+h.fileCommentLength),h.comment=Lt(h.commentBytes),o+=m.length,h.uncompressedSize===4294967295||h.compressedSize===4294967295||h.relativeOffsetOfLocalHeader===4294967295){const w=h.extraFields.find(E=>E.id===1);if(!w)throw new Error("expected zip64 extended information extra field");const k=w.data;let b=0;if(h.uncompressedSize===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include uncompressed size");h.uncompressedSize=Qe(k,b),b+=8}if(h.compressedSize===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include compressed size");h.compressedSize=Qe(k,b),b+=8}if(h.relativeOffsetOfLocalHeader===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include relative header offset");h.relativeOffsetOfLocalHeader=Qe(k,b),b+=8}}const A=h.extraFields.find(w=>w.id===28789&&w.data.length>=6&&w.data[0]===1&&ee(w.data,1),la.unsigned(h.nameBytes));if(A&&(h.fileName=Lt(A.data.slice(5))),h.compressionMethod===0){let w=h.uncompressedSize;if(h.generalPurposeBitFlag&1&&(w+=12),h.compressedSize!==w)throw new Error(`compressed size mismatch for stored file: ${h.compressedSize} != ${w}`)}a.push(h)}return{zip:{comment:n,commentBytes:i},entries:a.map(u=>new na(e,u))}}async function hi(e,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const r=await ut(e,t.relativeOffsetOfLocalHeader,30),s=await e.getLength(),n=ee(r,0);if(n!==67324752)throw new Error(`invalid local file header signature: 0x${n.toString(16)}`);const i=H(r,26),o=H(r,28),l=t.relativeOffsetOfLocalHeader+r.length+i+o;let a;if(t.compressionMethod===0)a=!1;else if(t.compressionMethod===8)a=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);const c=l,u=c+t.compressedSize;if(t.compressedSize!==0&&u>s)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${s}`);return{decompress:a,fileDataStart:c}}async function pa(e,t){const{decompress:r,fileDataStart:s}=await hi(e,t);if(!r){const o=await ut(e,s,t.compressedSize);return Yo(o)?o.buffer:o.slice().buffer}const n=await ls(e,s,t.compressedSize);return await di(n,t.uncompressedSize)}async function ga(e,t,r){const{decompress:s,fileDataStart:n}=await hi(e,t);if(!s){const l=await ls(e,n,t.compressedSize,r);return li(l)?l:new Blob([Mt(l.buffer)?new Uint8Array(l):l],{type:r})}const i=await ls(e,n,t.compressedSize);return await di(i,t.uncompressedSize,r)}async function ma(e){let t;if(typeof Blob<"u"&&e instanceof Blob)t=new mn(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new gn(e);else if(Mt(e)||Mt(e.buffer))t=new gn(e);else if(typeof e=="string"){const s=await fetch(e);if(!s.ok)throw new Error(`failed http request ${e}, status: ${s.status}: ${s.statusText}`);const n=await s.blob();t=new mn(n)}else if(typeof e.getLength=="function"&&typeof e.read=="function")t=e;else throw new Error("unsupported source type");const r=await t.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await ua(t,r)}async function pi(e){const{zip:t,entries:r}=await ma(e);return{zip:t,entries:Object.fromEntries(r.map(s=>[s.name,s]))}}var Vs={},Ws={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+t+"]["+r+"]*",n=new RegExp("^"+s+"$"),i=function(l,a){const c=[];let u=a.exec(l);for(;u;){const d=[];d.startIndex=a.lastIndex-u[0].length;const f=u.length;for(let h=0;h<f;h++)d.push(u[h]);c.push(d),u=a.exec(l)}return c},o=function(l){const a=n.exec(l);return!(a===null||typeof a>"u")};e.isExist=function(l){return typeof l<"u"},e.isEmptyObject=function(l){return Object.keys(l).length===0},e.merge=function(l,a,c){if(a){const u=Object.keys(a),d=u.length;for(let f=0;f<d;f++)c==="strict"?l[u[f]]=[a[u[f]]]:l[u[f]]=a[u[f]]}},e.getValue=function(l){return e.isExist(l)?l:""},e.isName=o,e.getAllMatches=i,e.nameRegexp=s})(Ws);const zs=Ws,ya={allowBooleanAttributes:!1,unpairedTags:[]};Vs.validate=function(e,t){t=Object.assign({},ya,t);const r=[];let s=!1,n=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=En(e,i),i.err)return i}else if(e[i]==="<"){let o=i;if(i++,e[i]==="!"){i=kn(e,i);continue}else{let l=!1;e[i]==="/"&&(l=!0,i++);let a="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
`&&e[i]!=="\r";i++)a+=e[i];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),i--),!Ia(a)){let d;return a.trim().length===0?d="Invalid space after '<'.":d="Tag '"+a+"' is an invalid name.",D("InvalidTag",d,se(e,i))}const c=wa(e,i);if(c===!1)return D("InvalidAttr","Attributes for '"+a+"' have open quote.",se(e,i));let u=c.value;if(i=c.index,u[u.length-1]==="/"){const d=i-u.length;u=u.substring(0,u.length-1);const f=_n(u,t);if(f===!0)s=!0;else return D(f.err.code,f.err.msg,se(e,d+f.err.line))}else if(l)if(c.tagClosed){if(u.trim().length>0)return D("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",se(e,o));{const d=r.pop();if(a!==d.tagName){let f=se(e,d.tagStartPos);return D("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+f.line+", col "+f.col+") instead of closing tag '"+a+"'.",se(e,o))}r.length==0&&(n=!0)}}else return D("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",se(e,i));else{const d=_n(u,t);if(d!==!0)return D(d.err.code,d.err.msg,se(e,i-u.length+d.err.line));if(n===!0)return D("InvalidXml","Multiple possible root nodes found.",se(e,i));t.unpairedTags.indexOf(a)!==-1||r.push({tagName:a,tagStartPos:o}),s=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=kn(e,i);continue}else if(e[i+1]==="?"){if(i=En(e,++i),i.err)return i}else break;else if(e[i]==="&"){const d=ka(e,i);if(d==-1)return D("InvalidChar","char '&' is not expected.",se(e,i));i=d}else if(n===!0&&!bn(e[i]))return D("InvalidXml","Extra text at the end",se(e,i));e[i]==="<"&&i--}}else{if(bn(e[i]))continue;return D("InvalidChar","char '"+e[i]+"' is not expected.",se(e,i))}if(s){if(r.length==1)return D("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",se(e,r[0].tagStartPos));if(r.length>0)return D("InvalidXml","Invalid '"+JSON.stringify(r.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return D("InvalidXml","Start tag expected.",1);return!0};function bn(e){return e===" "||e==="	"||e===`
`||e==="\r"}function En(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const s=e.substr(r,t-r);if(t>5&&s==="xml")return D("InvalidXml","XML declaration allowed only at the start of the document.",se(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function kn(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const Aa='"',va="'";function wa(e,t){let r="",s="",n=!1;for(;t<e.length;t++){if(e[t]===Aa||e[t]===va)s===""?s=e[t]:s!==e[t]||(s="");else if(e[t]===">"&&s===""){n=!0;break}r+=e[t]}return s!==""?!1:{value:r,index:t,tagClosed:n}}const ba=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function _n(e,t){const r=zs.getAllMatches(e,ba),s={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return D("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",yt(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return D("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",yt(r[n]));if(r[n][3]===void 0&&!t.allowBooleanAttributes)return D("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",yt(r[n]));const i=r[n][2];if(!_a(i))return D("InvalidAttr","Attribute '"+i+"' is an invalid name.",yt(r[n]));if(!s.hasOwnProperty(i))s[i]=1;else return D("InvalidAttr","Attribute '"+i+"' is repeated.",yt(r[n]))}return!0}function Ea(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function ka(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Ea(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function D(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function _a(e){return zs.isName(e)}function Ia(e){return zs.isName(e)}function se(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function yt(e){return e.startIndex+e[1].length}var Ds={};const gi={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},xa=function(e){return Object.assign({},gi,e)};Ds.buildOptions=xa;Ds.defaultOptions=gi;class Ca{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,[":@"]:t[":@"]}):this.child.push({[t.tagname]:t.child})}}var Sa=Ca;function Na(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let s=1,n=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!i){if(n&&Oa(e,t))t+=7,[entityName,val,t]=Ta(e,t+1),val.indexOf("&")===-1&&(r[entityName]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Ba(e,t))t+=8;else if(n&&Pa(e,t))t+=8;else if(n&&Ga(e,t))t+=9;else if(La)i=!0;else throw new Error("Invalid DOCTYPE");s++,o=""}else if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,s--):s--,s===0)break}else e[t]==="["?n=!0:o+=e[t];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function Ta(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=e[t++];let n="";for(;t<e.length&&e[t]!==s;t++)n+=e[t];return[r,n,t]}function La(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function Oa(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function Ba(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function Pa(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Ga(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}var Ra=Na;const Fa=/^[-+]?0x[a-fA-F0-9]+$/,Ka=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ua={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Ma(e,t={}){if(t=Object.assign({},Ua,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&Fa.test(r))return Number.parseInt(r,16);{const s=Ka.exec(r);if(s){const n=s[1],i=s[2];let o=Qa(s[3]);const l=s[4]||s[6];if(!t.leadingZeros&&i.length>0&&n&&r[2]!==".")return e;if(!t.leadingZeros&&i.length>0&&!n&&r[1]!==".")return e;{const a=Number(r),c=""+a;return c.search(/[eE]/)!==-1||l?t.eNotation?a:e:r.indexOf(".")!==-1?c==="0"&&o===""||c===o||n&&c==="-"+o?a:e:i?o===c||n+o===c?a:e:r===c||r===n+c?a:e}}else return e}}function Qa(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var Va=Ma;const Zs=Ws,At=Sa,Wa=Ra,za=Va;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,Zs.nameRegexp);let Da=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Za,this.parseXml=Ha,this.parseTextData=qa,this.resolveNameSpace=Ya,this.buildAttributesMap=ja,this.isItStopNode=tl,this.replaceEntitiesValue=$a,this.readStopNodeData=sl,this.saveTextToParentTag=el,this.addChild=Ja}};function Za(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const s=t[r];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:e[s]}}}function qa(e,t,r,s,n,i,o){if(e!==void 0&&(this.options.trimValues&&!s&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const l=this.options.tagValueProcessor(t,e,r,n,i);return l==null?e:typeof l!=typeof e||l!==e?l:this.options.trimValues?us(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?us(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Ya(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const Xa=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ja(e,t,r){if(!this.options.ignoreAttributes&&typeof e=="string"){const s=Zs.getAllMatches(e,Xa),n=s.length,i={};for(let o=0;o<n;o++){const l=this.resolveNameSpace(s[o][1]);let a=s[o][4],c=this.options.attributeNamePrefix+l;if(l.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const u=this.options.attributeValueProcessor(l,a,t);u==null?i[c]=a:typeof u!=typeof a||u!==a?i[c]=u:i[c]=us(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[c]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=i,o}return i}}const Ha=function(e){e=e.replace(/\r\n?/g,`
`);const t=new At("!xml");let r=t,s="",n="";for(let i=0;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){const l=Ve(e,">",i,"Closing Tag is not closed.");let a=e.substring(i+2,l).trim();if(this.options.removeNSPrefix){const d=a.indexOf(":");d!==-1&&(a=a.substr(d+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&(s=this.saveTextToParentTag(s,r,n));const c=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let u=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(u=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):u=n.lastIndexOf("."),n=n.substring(0,u),r=this.tagsNodeStack.pop(),s="",i=l}else if(e[i+1]==="?"){let l=cs(e,i,!1,"?>");if(!l)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,r,n),!(this.options.ignoreDeclaration&&l.tagName==="?xml"||this.options.ignorePiTags)){const a=new At(l.tagName);a.add(this.options.textNodeName,""),l.tagName!==l.tagExp&&l.attrExpPresent&&(a[":@"]=this.buildAttributesMap(l.tagExp,n,l.tagName)),this.addChild(r,a,n)}i=l.closeIndex+1}else if(e.substr(i+1,3)==="!--"){const l=Ve(e,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(i+4,l-2);s=this.saveTextToParentTag(s,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}i=l}else if(e.substr(i+1,2)==="!D"){const l=Wa(e,i);this.docTypeEntities=l.entities,i=l.i}else if(e.substr(i+1,2)==="!["){const l=Ve(e,"]]>",i,"CDATA is not closed.")-2,a=e.substring(i+9,l);if(s=this.saveTextToParentTag(s,r,n),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]);else{let c=this.parseTextData(a,r.tagname,n,!0,!1,!0);c==null&&(c=""),r.add(this.options.textNodeName,c)}i=l+2}else{let l=cs(e,i,this.options.removeNSPrefix),a=l.tagName,c=l.tagExp,u=l.attrExpPresent,d=l.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&s&&r.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,r,n,!1));const f=r;if(f&&this.options.unpairedTags.indexOf(f.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let h="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)i=l.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)i=l.closeIndex;else{const g=this.readStopNodeData(e,a,d+1);if(!g)throw new Error(`Unexpected end of ${a}`);i=g.i,h=g.tagContent}const m=new At(a);a!==c&&u&&(m[":@"]=this.buildAttributesMap(c,n,a)),h&&(h=this.parseTextData(h,a,n,!0,u,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),m.add(this.options.textNodeName,h),this.addChild(r,m,n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const h=new At(a);a!==c&&u&&(h[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(r,h,n),n=n.substr(0,n.lastIndexOf("."))}else{const h=new At(a);this.tagsNodeStack.push(r),a!==c&&u&&(h[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(r,h,n),r=h}s="",i=d}}else s+=e[i];return t.child};function Ja(e,t,r){const s=this.options.updateTag(t.tagname,r,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),e.addChild(t))}const $a=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function el(e,t,r,s){return e&&(s===void 0&&(s=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,s),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function tl(e,t,r){const s="*."+r;for(const n in e){const i=e[n];if(s===i||t===i)return!0}return!1}function rl(e,t,r=">"){let s,n="";for(let i=t;i<e.length;i++){let o=e[i];if(s)o===s&&(s="");else if(o==='"'||o==="'")s=o;else if(o===r[0])if(r[1]){if(e[i+1]===r[1])return{data:n,index:i}}else return{data:n,index:i};else o==="	"&&(o=" ");n+=o}}function Ve(e,t,r,s){const n=e.indexOf(t,r);if(n===-1)throw new Error(s);return n+t.length-1}function cs(e,t,r,s=">"){const n=rl(e,t+1,s);if(!n)return;let i=n.data;const o=n.index,l=i.search(/\s/);let a=i,c=!0;if(l!==-1&&(a=i.substr(0,l).replace(/\s\s*$/,""),i=i.substr(l+1)),r){const u=a.indexOf(":");u!==-1&&(a=a.substr(u+1),c=a!==n.data.substr(u+1))}return{tagName:a,tagExp:i,closeIndex:o,attrExpPresent:c}}function sl(e,t,r){const s=r;let n=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const i=Ve(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(n--,n===0))return{tagContent:e.substring(s,r),i};r=i}else if(e[r+1]==="?")r=Ve(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=Ve(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=Ve(e,"]]>",r,"StopNode is not closed.")-2;else{const i=cs(e,r,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&n++,r=i.closeIndex)}}function us(e,t,r){if(t&&typeof e=="string"){const s=e.trim();return s==="true"?!0:s==="false"?!1:za(e,r)}else return Zs.isExist(e)?e:""}var nl=Da,mi={};function il(e,t){return yi(e,t)}function yi(e,t,r){let s;const n={};for(let i=0;i<e.length;i++){const o=e[i],l=ol(o);let a="";if(r===void 0?a=l:a=r+"."+l,l===t.textNodeName)s===void 0?s=o[l]:s+=""+o[l];else{if(l===void 0)continue;if(o[l]){let c=yi(o[l],t,a);const u=ll(c,t);o[":@"]?al(c,o[":@"],a,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),n[l]!==void 0&&n.hasOwnProperty(l)?(Array.isArray(n[l])||(n[l]=[n[l]]),n[l].push(c)):t.isArray(l,a,u)?n[l]=[c]:n[l]=c}}}return typeof s=="string"?s.length>0&&(n[t.textNodeName]=s):s!==void 0&&(n[t.textNodeName]=s),n}function ol(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const s=t[r];if(s!==":@")return s}}function al(e,t,r,s){if(t){const n=Object.keys(t),i=n.length;for(let o=0;o<i;o++){const l=n[o];s.isArray(l,r+"."+l,!0,!0)?e[l]=[t[l]]:e[l]=t[l]}}}function ll(e,t){const{textNodeName:r}=t,s=Object.keys(e).length;return!!(s===0||s===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}mi.prettify=il;const{buildOptions:cl}=Ds,ul=nl,{prettify:dl}=mi,fl=Vs;let hl=class{constructor(t){this.externalEntities={},this.options=cl(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const i=fl.validate(t,r);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const s=new ul(this.options);s.addExternalEntities(this.externalEntities);const n=s.parseXml(t);return this.options.preserveOrder||n===void 0?n:dl(n,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};var pl=hl;const gl=`
`;function ml(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=gl),Ai(e,t,"",r)}function Ai(e,t,r,s){let n="",i=!1;for(let o=0;o<e.length;o++){const l=e[o],a=yl(l);let c="";if(r.length===0?c=a:c=`${r}.${a}`,a===t.textNodeName){let m=l[a];Al(c,t)||(m=t.tagValueProcessor(a,m),m=vi(m,t)),i&&(n+=s),n+=m,i=!1;continue}else if(a===t.cdataPropName){i&&(n+=s),n+=`<![CDATA[${l[a][0][t.textNodeName]}]]>`,i=!1;continue}else if(a===t.commentPropName){n+=s+`<!--${l[a][0][t.textNodeName]}-->`,i=!0;continue}else if(a[0]==="?"){const m=In(l[":@"],t),g=a==="?xml"?"":s;let y=l[a][0][t.textNodeName];y=y.length!==0?" "+y:"",n+=g+`<${a}${y}${m}?>`,i=!0;continue}let u=s;u!==""&&(u+=t.indentBy);const d=In(l[":@"],t),f=s+`<${a}${d}`,h=Ai(l[a],t,c,u);t.unpairedTags.indexOf(a)!==-1?t.suppressUnpairedNode?n+=f+">":n+=f+"/>":(!h||h.length===0)&&t.suppressEmptyNode?n+=f+"/>":h&&h.endsWith(">")?n+=f+`>${h}${s}</${a}>`:(n+=f+">",h&&s!==""&&(h.includes("/>")||h.includes("</"))?n+=s+t.indentBy+h+s:n+=h,n+=`</${a}>`),i=!0}return n}function yl(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const s=t[r];if(s!==":@")return s}}function In(e,t){let r="";if(e&&!t.ignoreAttributes)for(let s in e){let n=t.attributeValueProcessor(s,e[s]);n=vi(n,t),n===!0&&t.suppressBooleanAttributes?r+=` ${s.substr(t.attributeNamePrefix.length)}`:r+=` ${s.substr(t.attributeNamePrefix.length)}="${n}"`}return r}function Al(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let s in t.stopNodes)if(t.stopNodes[s]===e||t.stopNodes[s]==="*."+r)return!0;return!1}function vi(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const s=t.entities[r];e=e.replace(s.regex,s.val)}return e}var vl=ml;const wl=vl,bl={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Le(e){this.options=Object.assign({},bl,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=_l),this.processTextOrObjNode=El,this.options.format?(this.indentate=kl,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Le.prototype.build=function(e){return this.options.preserveOrder?wl(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)};Le.prototype.j2x=function(e,t){let r="",s="";for(let n in e)if(!(typeof e[n]>"u"))if(e[n]===null)n[0]==="?"?s+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(e[n]instanceof Date)s+=this.buildTextValNode(e[n],n,"",t);else if(typeof e[n]!="object"){const i=this.isAttribute(n);if(i)r+=this.buildAttrPairStr(i,""+e[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+e[n]);s+=this.replaceEntitiesValue(o)}else s+=this.buildTextValNode(e[n],n,"",t)}else if(Array.isArray(e[n])){const i=e[n].length;let o="";for(let l=0;l<i;l++){const a=e[n][l];typeof a>"u"||(a===null?n[0]==="?"?s+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+n+"/"+this.tagEndChar:typeof a=="object"?this.options.oneListGroup?o+=this.j2x(a,t+1).val:o+=this.processTextOrObjNode(a,n,t):o+=this.buildTextValNode(a,n,"",t))}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,"",t)),s+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const i=Object.keys(e[n]),o=i.length;for(let l=0;l<o;l++)r+=this.buildAttrPairStr(i[l],""+e[n][i[l]])}else s+=this.processTextOrObjNode(e[n],n,t);return{attrStr:r,val:s}};Le.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function El(e,t,r){const s=this.j2x(e,r+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,s.attrStr,r):this.buildObjectNode(s.val,t,s.attrStr,r)}Le.prototype.buildObjectNode=function(e,t,r,s){if(e==="")return t[0]==="?"?this.indentate(s)+"<"+t+r+"?"+this.tagEndChar:this.indentate(s)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,i="";return t[0]==="?"&&(i="?",n=""),r&&e.indexOf("<")===-1?this.indentate(s)+"<"+t+r+i+">"+e+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&i.length===0?this.indentate(s)+`<!--${e}-->`+this.newLine:this.indentate(s)+"<"+t+r+i+this.tagEndChar+e+this.indentate(s)+n}};Le.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t};Le.prototype.buildTextValNode=function(e,t,r,s){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(s)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(s)+"<"+t+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,e);return n=this.replaceEntitiesValue(n),n===""?this.indentate(s)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(s)+"<"+t+r+">"+n+"</"+t+this.tagEndChar}};Le.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function kl(e){return this.options.indentBy.repeat(e)}function _l(e){return e.startsWith(this.options.attributeNamePrefix)?e.substr(this.attrPrefixLen):!1}var Il=Le;const xl=Vs,Cl=pl,Sl=Il;var wi={XMLParser:Cl,XMLValidator:xl,XMLBuilder:Sl};const Nl={catalogueLinks:{allowedChildrens:[]},publications:{allowedChildrens:[]},costTypes:{allowedChildrens:[]},profileTypes:{allowedChildrens:["characteristicTypes"]},categoryEntries:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},categoryLinks:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"]},forceEntries:{allowedChildrens:["forceEntries","categoryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","costs"]},entryLinks:{allowedChildrens:"type"},selectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"]},selectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},sharedSelectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"]},associations:{allowedChildrens:["constraints","modifiers","modifierGroups"]},sharedRules:{allowedChildrens:["modifiers","modifierGroups"]},rule:{allowedChildrens:["modifiers","modifierGroups"]},rules:{allowedChildrens:["modifiers","modifierGroups"]},profile:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},profiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},sharedProfiles:{allowedChildrens:["modifiers","modifierGroups","characteristics"]},infoGroup:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},sharedInfoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"]},infoLinks:{allowedChildrens:"type"},modifiers:{allowedChildrens:["conditions","conditionGroups","repeats"]},modifierGroups:{allowedChildrens:["modifiers","modifierGroups","conditions","conditionGroups","repeats"]},conditions:{allowedChildrens:[]},conditionGroups:{allowedChildrens:["conditions","conditionGroups"]},catalogue:{allowedChildrens:["catalogueLinks","publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]},gameSystem:{allowedChildrens:["publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]}},De={categories:"category",catalogueLinks:"catalogueLink",categoryEntries:"categoryEntry",categoryLinks:"categoryLink",characteristics:"characteristic",characteristicTypes:"characteristicType",conditions:"condition",conditionGroups:"conditionGroup",constraints:"constraint",costs:"cost",costLimits:"costLimit",costTypes:"costType",entryLinks:"entryLink",forceEntries:"forceEntry",infoGroups:"infoGroup",infoLinks:"infoLink",forces:"force",modifiers:"modifier",modifierGroups:"modifierGroup",profiles:"profile",profileTypes:"profileType",publications:"publication",repeats:"repeat",rules:"rule",selections:"selection",selectionEntries:"selectionEntry",selectionEntryGroups:"selectionEntryGroup",sharedInfoGroups:"infoGroup",sharedProfiles:"profile",sharedRules:"rule",sharedSelectionEntries:"selectionEntry",sharedSelectionEntryGroups:"selectionEntryGroup",associations:"association"},Or=new Set(["description","readme","comment"]),xn=/&(?:amp|lt|gt|quot|#39|apos);/g,Tl={"&amp;":"&","&apos;":"'","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Cn=e=>xn.test(e)?e.replace(xn,t=>Tl[t]):e,qs={};for(const e in De)qs[De[e]]=e;const dt={};for(const[e,t]of Object.entries(Nl))typeof t.allowedChildrens=="string"?dt[e]=t.allowedChildrens:dt[e]=new Set(t.allowedChildrens);function Ll(e){const t={allowBooleanAttributes:!0,ignoreAttributes:!1,attributeNamePrefix:"",textNodeName:"$text",parseAttributeValue:!0,processEntities:!1,parseTagValue:!1,ignoreDeclaration:!0,alwaysCreateTextNode:!0,isArray:(r,s,n,i)=>!i&&r in qs,attributeValueProcessor:(r,s)=>Cn(s),tagValueProcessor:(r,s)=>Cn(s)};return new wi.XMLParser(t).parse(e)}async function qd(e,t){const r=await pi(e),s={};console.log("unzipping folder",r,"path",t);for(const n in r.entries){const i=r.entries[n];if(i.isDirectory)continue;const o=ts(ts(n,t),"/");if(o.startsWith("."))continue;const l=bi(o)?await i.arrayBuffer():await i.text();s[o]=l}return s}async function Ol(e){if(typeof e=="string"){var t=new TextEncoder;e=t.encode(e)}const r=await pi(e);for(const s of Object.values(r.entries))return await s.text();throw"unzipFile failed: No Entries"}const Bl=["gstz","zip","catz"],Pl=["gst","gstz","xml","zip","cat","catz","json"];function Yd(e){const t=e.lastIndexOf(".");return t===-1?e:e.substring(0,t)}function Br(e){return e.split(".").pop().toLowerCase()}function bi(e){const t=Br(e);return Bl.includes(t)}function Gl(e){const t=Br(e);return!!Pl.includes(t)}const Sn={sharedRules:"shareRule",sharedProfiles:"sharedProfile",sharedInfoGroups:"sharedInfoGroup",sharedSelectionEntries:"sharedSelectionEntry",sharedSelectionEntryGroups:"sharedSelectionEntryGroup"};function ds(e){var t,r;for(let s in e)if(e[s]==="")delete e[s];else if(De[s]&&e[s])if(s in Sn){const n=e[s][De[s]],i=e[s][Sn[s]];e[s]=[...Array.isArray(n)?n:[],...Array.isArray(i)?i:[]],(t=e[s])==null||t.forEach(ds)}else{const n=e[s][De[s]];Array.isArray(n)?(e[s]=n,(r=e[s])==null||r.forEach(ds)):le(e[s])&&delete e[s]}else Or.has(s)&&(e[s]=e[s].$text??"");return e}function Ei(e,t){const r=dt[t],s=typeof r=="string"?dt[e[r]]:r;for(let n in e)n in De&&Array.isArray(e[n])&&(s&&!s.has(n)?delete e[n]:e[n].forEach(i=>Ei(i,n)))}const Nn=new Set;function ki(e,t){let r=dt[t];if(typeof r=="string"){const s=e[r];if(s){const n=Kl(s);if(typeof n!="string"||n===r)return Nn;r=dt[n]}}return r||Nn}function Tn(e){const t=Ll(e);ds(ge(t));const r=t.catalogue?"catalogue":"gameSystem";t.catalogue?(t.playable=1,t.id=po(t.catalogue.id),t.include=[1e3]):(t.playable=0,t.id=1e3);const s=t[r];return t.name=s.name,t.short=go(s.name),t.playable=!s.library,t.version=s.battleScribeVersion,t.nrversion=s.revision,t}async function Rl(e,t){switch(t=Br(t),t){case"xml":case"cat":case"gst":return Tn(e);case"zip":case"catz":case"gstz":return Tn(await Ol(e));case"json":return JSON.parse(e);default:throw new Error("Extension not supported "+t)}}function Fl(e){return De[e]}function Kl(e){return qs[e]}const _i=new Set(["?xml","$text","_"]);function Ul(e){for(const[t,r]of Object.entries(e))Or.has(t)?e[t]=Array.isArray(r)?r:[r]:Array.isArray(r)&&!_i.has(t)&&(e[t]=[{[Fl(t)]:r}])}function Ml(e){return an(e,t=>{typeof t=="object"&&Ul(t)}),an(e,t=>{if(typeof t=="object")for(const[r,s]of Object.entries(t))Array.isArray(s)||_i.has(r)||Or.has(r)||le(s)||(t[`_${r}`]=s,delete t[r])}),e}function Ql(e){const t=JSON.parse(as(e));Ml(t);const r={textNodeName:"$text",format:!0,attributeNamePrefix:"_",ignoreAttributes:!1,suppressBooleanAttributes:!1,suppressEmptyNode:!0};return t.gameSystem&&(t.gameSystem._xmlns="http://www.battlescribe.net/schema/gameSystemSchema"),t.catalogue&&(t.catalogue._xmlns="http://www.battlescribe.net/schema/catalogueSchema"),`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
`+new wi.XMLBuilder(r).build(t)}const Ii=[{type:"publications",name:"Publications",icon:"publication.png"},{type:"costTypes",name:"Cost Types",icon:"cost.png"},{type:"profileTypes",name:"Profile Types",icon:"profileType.png"},{type:"categoryEntries",name:"Category Entries",icon:"category.png"},{type:"forceEntries",name:"Force Entries",icon:"force.png"},{type:"sharedSelectionEntries",name:"Shared Selection Entries",icon:"selectionEntryLink.png"},{type:"sharedSelectionEntryGroups",name:"Shared Selection Entry Groups",icon:"shared_groups.png"},{type:"sharedProfiles",name:"Shared Profiles",icon:"shared_profiles.png"},{type:"sharedRules",name:"Shared Rules",icon:"shared_rules.png"},{type:"sharedInfoGroups",name:"Shared Info Groups",icon:"infoGroup.png"},{type:"rules",links:"infoLinks",name:"Root Rules",icon:"rule.png"},{type:"selectionEntries",links:"entryLinks",name:"Root Selection Entries",icon:"selectionEntry.png"}],Vl=[{type:"catalogueLinks",name:"Catalogue Links",icon:"catalogueLink.png"},...Ii];function Re(e,t){switch(e){case"selectionEntry":return"Entry";case"selectionEntryGroup":return"Group";case"selectionEntryLink":return"Entry (link)";case"selectionEntryGroupLink":return"Group (link)";case"force":return"Force";case"category":return"Category";case"categoryLink":return"Category (link)";case"catalogueLink":return"Catalogue (link)";case"publication":return"Publication";case"costType":return"Cost Type";case"costs":return"Cost";case"link":return"Link";case"profileType":return"Profile Type";case"profile":return"Profile";case"rule":return"Rule";case"infoLink":return"Info (link)";case"infoGroup":return"Info Group";case"profileLink":return"Profile";case"ruleLink":return"Rule (link)";case"infoGroupLink":return"Info Group (link)";case"characteristic":return"Characteristic";case"characteristicType":return"Characteristic Type";case"constraint":return"Constraint";case"condition":return"Condition";case"modifier":return"Modifier";case"modifierGroup":return"Modifier Group";case"repeat":return"Repeat";case"conditionGroup":return"Condition Group";case"catalogue":return"Catalogue";case"gameSystem":return"Game System";default:return console.warn("unknown getTypeLabel key",e),e}}function xe(e,t){switch(e){case"selectionEntries":return"selectionEntry";case"selectionEntryGroups":return"selectionEntryGroup";case"sharedSelectionEntries":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntry";case"sharedSelectionEntryGroups":return t!=null&&t.targetId?"selectionEntryLink":"selectionEntryGroup";case"entryLinks":return t!=null&&t.target?t.target.editorTypeName+"Link":"link";case"forceEntries":return"force";case"categoryEntries":return"category";case"categoryLinks":return"categoryLink";case"catalogueLinks":return"catalogueLink";case"publications":return"publication";case"costTypes":return"costType";case"costs":return"cost";case"profileTypes":return"profileType";case"profiles":return"profile";case"rules":return"rule";case"characteristics":return"characteristic";case"characteristicTypes":return"characteristicType";case"sharedProfiles":return"profile";case"sharedRules":return"rule";case"sharedInfoGroups":return"infoGroup";case"infoLinks":return t?`${t.type||"info"}Link`:"infoLink";case"infoGroups":return"infoGroup";case"associations":return"association";case"constraints":return"constraint";case"conditions":return"condition";case"modifiers":return"modifier";case"modifierGroups":return"modifierGroup";case"repeats":return"repeat";case"conditionGroups":return"conditionGroup";case"catalogue":case"gameSystem":return e;default:return console.warn("unknown getTypeName key",e),e}}function Wl(e,t=!0){var i,o,l,a,c;const r=e.parentKey,s=[];switch(r){case"infoLinks":["profiles","sharedProfiles"].includes((i=e.target)==null?void 0:i.parentKey)&&s.push(e.target.typeName);break;case"sharedProfiles":case"profiles":s.push(e.typeName);break;case"selectionEntries":case"sharedSelectionEntries":e.isEntry()&&e.getType()!=="upgrade"&&s.push(e.getType());break;case"entryLinks":e.target&&e.isEntry()&&e.getType()!=="upgrade"&&s.push(e.getType());break;case"modifierGroups":s.push(`(${(((o=e.modifiers)==null?void 0:o.length)||0)+(((l=e.modifierGroups)==null?void 0:l.length)||0)})`);break}const n=(((a=e.links)==null?void 0:a.length)??0)+(((c=e.other_links)==null?void 0:c.length)??0);if(n){const u=n===1?"":"s";s.push(`(${n||0} ref${u})`)}return e.comment&&e.comment[0]&&s.push("# "+e.comment),e.collective&&s.push("(collective)"),s.join(" ")}function ot(e){const t=e.parentKey;switch(t){case"selectionEntries":case"sharedSelectionEntries":case"selectionEntryGroups":case"sharedSelectionEntryGroups":case"entryLinks":case"forceEntries":case"categoryLinks":case"categoryEntries":case"sharedInfoGroups":case"infoGroups":case"catalogueLinks":case"publications":case"profileTypes":case"catalogue":case"gameSystem":case"rules":case"sharedRules":case"costs":case"costTypes":case"sharedProfiles":case"profiles":case"characteristics":case"characteristicTypes":return e.getName();case"modifiers":return Uo(nt(e),e);case"repeats":{const r=e,s=nt(e);return s||console.error("no parent for repeat",e),`Repeat ${r.repeats} times for every ${r.value} ${ze(s,r.field)} in ${ze(s,r.scope)} of ${r.childId?ze(s,r.childId):" any"}`}case"conditions":return hn(nt(e),e);case"constraints":return hn(nt(e),e);case"modifierGroups":return"Modify...";case"conditionGroups":return`${e.type.toUpperCase()}`;case"infoLinks":return e.target?ot(e.target):e.getName();case"associations":return`${e.label}`;default:return console.log(t,e),t}}function Er(e,t){t(e);const r=[e];for(;r.length;){const s=r.pop();for(const n of Object.keys(s)){if(!ht.has(n)||Or.has(n))continue;const i=s[n];if(i&&Array.isArray(i))for(const o of i)r.push(o),t(o,n,s)}}}function zl(e){const t=e.parent;if(t){const r=t[e.parentKey],s=r.indexOf(e);s!==-1&&r.splice(s,1)}}async function Jt(e,t){const r=e.catalogue;Er(e,(s,n,i)=>{if(r.removeFromIndex(s),s.isLink&&s.isLink()&&(r.unlinkLink(s),delete s.target),s instanceof St&&s.typeId){const o=s.catalogue.findOptionById(s.typeId);o&&s.catalogue.removeRef(s,o)}if(s instanceof Xe){const o=s.scope,l=s.childId;if(!Ms.has(o)){const a=s.catalogue.findOptionById(s.scope);a&&s.catalogue.removeOtherRef(s,a)}if(!Ro.has(l)){const a=s.catalogue.findOptionById(s.childId);a&&s.catalogue.removeOtherRef(s,a)}}delete s.parent,delete s.catalogue}),t&&e instanceof Qs&&await r.reload(t)}async function vt(e,t,r,s){let n=!1;for(const i of Array.isArray(e)?e:[e])Er(i,(o,l,a)=>{if(le(o)){if(o.parent=a||r,o.catalogue=t,t.addToIndex(o),o.isLink()&&t.updateLink(o),o instanceof St&&o.typeId){const c=o.catalogue.findOptionById(o.typeId);c&&o.catalogue.addRef(o,c)}o instanceof Qs&&o.targetId&&(n=!0),t.refreshErrors(o)}});n&&r&&await(r.catalogue||r).reload(s)}function _e(e){if(!e.parent&&!e.isCatalogue())return[{id:e.id,key:e.parentKey,index:0}];const t=[];for(;e.parent;){const r=e.parent||e.catalogue;t.push({key:e.parentKey,index:r[e.parentKey].indexOf(e),id:e.id}),e=e.parent}return t.reverse(),t}function Xd(e){if(!e.parent&&!e.isCatalogue())return[{id:e.id,key:e.parentKey,index:0}];const t=[];do{const r=e.parent||e.catalogue;r?t.push({name:e.getName(),type:e.editorTypeName,label:e.getTypeName(),display:ot(e),key:e.parentKey,index:r[e.parentKey].indexOf(e),id:e.id}):t.push({name:e.getName(),display:ot(e),type:"catalogue",key:"catalogue",id:e.id,index:0}),e=e.parent}while(e);return t.reverse(),t}function Ln(e,t,r){let s=e;for(let o=0;o<t.length-1;o++){const l=t[o];s=s[l.key][l.index]}const n=t[t.length-1];return s[n.key]||(s[n.key]=[]),s[n.key].splice(n.index,0,r),s}function Dl(e,t){let r=e;for(const s of t){if(r=r[s.key],!r)return;r=r[s.index]}return r}function Yr(e,t){let r=e;const s=t[t.length-1];for(const o of t)o!==s&&(r=r[o.key][o.index]);const i=r[s.key].splice(s.index,1)[0];if(!i)throw new Error("popAtEntryPath failed");return i}function On(e,t){const r={};Er(t,(s,n,i)=>{if(s.id){const o=s.id,l=e.generateNonConflictingId();s.id=l,r[o]=l}}),Er(t,(s,n,i)=>{s instanceof Xe&&(s.scope in r&&(s.scope=r[s.scope]),s.childId in r&&(s.childId=r[s.childId])),s instanceof Us&&s.field in r&&(s.field=r[s.field])})}function Zl(e,t,r){if(e.isCatalogue()){if(r)switch(t){case"sharedRules":case"rules":return["sharedRules","rules"].includes(r)?r:"";case"sharedProfiles":case"profiles":return["sharedProfiles","profiles"].includes(r)?r:"";case"sharedInfoGroups":case"infoGroups":return["sharedInfoGroups","infoGroups"].includes(r)?r:"";case"sharedSelectionEntries":case"selectionEntries":return["sharedSelectionEntries","selectionEntries"].includes(r)?r:"";case"sharedSelectionEntryGroups":case"selectionEntryGroups":return["sharedSelectionEntryGroups","selectionEntryGroups"].includes(r)?r:"";default:return t}}else switch(t){case"sharedRules":return"rules";case"sharedProfiles":return"profiles";case"sharedInfoGroups":return"infoGroups";case"sharedSelectionEntries":return"selectionEntries";case"sharedSelectionEntryGroups":return"selectionEntryGroups";default:return t}return t}class ql{get[Symbol.toStringTag](){return"ObjectNoObserve"}}function Yl(){return new ql}const Xl={};function jl(e,t,r){if(t in e)return e[t];const s=class extends W{get parentKey(){return t}get editorTypeName(){return xe(t,this)}toString(){return`${this.editorTypeName} - ${this.getName()}`}};return s.prototype.parentKey,Object.setPrototypeOf(s.prototype,Object.getPrototypeOf(r)),e[t]=s.prototype,s.prototype}function Hl(e,t,r){Object.setPrototypeOf(r,jl(e,t,r))}const fr={"*":W.prototype,catalogue:br.prototype,catalogueLinks:Qs.prototype,gameSystem:br.prototype,forceEntries:Vr.prototype,forces:Vr.prototype,force:Vr.prototype,categoryEntries:Ct.prototype,category:Ct.prototype,categories:Ct.prototype,link:Kt.prototype,infoLinks:Oo.prototype,categoryLinks:ri.prototype,entry:Ur.prototype,selectionEntries:Ur.prototype,entryLinks:Kt.prototype,sharedSelectionEntries:Ur.prototype,group:Mr.prototype,selectionEntryGroups:Mr.prototype,sharedSelectionEntryGroups:Mr.prototype,sharedRules:lr.prototype,rules:lr.prototype,rule:lr.prototype,profileTypes:Po.prototype,sharedProfiles:St.prototype,profiles:St.prototype,profile:St.prototype,characteristics:dn.prototype,characteristic:dn.prototype,characteristicTypes:W.prototype,characteristicType:W.prototype,sharedInfoGroups:zr.prototype,infoGroups:zr.prototype,infoGroup:zr.prototype,publications:pn.prototype,publication:pn.prototype,repeats:Xe.prototype,conditions:Xe.prototype,constraints:os.prototype,modifiers:Us.prototype,modifierGroups:si.prototype};Object.values(fr);function Jl(e){return e in fr?fr[e]:fr["*"]}function fs(e,t){const r=Jl(t);return r&&(Object.setPrototypeOf(e,r),e.post_init&&e.post_init(),globalThis.isEditor&&Hl(e.keyInfoCache||Xl,t,e)),e}function Et(e){const t=[e];for(;t.length;){const r=t.pop();for(const s of Object.keys(r)){const n=r[s];if(le(n))if(Array.isArray(n)){if(n.length&&le(n[0]))for(let i=n.length;i--;){const o=n[i];ln(o)&&(fs(o,s),t.push(o))}}else ln(n)&&(fs(n,s),t.push(n))}}}const Bn=Fs("catalogues",{state:()=>({dict:{},version:1}),persist:{storage:globalThis.localStorage},actions:{get(e){return e in this.dict||(this.dict[e]={}),this.dict[e]},setEdited(e,t){this.get(e).edited=t},getEdited(e){return this.get(e).edited},setErrors(e,t){this.get(e).errors=t},getErrors(e){return this.get(e).errors},getDependents(e){return this.get(e).dependents},updateCatalogue(e){var n;const t=e.id,r=e.gameSystemId||e.id,s=(n=e.catalogueLinks)==null?void 0:n.map(i=>({targetId:i.targetId===r?r:`${r}-${i.targetId}`,sourceId:t===r?r:`${r}-${t}`,importRootEntries:i.importRootEntries,sourceName:e.name}));e.gameSystemId&&(s==null||s.push({targetId:e.gameSystemId,sourceId:t,importRootEntries:!0,sourceName:e.name})),this.setDependencies(t,s)},setDependencies(e,t){var s;const r=(s=this.get(e))==null?void 0:s.dependencies;if(r)for(const n of r)this.removeDependent(n.targetId,n);if(t)for(const n of t)this.addDependent(n.targetId,n);this.get(e).dependencies=t||[]},setDependents(e,t){this.get(e).dependents=t},addDependent(e,t){const r=this.get(e);r.dependents||(r.dependents=[]),r.dependents.push(t)},removeDependent(e,t){var s;const r=(s=this.get(e))==null?void 0:s.dependents;if(r){const n=r.findIndex(i=>i.sourceId===t.sourceId);n>=0&&r.splice(n,1)}}}});function xi(e){return e.replaceAll("\\","/").split("/").slice(0,-1).join("/")}function Ci(e){const t=e.replaceAll("\\","/").split("/");return t[t.length-1]}async function $l(e){return electron?await electron.invoke("getFolderFiles",e):[]}async function jd(e){if(electron)try{const t=[];if(!await electron.invoke("isDirectory",e))return[];const s=await electron.invoke("readdirSync",e);for(const n of s){const i=`${e}/${n}`;try{if(await electron.invoke("isDirectory",i)){const l={name:n,path:i};t.push(l)}}catch(o){console.error("Error reading dir:",i,o);continue}}return t}catch(t){throw console.error("Error:",t),t}}async function Pn(e,t){if(!electron)return;const r=xi(e);await electron.invoke("mkdirSync",r,{recursive:!0}),await electron.invoke("writeFileSync",e,t)}async function Hd(e){if(electron)return await electron.invoke("unlinkSync",e)}async function Jd(e){if(electron)return electron.invoke("showOpenDialog",e)}async function $d(e){if(electron)return electron.invoke("showMessageBoxSync",e)}async function ef(){if(electron)return electron.invoke("closeWindow")}async function tf(e){if(electron)return await electron.invoke("getPath",e)}async function ec(e){electron&&await electron.invoke("mkdirSync",e,{recursive:!0})}let Gn=!1;const Rn={};async function tc(e,t){electron&&(Gn||(Gn=!0,electron.on("fileChanged",(r,s,n)=>{const i=Rn[s];i&&i(s,n)})),await electron.invoke("chokidarWatchFile",e),Rn[e]=t)}async function rc(e){return electron?await electron.invoke("getFolderRemote",e):null}const sc={name:"ErrorIcon",props:{errors:{type:Array,default:[]},showNumber:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1}},data(){return{show:!1}},methods:{display(){if(!this.clickable)return;this.show=!0;const e=()=>{this.show=!1};addEventListener("click",e,{capture:!0,once:!0})},errorToText(e){return mo(e.msg)},errorExtraText(e){return e.extra},getErrorImage(e){let t=e.severity==="warning",r=!e.severity||e.severity==="error",s=!e.severity||e.severity==="info";return r?"assets/icons/error_exclamation.png":t?"assets/icons/warning_exclamation.png":s?"assets/icons/info_exclamation.png":"assets/icons/error_exclamation.png"},gotoError(e){const t=Gr();e.source?t.goto(e.source):console.warn("Couldn't goto error: no source attached"),this.show=!1}},computed:{computedShowNumber(){return!(this.showNumber===!1||this.showNumber===void 0||this.showNumber===null)},getImage(){let e=this.errors.find(s=>s.severity==="warning"),t=this.errors.find(s=>!s.severity||s.severity==="error"),r=this.errors.find(s=>!s.severity||s.severity==="info");return t?"assets/icons/error_exclamation.png":e?"assets/icons/warning_exclamation.png":r?"assets/icons/info_exclamation.png":"assets/icons/error_exclamation.png"},numErrors(){var e;return((e=this.errors)==null?void 0:e.length)||0},errorText(){return or(this.errors||[],e=>e.msg).map(e=>`• ${this.errorToText(e)}
`).join("").trim()}}};const nc=["title"],ic=["src"],oc={key:0,class:"ml-4px align-middle"},ac={key:0,class:"fixed bg text"},lc=["onClick"],cc=["src"],uc={key:0,class:"grey"};function dc(e,t,r,s,n,i){return i.numErrors?(I(),S("span",{key:0,class:"ErrorIcon cursor-pointer my-auto",title:i.errorText},[O("span",{onClick:t[0]||(t[0]=o=>i.display()),class:"gap-4px"},[O("img",{src:i.getImage,class:"my-auto align-text-bottom"},null,8,ic),i.computedShowNumber?(I(),S("span",oc,j(i.numErrors),1)):T("",!0)]),n.show?(I(),S("div",ac,[(I(!0),S(de,null,bt(r.errors,o=>(I(),S("div",{onClick:l=>i.gotoError(o),class:"border py-3px px-10px hover-darken"},[O("img",{src:i.getErrorImage(o),class:"my-auto align-text-bottom"},null,8,cc),G(" "+j(i.errorToText(o))+" ",1),i.errorExtraText(o)?(I(),S("span",uc,j(i.errorExtraText(o)),1)):T("",!0)],8,lc))),256))])):T("",!0)],8,nc)):T("",!0)}const fc=qt(sc,[["render",dc],["__scopeId","data-v-dc9d87d4"]]);const hc={},pc={style:{width:"100%",height:"0px","text-align":"left",margin:"0",padding:"0"}};function gc(e,t){return I(),S("hr",pc)}const mc=qt(hc,[["render",gc],["__scopeId","data-v-43dd2251"]]),yc={name:"ContextMenu",data(){return{left:100,top:100,bottom:100,right:100,width:200,height:200,visible:!1,isDown:!1,isRight:!1,payload:void 0}},props:{modelValue:{type:Boolean,default:!0}},methods:{do_update(e){var r,s;if(this.width=((r=this.el)==null?void 0:r.clientWidth)||this.width,this.height=((s=this.el)==null?void 0:s.clientHeight)||this.height,this.top=e.clientY,this.left=e.clientX,this.avoid){const n=this.avoid,i=n.offsetLeft;this.left=i+n.offsetWidth;var t=e.target.getBoundingClientRect();this.top=t.top-1}this.left=Math.min(this.left,window.innerWidth-this.width)+2,this.top=Math.min(this.top,window.innerHeight-7-this.height),this.bottom=window.innerHeight-this.top,this.right=window.innerWidth-this.left},update(e){e.preventDefault(),this.do_update(e),this.$nextTick(()=>{this.do_update(e)})},show(e,t){this.payload=t,this.visible=!0,this.update(e),this.$emit("update:modelValue",!0)},close(){this.visible=!1,this.$emit("update:modelValue",!1)}},mounted(){addEventListener("click",this.close,{capture:!0}),addEventListener("contextmenu",this.close,{capture:!0}),addEventListener("scroll",this.close,{capture:!0})},unmounted(){addEventListener("click",this.close,{capture:!0}),removeEventListener("contextmenu",this.close,{capture:!0}),removeEventListener("scroll",this.close,{capture:!0})},computed:{el(){return this.$refs["context-menu"]},style(){const e={};return e.top=`${this.top}px`,e.left=`${this.left}px`,e},avoid(){var e;return(e=this.$el.parentElement)==null?void 0:e.closest(".context-menu")}}};function Ac(e,t,r,s,n,i){return ss((I(),ne(Ao,{to:"#dialogs"},[ss(O("li",{ref:"context-menu",class:"context-menu",style:yo(i.style)},[is(e.$slots,"default",{payload:n.payload})],4),[[ns,n.visible]])],512)),[[ns,n.visible]])}const vc=qt(yc,[["render",Ac]]),wc={name:"EditorCollapsibleBox",props:{payload:{},collapsible:{type:Boolean,default:!0},nobox:{type:Boolean,default:!1},defcollapsed:{type:Boolean,default:!0},notitle:{type:Boolean,default:!1},title:{type:String,required:!1,default:"titreCategory"},titleCollapse:{type:Boolean,default:!0},group:{type:Array,required:!0},modelValue:{default:!0},altclickable:{default:!1}},data(){return{collapsed:!0,initiated:!1,selected:!1,alt:!1}},created(){this.defcollapsed==!1&&this.collapseSwitch()},setup(){return{store:Gr()}},mounted(){var e;addEventListener("keydown",this.handleKeyDown),addEventListener("keyup",this.handleKeyUp),this.$el.vnode=this,(e=this.group)==null||e.push(this),this.init(this.payload)},updated(){this.$el.vnode=this},unmounted(){var e;if(removeEventListener("keydown",this.handleKeyDown),removeEventListener("keyup",this.handleKeyUp),this.group&&Array.isArray(this.group)){const t=this.group.indexOf(this);t!==-1&&((e=this.group)==null||e.splice(t,1))}},watch:{payload(e){this.init(e)},collapsed(e){e!==this.modelValue&&this.$emit("update:modelValue",e)},modelValue(e){e!=this.collapsed&&(this.collapsed=e)}},computed:{dropdownSrc(){let e=2,t=[`assets/icons/right${e}.png`,`assets/icons/down${e}.png`],r=this.collapsed?0:1;return t[r]},hide(){return!this.collapsible},nocollapse(){return!this.collapsible},box(){return!this.nobox},opened(){return this.collapsible&&!this.collapsed}},methods:{cut(){console.log("cut")},copy(){console.log("copy")},paste(){console.log("paste")},init(e){(e==null?void 0:e.select)!==void 0&&(e.select&&(this.store.do_select(null,this,this.group),this.store.scrollto(Ue(this))),e==null||delete e.select)},select(){this.selected=!0,this.store.select(this,()=>this.unselect(),this.payload)},unselect(){this.selected=!1},open(){this.initiated=!0,this.collapsed&&(this.collapsed=!1,this.$emit("open"))},async open_recursive(){var t;this.open(),await this.$nextTick();const e=this.$el;if(e)for(const r of e.getElementsByClassName("collapsible-box"))await((t=ae(r))==null?void 0:t.open_recursive())},close(){this.initiated=!0,this.collapsed||(this.collapsed=!0,this.$emit("close"))},async close_recursive(){var t;const e=this.$el;if(e)for(const r of e.getElementsByClassName("collapsible-box"))(t=ae(r))==null||t.close_recursive();await this.$nextTick(),this.close()},do_select(e){this.store.do_select(e,this,this.group),this.$el.focus()},do_rightcllick_select(e){this.store.do_rightclick_select(e,this,this.group)},async collapseSwitch(e){this.collapsed=!this.collapsed,this.initiated=!0,this.collapsed==!1?e?await this.open_recursive():this.open():e?await this.close_recursive():this.close()},handleKeyDown(e){e.key==="Alt"&&(this.alt=!0,e.preventDefault())},handleKeyUp(e){e.key==="Alt"&&(this.alt=!1,e.preventDefault())}}};const bc=["src"],Ec={key:1,class:"content"};function kc(e,t,r,s,n,i){return I(),S("div",{class:it([{box:i.box,nobox:r.nobox,nocollapse:i.nocollapse,collapsed:n.collapsed,opened:i.opened},"collapsible-box"]),onContextmenu:t[8]||(t[8]=(...o)=>i.do_rightcllick_select&&i.do_rightcllick_select(...o))},[r.notitle?T("",!0):(I(),S("h3",{key:0,class:it(["title hover-darken",{selected:n.selected,arrowTitle:r.collapsible,normalTitle:!r.collapsible,collapsed:r.collapsible&&n.collapsed,alt:n.alt&&r.altclickable}]),onClick:[t[1]||(t[1]=Me((...o)=>i.do_select&&i.do_select(...o),["stop"])),t[2]||(t[2]=Me(o=>e.$emit("ctrlclick"),["ctrl","stop"])),t[3]||(t[3]=Me(o=>e.$emit("altclick"),["alt","stop"]))],onDblclick:t[4]||(t[4]=o=>i.collapseSwitch(o.shiftKey)),onPaste:t[5]||(t[5]=(...o)=>i.paste&&i.paste(...o)),onCopy:t[6]||(t[6]=(...o)=>i.paste&&i.paste(...o)),onCut:t[7]||(t[7]=(...o)=>i.paste&&i.paste(...o))},[O("div",{class:"arrow-wrap",onClick:t[0]||(t[0]=Me(o=>i.collapseSwitch(o.shiftKey),["stop"]))},[O("img",{class:it([{hide:i.hide},"arrow icon"]),src:i.dropdownSrc},null,10,bc)]),is(e.$slots,"title",{},void 0,!0)],34)),n.initiated?ss((I(),S("div",Ec,[is(e.$slots,"content",{},void 0,!0)],512)),[[ns,!n.collapsed||!r.collapsible]]):T("",!0)],34)}const _c=qt(wc,[["render",kc],["__scopeId","data-v-eef2c977"]]),Ot=Fs("editor-ui",{state:()=>({catalogues:{}}),persist:{storage:globalThis.localStorage},actions:{collapse_level(e){var t;if(e>=0){const r=`depth-${e} collapsible-box opened`,s=document.documentElement.getElementsByClassName(r);if(s!=null&&s.length)for(const n of s)(t=ae(n))==null||t.close()}},collapse_all(){this.collapse_level(1),this.collapse_level(0)},collapse_deepest(){const e="collapsible-box opened",t=document.documentElement.getElementsByClassName(e);let r=-1;if(t!=null&&t.length)for(const s of t)s.classList.forEach(n=>{n.startsWith("depth-")&&(r=Math.max(r,parseInt(n.split("-")[1])))});this.collapse_level(r)},set_state(e,t){function r(i,o,l=0){const a=`depth-${l} collapsible-box opened`,c=i.getElementsByClassName(a);if(c!=null&&c.length)for(const u of c){const d=Ue(ae(u)),f=d.parentKey,h=d.parent;let m=o;if(h){const g=h[f];if(!g||!Array.isArray(g))continue;const y=g.indexOf(d);f in o||(o[f]={});const p=o[f];y in p||(p[y]={}),m=p[y]}else{const g=[...u.classList].filter(y=>ht.has(y));for(const y of g)o[y]={},o[y][0]={},m=o[y][0]}r(u,m,l+1)}}const s={};r(document.documentElement,s);const n={...t,open:s};return this.$state.catalogues[e]=n,s},get_data(e){const t=this.$state.catalogues[e];return t||{}},get_root(e,t){let r=this.$state.catalogues[e];return!(!r||(r=r.open[t],!r))},get(e,t){if(!t.length)return!1;let r=this.$state.catalogues[e];if(!r)return!1;let s=r.open[t[0].key];if(!s||(s=s[0],!s))return!1;for(const n of t){const i=s[n.key];if(!i)return!1;const o=i[n.index];if(!o)return!1;s=o}return!0}}});function Ic(e){return Math.round(e*100)/100}function xc(e){let t="";e=Jn(e,r=>r.name);for(const r of e)if(r.value!=0){let s="";r.name.length!=0&&(s=" "+r.name),t=`${t}<span class='cost'>${Ic(r.value)}${s}</span>`}return t.length==0?t:`<span class="costList">${t}</span>`}const Fn={link:1,selectionEntry:1,entryLink:1,selectionEntryGroup:2,entryGroupLink:2,constraint:3,forceEntry:4,profile:5,rule:6,infoGroup:7,infoLink:8,modifier:9,modifierGroup:10,categoryLink:11,association:12},Cc=new Set(["force"]),Sc=new Set(["modifierGroups","conditionGroups"]),Nc=new Set(["characteristicTypes","characteristics","costs"]),Tc={name:"CatalogueEntry",components:{ContextMenu:vc,EditorCollapsibleBox:_c},setup(){return{store:Gr(),state:Ot(),settings:xt()}},props:{item:{type:Object,required:!0},group:{type:Array},forceShowRecursive:{type:Boolean,default:!1},showImported:{type:Boolean},imported:{type:Boolean},depth:{type:Number,default:0}},data(){return{groups:{},contextmenuopen:!1,open:!1,open_categories:void 0,name:""}},mounted(){if(this.catalogue&&(this.catalogue.processForEditor(),!this.imported&&(this.open=Sc.has(this.item.parentKey)||this.state.get(this.catalogue.id,_e(this.item)),this.item.isCatalogue()))){const e=new Set;for(const t of this.categories)this.state.get_root(this.catalogue.id,t.type)&&e.add(t.type);this.open_categories=e}},watch:{"scope.name"(e){this.name=ot(this.item)},_name:{immediate:!0,handler(e){this.name=e}}},methods:{escapeXml:vo,getTypeName:xe,getTypeLabel:Re,getName:ot,getNameExtra:Wl,key(e){return e.id?e.id:(e.$id||(e.$id=`temp-${It()}`),e.$id)},should_be_open(e){var t;return(t=this.open_categories)==null?void 0:t.has(e)},sortable(e){return this.settings.sort==="none"?!1:e?Cc.has(e.editorTypeName)===!1:!0},get_group(e){return e in this.groups||(this.groups[e]=[]),this.groups[e]},ref_count(e){var t;switch(e.editorTypeName){case"category":default:return(t=e.links)==null?void 0:t.length}},async onctrlclick(){this.store.can_follow(this.item)?await this.store.follow(this.item):this.imported?await this.store.goto(this.item):(this.item.links||this.item.other_links)&&(this.store.mode="references")},debug(){console.log(this.item.name,this.item.editorTypeName,Ge(this.item)),globalThis.$debugOption=this.item},hasRootLink(e,t){var r;return(r=e.entryLinks)==null?void 0:r.find(s=>s.targetId===t.id)},getTypedArray(e,t,r){if(!t)return;const s=t,n=e[s];if(n&&Array.isArray(n))for(const i of n)this.filter_child(i)&&r.push({item:i,type:t});if(this.showImported){const o=["selectionEntries","selectionEntryLinks","rules"].includes(t)?e.importsWithEntries:e.imports;for(const l of o){const a=l[s],c=l.isGameSystem();if(a&&Array.isArray(a))for(const u of a)this.filter_child(u)&&(!c&&u.import===!1||r.push({item:u,type:t,imported:!0}))}}},allowed(e){if(Array.isArray(e)){for(const t of e)if(this.allowedChildren.has(t))return!0;return!1}return this.allowedChildren.has(e)},filter_child(e){return!(!this.forceShow&&this.store.filter&&e.showInEditor!==!0)},sorted(e){if(!this.sortable(this.item))return e;switch(this.settings.sort){default:case"asc":return or(e,n=>n.item.getName()||"");case"desc":return Jn(e,n=>n.item.getName()||"");case"type":return or(e,n=>(n.item.isProfile()?n.item.getTypeName():n.item.getType())||"")}},grouped(e){return or(this.sorted(e),t=>{var r,s;return Fn[((s=(r=t.item)==null?void 0:r.target)==null?void 0:s.editorTypeName)??t.item.editorTypeName]??1e3})},menu(e){return{show:(t,r)=>{this.contextmenuopen=!0,this.$nextTick(()=>{var s;(s=this.$refs[e])==null||s.show(t,r)})},close:(t,r)=>{var s;(s=this.$refs[e])==null||s.close(t,r),this.contextmenuopen=!1}}},get_field(e){return this.item[e]},get_target_field(e){if(this.item.target)return this.item.target[e]},hideType(e){if(e==="categoryLinks"&&!this.item.isForce()||Nc.has(e))return!0}},computed:{order(){return Fn},_name(){return ot(this.item)},scope(){const e=this.item;if(e.scope){const t=ii(e,e.scope);if(t)return wo(t)}},costs(){var s;const e=[],t=this.item.getCatalogue(),r=this.item.getCosts();for(const n of r){const i=((s=t.findOptionById(n.typeId))==null?void 0:s.name)||n.name||n.typeId;i&&e.push({name:i,value:n.value,typeId:n.typeId})}return xc(e)},childId(){return this.item.childId},child(){if(this.childId)return this.item.getCatalogue().findOptionById(this.childId)},link(){return this.item},iscollapsible(){return this.mixedChildren.length>0},contextmenu(){return this.menu("contextmenu")},nestedcontextmenu(){return this.menu("nestedcontextmenu")},catalogue(){return this.item.getCatalogue()},catalogues(){return this.catalogue.imports},allowedChildren(){return ki(this.item,this.item.parentKey)},forceShow(){return this.item.showChildsInEditor||this.forceShowRecursive},mixedChildren(){const e=[];for(const t of this.allowedChildren){if(this.hideType(t))continue;const r=this.get_field(t);if(r!=null&&r.length)for(const s of r)this.filter_child(s)&&e.push({type:t,item:s})}if(this.item.isLink()&&this.item.target){const t=[];for(const r of this.allowedChildren){if(this.hideType(r))continue;const s=this.get_target_field(r);if(s!=null&&s.length)for(const n of s)this.filter_child(n)&&t.push({type:r,item:n,imported:!0})}return[...this.grouped(t),...this.grouped(e)]}return this.grouped(e)},categories(){return this.item.isCatalogue()?this.item.isGameSystem()?Ii:Vl:[]},groupedCategories(){return this.categories.map(e=>{const t=[];return e.type&&this.getTypedArray(this.item,e.type,t),e.links&&this.getTypedArray(this.item,e.links,t),{...e,items:this.grouped(t)}})}}},Lc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TiyIVBzOICGaoThbEijhqFYpQIdQKrTqYXD+hSUOS4uIouBYc/FisOrg46+rgKgiCHyCuLk6KLlLi/5JCixgPjvvx7t7j7h0gNCpMs7omAE23zVQiLmWyq1L3K0IYgYgYJIVZxpwsJ+E7vu4R4OtdlGf5n/tz9OXyFgMCEvEsM0ybeIN4etM2OO8Ti6yk5IjPicdNuiDxI9dVj984F10WeKZoplPzxCKxVOxgtYNZydSIp4gjOU2nfCHjcY7zFmetUmOte/IXhvP6yjLXaQ4jgUUsQYYEFTWUUYGNKK06KRZStB/38Q+5fplcKrnKYORYQBUaFNcP/ge/u7UKsUkvKRwHQi+O8zEKdO8CzbrjfB87TvMECD4DV3rbX20AM5+k19ta5Ajo3wYurtuaugdc7gCDT4ZiKq4UpCkUCsD7GX1TFhi4BXrXvN5a+zh9ANLUVfIGODgExoqUve7z7p7O3v490+rvB80rcsuoyXg3AAAABmJLR0QA6AAAAADh5zdhAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5wUfFDQeXQWMGwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAG9SURBVCjPhdO/a1NRFMDx7733PfOiFcGhErUoBm1DwFH8DwQnR90KLiI4aAbd/DNsQVCHLh0EqyA4uPofBDMphaRU0FgiLcm75xyH9xrNj9IzHt6Xz708rqOch62nttvrMrh2j+PmwpmEV09uueRwsdvrcvf+Kpc3NljY3iZ4jy0vo60Wp6pVTlYqZFlGlqY8X3sJwDje6XXZXF/n9qWbrNbrALz+XeXLp58z8vcfS5OxqdFsNjmx72A4BCB1VWq12kSYpinfujtTsSmqihfBYix2oyHtdnsibjQamNpkrFrEQeM4rjhYWVkZh51Op/jOdDYWEZKYY5YD4OOIwWAwjr33iAgmc+QYI0Fy1Ao5iZFYnuJwYoyoynw5xBxzhRw0R0TGoXOukHX62CLEGEmiw1wpaz5flqNkdYTElXKckAFEBJ2WpZSDOh5n13HOcWf4da5sEmdjEWHt7A1k8SIhBF74KpX/ZDMr5HLn/8URVWXhapMkSQghkC7Vx/9fVTGz4np5eefNj5/t4GCfZ48eoKok3pNl2ZEvynvP8M+AN28/WDIaDdnr9zlXO8+7rfcs/rpy7JOsnY7s9fv8Bc0zE6+cxDjNAAAAAElFTkSuQmCC",Oc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAQCAYAAAAiYZ4HAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bi1IqIu0g4pChumhBVMRRq1CECqFWaNXB5NIvaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIq4uToouU+L+k0CLGg+N+vLv3uHsH+BsVpppd44CqWUY6mRCyuVWh+xVBhNCPUUQkZupzopiC5/i6h4+vd3Ge5X3uz9Gr5E0G+ATiWaYbFvEG8fSmpXPeJ46ykqQQnxOPGXRB4keuyy6/cS467OeZUSOTnieOEgvFDpY7mJUMlXiKOKaoGuX7sy4rnLc4q5Uaa92TvzCc11aWuU5zCEksYgkiBMiooYwKLMRp1Ugxkab9hId/0PGL5JLJVQYjxwKqUCE5fvA/+N2tWZiccJPCCSD4Ytsfw0D3LtCs2/b3sW03T4DAM3Cltf3VBjDzSXq9rcWOgL5t4OK6rcl7wOUOMPCkS4bkSAGa/kIBeD+jb8oBkVsgtOb21trH6QOQoa5SN8DBITBSpOx1j3f3dPb275lWfz9cmHKeGGO3IgAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFChE0NOeyIIsAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB2klEQVQoz43SP2gUURDH8e+83WVFOa5USKF1QMiZaGfAExH/9dYKIlZ2gkGtDATstBEEqzT2kkJDRNBCJVxOzUEakzvRkCLNbS532Z0Zi1tP04gDw6vefH4MIy8W33jW3+VfdezwEepTNQGIu70drl44z54quSq5GeqOuwPQaDT49vMHix+X/ezJExLcHTND8xzNc/b6fXZ3dsiyjG63S5ZlXLt8cfQpNjMECCIkUfQnR1FQmLG9vc2T+XkAltbXic2cIMK5l8d5dekzH1ZWqFarHB0bg6KgXq/j7lQqFRZeLxGrGyLC0pWvmDunJycxd3LVfRKAuhF7Galx9w4Ts3N8arVI05Rer0eappgZaZpSqVRwM2JTJYgwNfcIM+PU+DjmPupclX6eE4lgqoRCh8Lt5wkhBN43m7TabVobG3zf3CSJIg4kCUkUUWgpiAiPryvuwnSthpntU5IoIgphKJgpAtyfmUFEeNdsstrpsLy2NpKCyDCSKbGWwsPZWRyYnpjAf0//SxJAVQmqQ+HWs4AAbxsNvrTbrHY6dLa2CCKjVlXiwWAAwNMb4C6cqdVwwMp7MncoVz8YDIizLBtdg5ST3B0p3wBYCEgIZFlGnDjcvPeA/6nqwUP8AtTWMEb6wHGvAAAAAElFTkSuQmCC",Bc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9bS0UqIlYQ6ZChOlkQFXHUKhShQqgVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4B/kaFqWbXOKBqlpFOJoRsblUIvSKIMPoRxaDETH1OFFPwHF/38PH1Ls6zvM/9OXqVvMkAn0A8y3TDIt4gnt60dM77xBFWkhTic+Ixgy5I/Mh12eU3zkWH/TwzYmTS88QRYqHYwXIHs5KhEk8RxxRVo3x/1mWF8xZntVJjrXvyF4bz2soy12lGkcQiliBCgIwayqjAQpxWjRQTadpPePiHHb9ILplcZTByLKAKFZLjB/+D392ahckJNymcAIIvtv0xAoR2gWbdtr+Pbbt5AgSegSut7a82gJlP0uttLXYE9G0DF9dtTd4DLneAoSddMiRHCtD0FwrA+xl9Uw4YuAV61tzeWvs4fQAy1FXqBjg4BEaLlL3u8e7uzt7+PdPq7wdBJ3KT7BaVSwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDBEdBk5IsTwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAACx0lEQVQ4y42O309TBxiGn3N6qKZGNLqwhUSIFhDMUFwXb2pxJoyIAv7elmXJdsHlZvA/8G7ZrpbMu91oYtAbo0QzhSYGGtivokB7Ss85LS1VxFFKtRBSjrbn88rGxbjwJe/N9+R58yps8OLpjJhPnvznt22LZ2PyTGpObo2ExBGpRETk1khIXBuR448z9B5pZ2xigsFgkJelEnW1tcQzGdT/k2OzaYnNpek90k65XGapUOCbk6dZKhQAcBzn/QV6MiV6OsXJo59h2zaOCC1eLw8tg30NDZWC98oDw0FZF5H5+XkJDQ7Ks4UFKb56JXapJCURGRgOip5MyTsLoolZmUomOP15BwuZDLGxMYrFIpFQiHK5jOpycWNomNbde/i4YY+ivS1HrKRMWiZnj3fxOJlEHx2tMF9HB+5Nm7j++z3aGptobfQqAJWCaSshE0acL3q6SZsmU8FgRT7U1cVH9fVcu3MXX3Mz+5salDdMBZg0LQnHYpzr6WY2HufR0BCO4+A4Dr7OTnZ5vVy7Pcgne/dyoKlReXu1MmmYEtZ1vjx7hjnDID4yUoH1Ph+pTIbR8T/w1tUR8PuJRiLYtk11dTWHAwFcbYH2S1+dP0c2myUVCuF2u3G73TQHAkzrOtUeD2e6T2AZJuPj43g2b6a35wTlUonpqWl4OBOXywM35IWIRE1THty8KbFEQlZE5Ou+PjGMhFzovyiRqCX5fFEiUUsu9F8Uw0jIjz/9LErueUHST+cZDYfp++5bstksH9bU8NuVqzydmeF45ym2bt3C/ft3yb/IsWP7Bxw71s3q6hp//vUAZTGXl7W1NXTD4JFp0P/D9/zy62Uaa2sprqwS/udvFEXB4/HQdvAg0UiE4vo6iqLg9/tRnmVzsri4SH55mX9zS0xaFp+2tLBz23bslzaqqlKlVaFpGlXuKjSXhqZpuDQNVVV5DQyKeoiSxZAyAAAAAElFTkSuQmCC",Pc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgjN9BzCj0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABnElEQVQoz42SsWoiURSGv5m5OIVplsQBky67ICisi6QQ3GreQRBsrHwEn8GHEMTCQiufIFVIsQRcd8Bml7XJFuvsIJoE1Lkzs8XEYSaaxB9ucbn3+8899/wKwM3d92Dh2Pi+j+/7vCVVVVFVlQ+nGb5efVEEgGP/5ar4GSNzxjGa2/+4m/wIDQGklEfDAEbmDCllzMB1o0NN0xBC7C3P8wDodDrEGQFEfSuKEl2Ma7vdkkql6Pf7zOdz4kzCIAgCgISJlBJd1xkMBiwWC8rlcsJADYFw0263GY1GaJrGZrNhvV6j6zrD4ZDlckk+n8c0TeKMiFcsFAqMx2Nc16VarQLQ7XZxHIdSqUSlUoletmNCAz/cmKaJ4zhMp1N6vR6r1QrbthOVI4NnJmzheSTpdJpGo0E2m8WyLGazGblcjlqttvexXnyML9PXbDYxDINisUi9Xj+YhcQUdr8fV6vVejNMO0YFCICJZR2dxIllsSupXN9+C37/+smf+3s8T0YRfU1CCDRNkL045/LjJ5TbsRU8PT5woIt3lT454T+zOsZSlUjWPwAAAABJRU5ErkJggg==",Gc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgiC+YHR/sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABwUlEQVQoz42TT4vaQBjGfzHBSw6rt+2lhLL04lFY+h1aevPup/CqIH4D2YJ4Fbsbqv1Da6nXYi+ibL3YdruoZHXXSzaVVMgkmR7SFcU27A/eyzDPM8+8844CcDmZyevrBUEQEAYhcSTUBKqqcnj4gEfGQ0UDmM+veHx0RDqd4j7Y9i3fLy4iQwAhxL3FAOl0CiHErsEdqqqiadpeBUEAQL1eZ1ujAYRhdG9FUTYbt/E8j2QySaPRYLlcsq3ZMZBSAmxMbNvGsizCMKTf77NarTAMg8FgwGI+53IyiwTv3n+QQghZLpelaZpSCCEdx5G9Xk/G8bn3RWrbJ2YyGYbDIUIIcrkcQRDQ7XY5OXlBu92iWq2iaRphGJLNZlmv1ygAr9qv5fNnT3FdF9M0mU6nGIaBZVkUi8X/vsbHT92oB77vA6DrOvl8nlqtxmg0wvO82ASbhjdPz6QQYqcqlYoslUqxPWi/eRv14F8UCgU6nU5sgs38NE/P5Pn5170UrVYrNkGj+VIq3378lOPxmOl0gu/7+H9dXdflZnmDc+vsTGoiEX2mg9QBx8dPUGZXC7la/doM0R3r32tc191b30bXdf4AswSDFyrGAhMAAAAASUVORK5CYII=",Si="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9Tix9UOlhBikOG6mRBVMRRq1CECqFWaNXB5PoJTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/5cUWsR4cNyPd/ced+8AoVFhqtk1DqiaZaQScTGTXRW7XxHAIHoRQkRmpj4nSUl4jq97+Ph6F+NZ3uf+HP25vMkAn0g8y3TDIt4gnt60dM77xGFWknPE58RjBl2Q+JHristvnIsOCzwzbKRT88RhYrHYwUoHs5KhEk8RR3OqRvlCxuUc5y3OaqXGWvfkLwzmtZVlrtMcRgKLWIIEEQpqKKMCCzFaNVJMpGg/7uGPOH6JXAq5ymDkWEAVKmTHD/4Hv7s1C5MTblIwDgRebPtjBOjeBZp12/4+tu3mCeB/Bq60tr/aAGY+Sa+3tegRENoGLq7bmrIHXO4AQ0+6bMiO5KcpFArA+xl9UxYYuAX61tzeWvs4fQDS1FXyBjg4BEaLlL3u8e6ezt7+PdPq7wcvuHKMRIsU1QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFFQkWEGZMN3sAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABVElEQVQoz93Ry0oCARjF8f/kpC0mZYoupJZWWhSouUopy0fQxxF9kagXKNpEtLZVQajdFl28kVp2mRFGiS4zTLsiqkXLOtvf4nx8B/58BID84bHZaNTRX/V3ELtFnE4XAD9ZOBQQhINcwaxUyng9Y/TJMlarFcMweFAUcvkCAOG50BcrV6p4veMI6xubptvt5PjoiPOLS3TDYGR4CFmWP53aarW4bt4iWixM+X0EgkFqtQZdWltDkiQUVSWVzgAQjUZYXFwgkUiQTCaJx+PEYjEAUukMiqoiSRJaW0NYWV0zPaPj1Os17pU7NE1Df3n+9mGi1YbdbmegfxCXy031qoywtb1j7u/tMTsTwuPx4XDIPD52KJXOODnNA/xo85EIwmW5au5ms1ycn/H0/NHcY7MxMTkJQKlY/GL+qWmWlpcR6jdNs9PuoBv6r/YXLSJSr8Q/yBspXJbfdFchHAAAAABJRU5ErkJggg==",Rc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8ziBhJZiFZ3AVKUUKyZCgpahqjxmPh3jtmqLl3pntHNpbKVll4bLwWNtZsLWyVUh4lWxsrYiNd/3NHzaRGOXU6v75zvq9zvgPBg4xpuZU9YNl5JzYW0RIzs1r1M1XU0Ugtnbrp5oaj0QnKjo9bAmq96VZZ/G/UJxddEwKa8JCZc/LCC8IDq/mc4h3hsLmkJ4VPhbscuaDwvdKNAr8oTvscVJlhJx4bEQ4La+kSNkrYXHIs4X7htqRlS34wUeCk4jXFVmbF/LmnemFo0Z6eUrrMVsYYZ5IoGgYrLJMhT7estiguMdmPlPG3+P6ouAxxLWOKY5QsFrrvR/3B727dVF9vISkUgaonz3trh+ot+Nr0vM9Dz/s6gopHuLCL/uwBDL6LvlnU2vahYR3OLouasQ3nG9D8kNMd3ZcqZAZTKXg9kW+agaZrqJ0r9Pazz/EdxKWriSvY3YOOtGTPl3l3TWlvf57x+yPyDUN6cpTX8RfMAAAAmVBMVEVAQUE9PT1YWFg9Pj5VVVVUVFQrKytZWVkpKSpERERRUVFQUFBDQ0NYWVo+Pz9TU1NSUlI4OTlXV1cgISFdXV04ODk4ODhRUlMhIiInJycuLi5KSkpJSUkoKCk7OztBQUE8PDzj5ugLCwtaWlpeXl5CQkK/wcNdX18BAQEJCQkUFRUfICAuLy8fHx8TFBTn6uzNz9HIyswAAABWGAQaAAAAM3RSTlP//////////////////////////////////////////////////////////////////wBxnr2OAAAACXBIWXMAAC4hAAAuIQEHW/z/AAAAmUlEQVQoU03MyRKCMBBF0RDSBBUICMgQAUFlUBTM/3+clbRF+TZ96yyaKBzZAo9FqYWFYDMGYJtEcDgD6pg04O72DA6eu4GP4G+gAsEgDEwiqOgIEdYP4gRiLITU4nBKTWrIcqGfhnmGUJRSajjLstBQ1XWD0FzqSpG2azwprreEh9K7dy3ph3F6PN15rl7vaRx6sqyfv63LF52MIsEsSTP4AAAAAElFTkSuQmCC",Fc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UrDhaU4pChOlkQFXHUKhShQqkVWnUwufQLmjQkKS6OgmvBwY/FqoOLs64OroIg+AHi6uKk6CIl/i8ptIjx4Lgf7+497t4BQqPCVLNrHFA1y0gn4mI2tyoGXxFAL4KIYFBipj6XSiXhOb7u4ePrXYxneZ/7c/QpeZMBPpF4lumGRbxBPL1p6Zz3icOsJCnE58RjBl2Q+JHrsstvnIsOCzwzbGTS88RhYrHYwXIHs5KhEk8RRxVVo3wh67LCeYuzWqmx1j35C0N5bWWZ6zSHkcAilpCCCBk1lFGBhRitGikm0rQf9/BHHH+KXDK5ymDkWEAVKiTHD/4Hv7s1C5MTblIoDgRebPtjBAjuAs26bX8f23bzBPA/A1da219tADOfpNfbWvQI6N8GLq7bmrwHXO4AQ0+6ZEiO5KcpFArA+xl9Uw4YuAV61tzeWvs4fQAy1FXyBjg4BEaLlL3u8e7uzt7+PdPq7wcllnKI7QJDVQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFCwgeFvbyUt0AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABKElEQVQoz6XPMUtCcRSG8eeCqR8ktKEaJYMw/QYtFUQQFFREUIM4GEEYRAkN0dQSQQWFIBQ4lSlKBA1SLQ2B9BlsuH/v9ZwGtYQIC9/5HH48VuX1TQGMbbORiLO9m8bn9wOwvrKEiqIoIoKK0B8IshZPYLUfy8UCL89PDA4NMzYepds8ba2YvyW5lSK1mSQ0Esbn97O6uICKoKqIKiqCiHB0ctoUS4U7spnL1hFMTE4Rica6i4X8DdMzs4TCozzcl8ldXxGJxlien/tSRAWVZuvx+cV343/nAZot7YaOlk5FWq2NRoOzTLZH8beWtiIiOI5D3RiMMeTyxR7Ej1qN/b0d3qvVH4rruhjbxhhDvV7HdR0CwQHSB4dYpceKGmMj8jfYsqDP6+UTS3LlTs6Kx84AAAAASUVORK5CYII=",Kc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAABuElEQVQ4T32Tu04CQRSGf9gLEKQgYmQN2qACNhpNCBSAPoKXRHoqtcWeh6A0EtGChMZoY7QwitGEgpcwoBJvhSD3cWcYUbKjXzKZ//xz2TNnZ/AfyysrhDYeCjHz3kAkEiHu8XHQRjW3DZh4P0QkGmWLKYT01z5VqyhcXxvmCzN4fXmBLMs8AtPUE2HYIBCYI5qmodFocAdMu91uNsatAYYN5hcWuDIiGhPWIBqLkTGXCxaLBTabjXm1Wh1b2ztMfzM5NcWVgFA4TBKJhF7Dv7m5vSMSn29AVpTUzPQ0rFYrksldxOObSKfTKJVKKBaL6PV6qNU/xUcIhcJEUWR4vV5kMhnuGjk7v8BQBqtr66TZbKZ8s7Ps7JIkweFw/JNB/ScDn89HaNE8Hg+LqVZVFblcjsUijk9O+xn4/QHico2yRXptoCgKuzxUO53OPzN4e3+H6b7ySPwzXgSDQZjN5sGvo32r1UI+n2dfE3GQPYTp8qpA9vf3cJTNsorbR0Zgt9uhKiq7Jb1uF+1OB512m21IW0ePF5eWsLa+AdND9ZlUymW09Qm/odf3o/ZBXxN3hpH0I2raBL4ARzrLEHEzjREAAAAASUVORK5CYII=",Uc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAPCAYAAADUFP50AAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAH9SURBVDhPnZJPaBNBFMa//ZPNpgHT0HartRD/IKJSRIoFLd5VPEmPBgQtXgqCnooIohRE8CBe9CZCTx48evGioKlKpCGiFUWxNmnS3eomNNnN7mafM2NZXNKTD37L8L3ve7MzjIQt6vrDdbIaJNaDGQm3Lg30+GLC5bsrdPRgGsfG0hgZUoVWNQMUyi28+9jCvaujvRtN31yirz/bFAQB+b4fg2u8xz2b9r81deUNff7eJNd1yXEcmsy/iLGwWBc97uFenpH5Z+JQGqOGAjYdbDryZ3YIThzZhmaziYXSmuhxDz8KL+Xk9DO6OLUPmbQEIhLsz2nIGSF+VBoolH4hNxxie38btt3AQDaFmnzqhrxccbFrpA9hGMLzPJimhWq1huevV/HgSRUTYwYunN0NWVbZUGA4q4BnZFXtA5jgOB1Ylo1OJ4CiJHDnsQ1JSmFuZg9c14OqagJip+MZeW9uEF+W22i1PBbQkEjogsL8cYHndSONs2oBPCM/vT8uvSz60PUUNC0ZcXqmIvhXSybZwDLAM+JWi0syzAYPpqLJup4RxHZbT6L8TRO3GlV+9je9/+BQve5QrebQxkYg4GuuvS216RzzbNrjT443xg9omDycwE6D/QyzrZhdvFr0UfzkY/52NvL3vj1W56+ZtGYrYm30d/FobmhL338U8AdLygpqJt/tXAAAAABJRU5ErkJggg==",Mc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABgmlDQ1BJQ0MgUHJvZmlsZQAAKM+VkU0oRFEcxX9miDSizEKyeAusTIRkyVCToqZBGSy898YMNe+Z3hvZWCrbKQsfG18LG2u2FrZKKR8lWxsrYiM9//tGzaRGuXW7v86953TvuRA4yJqWW90Dlp13ErGoNpOc1WqfqSFEE90EddPNDcfj41QcH7dUqfUmorL432hILbomVGnCQ2bOyQsvCA+s5XOKd4TD5pKeEj4V7nLkgsL3SjeK/KI443NAZYadqcSIcFhYy5SxUcbmkmMJ9wu3pyxb8gMzRU4pXldsZVfNn3uqF4YW7elJpctsI8YYE8TRMFhlmSx5IrLaorgkZD9awd/q++PiMsS1jCmOUVaw0H0/6g9+d+um+3qLSaEo1Dx53lsH1G7BV8HzPg897+sIgo9wYZf8Kwcw+C56oaS170PjBpxdljRjG843oeUhpzu6LwVlBtJpeD2Rb0pC8zXUzxV7+9nn+A6mpKvxK9jdg86MZM9XeHddeW9/nvH7I/oNQUlyk6fcG6sAAAAJcEhZcwAALiIAAC4iAari3ZIAAAIwSURBVDhPdVNLaBNRFD3jTJs0iQnWtqC2uLEWUlxIUBBxWQjqRigoaNxoEQSRKiIuKqILQRA/hIiCCwviDxoURLGCiJLGT6AhUGvTJjYfpTGdNGknE83n+uZlNASTA3eYuee8e+57746ABhi5vUjpLPH3DpuAS8fWNtTVJU9eTdA2uxk7tpixvlPiue8/S5gIKfg0peDG6e6GRTB0cZpm43kqlUpULBbrQstpnKbR5TUMnvpAX6M5KhQKpKoq7XS9rQv/5ALnNI2m1ZdhlfbY3m9Gd5cI5gLmAtfedTx2bbUil8vBH0xxTtNo27p8Z5IXEJ1DL+joYC9sZgFExKNvYyva27KIz89BTi/AZpCh5uKIRqMwSSvwB+bgfXTzAuy7vbSYWSFZlimVSlE4PEvBYIiue56wOs3x3jdBkiSZANaEqv5CNruMSqUCUWzB83dLsG8ah8dzC17vGNxuN5iY8w6Hg+lVCPtOBOjskR60m1Te8l9EIjNwOgf0r//x8tV49Z6v3E3SgYEWlMtlTmg4fv4Nhl0dTZ3TcqYq3H/mBwVCy5RMLlEikeGx5/Dj6uaawPv0Gf2bGNe5DA0fNGJDJzsC1r3P9xoWi6GpcyyR1FfqOMQKXBtV6GPwN90bHdM9GuP+g4c159DUF4p8S+PztBEzcQti82EUlRiMrQrWtMno6SrBZjVitdUKSRTRu7mv9mNEYwk2mnnelppXoShK3ekLggCD0QCTycyuUhtM4A+OzZgJPZUHrgAAAABJRU5ErkJggg==",Qc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS1WqInYQcchQnSyIijhqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxdXFSdJES/9cUWsR4cNyPd/ced+8AoVZimtUxDmi6bSbjMTGdWRWDrwigF13oR0hmljEnSQl4jq97+Ph6F+VZ3uf+HD1q1mKATySeZYZpE28QT2/aBud94jAryCrxOfGYSRckfuS64vIb53yDBZ4ZNlPJeeIwsZhvY6WNWcHUiKeII6qmU76QdlnlvMVZK1VY8578haGsvrLMdZrDiGMRS5AgQkEFRZRgI0qrToqFJO3HPPxDDb9ELoVcRTByLKAMDXLDD/4Hv7u1cpMTblIoBgReHOdjBAjuAvWq43wfO079BPA/A1d6y1+uATOfpFdbWuQI6NsGLq5bmrIHXO4Ag0+GbMoNyU9TyOWA9zP6pgwwcAt0r7m9Nfdx+gCkqKvEDXBwCIzmKXvd492d7b39e6bZ3w8AS3J5R6xfBwAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cFDgkROnWuuPQAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAABPUlEQVQY023OzUsCQQBA8TcqfpSwa7uQYKXmpbAuJVT7j0fBnvtgK0LFArVod2mDNF0EYWZgupR06Hd6xyf4MXp9M9PJJ8vlEoBSqcSG49Jq7AgAAdDtD8x89kVrt4njOABMJhNG4xcsu8Jhe1+I4fjVxFFI5/iIfD7PX1JKgrt7alvb5JLknUa9TjabZTgcEgQBAJ1Oh2azSaNeJ4xjMuk8xbYtpJT4vk8YhoRhiO/7SCmxbYt0npLTWqO1BmA6nTKbzQDQWqOUWnWmUCySJB8opfA8b/XneR5KKZLkg0KxiOgPnk2/1+Xs9AQhBMYYgFVfXd/QPjgks1mt4rgu5xeXRFGMMWAMRFHM+cUljuuyWa2ScyuWuHt4NI7jchsELBYLAMrlMrXaFmvr67gVS4jfp97gyfCPg/09AfANwseSxMxvrXsAAAAASUVORK5CYII=",Vc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAAzElEQVQ4T2NkwAIWLFiw6+hzX1col8FacvPuhIQENyiXMAAZENfw9D+IhgpRF6A4O7/r2n9DsVO7V5zSc40wu4RBn39l5jqxTAurV8FOhTKxAgx5ZAGjkO3/oUysAFkerE/Tez08UIi1GUSD9DEou67+D8IgQRiNCyCrA2Gm//8ZGWqjv+4GCcJoXABZHUgfilNV3DbhtRlZHsOLxPoZBpigNBisPsDhClKgH3gCHIjoNEgeqpSGAGSTbfwD0tM2SINj8sv/MIzdAAYGAB1Xk+VGE8P2AAAAAElFTkSuQmCC",Wc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkTlIA0EYhb9EJeKBhQFFLLZQKwOiIpYaBREUQlTwKtzdmChkN2E3wcZSsA1YeDRehY21tha2giB4gNjaWCnaiKz/bIQEIYIDw3y8mfeYeQPBg7RpudU9YNk5Jz4W1Wbn5rXQMzXUE6KNFt10s8Ox2AQVx8ctAbXeRFQW/xuNiWXXhIAmPGRmnZzwkvDAWi6reEc4bK7oCeFT4W5HLih8r3SjyC+KUz4HVWbYmY6PCIeFtVQZG2VsrjiWcL9wR8KyJT84W+SE4nXFVjpv/txTvbBh2Z6ZUrrMdsYYZ5IYGgZ5VkmTIyKrLYpLXPajFfxtvj8mLkNcq5jiGCWDhe77UX/wu1s32ddbTGqIQs2T5711QmgLvgqe93noeV9HUPUIF3bJnzmAwXfRCyWtYx+aNuDssqQZ23C+Ca0PWd3RfalKZjCZhNcT+aY5aL6GuoVibz/7HN/BtHQ1cQW7e9CVkuzFCu+uLe/tzzN+f0S/ASWWcoi7xtRwAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB+UlEQVQ4T5WTz2sTQRTHv7M/6iH4m7aXTTZnqY1E1JBSsChW1KJSYijiwZN4Lo1/giZetHhWiaHaH9aoNbEHtb8sCagtChWTNNAt9eaWellpDs+ZaSwGbZJ+4PFm38z77O7sDkOdTM68p59ra3LcdfZMRZ9SzlUZe5WmHboG/yEfrCWrXN0GbycmaWp6inK5bxSNxahcrqDmk9g/bOzetROp9DhuRCKbr/F4cIhGk8+ltKbE+eVgfb2EtmAAN29FZVP8UYLa24JwHEeuqSkplUoyVldtnDzRgTt3+ylw7AgWFr5ifm5Orqn6dVKvx+n7ygpMjwGXy4WGBp1XGZasZWQyWdyORWX/lpKxVJosy0JrywFMz8zCtu3yzAZ/BIL/SpIvXtKyEBxswfznL/B6vTjfdW7LG/6zJyOjz6hYLMLX6sOHj59gGEZVgaBCMjj8lIqLiwgcDWI2k4Hh9qD74oWqAsGmZODJEBUKeXQcP413E29gmibCoe6aAoGUxBMDlM/l+ZkI8Z8qCQ8X9IRDdQkEysN4ggr5AsKXrmJ4JAGTb+KVyz11CwSst6+Prl+L4P6De2hubsSpzk4oigLGQ+S/Q1V5nW2MGWMyN+7bw5g4A9lsFm63G37/YSiqCk3joWo8a1B56PwEy2tdlzUxrygql6po2r+X/QZc4Kt8vjU1QAAAAABJRU5ErkJggg==",zc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABg2lDQ1BJQ0MgUHJvZmlsZQAAKM+VkUsoRFEcxn8zyKORhVGSxV0MK0pIlgwlRU1j1AwW7r1jhpp7TfeObCyVrbLw2HgtbKzZWtgqpTxKtjZWxEa6/ueOmkmNcup0fn3nfF/nfAeCBznTcqt7wLILTnwsqiVTM1rtMzW0UE8Tbbrp5odjsQkqjo9bAmq96VZZ/G80phdcEwKa8JCZdwrC88IDq4W84h3hsLmop4VPhbscuaDwvdKNIr8ozvocVJlhJxEfEQ4La9kyNsrYXHQs4X7hSNqyJT+YLHJa8ZpiK7di/txTvTC0YE9PKV1mO2OMM0kMDYMVlshRoFtWWxSXuOxHK/jbfH9MXIa4ljDFMcoyFrrvR/3B727dTF9vMSkUhZonz3vrgNot+Nr0vM9Dz/s6gqpHuLBL/uUDGHwXfbOkRfahaR3OLkuasQ3nG9D6kNcd3ZeqZAYzGXg9kW9KQfM1NMwWe/vZ5/gOEtLVxBXs7kFnVrLnKry7rry3P8/4/RH9Bi+4coweluJpAAAACXBIWXMAAC4iAAAuIgGq4t2SAAAB7klEQVQ4T5WSS0xTQRSG/zu33fFYGdJF17BS08tGE3YGFuICmgrojkCIC8FECjtIWAnIrilNMGgAeRRtCyVo7A6Npg12oeHVEjHlsS4p5XVJjzPDhZRAbuo3i3PmzPyTf+aMggJxd3WTkWJwoP9Sx4xoihA7nfV40dFuVP4DIV76ukSJxAblu7jAYkRTSkuKMfJm9Ir1i8MKusLpqY7HLuelSMSO9udyrSAHuq7j4CAjD+FQa0szVlfX5JppFwKhOcpm9mX+6/eKjPk0PXlqZDewsPiJXg8NkRnfvv+gGx2E5sO0nUqhpLgINpsNXu8wgsEAPB4PLBYLcrkcNE1DJnt4/QofAkFKcXGlQ0N4IYyB/lfGynU+f4lANXLJzOxH+rv1B/fvVWFuPmRUCZ2dbjQ2NkgH8XgcsVhMusge5jmYnPbTFhdXP6iFf3YcDq0S8Z/Lpg74Vc//wdjEJCUTSTx66JLi23fuoqnBJQ+PRCKoq6sXqXTg8/n4m3gRjUZle/FubIJ6evtofX1PflUxl7s5Ym7G+6lpUl663fSsrQujbz0oK7uF6poaMMaQTqexuZnE7s4Ojk9OoCiKrIsohqC8ogLK1IyfhB273Q4Hf3mmqrxVKs70MxwdH0FlKqxWK68zGcVc5a1U+T7GGP4BgBQJdqV6GiMAAAAASUVORK5CYII=",Dc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TSkWqDhYp4hCwOlkQFXHUKhShQqgVWnUwufRDaNKQtLg4Cq4FBz8Wqw4uzro6uAqC4AeIo5OToouU+L+k0CLGg+N+vLv3uHsHCPUS06zAGKDpFTOViIuZ7IoYfEUAEfSgH0Mys4xZSUrCc3zdw8fXuxjP8j735+hWcxYDfCLxDDPMCvE68dRmxeC8TxxmRVklPiceNemCxI9cV1x+41xwWOCZYTOdmiMOE4uFNlbamBVNjXiSOKpqOuULGZdVzluctVKVNe/JXxjK6ctLXKc5iAQWsAgJIhRUsYESKojRqpNiIUX7cQ//gOOXyKWQawOMHPMoQ4Ps+MH/4He3Vn5i3E0KxYGOF9v+GAaCu0CjZtvfx7bdOAH8z8CV3vKX68D0J+m1lhY9Anq3gYvrlqbsAZc7QOTJkE3Zkfw0hXweeD+jb8oCfbdA16rbW3Mfpw9AmrpK3gAHh8BIgbLXPN7d2d7bv2ea/f0AZphyovX12KAAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfmBBgOKgbgcs+YAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAzFJREFUOMuVlWtMFGcUht8Ztt1lZmFwZlmWXXZZkF0tEW1TI02s2kvU/miJicaUeMFoURtquDRYTdqGhhAjRkNL0ia9gReIrRVawRQjmqz+MsbourUlbUkI7sLOfLNovKS2Ro+/WGbKboBJ5s98532+c857cgZEhBv7D9rivuA+vXKNSESYyxtp2WFVg4FGdV25nYiA29uarJri7mQQY0xReu9vXGWfLexiS5NVz8n9RocYZRbpl/tvrsiG6vSsZxBuMwhRBiGqyfKZeytfE2aC/bl/3/MJr+u7SR2DEE14Cutw7dtfOSbP22s80CSpj214PSsd7LeP662ay9Vh1MRF5xeRtnYLiAgNoS2cruR+qBsCmJTdx8pXTCv/yieNNt1b0KkZYlV3YfuNjs4MIkIyEKFD0HIdDcZb9eyc/sSqsmSmQ427bczpOmqMUeX8tqHWpowkx3h79NjbmHDk1Zqgotz/6K2XskZ2VlrVIv8JU5kF8z+/2laXYWRM68/aB+dxx6Hs0Q1GMUk6q3r93UbYmE0+3Nt9iv+/PmXTK4+v5nRBqTH2VIc4lVm+70i4d4BPpU07FruadnFqib/OZBSEaNzhODxyqJ9Pp+OR5ql5LGdydx++QgBn/P6c/m+pZeADKZ0uJfCPvR+JzpOnjkJ/+CoAIgAcOA4AnuJJWWaIdccWlsmptBwRmWH1taLSdfL7DPZgOQEgAOSe18U/fTSM+D+fTsZZeD7yX6m4yRmJT5gAxvqHq6oEtaj4tMnN0iWtPw528USEiSLvexqEWNIoi3ROe7lYTmnK37U1dtVd8JMRNu4qaPk6HE4agOvt0Is91cwAZYI0OFoWVEzAa9XvZ2l5bhNsbOGiAz9Ebk5z82LPu5zqd29nEKcyzcwZHF0WyCUi4NZnrXZVVnpMo1Hob/750vW0o9HXcZNTS/K3GzPVefuFkaWL8hAv9lUktwyE6FjJC80N2h1+xn0IAgt4qiZ7qkGIxRYE6rF56BYSLs8ODUJ0fPGLzV9duszPemP/fpxjQe9WDWJszOc7WD16jAcR4Z3QAW68fEn5l3+p/Fx/AYGWIEbeWLa8gsIcEeEZsTM0Y8K17+YAAAAASUVORK5CYII=";const U=e=>(bo("data-v-6111c5ce"),e=e(),Eo(),e),Zc={class:"head"},qc=U(()=>O("img",{src:Lc},null,-1)),Yc={key:0,class:"gray"},Xc={class:"typeIcon-wrapper"},jc=["src"],Hc={class:"typeIcon-wrapper"},Jc=["src"],$c={key:0,class:"gray"},eu=["innerHTML"],tu={key:0,class:"gray"},ru={class:"gray"},su={class:"gray"},nu={key:0,class:"gray"},iu=["onClick"],ou=["src"],au=["src"],lu=["src"],cu=U(()=>O("img",{class:"pr-4px",src:Oc},null,-1)),uu=U(()=>O("img",{class:"pr-4px",src:Bc},null,-1)),du=U(()=>O("img",{class:"pr-4px",src:Pc},null,-1)),fu=U(()=>O("img",{class:"pr-4px",src:Gc},null,-1)),hu=U(()=>O("img",{class:"pr-4px",src:Si},null,-1)),pu=U(()=>O("img",{class:"pr-4px",src:Rc},null,-1)),gu=U(()=>O("img",{class:"pr-4px",src:Fc},null,-1)),mu=U(()=>O("img",{class:"pr-4px",src:Kc},null,-1)),yu=U(()=>O("img",{class:"pr-4px",src:Si},null,-1)),Au=U(()=>O("img",{class:"pr-4px",src:Uc},null,-1)),vu=U(()=>O("img",{class:"pr-4px",src:Mc},null,-1)),wu=U(()=>O("img",{class:"pr-4px",src:Qc},null,-1)),bu=U(()=>O("img",{class:"pr-4px",src:Vc},null,-1)),Eu=U(()=>O("img",{class:"pr-4px",src:Wc},null,-1)),ku=U(()=>O("img",{class:"pr-4px",src:zc},null,-1)),_u=U(()=>O("span",{class:"gray absolute right-5px"},"Ctrl+X",-1)),Iu=U(()=>O("span",{class:"gray absolute right-5px"},"Ctrl+C",-1)),xu=U(()=>O("span",{class:"gray absolute right-5px"},"Ctrl+V",-1)),Cu=U(()=>O("span",{class:"gray absolute right-5px"},"Ctrl+D",-1)),Su=U(()=>O("span",null," Move Up ",-1)),Nu=[Su],Tu=U(()=>O("span",null," Move Down ",-1)),Lu=[Tu],Ou=U(()=>O("span",null," Move To ",-1)),Bu=U(()=>O("span",{class:"absolute right-5px"},"❯",-1)),Pu=[Ou,Bu],Gu=["onClick"],Ru={key:0,class:"gray"},Fu=U(()=>O("img",{class:"w-12px pr-4px",src:Dc},null,-1)),Ku=U(()=>O("span",{class:"gray absolute right-5px"},"Del",-1));function Uu(e,t,r,s,n,i){const o=Kr("EditorCollapsibleBox"),l=Kr("CatalogueEntry",!0),a=fc,c=mc,u=Kr("ContextMenu");return I(),S("div",{class:"item unselectable",onMouseup:t[32]||(t[32]=Me((...d)=>i.debug&&i.debug(...d),["middle","stop"])),onContextmenu:t[33]||(t[33]=Me((...d)=>i.contextmenu.show&&i.contextmenu.show(...d),["stop"]))},[r.item.editorTypeName==="catalogue"||r.item.editorTypeName==="gameSystem"?(I(),S(de,{key:0},[O("div",Zc,[Ht(o,{payload:i.catalogue,nobox:"",group:[],collapsible:!1},{title:ke(()=>[qc,G(" "+j(i.catalogue.name)+" ",1),i.getNameExtra(i.catalogue)?(I(),S("span",Yc," "+j(i.getNameExtra(i.catalogue)),1)):T("",!0)]),content:ke(()=>[]),_:1},8,["payload"])]),(I(!0),S(de,null,bt(i.groupedCategories,d=>(I(),ne(o,{key:d.type,altclickable:s.store.can_follow(r.item)||r.imported,onAltclick:i.onctrlclick,collapsible:d.items.length>0,group:i.get_group("entries"),payload:d.type,onContextmenu:Me(f=>i.contextmenu.show(f,d.type),["stop"]),class:it([d.type,d.links,`depth-${r.depth}`]),nobox:"",defcollapsed:!i.should_be_open(d.type)},{title:ke(()=>[O("span",null,[O("span",Xc,[O("img",{class:"typeIcon",src:`assets/bsicons/${d.icon}`},null,8,jc)]),G(" "+j(d.name),1)])]),content:ke(()=>[(I(!0),S(de,null,bt(d.items,f=>(I(),ne(l,{key:i.key(f.item),item:f.item,group:i.get_group(d.type),forceShowRecursive:i.forceShow,imported:f.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:2},1032,["altclickable","onAltclick","collapsible","group","payload","onContextmenu","class","defcollapsed"]))),128))],64)):(I(),ne(o,{key:1,altclickable:s.store.can_follow(r.item)||r.imported,onAltclick:i.onctrlclick,collapsible:i.mixedChildren&&i.mixedChildren.length>0,empty:!i.mixedChildren||i.mixedChildren.length==0,group:r.group||[],payload:r.item,class:it([r.item.parentKey,`depth-${r.depth}`]),defcollapsed:!n.open,nobox:""},{title:ke(()=>[O("span",null,[O("span",Hc,[O("img",{class:"typeIcon",src:`assets/bsicons/${r.item.editorTypeName}.png`},null,8,Jc)]),Ht(a,{errors:r.item.errors},null,8,["errors"]),O("span",{class:it({imported:r.imported,filtered:r.item.highlight})},j(n.name),3),i.getNameExtra(r.item)?(I(),S("span",$c," "+j(i.getNameExtra(r.item)),1)):T("",!0),i.costs?(I(),S("span",{key:1,class:"ml-10px",innerHTML:i.costs},null,8,eu)):T("",!0)])]),content:ke(()=>[(I(!0),S(de,null,bt(i.mixedChildren,d=>(I(),ne(l,{key:i.key(d.item),item:d.item,group:i.get_group("default"),forceShowRecursive:i.forceShow,imported:r.imported||d.imported,depth:r.depth+1},null,8,["item","group","forceShowRecursive","imported","depth"]))),128))]),_:1},8,["altclickable","onAltclick","collapsible","empty","group","payload","class","defcollapsed"])),n.contextmenuopen?(I(),ne(u,{key:2,modelValue:n.contextmenuopen,"onUpdate:modelValue":t[31]||(t[31]=d=>n.contextmenuopen=d),ref:"contextmenu"},{default:ke(({payload:d})=>{var f,h,m,g,y;return[!d&&r.item?(I(),S(de,{key:0},[s.store.can_follow(r.item)?(I(),S("div",{key:0,onClick:t[0]||(t[0]=p=>s.store.follow(i.link))},[G(" Follow "),i.link.target.getCatalogue()!==r.item.getCatalogue()?(I(),S("span",tu,"  ["+j(((f=i.link.target.getCatalogue())==null?void 0:f.getName())||i.link.target.getName())+"] ",1)):T("",!0)])):T("",!0),r.imported?(I(),S("div",{key:1,onClick:t[1]||(t[1]=p=>s.store.goto(r.item))},[G(" Goto "),O("span",ru,"  ("+j((h=r.item.getCatalogue())==null?void 0:h.getName())+") ",1)])):T("",!0),r.item.isProfile()&&r.item.typeId&&r.item.getCatalogue().findOptionById(r.item.typeId)?(I(),S("div",{key:2,onClick:t[2]||(t[2]=p=>s.store.goto(r.item.getCatalogue().findOptionById(r.item.typeId)))},[G(" Goto "+j(r.item.typeName)+" ",1),O("span",su,"  ["+j(r.item.getCatalogue().findOptionById(r.item.typeId).getCatalogue().getName())+"] ",1)])):T("",!0),i.child&&s.store.can_goto(i.child)?(I(),S("div",{key:3,onClick:t[3]||(t[3]=p=>s.store.goto(i.child))},[G(" Goto "+j(i.child.getName())+" ",1),r.item.getCatalogue()!==i.child.getCatalogue()?(I(),S("span",nu,"  ["+j(i.child.getCatalogue().getName())+"] ",1)):T("",!0)])):T("",!0),(m=r.item.links)!=null&&m.length||(g=r.item.other_links)!=null&&g.length?(I(),S("div",{key:4,onClick:t[4]||(t[4]=p=>s.store.mode="references")}," References ("+j(r.item.links?r.item.links.length:0)+") ",1)):T("",!0),r.item.isLink()||r.item.links||r.imported?(I(),ne(c,{key:5})):T("",!0)],64)):T("",!0),d?(I(),S(de,{key:1},[O("div",{onClick:p=>s.store.create(d)},[O("img",{class:"pr-4px",src:`assets/bsicons/${i.getTypeName(d)}.png`},null,8,ou),G(" "+j(i.getTypeLabel(i.getTypeName(d))),1)],8,iu),d==="selectionEntries"?(I(),S("div",{key:0,onClick:t[5]||(t[5]=p=>s.store.create("entryLinks",{type:"selectionEntry"}))},[O("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,au),G(" Link ")])):T("",!0),d==="rules"?(I(),S("div",{key:1,onClick:t[6]||(t[6]=p=>s.store.create("infoLinks",{type:"profile"}))},[O("img",{class:"pr-4px",src:"assets/bsicons/link.png"},null,8,lu),G(" Link ")])):T("",!0),Ht(c)],64)):(I(),S(de,{key:2},[i.allowed("forceEntries")?(I(),S("div",{key:0,onClick:t[7]||(t[7]=p=>s.store.create("forceEntries"))},[cu,G(" Force ")])):T("",!0),i.allowed("categoryLinks")&&r.item.isForce()?(I(),S("div",{key:1,onClick:t[8]||(t[8]=p=>s.store.create("categoryLinks"))},[uu,G(" Category ")])):T("",!0),i.allowed(["forces","categoryLinks"])?(I(),ne(c,{key:2})):T("",!0),i.allowed("selectionEntries")?(I(),S("div",{key:3,onClick:t[9]||(t[9]=p=>s.store.create("selectionEntries"))},[du,G(" Entry ")])):T("",!0),i.allowed("selectionEntryGroups")?(I(),S("div",{key:4,onClick:t[10]||(t[10]=p=>s.store.create("selectionEntryGroups"))},[fu,G(" Group ")])):T("",!0),i.allowed("entryLinks")?(I(),S("div",{key:5,onClick:t[11]||(t[11]=p=>s.store.create("entryLinks",{type:"selectionEntry"}))},[hu,G(" Link ")])):T("",!0),i.allowed(["selectionEntries","selectionEntryGroups","entryLinks"])?(I(),ne(c,{key:6})):T("",!0),i.allowed("profiles")?(I(),S("div",{key:7,onClick:t[12]||(t[12]=p=>s.store.create_child("profiles",r.item))},[pu,G(" Profile ")])):T("",!0),i.allowed("rules")?(I(),S("div",{key:8,onClick:t[13]||(t[13]=p=>s.store.create("rules"))},[gu,G(" Rule ")])):T("",!0),i.allowed("infoGroups")?(I(),S("div",{key:9,onClick:t[14]||(t[14]=p=>s.store.create("infoGroups"))},[mu,G(" Info Group ")])):T("",!0),i.allowed("infoLinks")?(I(),S("div",{key:10,onClick:t[15]||(t[15]=p=>s.store.create("infoLinks",{type:"profile"}))},[yu,G(" Info Link ")])):T("",!0),i.allowed(["profiles","rules","infoGroups","infoLinks"])?(I(),ne(c,{key:11})):T("",!0),i.allowed("conditions")?(I(),S("div",{key:12,onClick:t[16]||(t[16]=p=>s.store.create("conditions"))},[Au,G(" Condition ")])):T("",!0),i.allowed("conditionGroups")?(I(),S("div",{key:13,onClick:t[17]||(t[17]=p=>s.store.create("conditionGroups"))},[vu,G(" Condition Group ")])):T("",!0),i.allowed("repeats")?(I(),S("div",{key:14,onClick:t[18]||(t[18]=p=>s.store.create("repeats"))},[wu,G(" Repeat ")])):T("",!0),i.allowed(["conditions","conditionGroups","repeats"])?(I(),ne(c,{key:15})):T("",!0),i.allowed("constraints")?(I(),S("div",{key:16,onClick:t[19]||(t[19]=p=>s.store.create_child("constraints",r.item))},[bu,G(" Constraint ")])):T("",!0),i.allowed("modifiers")?(I(),S("div",{key:17,onClick:t[20]||(t[20]=p=>s.store.create("modifiers"))},[Eu,G(" Modifier ")])):T("",!0),i.allowed("modifierGroups")?(I(),S("div",{key:18,onClick:t[21]||(t[21]=p=>s.store.create("modifierGroups"))},[ku,G(" Modifier Group ")])):T("",!0),i.allowed(["constraints","modifiers","modifierGroups"])?(I(),ne(c,{key:19})):T("",!0)],64)),d?T("",!0):(I(),S("div",{key:3,onClick:t[22]||(t[22]=(...p)=>s.store.cut&&s.store.cut(...p))},[G("Cut"),_u])),d?T("",!0):(I(),S("div",{key:4,onClick:t[23]||(t[23]=(...p)=>s.store.copy&&s.store.copy(...p))},[G("Copy"),Iu])),O("div",{onClick:t[24]||(t[24]=(...p)=>s.store.paste&&s.store.paste(...p))},[G("Paste"),xu]),d?T("",!0):(I(),S("div",{key:5,onClick:t[25]||(t[25]=(...p)=>s.store.duplicate&&s.store.duplicate(...p))},[G("Duplicate"),Cu])),i.sortable(r.item.parent)?T("",!0):(I(),S("div",{key:6,onClick:t[26]||(t[26]=p=>s.store.move_up(r.item))},Nu)),i.sortable(r.item.parent)?T("",!0):(I(),S("div",{key:7,onClick:t[27]||(t[27]=p=>s.store.move_down(r.item))},Lu)),!d&&((y=s.store.get_move_targets(r.item))!=null&&y.length)?(I(),S(de,{key:8},[O("div",{onMouseover:t[28]||(t[28]=(...p)=>i.nestedcontextmenu.show&&i.nestedcontextmenu.show(...p))},Pu,32),Ht(u,{ref:"nestedcontextmenu"},{default:ke(()=>[(I(!0),S(de,null,bt(s.store.get_move_targets(r.item),p=>(I(),S("div",{onClick:A=>s.store.move(r.item,i.catalogue,p.target,p.type)},j(p.target.name)+" - "+j(p.type),9,Gu))),256))]),_:1},512)],64)):T("",!0),r.item.parentKey==="sharedSelectionEntries"?(I(),S("div",{key:9,onClick:t[29]||(t[29]=p=>s.store.create_child("entryLinks",i.catalogue,{targetId:r.item.id,type:"selectionEntry",name:r.item.getName()}))},[G(" Add Root Link"),i.hasRootLink(i.catalogue,r.item)?(I(),S("span",Ru," (already has one)")):T("",!0)])):T("",!0),d?T("",!0):(I(),ne(c,{key:10})),d?T("",!0):(I(),S("div",{key:11,onClick:t[30]||(t[30]=p=>s.store.remove())},[Fu,G("Remove"),Ku]))]}),_:1},8,["modelValue"])):T("",!0)],32)}const Mu=qt(Tc,[["render",Uu],["__scopeId","data-v-6111c5ce"]]),Ni={showImported:!1,ignoreProfilesRules:!1,filter:"",scroll:0,selection:void 0,mode:"edit"},rf=ko({components:{CatalogueEntry:Mu},emits:["scrolltop"],setup(){return{store:Gr(),uistate:Ot(),settings:xt()}},data(){return{...Ni,...this.defaults,shouldScrollTo:void 0,shouldScrollToElement:void 0}},async mounted(){this.load(),addEventListener("keydown",this.keydown),addEventListener("copy",this.copy),addEventListener("paste",this.paste),addEventListener("cut",this.cut)},unmounted(){removeEventListener("keydown",this.keydown),removeEventListener("copy",this.copy),removeEventListener("paste",this.paste),removeEventListener("cut",this.cut)},props:{catalogue:{type:Object,required:!0},defaults:{type:Object,default:{}}},methods:{onscroll(e){this.scroll=e.target.scrollTop},load(){this.$nextTick(async()=>{if(this.shouldScrollTo=this.scroll,this.selection)try{let e=Dl(this.catalogue,this.selection);const t=this.selection[this.selection.length-1];if(!e&&t.id&&(e=this.catalogue.findOptionById(t.id)),e){const r=await this.store.open(e);r&&(await ae(r).do_select(),this.store.mode=this.defaults.mode,this.shouldScrollToElement=r)}}catch(e){console.error(e)}})},async set_scroll(e){const t=this.$refs.scrollable;t&&(t.scrollTop=e),this.$nextTick(async()=>{const r=this.$refs.scrollable;r&&(r.scrollTop=e)})},async scroll_to(e){e.scrollIntoView({block:"nearest",inline:"center"}),this.$nextTick(async()=>{e.scrollIntoView({block:"nearest",inline:"center"})})},should_capture_copy(e){var t;return!((t=getSelection())!=null&&t.toString())},should_capture_paste(e){var r,s;const t=(((r=e.target)==null?void 0:r.tagName)||"").toLowerCase();return!(["input"].includes(t)||(s=e.target)!=null&&s.isContentEditable||this.$route.name!=="catalogue")},async cut(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.cut(e))},async copy(e){this.should_capture_copy(e)&&(e.preventDefault(),await this.store.copy(e))},async paste(e){this.should_capture_paste(e)&&(e.preventDefault(),await this.store.paste(e))},async keydown(e){var s,n;if(this.$route.name!=="catalogue"||!e.target)return;const t=(n=(s=e.target)==null?void 0:s.tagName)==null?void 0:n.toLowerCase(),r=e.key.toLowerCase();e.ctrlKey&&r==="f"&&(e.preventDefault(),this.$refs["editor-searchbox"].focus()),r==="escape"&&(this.$refs["editor-searchbox"].blur(),this.store.filter="",this.store.update_catalogue_search(this.catalogue,this.filterData)),t==="body"&&(e.ctrlKey&&r==="z"&&(e.preventDefault(),await this.store.undo()),e.ctrlKey&&r==="y"&&(e.preventDefault(),await this.store.redo()),e.ctrlKey&&r==="d"&&(e.preventDefault(),await this.store.duplicate()),r==="delete"&&(e.preventDefault(),await this.store.remove()))},async update(e){const{filter:t,ignoreProfilesRules:r}=e,s=this.store.filtered;for(const n of s)delete n.showInEditor,delete n.showChildsInEditor,delete n.highlight,ar(n,i=>{delete i.showInEditor,delete n.showChildsInEditor});if(t.length>1){this.store.set_filter(t),this.store.filtered=this.catalogue.findOptionsByText(t),r&&(this.store.filtered=this.store.filtered.filter(n=>!n.isProfile()&&!n.isRule()&&!n.isInfoGroup()));for(const n of this.store.filtered)this.store.show(n);if(await $n(),this.store.filtered.length<300){for(const n of this.store.filtered)if(n.parent)try{await this.store.open(n,!1,!0)}catch{continue}}}else this.store.set_filter(""),this.store.filtered=[]}},computed:{filterData(){return{filter:this.filter.trim(),ignoreProfilesRules:this.ignoreProfilesRules}}},watch:{filterData:{handler(e){this.update(e)},immediate:!0},showImported:{immediate:!0,handler(e){e&&this.catalogue.imports.map(t=>t.processForEditor())}},shouldScrollTo(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.set_scroll(e)})},shouldScrollToElement(e){e!==void 0&&this.$nextTick(()=>{delete this.shouldScrollTo,this.scroll_to(e)})}}});const Q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Z=Object.keys,$=Array.isArray;function re(e,t){return typeof t!="object"||Z(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||Q.Promise||(Q.Promise=Promise);const Qt=Object.getPrototypeOf,Qu={}.hasOwnProperty;function oe(e,t){return Qu.call(e,t)}function ft(e,t){typeof t=="function"&&(t=t(Qt(e))),(typeof Reflect>"u"?Z:Reflect.ownKeys)(t).forEach(r=>{ve(e,r,t[r])})}const Ti=Object.defineProperty;function ve(e,t,r,s){Ti(e,t,re(r&&oe(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},s))}function at(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ve(e.prototype,"constructor",e),{extend:ft.bind(null,e.prototype)}}}}const Vu=Object.getOwnPropertyDescriptor;function Ys(e,t){let r;return Vu(e,t)||(r=Qt(e))&&Ys(r,t)}const Wu=[].slice;function kr(e,t,r){return Wu.call(e,t,r)}function Li(e,t){return t(e)}function kt(e){if(!e)throw new Error("Assertion Failed")}function Oi(e){Q.setImmediate?setImmediate(e):setTimeout(e,0)}function Bi(e,t){return e.reduce((r,s,n)=>{var i=t(s,n);return i&&(r[i[0]]=i[1]),r},{})}function we(e,t){if(oe(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],s=0,n=t.length;s<n;++s){var i=we(e,t[s]);r.push(i)}return r}var o=t.indexOf(".");if(o!==-1){var l=e[t.substr(0,o)];return l===void 0?void 0:we(l,t.substr(o+1))}}function ce(e,t,r){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){kt(typeof r!="string"&&"length"in r);for(var s=0,n=t.length;s<n;++s)ce(e,t[s],r[s])}else{var i=t.indexOf(".");if(i!==-1){var o=t.substr(0,i),l=t.substr(i+1);if(l==="")r===void 0?$(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r;else{var a=e[o];a&&oe(e,o)||(a=e[o]={}),ce(a,l,r)}}else r===void 0?$(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Pi(e){var t={};for(var r in e)oe(e,r)&&(t[r]=e[r]);return t}const zu=[].concat;function Gi(e){return zu.apply([],e)}const Ri="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Gi([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>Q[e]),Du=Ri.map(e=>Q[e]);Bi(Ri,e=>[e,!0]);let Ce=null;function Yt(e){Ce=typeof WeakMap<"u"&&new WeakMap;const t=hs(e);return Ce=null,t}function hs(e){if(!e||typeof e!="object")return e;let t=Ce&&Ce.get(e);if(t)return t;if($(e)){t=[],Ce&&Ce.set(e,t);for(var r=0,s=e.length;r<s;++r)t.push(hs(e[r]))}else if(Du.indexOf(e.constructor)>=0)t=e;else{const i=Qt(e);for(var n in t=i===Object.prototype?{}:Object.create(i),Ce&&Ce.set(e,t),e)oe(e,n)&&(t[n]=hs(e[n]))}return t}const{toString:Zu}={};function ps(e){return Zu.call(e).slice(8,-1)}const gs=typeof Symbol<"u"?Symbol.iterator:"@@iterator",qu=typeof gs=="symbol"?function(e){var t;return e!=null&&(t=e[gs])&&t.apply(e)}:function(){return null},st={};function ye(e){var t,r,s,n;if(arguments.length===1){if($(e))return e.slice();if(this===st&&typeof e=="string")return[e];if(n=qu(e)){for(r=[];!(s=n.next()).done;)r.push(s.value);return r}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const Xs=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var he=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fi(e,t){he=e,Ki=t}var Ki=()=>!0;const Yu=!new Error("").stack;function Je(){if(Yu)try{throw Je.arguments,new Error}catch(e){return e}return new Error}function ms(e,t){var r=e.stack;return r?(t=t||0,r.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),r.split(`
`).slice(t).filter(Ki).map(s=>`
`+s).join("")):""}var Ui=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],js=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ui),Xu={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function lt(e,t){this._e=Je(),this.name=e,this.message=t}function Mi(e,t){return e+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,s,n)=>n.indexOf(r)===s).join(`
`)}function _r(e,t,r,s){this._e=Je(),this.failures=t,this.failedKeys=s,this.successCount=r,this.message=Mi(e,t)}function Bt(e,t){this._e=Je(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=Mi(e,t)}at(lt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ms(this._e,2))}},toString:function(){return this.name+": "+this.message}}),at(_r).from(lt),at(Bt).from(lt);var Hs=js.reduce((e,t)=>(e[t]=t+"Error",e),{});const ju=lt;var B=js.reduce((e,t)=>{var r=t+"Error";function s(n,i){this._e=Je(),this.name=r,n?typeof n=="string"?(this.message=`${n}${i?`
 `+i:""}`,this.inner=i||null):typeof n=="object"&&(this.message=`${n.name} ${n.message}`,this.inner=n):(this.message=Xu[t]||r,this.inner=null)}return at(s).from(ju),e[t]=s,e},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var Kn=Ui.reduce((e,t)=>(e[t+"Error"]=B[t],e),{}),hr=js.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=B[t]),e),{});function K(){}function Vt(e){return e}function Hu(e,t){return e==null||e===Vt?t:function(r){return t(e(r))}}function je(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ju(e,t){return e===K?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var s=this.onsuccess,n=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?je(s,this.onsuccess):s),n&&(this.onerror=this.onerror?je(n,this.onerror):n),i!==void 0?i:r}}function $u(e,t){return e===K?t:function(){e.apply(this,arguments);var r=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?je(r,this.onsuccess):r),s&&(this.onerror=this.onerror?je(s,this.onerror):s)}}function ed(e,t){return e===K?t:function(r){var s=e.apply(this,arguments);re(r,s);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?je(n,this.onsuccess):n),i&&(this.onerror=this.onerror?je(i,this.onerror):i),s===void 0?o===void 0?void 0:o:re(s,o)}}function td(e,t){return e===K?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Js(e,t){return e===K?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var s=this,n=arguments.length,i=new Array(n);n--;)i[n]=arguments[n];return r.then(function(){return t.apply(s,i)})}return t.apply(this,arguments)}}hr.ModifyError=_r,hr.DexieError=lt,hr.BulkError=Bt;var Wt={};const[ys,Ir,As]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Qt(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Qt(t),e]})(),Qi=Ir&&Ir.then,pr=ys&&ys.constructor,$s=!!As;var vs=!1,rd=As?()=>{As.then($t)}:Q.setImmediate?setImmediate.bind(null,$t):Q.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{$t(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout($t,0)},Pt=function(e,t){_t.push([e,t]),xr&&(rd(),xr=!1)},ws=!0,xr=!0,Ze=[],gr=[],bs=null,Es=Vt,ct={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Mn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Mn(e[0],e[1])}catch{}})}},N=ct,_t=[],qe=0,mr=[];function x(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=K,this._lib=!1;var t=this._PSD=N;if(he&&(this._stackHolder=Je(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==Wt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&_s(this,this._value))}this._state=null,this._value=null,++t.ref,Wi(this,e)}const ks={get:function(){var e=N,t=Cr;function r(s,n){var i=!e.global&&(e!==N||t!==Cr);const o=i&&!be();var l=new x((a,c)=>{en(this,new Vi(Sr(s,e,i,o),Sr(n,e,i,o),a,c,e))});return he&&Zi(l,this),l}return r.prototype=Wt,r},set:function(e){ve(this,"then",e&&e.prototype===Wt?ks:{get:function(){return e},set:ks.set})}};function Vi(e,t,r,s,n){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=s,this.psd=n}function Wi(e,t){try{t(r=>{if(e._state===null){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var s=e._lib&&Xt();r&&typeof r.then=="function"?Wi(e,(n,i)=>{r instanceof x?r._then(n,i):r.then(n,i)}):(e._state=!0,e._value=r,zi(e)),s&&jt()}},_s.bind(null,e))}catch(r){_s(e,r)}}function _s(e,t){if(gr.push(t),e._state===null){var r=e._lib&&Xt();t=Es(t),e._state=!1,e._value=t,he&&t!==null&&typeof t=="object"&&!t._promise&&function(s,n,i){try{s.apply(null,i)}catch(o){n&&n(o)}}(()=>{var s=Ys(t,"stack");t._promise=e,ve(t,"stack",{get:()=>vs?s&&(s.get?s.get.apply(t):s.value):e.stack})}),function(s){Ze.some(n=>n._value===s._value)||Ze.push(s)}(e),zi(e),r&&jt()}}function zi(e){var t=e._listeners;e._listeners=[];for(var r=0,s=t.length;r<s;++r)en(e,t[r]);var n=e._PSD;--n.ref||n.finalize(),qe===0&&(++qe,Pt(()=>{--qe==0&&tn()},[]))}function en(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++qe,Pt(sd,[r,e,t])}else e._listeners.push(t)}function sd(e,t,r){try{bs=t;var s,n=t._value;t._state?s=e(n):(gr.length&&(gr=[]),s=e(n),gr.indexOf(n)===-1&&function(i){for(var o=Ze.length;o;)if(Ze[--o]._value===i._value)return void Ze.splice(o,1)}(t)),r.resolve(s)}catch(i){r.reject(i)}finally{bs=null,--qe==0&&tn(),--r.psd.ref||r.psd.finalize()}}function Di(e,t,r){if(t.length===r)return t;var s="";if(e._state===!1){var n,i,o=e._value;o!=null?(n=o.name||"Error",i=o.message||o,s=ms(o,0)):(n=o,i=""),t.push(n+(i?": "+i:"")+s)}return he&&((s=ms(e._stackHolder,2))&&t.indexOf(s)===-1&&t.push(s),e._prev&&Di(e._prev,t,r)),t}function Zi(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function $t(){Xt()&&jt()}function Xt(){var e=ws;return ws=!1,xr=!1,e}function jt(){var e,t,r;do for(;_t.length>0;)for(e=_t,_t=[],r=e.length,t=0;t<r;++t){var s=e[t];s[0].apply(null,s[1])}while(_t.length>0);ws=!0,xr=!0}function tn(){var e=Ze;Ze=[],e.forEach(s=>{s._PSD.onunhandled.call(null,s._value,s)});for(var t=mr.slice(0),r=t.length;r;)t[--r]()}function er(e){return new x(Wt,!1,e)}function V(e,t){var r=N;return function(){var s=Xt(),n=N;try{return Ne(r,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{Ne(n,!1),s&&jt()}}}ft(x.prototype,{then:ks,_then:function(e,t){en(this,new Vi(null,null,e,t,N))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,s=>s instanceof t?r(s):er(s)):this.then(null,s=>s&&s.name===t?r(s):er(s))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),er(t)))},stack:{get:function(){if(this._stack)return this._stack;try{vs=!0;var e=Di(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{vs=!1}}},timeout:function(e,t){return e<1/0?new x((r,s)=>{var n=setTimeout(()=>s(new B.Timeout(t)),e);this.then(r,s).finally(clearTimeout.bind(null,n))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ve(x.prototype,Symbol.toStringTag,"Dexie.Promise"),ct.env=qi(),ft(x,{all:function(){var e=ye.apply(null,arguments).map(tr);return new x(function(t,r){e.length===0&&t([]);var s=e.length;e.forEach((n,i)=>x.resolve(n).then(o=>{e[i]=o,--s||t(e)},r))})},resolve:e=>{if(e instanceof x)return e;if(e&&typeof e.then=="function")return new x((r,s)=>{e.then(r,s)});var t=new x(Wt,!0,e);return Zi(t,bs),t},reject:er,race:function(){var e=ye.apply(null,arguments).map(tr);return new x((t,r)=>{e.map(s=>x.resolve(s).then(t,r))})},PSD:{get:()=>N,set:e=>N=e},totalEchoes:{get:()=>Cr},newPSD:Se,usePSD:gt,scheduler:{get:()=>Pt,set:e=>{Pt=e}},rejectionMapper:{get:()=>Es,set:e=>{Es=e}},follow:(e,t)=>new x((r,s)=>Se((n,i)=>{var o=N;o.unhandleds=[],o.onunhandled=i,o.finalize=je(function(){(function(l){function a(){l(),mr.splice(mr.indexOf(a),1)}mr.push(a),++qe,Pt(()=>{--qe==0&&tn()},[])})(()=>{this.unhandleds.length===0?n():i(this.unhandleds[0])})},o.finalize),e()},t,r,s))}),pr&&(pr.allSettled&&ve(x,"allSettled",function(){const e=ye.apply(null,arguments).map(tr);return new x(t=>{e.length===0&&t([]);let r=e.length;const s=new Array(r);e.forEach((n,i)=>x.resolve(n).then(o=>s[i]={status:"fulfilled",value:o},o=>s[i]={status:"rejected",reason:o}).then(()=>--r||t(s)))})}),pr.any&&typeof AggregateError<"u"&&ve(x,"any",function(){const e=ye.apply(null,arguments).map(tr);return new x((t,r)=>{e.length===0&&r(new AggregateError([]));let s=e.length;const n=new Array(s);e.forEach((i,o)=>x.resolve(i).then(l=>t(l),l=>{n[o]=l,--s||r(new AggregateError(n))}))})}));const J={awaits:0,echoes:0,id:0};var nd=0,yr=[],Xr=0,Cr=0,id=0;function Se(e,t,r,s){var n=N,i=Object.create(n);i.parent=n,i.ref=0,i.global=!1,i.id=++id;var o=ct.env;i.env=$s?{Promise:x,PromiseProp:{value:x,configurable:!0,writable:!0},all:x.all,race:x.race,allSettled:x.allSettled,any:x.any,resolve:x.resolve,reject:x.reject,nthen:Un(o.nthen,i),gthen:Un(o.gthen,i)}:{},t&&re(i,t),++n.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=gt(i,e,r,s);return i.ref===0&&i.finalize(),l}function pt(){return J.id||(J.id=++nd),++J.awaits,J.echoes+=100,J.id}function be(){return!!J.awaits&&(--J.awaits==0&&(J.id=0),J.echoes=100*J.awaits,!0)}function tr(e){return J.echoes&&e&&e.constructor===pr?(pt(),e.then(t=>(be(),t),t=>(be(),X(t)))):e}function od(e){++Cr,J.echoes&&--J.echoes!=0||(J.echoes=J.id=0),yr.push(N),Ne(e,!0)}function ad(){var e=yr[yr.length-1];yr.pop(),Ne(e,!1)}function Ne(e,t){var r=N;if((t?!J.echoes||Xr++&&e===N:!Xr||--Xr&&e===N)||Yi(t?od.bind(null,e):ad),e!==N&&(N=e,r===ct&&(ct.env=qi()),$s)){var s=ct.env.Promise,n=e.env;Ir.then=n.nthen,s.prototype.then=n.gthen,(r.global||e.global)&&(Object.defineProperty(Q,"Promise",n.PromiseProp),s.all=n.all,s.race=n.race,s.resolve=n.resolve,s.reject=n.reject,n.allSettled&&(s.allSettled=n.allSettled),n.any&&(s.any=n.any))}}function qi(){var e=Q.Promise;return $s?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Q,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Ir.then,gthen:e.prototype.then}:{}}function gt(e,t,r,s,n){var i=N;try{return Ne(e,!0),t(r,s,n)}finally{Ne(i,!1)}}function Yi(e){Qi.call(ys,e)}function Sr(e,t,r,s){return typeof e!="function"?e:function(){var n=N;r&&pt(),Ne(t,!0);try{return e.apply(this,arguments)}finally{Ne(n,!1),s&&Yi(be)}}}function Un(e,t){return function(r,s){return e.call(this,Sr(r,t),Sr(s,t))}}(""+Qi).indexOf("[native code]")===-1&&(pt=be=K);function Mn(e,t){var r;try{r=t.onuncatched(e)}catch{}if(r!==!1)try{var s,n={promise:t,reason:e};if(Q.document&&document.createEvent?((s=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),re(s,n)):Q.CustomEvent&&re(s=new CustomEvent("unhandledrejection",{detail:n}),n),s&&Q.dispatchEvent&&(dispatchEvent(s),!Q.PromiseRejectionEvent&&Q.onunhandledrejection))try{Q.onunhandledrejection(s)}catch{}he&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var X=x.reject;function Is(e,t,r,s){if(e.idbdb&&(e._state.openComplete||N.letThrough||e._vip)){var n=e._createTransaction(t,r,e._dbSchema);try{n.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Hs.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>Is(e,t,r,s))):X(i)}return n._promise(t,(i,o)=>Se(()=>(N.trans=n,s(i,o,n)))).then(i=>n._completion.then(()=>i))}if(e._state.openComplete)return X(new B.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return X(new B.DatabaseClosed);e.open().catch(K)}return e._state.dbReadyPromise.then(()=>Is(e,t,r,s))}const We=String.fromCharCode(65535),pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Gt=[],Pr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ld=Pr,cd=Pr,Xi=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function He(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const ji={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function rr(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=Yt(t))[e],t)}class ud{_trans(t,r,s){const n=this._tx||N.trans,i=this.name;function o(a,c,u){if(!u.schema[i])throw new B.NotFound("Table "+i+" not part of transaction");return r(u.idbtrans,u)}const l=Xt();try{return n&&n.db===this.db?n===N.trans?n._promise(t,o,s):Se(()=>n._promise(t,o,s),{trans:n,transless:N.transless||N}):Is(this.db,t,[this.name],o)}finally{l&&jt()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",s=>this.core.get({trans:s,key:t}).then(n=>this.hook.reading.fire(n))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if($(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=Z(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const s=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&r.every(u=>c.keyPath.indexOf(u)>=0)&&c.keyPath.every(u=>r.indexOf(u)>=0))[0];if(s&&this.db._maxKey!==We)return this.where(s.name).equals(s.keyPath.map(c=>t[c]));!s&&he&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:n}=this.schema,i=this.db._deps.indexedDB;function o(c,u){try{return i.cmp(c,u)===0}catch{return!1}}const[l,a]=r.reduce(([c,u],d)=>{const f=n[d],h=t[d];return[c||f,c||!f?He(u,f&&f.multi?m=>{const g=we(m,d);return $(g)&&g.some(y=>o(h,y))}:m=>o(h,we(m,d))):u]},[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(a):s?this.filter(a):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,$(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const r=s=>{if(!s)return s;const n=Object.create(t.prototype);for(var i in s)if(oe(s,i))try{n[i]=s[i]}catch{}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t}defineClass(){return this.mapToClass(function(t){re(this,t)})}add(t,r){const{auto:s,keyPath:n}=this.schema.primKey;let i=t;return n&&s&&(i=rr(n)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:r!=null?[r]:null,values:[i]})).then(o=>o.numFailures?x.reject(o.failures[0]):o.lastResult).then(o=>{if(n)try{ce(t,n,o)}catch{}return o})}update(t,r){if(typeof t!="object"||$(t))return this.where(":id").equals(t).modify(r);{const s=we(t,this.schema.primKey.keyPath);if(s===void 0)return X(new B.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?Z(r).forEach(n=>{ce(t,n,r[n])}):r(t,{value:t,primKey:s})}catch{}return this.where(":id").equals(s).modify(r)}}put(t,r){const{auto:s,keyPath:n}=this.schema.primKey;let i=t;return n&&s&&(i=rr(n)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:r!=null?[r]:null})).then(o=>o.numFailures?x.reject(o.failures[0]):o.lastResult).then(o=>{if(n)try{ce(t,n,o)}catch{}return o})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?x.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:ji})).then(t=>t.numFailures?x.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(s=>s.map(n=>this.hook.reading.fire(n))))}bulkAdd(t,r,s){const n=Array.isArray(r)?r:void 0,i=(s=s||(n?void 0:r))?s.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&n)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let u=a&&l?t.map(rr(a)):t;return this.core.mutate({trans:o,type:"add",keys:n,values:u,wantResults:i}).then(({numFailures:d,results:f,lastResult:h,failures:m})=>{if(d===0)return i?f:h;throw new Bt(`${this.name}.bulkAdd(): ${d} of ${c} operations failed`,m)})})}bulkPut(t,r,s){const n=Array.isArray(r)?r:void 0,i=(s=s||(n?void 0:r))?s.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:l,keyPath:a}=this.schema.primKey;if(a&&n)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let u=a&&l?t.map(rr(a)):t;return this.core.mutate({trans:o,type:"put",keys:n,values:u,wantResults:i}).then(({numFailures:d,results:f,lastResult:h,failures:m})=>{if(d===0)return i?f:h;throw new Bt(`${this.name}.bulkPut(): ${d} of ${c} operations failed`,m)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",s=>this.core.mutate({trans:s,type:"delete",keys:t})).then(({numFailures:s,lastResult:n,failures:i})=>{if(s===0)return n;throw new Bt(`${this.name}.bulkDelete(): ${s} of ${r} operations failed`,i)})}}function Rt(e){var t={},r=function(l,a){if(a){for(var c=arguments.length,u=new Array(c-1);--c;)u[c-1]=arguments[c];return t[l].subscribe.apply(null,u),e}if(typeof l=="string")return t[l]};r.addEventType=i;for(var s=1,n=arguments.length;s<n;++s)i(arguments[s]);return r;function i(l,a,c){if(typeof l=="object")return o(l);a||(a=td),c||(c=K);var u={subscribers:[],fire:c,subscribe:function(d){u.subscribers.indexOf(d)===-1&&(u.subscribers.push(d),u.fire=a(u.fire,d))},unsubscribe:function(d){u.subscribers=u.subscribers.filter(function(f){return f!==d}),u.fire=u.subscribers.reduce(a,c)}};return t[l]=r[l]=u,u}function o(l){Z(l).forEach(function(a){var c=l[a];if($(c))i(a,l[a][0],l[a][1]);else{if(c!=="asap")throw new B.InvalidArgument("Invalid event config");var u=i(a,Vt,function(){for(var d=arguments.length,f=new Array(d);d--;)f[d]=arguments[d];u.subscribers.forEach(function(h){Oi(function(){h.apply(null,f)})})})}})}}function wt(e,t){return at(t).from({prototype:e}),t}function et(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function jr(e,t){e.filter=He(e.filter,t)}function Hr(e,t,r){var s=e.replayFilter;e.replayFilter=s?()=>He(s(),t()):t,e.justLimit=r&&!s}function Ar(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Qn(e,t,r){const s=Ar(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:s,range:e.range}})}function sr(e,t,r,s){const n=e.replayFilter?He(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(l,a,c)=>{if(!n||n(a,c,f=>a.stop(f),f=>a.fail(f))){var u=a.primaryKey,d=""+u;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(u)),oe(i,d)||(i[d]=!0,t(l,a,c))}};return Promise.all([e.or._iterate(o,r),Vn(Qn(e,s,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Vn(Qn(e,s,r),He(e.algorithm,n),t,!e.keysOnly&&e.valueMapper)}function Vn(e,t,r,s){var n=V(s?(i,o,l)=>r(s(i),o,l):r);return e.then(i=>{if(i)return i.start(()=>{var o=()=>i.continue();t&&!t(i,l=>o=l,l=>{i.stop(l),o=K},l=>{i.fail(l),o=K})||n(i.value,i,l=>o=l),o()})})}function te(e,t){try{const r=Wn(e),s=Wn(t);if(r!==s)return r==="Array"?1:s==="Array"?-1:r==="binary"?1:s==="binary"?-1:r==="string"?1:s==="string"?-1:r==="Date"?1:s!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(n,i){const o=n.length,l=i.length,a=o<l?o:l;for(let c=0;c<a;++c)if(n[c]!==i[c])return n[c]<i[c]?-1:1;return o===l?0:o<l?-1:1}(zn(e),zn(t));case"Array":return function(n,i){const o=n.length,l=i.length,a=o<l?o:l;for(let c=0;c<a;++c){const u=te(n[c],i[c]);if(u!==0)return u}return o===l?0:o<l?-1:1}(e,t)}}catch{}return NaN}function Wn(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const r=ps(e);return r==="ArrayBuffer"?"binary":r}function zn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class dd{_read(t,r){var s=this._ctx;return s.error?s.table._trans(null,X.bind(null,s.error)):s.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,X.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=He(r.algorithm,t)}_iterate(t,r){return sr(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),s=Object.create(this._ctx);return t&&re(s,t),r._ctx=s,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(s=>sr(r,t,s,r.table.core))}count(t){return this._read(r=>{const s=this._ctx,n=s.table.core;if(et(s,!0))return n.count({trans:r,query:{index:Ar(s,n.schema),range:s.range}}).then(o=>Math.min(o,s.limit));var i=0;return sr(s,()=>(++i,!1),r,n).then(()=>i)}).then(t)}sortBy(t,r){const s=t.split(".").reverse(),n=s[0],i=s.length-1;function o(c,u){return u?o(c[s[u]],u-1):c[n]}var l=this._ctx.dir==="next"?1:-1;function a(c,u){var d=o(c,i),f=o(u,i);return d<f?-l:d>f?l:0}return this.toArray(function(c){return c.sort(a)}).then(r)}toArray(t){return this._read(r=>{var s=this._ctx;if(s.dir==="next"&&et(s,!0)&&s.limit>0){const{valueMapper:n}=s,i=Ar(s,s.table.core.schema);return s.table.core.query({trans:r,limit:s.limit,values:!0,query:{index:i,range:s.range}}).then(({result:o})=>n?o.map(n):o)}{const n=[];return sr(s,i=>n.push(i),r,s.table.core).then(()=>n)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,et(r)?Hr(r,()=>{var s=t;return(n,i)=>s===0||(s===1?(--s,!1):(i(()=>{n.advance(s),s=0}),!1))}):Hr(r,()=>{var s=t;return()=>--s<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Hr(this._ctx,()=>{var r=t;return function(s,n,i){return--r<=0&&n(i),r>=0}},!0),this}until(t,r){return jr(this._ctx,function(s,n,i){return!t(s.value)||(n(i),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,s;return jr(this._ctx,function(n){return t(n.value)}),r=this._ctx,s=t,r.isMatch=He(r.isMatch,s),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(s,n){t(n.key,n)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(s,n){t(n.primaryKey,n)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var s=[];return this.each(function(n,i){s.push(i.key)}).then(function(){return s}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&et(r,!0)&&r.limit>0)return this._read(n=>{var i=Ar(r,r.table.core.schema);return r.table.core.query({trans:n,values:!1,limit:r.limit,query:{index:i,range:r.range}})}).then(({result:n})=>n).then(t);r.keysOnly=!r.isMatch;var s=[];return this.each(function(n,i){s.push(i.primaryKey)}).then(function(){return s}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var s={};return jr(this._ctx,function(n){var i=n.primaryKey.toString(),o=oe(s,i);return s[i]=!0,!o}),this}modify(t){var r=this._ctx;return this._write(s=>{var n;if(typeof t=="function")n=t;else{var i=Z(t),o=i.length;n=function(g){for(var y=!1,p=0;p<o;++p){var A=i[p],w=t[A];we(g,A)!==w&&(ce(g,A,w),y=!0)}return y}}const l=r.table.core,{outbound:a,extractKey:c}=l.schema.primaryKey,u=this.db._options.modifyChunkSize||200,d=[];let f=0;const h=[],m=(g,y)=>{const{failures:p,numFailures:A}=y;f+=g-A;for(let w of Z(p))d.push(p[w])};return this.clone().primaryKeys().then(g=>{const y=p=>{const A=Math.min(u,g.length-p);return l.getMany({trans:s,keys:g.slice(p,p+A),cache:"immutable"}).then(w=>{const k=[],b=[],E=a?[]:null,_=[];for(let C=0;C<A;++C){const F=w[C],R={value:Yt(F),primKey:g[p+C]};n.call(R,R.value,R)!==!1&&(R.value==null?_.push(g[p+C]):a||te(c(F),c(R.value))===0?(b.push(R.value),a&&E.push(g[p+C])):(_.push(g[p+C]),k.push(R.value)))}const P=et(r)&&r.limit===1/0&&(typeof t!="function"||t===Jr)&&{index:r.index,range:r.range};return Promise.resolve(k.length>0&&l.mutate({trans:s,type:"add",values:k}).then(C=>{for(let F in C.failures)_.splice(parseInt(F),1);m(k.length,C)})).then(()=>(b.length>0||P&&typeof t=="object")&&l.mutate({trans:s,type:"put",keys:E,values:b,criteria:P,changeSpec:typeof t!="function"&&t}).then(C=>m(b.length,C))).then(()=>(_.length>0||P&&t===Jr)&&l.mutate({trans:s,type:"delete",keys:_,criteria:P}).then(C=>m(_.length,C))).then(()=>g.length>p+A&&y(p+u))})};return y(0).then(()=>{if(d.length>0)throw new _r("Error modifying one or more objects",d,f,h);return g.length})})})}delete(){var t=this._ctx,r=t.range;return et(t)&&(t.isPrimKey&&!cd||r.type===3)?this._write(s=>{const{primaryKey:n}=t.table.core.schema,i=r;return t.table.core.count({trans:s,query:{index:n,range:i}}).then(o=>t.table.core.mutate({trans:s,type:"deleteRange",range:i}).then(({failures:l,lastResult:a,results:c,numFailures:u})=>{if(u)throw new _r("Could not delete some values",Object.keys(l).map(d=>l[d]),o-u);return o-u}))}):this.modify(Jr)}}const Jr=(e,t)=>t.value=null;function fd(e,t){return e<t?-1:e===t?0:1}function hd(e,t){return e>t?-1:e===t?0:1}function ie(e,t,r){var s=e instanceof Ji?new e.Collection(e):e;return s._ctx.error=r?new r(t):new TypeError(t),s}function tt(e){return new e.Collection(e,()=>Hi("")).limit(0)}function pd(e,t,r,s,n,i){for(var o=Math.min(e.length,s.length),l=-1,a=0;a<o;++a){var c=t[a];if(c!==s[a])return n(e[a],r[a])<0?e.substr(0,a)+r[a]+r.substr(a+1):n(e[a],s[a])<0?e.substr(0,a)+s[a]+r.substr(a+1):l>=0?e.substr(0,l)+t[l]+r.substr(l+1):null;n(e[a],c)<0&&(l=a)}return o<s.length&&i==="next"?e+r.substr(e.length):o<e.length&&i==="prev"?e.substr(0,r.length):l<0?null:e.substr(0,l)+s[l]+r.substr(l+1)}function nr(e,t,r,s){var n,i,o,l,a,c,u,d=r.length;if(!r.every(g=>typeof g=="string"))return ie(e,"String expected.");function f(g){n=function(p){return p==="next"?A=>A.toUpperCase():A=>A.toLowerCase()}(g),i=function(p){return p==="next"?A=>A.toLowerCase():A=>A.toUpperCase()}(g),o=g==="next"?fd:hd;var y=r.map(function(p){return{lower:i(p),upper:n(p)}}).sort(function(p,A){return o(p.lower,A.lower)});l=y.map(function(p){return p.upper}),a=y.map(function(p){return p.lower}),c=g,u=g==="next"?"":s}f("next");var h=new e.Collection(e,()=>Ie(l[0],a[d-1]+s));h._ondirectionchange=function(g){f(g)};var m=0;return h._addAlgorithm(function(g,y,p){var A=g.key;if(typeof A!="string")return!1;var w=i(A);if(t(w,a,m))return!0;for(var k=null,b=m;b<d;++b){var E=pd(A,w,l[b],a[b],o,c);E===null&&k===null?m=b+1:(k===null||o(k,E)>0)&&(k=E)}return y(k!==null?function(){g.continue(k+u)}:p),!1}),h}function Ie(e,t,r,s){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:s}}function Hi(e){return{type:1,lower:e,upper:e}}class Ji{get Collection(){return this._ctx.table.db.Collection}between(t,r,s,n){s=s!==!1,n=n===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(s||n)&&(!s||!n)?tt(this):new this.Collection(this,()=>Ie(t,r,!s,!n))}catch{return ie(this,pe)}}equals(t){return t==null?ie(this,pe):new this.Collection(this,()=>Hi(t))}above(t){return t==null?ie(this,pe):new this.Collection(this,()=>Ie(t,void 0,!0))}aboveOrEqual(t){return t==null?ie(this,pe):new this.Collection(this,()=>Ie(t,void 0,!1))}below(t){return t==null?ie(this,pe):new this.Collection(this,()=>Ie(void 0,t,!1,!0))}belowOrEqual(t){return t==null?ie(this,pe):new this.Collection(this,()=>Ie(void 0,t))}startsWith(t){return typeof t!="string"?ie(this,"String expected."):this.between(t,t+We,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):nr(this,(r,s)=>r.indexOf(s[0])===0,[t],We)}equalsIgnoreCase(t){return nr(this,(r,s)=>r===s[0],[t],"")}anyOfIgnoreCase(){var t=ye.apply(st,arguments);return t.length===0?tt(this):nr(this,(r,s)=>s.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=ye.apply(st,arguments);return t.length===0?tt(this):nr(this,(r,s)=>s.some(n=>r.indexOf(n)===0),t,We)}anyOf(){const t=ye.apply(st,arguments);let r=this._cmp;try{t.sort(r)}catch{return ie(this,pe)}if(t.length===0)return tt(this);const s=new this.Collection(this,()=>Ie(t[0],t[t.length-1]));s._ondirectionchange=i=>{r=i==="next"?this._ascending:this._descending,t.sort(r)};let n=0;return s._addAlgorithm((i,o,l)=>{const a=i.key;for(;r(a,t[n])>0;)if(++n,n===t.length)return o(l),!1;return r(a,t[n])===0||(o(()=>{i.continue(t[n])}),!1)}),s}notEqual(t){return this.inAnyRange([[-(1/0),t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=ye.apply(st,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ie(this,pe)}const r=t.reduce((s,n)=>s?s.concat([[s[s.length-1][1],n]]):[[-(1/0),n]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const s=this._cmp,n=this._ascending,i=this._descending,o=this._min,l=this._max;if(t.length===0)return tt(this);if(!t.every(A=>A[0]!==void 0&&A[1]!==void 0&&n(A[0],A[1])<=0))return ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);const a=!r||r.includeLowers!==!1,c=r&&r.includeUppers===!0;let u,d=n;function f(A,w){return d(A[0],w[0])}try{u=t.reduce(function(A,w){let k=0,b=A.length;for(;k<b;++k){const E=A[k];if(s(w[0],E[1])<0&&s(w[1],E[0])>0){E[0]=o(E[0],w[0]),E[1]=l(E[1],w[1]);break}}return k===b&&A.push(w),A},[]),u.sort(f)}catch{return ie(this,pe)}let h=0;const m=c?A=>n(A,u[h][1])>0:A=>n(A,u[h][1])>=0,g=a?A=>i(A,u[h][0])>0:A=>i(A,u[h][0])>=0;let y=m;const p=new this.Collection(this,()=>Ie(u[0][0],u[u.length-1][1],!a,!c));return p._ondirectionchange=A=>{A==="next"?(y=m,d=n):(y=g,d=i),u.sort(f)},p._addAlgorithm((A,w,k)=>{for(var b=A.key;y(b);)if(++h,h===u.length)return w(k),!1;return!!function(E){return!m(E)&&!g(E)}(b)||(this._cmp(b,u[h][1])===0||this._cmp(b,u[h][0])===0||w(()=>{d===n?A.continue(u[h][0]):A.continue(u[h][1])}),!1)}),p}startsWithAnyOf(){const t=ye.apply(st,arguments);return t.every(r=>typeof r=="string")?t.length===0?tt(this):this.inAnyRange(t.map(r=>[r,r+We])):ie(this,"startsWithAnyOf() only works with strings")}}function fe(e){return V(function(t){return zt(t),e(t.target.error),!1})}function zt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Te=Rt(null,"storagemutated");class gd{_lock(){return kt(!N.global),++this._reculock,this._reculock!==1||N.global||(N.lockOwnerFor=this),this}_unlock(){if(kt(!N.global),--this._reculock==0)for(N.global||(N.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{gt(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&N.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,s=this.db._state.dbOpenError;if(kt(!this.idbtrans),!t&&!r)switch(s&&s.name){case"DatabaseClosedError":throw new B.DatabaseClosed(s);case"MissingAPIError":throw new B.MissingAPI(s.message,s);default:throw new B.OpenFailed(s)}if(!this.active)throw new B.TransactionInactive;return kt(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=V(n=>{zt(n),this._reject(t.error)}),t.onabort=V(n=>{zt(n),this.active&&this._reject(new B.Abort(t.error)),this.active=!1,this.on("abort").fire(n)}),t.oncomplete=V(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Te.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,s){if(t==="readwrite"&&this.mode!=="readwrite")return X(new B.ReadOnly("Transaction is readonly"));if(!this.active)return X(new B.TransactionInactive);if(this._locked())return new x((i,o)=>{this._blockedFuncs.push([()=>{this._promise(t,r,s).then(i,o)},N])});if(s)return Se(()=>{var i=new x((o,l)=>{this._lock();const a=r(o,l,this);a&&a.then&&a.then(o,l)});return i.finally(()=>this._unlock()),i._lib=!0,i});var n=new x((i,o)=>{var l=r(i,o,this);l&&l.then&&l.then(i,o)});return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const s=x.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>s);else{r._waitingFor=s,r._waitingQueue=[];var n=r.idbtrans.objectStore(r.storeNames[0]);(function o(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(n.get(-1/0).onsuccess=o)})()}var i=r._waitingFor;return new x((o,l)=>{s.then(a=>r._waitingQueue.push(V(o.bind(null,a))),a=>r._waitingQueue.push(V(l.bind(null,a)))).finally(()=>{r._waitingFor===i&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(oe(r,t))return r[t];const s=this.schema[t];if(!s)throw new B.NotFound("Table "+t+" not part of transaction");const n=new this.db.Table(t,s,this);return n.core=this.db.core.table(t),r[t]=n,n}}function xs(e,t,r,s,n,i,o){return{name:e,keyPath:t,unique:r,multi:s,auto:n,compound:i,src:(r&&!o?"&":"")+(s?"*":"")+(n?"++":"")+$i(t)}}function $i(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function eo(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Bi(r,s=>[s.name,s])}}let Dt=e=>{try{return e.only([[]]),Dt=()=>[[]],[[]]}catch{return Dt=()=>We,We}};function Cs(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>we(r,t)}(e):t=>we(t,e)}function Dn(e){return[].slice.call(e)}let md=0;function Ft(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function yd(e,t,r){function s(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:u,lowerOpen:d,upperOpen:f}=a;return c===void 0?u===void 0?null:t.upperBound(u,!!f):u===void 0?t.lowerBound(c,!!d):t.bound(c,u,!!d,!!f)}const{schema:n,hasGetAll:i}=function(a,c){const u=Dn(a.objectStoreNames);return{schema:{name:a.name,tables:u.map(d=>c.objectStore(d)).map(d=>{const{keyPath:f,autoIncrement:h}=d,m=$(f),g=f==null,y={},p={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:m,keyPath:f,autoIncrement:h,unique:!0,extractKey:Cs(f)},indexes:Dn(d.indexNames).map(A=>d.index(A)).map(A=>{const{name:w,unique:k,multiEntry:b,keyPath:E}=A,_={name:w,compound:$(E),keyPath:E,unique:k,multiEntry:b,extractKey:Cs(E)};return y[Ft(E)]=_,_}),getIndexByKeyPath:A=>y[Ft(A)]};return y[":id"]=p.primaryKey,f!=null&&(y[Ft(f)]=p.primaryKey),p})},hasGetAll:u.length>0&&"getAll"in c.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),o=n.tables.map(a=>function(c){const u=c.name;return{name:u,schema:c,mutate:function({trans:d,type:f,keys:h,values:m,range:g}){return new Promise((y,p)=>{y=V(y);const A=d.objectStore(u),w=A.keyPath==null,k=f==="put"||f==="add";if(!k&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:b}=h||m||{length:1};if(h&&m&&h.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(b===0)return y({numFailures:0,failures:{},results:[],lastResult:void 0});let E;const _=[],P=[];let C=0;const F=q=>{++C,zt(q)};if(f==="deleteRange"){if(g.type===4)return y({numFailures:C,failures:P,results:[],lastResult:void 0});g.type===3?_.push(E=A.clear()):_.push(E=A.delete(s(g)))}else{const[q,z]=k?w?[m,h]:[m,null]:[h,null];if(k)for(let M=0;M<b;++M)_.push(E=z&&z[M]!==void 0?A[f](q[M],z[M]):A[f](q[M])),E.onerror=F;else for(let M=0;M<b;++M)_.push(E=A[f](q[M])),E.onerror=F}const R=q=>{const z=q.target.result;_.forEach((M,Ee)=>M.error!=null&&(P[Ee]=M.error)),y({numFailures:C,failures:P,results:f==="delete"?h:_.map(M=>M.result),lastResult:z})};E.onerror=q=>{F(q),R(q)},E.onsuccess=R})},getMany:({trans:d,keys:f})=>new Promise((h,m)=>{h=V(h);const g=d.objectStore(u),y=f.length,p=new Array(y);let A,w=0,k=0;const b=_=>{const P=_.target;p[P._pos]=P.result,++k===w&&h(p)},E=fe(m);for(let _=0;_<y;++_)f[_]!=null&&(A=g.get(f[_]),A._pos=_,A.onsuccess=b,A.onerror=E,++w);w===0&&h(p)}),get:({trans:d,key:f})=>new Promise((h,m)=>{h=V(h);const g=d.objectStore(u).get(f);g.onsuccess=y=>h(y.target.result),g.onerror=fe(m)}),query:function(d){return f=>new Promise((h,m)=>{h=V(h);const{trans:g,values:y,limit:p,query:A}=f,w=p===1/0?void 0:p,{index:k,range:b}=A,E=g.objectStore(u),_=k.isPrimaryKey?E:E.index(k.name),P=s(b);if(p===0)return h({result:[]});if(d){const C=y?_.getAll(P,w):_.getAllKeys(P,w);C.onsuccess=F=>h({result:F.target.result}),C.onerror=fe(m)}else{let C=0;const F=y||!("openKeyCursor"in _)?_.openCursor(P):_.openKeyCursor(P),R=[];F.onsuccess=q=>{const z=F.result;return z?(R.push(y?z.value:z.primaryKey),++C===p?h({result:R}):void z.continue()):h({result:R})},F.onerror=fe(m)}})}(i),openCursor:function({trans:d,values:f,query:h,reverse:m,unique:g}){return new Promise((y,p)=>{y=V(y);const{index:A,range:w}=h,k=d.objectStore(u),b=A.isPrimaryKey?k:k.index(A.name),E=m?g?"prevunique":"prev":g?"nextunique":"next",_=f||!("openKeyCursor"in b)?b.openCursor(s(w),E):b.openKeyCursor(s(w),E);_.onerror=fe(p),_.onsuccess=V(P=>{const C=_.result;if(!C)return void y(null);C.___id=++md,C.done=!1;const F=C.continue.bind(C);let R=C.continuePrimaryKey;R&&(R=R.bind(C));const q=C.advance.bind(C),z=()=>{throw new Error("Cursor not stopped")};C.trans=d,C.stop=C.continue=C.continuePrimaryKey=C.advance=()=>{throw new Error("Cursor not started")},C.fail=V(p),C.next=function(){let M=1;return this.start(()=>M--?this.continue():this.stop()).then(()=>this)},C.start=M=>{const Ee=new Promise((Y,Oe)=>{Y=V(Y),_.onerror=fe(Oe),C.fail=Oe,C.stop=mt=>{C.stop=C.continue=C.continuePrimaryKey=C.advance=z,Y(mt)}}),ue=()=>{if(_.result)try{M()}catch(Y){C.fail(Y)}else C.done=!0,C.start=()=>{throw new Error("Cursor behind last entry")},C.stop()};return _.onsuccess=V(Y=>{_.onsuccess=ue,ue()}),C.continue=F,C.continuePrimaryKey=R,C.advance=q,ue(),Ee},y(C)},p)})},count({query:d,trans:f}){const{index:h,range:m}=d;return new Promise((g,y)=>{const p=f.objectStore(u),A=h.isPrimaryKey?p:p.index(h.name),w=s(m),k=w?A.count(w):A.count();k.onsuccess=V(b=>g(b.target.result)),k.onerror=fe(y)})}}}(a)),l={};return o.forEach(a=>l[a.name]=a),{stack:"dbcore",transaction:e.transaction.bind(e),table(a){if(!l[a])throw new Error(`Table '${a}' not found`);return l[a]},MIN_KEY:-1/0,MAX_KEY:Dt(t),schema:n}}function Ss({_novip:e},t){const r=t.db,s=function(n,i,{IDBKeyRange:o,indexedDB:l},a){return{dbcore:function(u,d){return d.reduce((f,{create:h})=>({...f,...h(f)}),u)}(yd(i,o,a),n.dbcore)}}(e._middlewares,r,e._deps,t);e.core=s.dbcore,e.tables.forEach(n=>{const i=n.name;e.core.schema.tables.some(o=>o.name===i)&&(n.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=n.core))})}function Nr({_novip:e},t,r,s){r.forEach(n=>{const i=s[n];t.forEach(o=>{const l=Ys(o,n);(!l||"value"in l&&l.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ve(o,n,{get(){return this.table(n)},set(a){Ti(this,n,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):o[n]=new e.Table(n,i))})})}function Ns({_novip:e},t){t.forEach(r=>{for(let s in r)r[s]instanceof e.Table&&delete r[s]})}function Ad(e,t){return e._cfg.version-t._cfg.version}function vd(e,t,r,s){const n=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,n);i.create(r),i._completion.catch(s);const o=i._reject.bind(i),l=N.transless||N;Se(()=>{N.trans=i,N.transless=l,t===0?(Z(n).forEach(a=>{$r(r,a,n[a].primKey,n[a].indexes)}),Ss(e,r),x.follow(()=>e.on.populate.fire(i)).catch(o)):function({_novip:a},c,u,d){const f=[],h=a._versions;let m=a._dbSchema=Ls(a,a.idbdb,d),g=!1;function y(){return f.length?x.resolve(f.shift()(u.idbtrans)).then(y):x.resolve()}return h.filter(p=>p._cfg.version>=c).forEach(p=>{f.push(()=>{const A=m,w=p._cfg.dbschema;Os(a,A,d),Os(a,w,d),m=a._dbSchema=w;const k=to(A,w);k.add.forEach(E=>{$r(d,E[0],E[1].primKey,E[1].indexes)}),k.change.forEach(E=>{if(E.recreate)throw new B.Upgrade("Not yet support for changing primary key");{const _=d.objectStore(E.name);E.add.forEach(P=>Ts(_,P)),E.change.forEach(P=>{_.deleteIndex(P.name),Ts(_,P)}),E.del.forEach(P=>_.deleteIndex(P))}});const b=p._cfg.contentUpgrade;if(b&&p._cfg.version>c){Ss(a,d),u._memoizedTables={},g=!0;let E=Pi(w);k.del.forEach(F=>{E[F]=A[F]}),Ns(a,[a.Transaction.prototype]),Nr(a,[a.Transaction.prototype],Z(E),E),u.schema=E;const _=Xs(b);let P;_&&pt();const C=x.follow(()=>{if(P=b(u),P&&_){var F=be.bind(null,null);P.then(F,F)}});return P&&typeof P.then=="function"?x.resolve(P):C.then(()=>P)}}),f.push(A=>{(!g||!ld)&&function(w,k){[].slice.call(k.db.objectStoreNames).forEach(b=>w[b]==null&&k.db.deleteObjectStore(b))}(p._cfg.dbschema,A),Ns(a,[a.Transaction.prototype]),Nr(a,[a.Transaction.prototype],a._storeNames,a._dbSchema),u.schema=a._dbSchema})}),y().then(()=>{var p,A;A=d,Z(p=m).forEach(w=>{A.db.objectStoreNames.contains(w)||$r(A,w,p[w].primKey,p[w].indexes)})})}(e,t,i,r).catch(o)})}function to(e,t){const r={del:[],add:[],change:[]};let s;for(s in e)t[s]||r.del.push(s);for(s in t){const n=e[s],i=t[s];if(n){const o={name:s,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(n.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||n.primKey.auto!==i.primKey.auto&&!Pr)o.recreate=!0,r.change.push(o);else{const l=n.idxByName,a=i.idxByName;let c;for(c in l)a[c]||o.del.push(c);for(c in a){const u=l[c],d=a[c];u?u.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&r.change.push(o)}}else r.add.push([s,i])}return r}function $r(e,t,r,s){const n=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return s.forEach(i=>Ts(n,i)),n}function Ts(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Ls(e,t,r){const s={};return kr(t.objectStoreNames,0).forEach(n=>{const i=r.objectStore(n);let o=i.keyPath;const l=xs($i(o),o||"",!1,!1,!!i.autoIncrement,o&&typeof o!="string",!0),a=[];for(let u=0;u<i.indexNames.length;++u){const d=i.index(i.indexNames[u]);o=d.keyPath;var c=xs(d.name,o,!!d.unique,!!d.multiEntry,!1,o&&typeof o!="string",!1);a.push(c)}s[n]=eo(n,l,a)}),s}function Os({_novip:e},t,r){const s=r.db.objectStoreNames;for(let n=0;n<s.length;++n){const i=s[n],o=r.objectStore(i);e._hasGetAll="getAll"in o;for(let l=0;l<o.indexNames.length;++l){const a=o.indexNames[l],c=o.index(a).keyPath,u=typeof c=="string"?c:"["+kr(c).join("+")+"]";if(t[i]){const d=t[i].idxByName[u];d&&(d.name=a,delete t[i].idxByName[u],t[i].idxByName[a]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Q.WorkerGlobalScope&&Q instanceof Q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class wd{_parseStoresSpec(t,r){Z(t).forEach(s=>{if(t[s]!==null){var n=t[s].split(",").map((o,l)=>{const a=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return xs(a,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),$(c),l===0)}),i=n.shift();if(i.multi)throw new B.Schema("Primary key cannot be multi-valued");n.forEach(o=>{if(o.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),r[s]=eo(s,i,n)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?re(this._cfg.storesSource,t):t;const s=r._versions,n={};let i={};return s.forEach(o=>{re(n,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(n,i)}),r._dbSchema=i,Ns(r,[r._allTables,r,r.Transaction.prototype]),Nr(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],Z(i),i),r._storeNames=Z(i),this}upgrade(t){return this._cfg.contentUpgrade=Js(this._cfg.contentUpgrade||K,t),this}}function rn(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Ye("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function sn(e){return e&&typeof e.databases=="function"}function Bs(e){return Se(function(){return N.letThrough=!0,e()})}function bd(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function Ed(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?X(t.dbOpenError):e);he&&(t.openCanceller._stackHolder=Je()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function n(){if(t.openCanceller!==s)throw new B.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,o=null,l=!1;return x.race([s,(typeof navigator>"u"?x.resolve():bd()).then(()=>new x((a,c)=>{if(n(),!r)throw new B.MissingAPI;const u=e.name,d=t.autoSchema?r.open(u):r.open(u,Math.round(10*e.verno));if(!d)throw new B.MissingAPI;d.onerror=fe(c),d.onblocked=V(e._fireOnBlocked),d.onupgradeneeded=V(f=>{if(o=d.transaction,t.autoSchema&&!e._options.allowEmptyDB){d.onerror=zt,o.abort(),d.result.close();const m=r.deleteDatabase(u);m.onsuccess=m.onerror=V(()=>{c(new B.NoSuchDatabase(`Database ${u} doesnt exist`))})}else{o.onerror=fe(c);var h=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;l=h<1,e._novip.idbdb=d.result,vd(e,h/10,o,c)}},c),d.onsuccess=V(()=>{o=null;const f=e._novip.idbdb=d.result,h=kr(f.objectStoreNames);if(h.length>0)try{const g=f.transaction((m=h).length===1?m[0]:m,"readonly");t.autoSchema?function({_novip:y},p,A){y.verno=p.version/10;const w=y._dbSchema=Ls(0,p,A);y._storeNames=kr(p.objectStoreNames,0),Nr(y,[y._allTables],Z(w),w)}(e,f,g):(Os(e,e._dbSchema,g),function(y,p){const A=to(Ls(0,y.idbdb,p),y._dbSchema);return!(A.add.length||A.change.some(w=>w.add.length||w.change.length))}(e,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ss(e,g)}catch{}var m;Gt.push(e),f.onversionchange=V(g=>{t.vcFired=!0,e.on("versionchange").fire(g)}),f.onclose=V(g=>{e.on("close").fire(g)}),l&&function({indexedDB:g,IDBKeyRange:y},p){!sn(g)&&p!=="__dbnames"&&rn(g,y).put({name:p}).catch(K)}(e._deps,u),a()},c)}))]).then(()=>(n(),t.onReadyBeingFired=[],x.resolve(Bs(()=>e.on.ready.fire(e.vip))).then(function a(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(Js,K);return t.onReadyBeingFired=[],x.resolve(Bs(()=>c(e.vip))).then(a)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(a=>{t.dbOpenError=a;try{o&&o.abort()}catch{}return s===t.openCanceller&&e._close(),X(a)}).finally(()=>{t.openComplete=!0,i()})}function Ps(e){var t=i=>e.next(i),r=n(t),s=n(i=>e.throw(i));function n(i){return o=>{var l=i(o),a=l.value;return l.done?a:a&&typeof a.then=="function"?a.then(r,s):$(a)?Promise.all(a).then(r,s):r(a)}}return n(t)()}function kd(e,t,r){var s=arguments.length;if(s<2)throw new B.InvalidArgument("Too few arguments");for(var n=new Array(s-1);--s;)n[s-1]=arguments[s];r=n.pop();var i=Gi(n);return[e,i,r]}function ro(e,t,r,s,n){return x.resolve().then(()=>{const i=N.transless||N,o=e._createTransaction(t,r,e._dbSchema,s),l={trans:o,transless:i};if(s)o.idbtrans=s.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(d){return d.name===Hs.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>ro(e,t,r,null,n))):X(d)}const a=Xs(n);let c;a&&pt();const u=x.follow(()=>{if(c=n.call(o,o),c)if(a){var d=be.bind(null,null);c.then(d,d)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Ps(c))},l);return(c&&typeof c.then=="function"?x.resolve(c).then(d=>o.active?d:X(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(d=>(s&&o._resolve(),o._completion.then(()=>d))).catch(d=>(o._reject(d),X(d)))})}function ir(e,t,r){const s=$(e)?e.slice():[e];for(let n=0;n<r;++n)s.push(t);return s}const _d={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:s}=r,n={},i=[];function o(u,d,f){const h=Ft(u),m=n[h]=n[h]||[],g=u==null?0:typeof u=="string"?1:u.length,y=d>0,p={...f,isVirtual:y,keyTail:d,keyLength:g,extractKey:Cs(u),unique:!y&&f.unique};return m.push(p),p.isPrimaryKey||i.push(p),g>1&&o(g===2?u[0]:u.slice(0,g-1),d+1,f),m.sort((A,w)=>A.keyTail-w.keyTail),p}const l=o(s.primaryKey.keyPath,0,s.primaryKey);n[":id"]=[l];for(const u of s.indexes)o(u.keyPath,0,u);function a(u){const d=u.query.index;return d.isVirtual?{...u,query:{index:d,range:(f=u.query.range,h=d.keyTail,{type:f.type===1?2:f.type,lower:ir(f.lower,f.lowerOpen?e.MAX_KEY:e.MIN_KEY,h),lowerOpen:!0,upper:ir(f.upper,f.upperOpen?e.MIN_KEY:e.MAX_KEY,h),upperOpen:!0})}}:u;var f,h}return{...r,schema:{...s,primaryKey:l,indexes:i,getIndexByKeyPath:function(u){const d=n[Ft(u)];return d&&d[0]}},count:u=>r.count(a(u)),query:u=>r.query(a(u)),openCursor(u){const{keyTail:d,isVirtual:f,keyLength:h}=u.query.index;return f?r.openCursor(a(u)).then(m=>m&&function(g){return Object.create(g,{continue:{value:function(p){p!=null?g.continue(ir(p,u.reverse?e.MAX_KEY:e.MIN_KEY,d)):u.unique?g.continue(g.key.slice(0,h).concat(u.reverse?e.MIN_KEY:e.MAX_KEY,d)):g.continue()}},continuePrimaryKey:{value(p,A){g.continuePrimaryKey(ir(p,e.MAX_KEY,d),A)}},primaryKey:{get:()=>g.primaryKey},key:{get(){const p=g.key;return h===1?p[0]:p.slice(0,h)}},value:{get:()=>g.value}})}(m)):r.openCursor(u)}}}}}};function nn(e,t,r,s){return r=r||{},s=s||"",Z(e).forEach(n=>{if(oe(t,n)){var i=e[n],o=t[n];if(typeof i=="object"&&typeof o=="object"&&i&&o){const l=ps(i);l!==ps(o)?r[s+n]=t[n]:l==="Object"?nn(i,o,r,s+n+"."):i!==o&&(r[s+n]=t[n])}else i!==o&&(r[s+n]=t[n])}else r[s+n]=void 0}),Z(t).forEach(n=>{oe(e,n)||(r[s+n]=t[n])}),r}const Id={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:s}=r.schema;return{...r,mutate(i){const o=N.trans,{deleting:l,creating:a,updating:c}=o.table(t).hook;switch(i.type){case"add":if(a.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"put":if(a.fire===K&&c.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"delete":if(l.fire===K)break;return o._promise("readwrite",()=>u(i),!0);case"deleteRange":if(l.fire===K)break;return o._promise("readwrite",()=>function(f){return d(f.trans,f.range,1e4)}(i),!0)}return r.mutate(i);function u(f){const h=N.trans,m=f.keys||function(g,y){return y.type==="delete"?y.keys:y.keys||y.values.map(g.extractKey)}(s,f);if(!m)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:m}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(g,y,p){return y.type==="add"?Promise.resolve([]):g.getMany({trans:y.trans,keys:p,cache:"immutable"})}(r,f,m).then(g=>{const y=m.map((p,A)=>{const w=g[A],k={onerror:null,onsuccess:null};if(f.type==="delete")l.fire.call(k,p,w,h);else if(f.type==="add"||w===void 0){const b=a.fire.call(k,p,f.values[A],h);p==null&&b!=null&&(p=b,f.keys[A]=p,s.outbound||ce(f.values[A],s.keyPath,p))}else{const b=nn(w,f.values[A]),E=c.fire.call(k,b,p,w,h);if(E){const _=f.values[A];Object.keys(E).forEach(P=>{oe(_,P)?_[P]=E[P]:ce(_,P,E[P])})}}return k});return r.mutate(f).then(({failures:p,results:A,numFailures:w,lastResult:k})=>{for(let b=0;b<m.length;++b){const E=A?A[b]:m[b],_=y[b];E==null?_.onerror&&_.onerror(p[b]):_.onsuccess&&_.onsuccess(f.type==="put"&&g[b]?f.values[b]:E)}return{failures:p,results:A,numFailures:w,lastResult:k}}).catch(p=>(y.forEach(A=>A.onerror&&A.onerror(p)),Promise.reject(p)))})}function d(f,h,m){return r.query({trans:f,values:!1,query:{index:s,range:h},limit:m}).then(({result:g})=>u({type:"delete",keys:g,trans:f}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):g.length<m?{failures:[],numFailures:0,lastResult:void 0}:d(f,{...h,lower:g[g.length-1],lowerOpen:!0},m)))}}}}})};function so(e,t,r){try{if(!t||t.keys.length<e.length)return null;const s=[];for(let n=0,i=0;n<t.keys.length&&i<e.length;++n)te(t.keys[n],e[i])===0&&(s.push(r?Yt(t.values[n]):t.values[n]),++i);return s.length===e.length?s:null}catch{return null}}const xd={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:s=>{if(!s.cache)return r.getMany(s);const n=so(s.keys,s.trans._cache,s.cache==="clone");return n?x.resolve(n):r.getMany(s).then(i=>(s.trans._cache={keys:s.keys,values:s.cache==="clone"?Yt(i):i},i))},mutate:s=>(s.type!=="add"&&(s.trans._cache=null),r.mutate(s))}}})};function on(e){return!("from"in e)}const me=function(e,t){if(!this){const r=new me;return e&&"d"in e&&re(r,e),r}re(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Zt(e,t,r){const s=te(t,r);if(isNaN(s))return;if(s>0)throw RangeError();if(on(e))return re(e,{from:t,to:r,d:1});const n=e.l,i=e.r;if(te(r,e.from)<0)return n?Zt(n,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Zn(e);if(te(t,e.to)>0)return i?Zt(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Zn(e);te(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),te(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;n&&!e.l&&Tr(e,n),i&&o&&Tr(e,i)}function Tr(e,t){on(t)||function r(s,{from:n,to:i,l:o,r:l}){Zt(s,n,i),o&&r(s,o),l&&r(s,l)}(e,t)}function Cd(e,t){const r=Gs(t);let s=r.next();if(s.done)return!1;let n=s.value;const i=Gs(e);let o=i.next(n.from),l=o.value;for(;!s.done&&!o.done;){if(te(l.from,n.to)<=0&&te(l.to,n.from)>=0)return!0;te(n.from,l.from)<0?n=(s=r.next(l.from)).value:l=(o=i.next(n.from)).value}return!1}function Gs(e){let t=on(e)?null:{s:0,n:e};return{next(r){const s=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&te(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||te(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Zn(e){var t,r;const s=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),n=s>1?"r":s<-1?"l":"";if(n){const i=n==="r"?"l":"r",o={...e},l=e[n];e.from=l.from,e.to=l.to,e[n]=l[n],o[n]=l[i],e[i]=o,o.d=qn(o)}e.d=qn(e)}function qn({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}ft(me.prototype,{add(e){return Tr(this,e),this},addKey(e){return Zt(this,e,e),this},addKeys(e){return e.forEach(t=>Zt(this,t,t)),this},[gs](){return Gs(this)}});const Sd={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new me(e.MIN_KEY,e.MAX_KEY);return{...e,table:s=>{const n=e.table(s),{schema:i}=n,{primaryKey:o}=i,{extractKey:l,outbound:a}=o,c={...n,mutate:f=>{const h=f.trans,m=h.mutatedParts||(h.mutatedParts={}),g=E=>{const _=`idb://${t}/${s}/${E}`;return m[_]||(m[_]=new me)},y=g(""),p=g(":dels"),{type:A}=f;let[w,k]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const b=f.trans._cache;return n.mutate(f).then(E=>{if($(w)){A!=="delete"&&(w=E.results),y.addKeys(w);const _=so(w,b);_||A==="add"||p.addKeys(w),(_||k)&&function(P,C,F,R){function q(z){const M=P(z.name||"");function Ee(Y){return Y!=null?z.extractKey(Y):null}const ue=Y=>z.multiEntry&&$(Y)?Y.forEach(Oe=>M.addKey(Oe)):M.addKey(Y);(F||R).forEach((Y,Oe)=>{const mt=F&&Ee(F[Oe]),Rr=R&&Ee(R[Oe]);te(mt,Rr)!==0&&(mt!=null&&ue(mt),Rr!=null&&ue(Rr))})}C.indexes.forEach(q)}(g,i,_,k)}else if(w){const _={from:w.lower,to:w.upper};p.add(_),y.add(_)}else y.add(r),p.add(r),i.indexes.forEach(_=>g(_.name).add(r));return E})}},u=({query:{index:f,range:h}})=>{var m,g;return[f,new me((m=h.lower)!==null&&m!==void 0?m:e.MIN_KEY,(g=h.upper)!==null&&g!==void 0?g:e.MAX_KEY)]},d={get:f=>[o,new me(f.key)],getMany:f=>[o,new me().addKeys(f.keys)],count:u,query:u,openCursor:u};return Z(d).forEach(f=>{c[f]=function(h){const{subscr:m}=N;if(m){const g=k=>{const b=`idb://${t}/${s}/${k}`;return m[b]||(m[b]=new me)},y=g(""),p=g(":dels"),[A,w]=d[f](h);if(g(A.name||"").add(w),!A.isPrimaryKey){if(f!=="count"){const k=f==="query"&&a&&h.values&&n.query({...h,values:!1});return n[f].apply(this,arguments).then(b=>{if(f==="query"){if(a&&h.values)return k.then(({result:_})=>(y.addKeys(_),b));const E=h.values?b.result.map(l):b.result;h.values?y.addKeys(E):p.addKeys(E)}else if(f==="openCursor"){const E=b,_=h.values;return E&&Object.create(E,{key:{get:()=>(p.addKey(E.primaryKey),E.key)},primaryKey:{get(){const P=E.primaryKey;return p.addKey(P),P}},value:{get:()=>(_&&y.addKey(E.primaryKey),E.value)}})}return b})}p.add(r)}}return n[f].apply(this,arguments)}}),c}}}};class Ye{constructor(t,r){this._middlewares={},this.verno=0;const s=Ye.dependencies;this._options=r={addons:Ye.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:n}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:K,dbReadyPromise:null,cancelOpen:K,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new x(l=>{i.dbReadyResolve=l}),i.openCanceller=new x((l,a)=>{i.cancelOpen=a}),this._state=i,this.name=t,this.on=Rt(this,"populate","blocked","versionchange","close",{ready:[Js,K]}),this.on.ready.subscribe=Li(this.on.ready.subscribe,l=>(a,c)=>{Ye.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||x.resolve().then(a),c&&l(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),c&&l(a);else{l(a);const d=this;c||l(function f(){d.on.ready.unsubscribe(a),d.on.ready.unsubscribe(f)})}})}),this.Collection=(o=this,wt(dd.prototype,function(l,a){this.db=o;let c=ji,u=null;if(a)try{c=a()}catch(m){u=m}const d=l._ctx,f=d.table,h=f.hook.reading.fire;this._ctx={table:f,index:d.index,isPrimKey:!d.index||f.schema.primKey.keyPath&&d.index===f.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:d.or,valueMapper:h!==Vt?h:null}})),this.Table=function(l){return wt(ud.prototype,function(a,c,u){this.db=l,this._tx=u,this.name=a,this.schema=c,this.hook=l._allTables[a]?l._allTables[a].hook:Rt(null,{creating:[Ju,K],reading:[Hu,Vt],updating:[ed,K],deleting:[$u,K]})})}(this),this.Transaction=function(l){return wt(gd.prototype,function(a,c,u,d,f){this.db=l,this.mode=a,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Rt(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new x((h,m)=>{this._resolve=h,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var m=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):m&&this.idbtrans&&this.idbtrans.abort(),X(h)})})}(this),this.Version=function(l){return wt(wd.prototype,function(a){this.db=l,this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return wt(Ji.prototype,function(a,c,u){this.db=l,this._ctx={table:a,index:c===":id"?null:c,or:u};const d=l._deps.indexedDB;if(!d)throw new B.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(f,h)=>d.cmp(h,f),this._max=(f,h)=>d.cmp(f,h)>0?f:h,this._min=(f,h)=>d.cmp(f,h)<0?f:h,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Dt(r.IDBKeyRange),this._createTransaction=(l,a,c,u)=>new this.Transaction(l,a,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=l=>{this.on("blocked").fire(l),Gt.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(l))},this.use(_d),this.use(Id),this.use(Sd),this.use(xd),this.vip=Object.create(this,{_vip:{value:!0}}),n.forEach(l=>l(this))}version(t){if(isNaN(t)||t<.1)throw new B.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var s=r.filter(n=>n._cfg.version===t)[0];return s||(s=new this.Version(t),r.push(s),r.sort(Ad),s.stores({}),this._state.autoSchema=!1,s)}_whenReady(t){return this.idbdb&&(this._state.openComplete||N.letThrough||this._vip)?t():new x((r,s)=>{if(this._state.openComplete)return s(new B.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void s(new B.DatabaseClosed);this.open().catch(K)}this._state.dbReadyPromise.then(r,s)}).then(t)}use({stack:t,create:r,level:s,name:n}){n&&this.unuse({stack:t,name:n});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:r,level:s??10,name:n}),i.sort((o,l)=>o.level-l.level),this}unuse({stack:t,name:r,create:s}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(n=>s?n.create!==s:!!r&&n.name!==r)),this}open(){return Ed(this)}_close(){const t=this._state,r=Gt.indexOf(this);if(r>=0&&Gt.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new x(s=>{t.dbReadyResolve=s}),t.openCanceller=new x((s,n)=>{t.cancelOpen=n})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new B.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new x((s,n)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=V(()=>{(function({indexedDB:l,IDBKeyRange:a},c){!sn(l)&&c!=="__dbnames"&&rn(l,a).delete(c).catch(K)})(this._deps,this.name),s()}),o.onerror=fe(n),o.onblocked=this._fireOnBlocked};if(t)throw new B.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Z(this._allTables).map(t=>this._allTables[t])}transaction(){const t=kd.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,s){let n=N.trans;n&&n.db===this&&t.indexOf("!")===-1||(n=null);const i=t.indexOf("?")!==-1;let o,l;t=t.replace("!","").replace("?","");try{if(l=r.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),t=="r"||t==="readonly")o="readonly";else{if(t!="rw"&&t!="readwrite")throw new B.InvalidArgument("Invalid transaction mode: "+t);o="readwrite"}if(n){if(n.mode==="readonly"&&o==="readwrite"){if(!i)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&l.forEach(c=>{if(n&&n.storeNames.indexOf(c)===-1){if(!i)throw new B.SubTransaction("Table "+c+" not included in parent transaction.");n=null}}),i&&n&&!n.active&&(n=null)}}catch(c){return n?n._promise(null,(u,d)=>{d(c)}):X(c)}const a=ro.bind(null,this,o,l,n,s);return n?n._promise(o,a,"lock"):N.trans?gt(N.transless,()=>this._whenReady(a)):this._whenReady(a)}table(t){if(!oe(this._allTables,t))throw new B.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Nd=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Td{constructor(t){this._subscribe=t}subscribe(t,r,s){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:s})}[Nd](){return this}}function no(e,t){return Z(t).forEach(r=>{Tr(e[r]||(e[r]=new me),t[r])}),e}function Ld(e){return new Td(t=>{const r=Xs(e);let s=!1,n={},i={};const o={get closed(){return s},unsubscribe:()=>{s=!0,Te.storagemutated.unsubscribe(u)}};t.start&&t.start(o);let l=!1,a=!1;function c(){return Z(i).some(f=>n[f]&&Cd(n[f],i[f]))}const u=f=>{no(n,f),c()&&d()},d=()=>{if(l||s)return;n={};const f={},h=function(m){r&&pt();const g=()=>Se(e,{subscr:m,trans:null}),y=N.trans?gt(N.transless,g):g();return r&&y.then(be,be),y}(f);a||(Te("storagemutated",u),a=!0),l=!0,Promise.resolve(h).then(m=>{l=!1,s||(c()?d():(n={},i=f,t.next&&t.next(m)))},m=>{l=!1,t.error&&t.error(m),o.unsubscribe()})};return d(),o})}let Rs;try{Rs={indexedDB:Q.indexedDB||Q.mozIndexedDB||Q.webkitIndexedDB||Q.msIndexedDB,IDBKeyRange:Q.IDBKeyRange||Q.webkitIDBKeyRange}}catch{Rs={indexedDB:null,IDBKeyRange:null}}const Be=Ye;function vr(e){let t=Ae;try{Ae=!0,Te.storagemutated.fire(e)}finally{Ae=t}}ft(Be,{...hr,delete:e=>new Be(e,{addons:[]}).delete(),exists:e=>new Be(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:r}){return sn(t)?Promise.resolve(t.databases()).then(s=>s.map(n=>n.name).filter(n=>n!=="__dbnames")):rn(t,r).toCollection().primaryKeys()}(Be.dependencies).then(e)}catch{return X(new B.MissingAPI)}},defineClass:()=>function(e){re(this,e)},ignoreTransaction:e=>N.trans?gt(N.transless,e):e(),vip:Bs,async:function(e){return function(){try{var t=Ps(e.apply(this,arguments));return t&&typeof t.then=="function"?t:x.resolve(t)}catch(r){return X(r)}}},spawn:function(e,t,r){try{var s=Ps(e.apply(r,t||[]));return s&&typeof s.then=="function"?s:x.resolve(s)}catch(n){return X(n)}},currentTransaction:{get:()=>N.trans||null},waitFor:function(e,t){const r=x.resolve(typeof e=="function"?Be.ignoreTransaction(e):e).timeout(t||6e4);return N.trans?N.trans.waitFor(r):r},Promise:x,debug:{get:()=>he,set:e=>{Fi(e,e==="dexie"?()=>!0:Xi)}},derive:at,extend:re,props:ft,override:Li,Events:Rt,on:Te,liveQuery:Ld,extendObservabilitySet:no,getByKeyPath:we,setByKeyPath:ce,delByKeyPath:function(e,t){typeof t=="string"?ce(e,t,void 0):"length"in t&&[].map.call(t,function(r){ce(e,r,void 0)})},shallowClone:Pi,deepClone:Yt,getObjectDiff:nn,cmp:te,asap:Oi,minKey:-(1/0),addons:[],connections:Gt,errnames:Hs,dependencies:Rs,semVer:"3.2.3",version:"3.2.3".split(".").map(e=>parseInt(e)).reduce((e,t,r)=>e+t/Math.pow(10,2*r))}),Be.maxKey=Dt(Be.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Te("storagemutated",e=>{if(!Ae){let t;Pr?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Ae=!0,dispatchEvent(t),Ae=!1}}),addEventListener("x-storagemutated-1",({detail:e})=>{Ae||vr(e)}));let Ae=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel("x-storagemutated-1");typeof e.unref=="function"&&e.unref(),Te("storagemutated",t=>{Ae||e.postMessage(t)}),e.onmessage=t=>{t.data&&vr(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Te("storagemutated",t=>{try{Ae||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key==="x-storagemutated-1"){const r=JSON.parse(t.newValue);r&&vr(r.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type==="x-storagemutated-1"&&vr(t.changedParts)})}x.rejectionMapper=function(e,t){if(!e||e instanceof lt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Kn[e.name])return e;var r=new Kn[e.name](t||e.message,e);return"stack"in e&&ve(r,"stack",{get:function(){return this.inner.stack}}),r},Fi(he,Xi);class Od extends Ye{constructor(){super("nr-editor");v(this,"catalogues");v(this,"systems");this.version(5).stores({catalogues:"id, content.catalogue.id, content.catalogue.gameSystemId",systems:"id"})}}const Ke=new Od;function sf(e){const t=/^(?:(http(s?)?:\/\/)?github.com\/)?([^\/]+)\/([^\/]+)$/,r=e.match(t);if(!r)return null;const[,s="https://",n,i,o]=r;return!i||!o?null:`https://github.com/${i}/${o}`}function io(e){const t=/^(?:https?:\/\/)?(?:www\.)?github\.com\/([^/]+)\/([^/]+)(?:\/)?$/,r=e.match(t);if(!r)throw new Error("Invalid GitHub URL format: "+e);const[,s,n]=r;return{githubUrl:e,githubRepo:`${s}/${n}`,githubOwner:s,githubName:n}}const Bd="https://github.com/octocat/hello-world",Pd=io(Bd);console.log(Pd);async function Yn(e,t){try{const r=e.split("/"),s=r[r.length-2],n=r[r.length-1].replace(".git",""),i=`https://api.github.com/repos/${s}/${n}/contents/${encodeURIComponent(t)}`;console.log(`Querying github api at ${i}`);const o=await $fetch(i,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});if(!o||!(o!=null&&o.download_url))throw new Error("No download_url found");console.log(`Downloading file at ${o==null?void 0:o.download_url}`);const l=await $fetch(o.download_url,{headers:{"User-Agent":"New Recruit Data Editor (Electron)",Accept:"application/vnd.github.v3+json"}});return console.log(`Downloaded file, length: ${l.length}`),l}catch(r){throw r}}async function Gd(e,t,r){try{return await Yn(e,t)}catch(s){if(!r)throw s;return await Yn(e,r)}}async function Rd(e,t){if(t.fullFilePath)try{const r=Ci(t.fullFilePath),s=r.endsWith("z")?ei(r,"z"):void 0,n=await Gd(e.githubUrl,r,s),i=/revision="(\d+)"/,o=n.match(i);if(o){const l=(Number(o[1])||0)+1;return console.log(`Revision of ${t.name}: ${t.revision} -> ${l}`),l}}catch(r){console.error(r)}return t.revision||1}function Xn(e,t){if(e)return e[t]||e["*"]}async function Lr(e,t,r,s){if(!t.catalogue&&!t.gameSystem)throw Error("invalid loadBsData argument: no .catalogue or .gameSystem in data");const n=t.catalogue?"catalogue":"gameSystem",i=n==="gameSystem",o=n==="catalogue",l=t[n],a=l;if(a.loaded||a.loaded_editor)return a;Et(l);const c=fs(l,n);if(c.manager=e,o){const d={targetId:c.gameSystemId},f=e.getLoadedCatalogue(d,r);if(f)c.gameSystem=f;else{const h=await e.getData(d,r),m=e.getLoadedCatalogue(d,r);m?c.gameSystem=m:c.gameSystem=await Lr(e,h,r)}}const u=[];for(const d of(c==null?void 0:c.catalogueLinks)||[]){if(!d.targetId){console.warn(`invalid link: no targetId in link: ${d}, found in ${l.name}`);continue}if(d.targetId===c.id){d.target=c;continue}const f=e.getLoadedCatalogue(d,r);if(f){d.target=f;continue}const h=e.getData(d,r).then(m=>{const g=e.getLoadedCatalogue(d,r);if(g){d.target=g;return}return Lr(e,m,r).then(y=>d.target=y)});u.push(h)}return await Promise.all(u),i&&e.addLoadedSystem(c),o&&e.addLoadedCatalogue(c),c}class Fd{constructor(){v(this,"catalogues",{});v(this,"unresolvedLinks");v(this,"settings")}async getData(t,r){throw new Error("Method not implemented.")}getCatalogueInfo(t){}findOptionById(t){}getLoadedCatalogue(t,r){const s=typeof t=="string"?t:t.targetId||t.name,n=Xn(r,s)||"default",i=this.catalogues[s];return i?i[n]:void 0}addLoadedCatalogue(t,r){const s=Xn(r,t.id)||"default";this.catalogues[t.name]||(this.catalogues[t.name]={}),this.catalogues[t.id]||(this.catalogues[t.id]={}),this.catalogues[t.name][s]=t,this.catalogues[t.id][s]=t}addLoadedSystem(t,r){return this.addLoadedCatalogue(t,r)}unloadAll(){this.catalogues={}}async loadData(t,r){const s=await Lr(this,t,r);return s.process(),s}async loadCatalogue(t,r,s){const n=this.getLoadedCatalogue(t,r);if(n&&!s)return n;const i=await this.getData(t,r);if(i)return await this.loadData(i,r);throw Error(`Couldn't load catalogue: couldn't getData ${t}`)}}class jn extends Fd{constructor(){super(...arguments);v(this,"gameSystem",null);v(this,"catalogueFiles",Yl());v(this,"allLoaded");v(this,"loadedCatalogues",{});v(this,"github");v(this,"unresolvedLinks",{});v(this,"index",{})}async loadData(r,s){return await Lr(this,r,s)}findOptionById(r){for(const s of Object.values(this.loadedCatalogues))if(s.index&&s.index[r])return s.index[r]}unloadAll(){super.unloadAll(),this.loadedCatalogues={};for(const r of this.getAllCatalogueFiles()){const s=ge(r);delete s.loaded,delete s.loaded_editor}delete this.allLoaded}async loadAll(r){var i,o;let s=Object.values(this.catalogueFiles).length+1,n=0;if(this.allLoaded||console.log("Loading all catalogues in",(o=(i=this.gameSystem)==null?void 0:i.gameSystem)==null?void 0:o.name),this.gameSystem){r&&await r(n,s,`Loading ${this.gameSystem.gameSystem.name}`),(await this.loadCatalogue({targetId:this.gameSystem.gameSystem.id})).processForEditor(),n++;for(const a of Object.values(this.catalogueFiles))r&&await r(n,s,`Loading ${a.catalogue.name}`),(await this.loadCatalogue({targetId:a.catalogue.id})).processForEditor(),n++,r&&await r(n,s,`Loading ${a.catalogue.name}`)}this.allLoaded=!0}getLoadedCatalogue(r,s){const n=r.targetId||r.name;return this.loadedCatalogues[n]}addLoadedCatalogue(r,s){this.loadedCatalogues[r.id]=r}getAllLoadedCatalogues(){var s;return((s=this.gameSystem)==null?void 0:s.gameSystem.id)?Object.values(this.loadedCatalogues):[]}getId(){var r;return(r=this.gameSystem)==null?void 0:r.gameSystem.id}getCatalogueInfo(r){var s,n;if(((s=this.gameSystem)==null?void 0:s.gameSystem.id)===r.targetId)return(n=this.gameSystem)==null?void 0:n.gameSystem;for(const i of Object.values(this.catalogueFiles))if(i.catalogue.id===r.targetId)return i.catalogue}getAllCatalogueFiles(){return[...this.gameSystem?[this.gameSystem]:[],...Object.values(this.catalogueFiles)]}setSystem(r){this.gameSystem=r}setCatalogue(r){const s=r.catalogue.id;this.catalogueFiles[s]=r}removeCatalogue(r){for(const[s,n]of Object.entries(this.catalogueFiles))n.catalogue.id===r.catalogue.id&&delete this.catalogueFiles[s]}async getData(r,s){var l;if(r.targetId==((l=this.gameSystem)==null?void 0:l.gameSystem.id))return this.gameSystem;if(r.targetId in this.catalogueFiles)return this.catalogueFiles[r.targetId];const n=await Ke.catalogues.get({"content.catalogue.id":r.targetId});if(n)return n.content;const i=await Ke.systems.get(r.targetId);if(i)return i.content;const o=r.name?`name ${r.name}`:`id ${r.targetId}`;throw Error(`Couldn't import catalogue with ${o}, perhaps it wasnt uploaded?`)}}const Kd=!1;function ae(e){return e.vnode}function Ue(e){const t=e.$parent;if(t.item)return t.item;const r=t.$parent;return r.item?r.item:r.$parent.item}function Ud(e){e.isSaving=!0}function Md(e){if(e.isSaving){e.isSaving=!1;return}e.isChangedOnDisk=!0}function Qd(e){e.isChangedOnDisk&&(e.isChangedOnDisk=!1),e.isSaving===void 0&&(e.isSaving=!1)}const es=new Set(["select","showInEditor","showChildsInEditor"]),Gr=Fs("editor",{state:()=>({selections:[],selectedElementGroup:null,selectedElement:null,selectedItem:null,filter:"",filterRegex:RegExp(""),filtered:[],undoStack:[],undoStackPos:-1,historyStack:[],historyStackPos:0,clipboard:[],mode:"edit",clipboardmode:"json",gameSystems:{},gameSystemsLoaded:!1,unsavedChanges:{},unsavedCount:0}),actions:{async create_system(e,t,r){console.log("Creating system with name:",e);const s=`sys-${It()}`,n=this.get_system(s),i=t?`${ei(t.replaceAll("\\","/"),"/")}/${e}`:"";if(electron){if(!i)throw new Error("No folder specified");ec(i)}const o={gameSystem:{id:s,name:e,battleScribeVersion:"2.03",revision:1,categoryEntries:[{name:"Default Category",id:"default-category"}],forceEntries:[{name:"Default Force",hidden:!1,id:"default-force",categoryLinks:[{name:"Default Category",hidden:!1,id:"default-force-category-link",targetId:"default-category"}]}],selectionEntries:[{type:"upgrade",import:!0,name:"Default Root Entry",hidden:!1,id:"default-entry",categoryLinks:[{targetId:"default-category",id:"default-category-link",primary:!0,name:"Default Category",hidden:!1}]}]}};return i&&(o.gameSystem.fullFilePath=`${i}/${e}.${r||"gst"}`),n.setSystem(o),this.get_catalogue_state(o).incremented=!0,this.saveCatalogue(o),n},saveCatalogueInDb(e){const t=as(e);!!!e.gameSystemId?Ke.systems.put({content:JSON.parse(t),path:e.fullFilePath,id:e.id}):Ke.catalogues.put({content:JSON.parse(t),path:e.fullFilePath,id:`${e.gameSystemId}-${e.id}`})},async saveCatalogueInFiles(e){const t=e.fullFilePath;if(!t){console.error(`No path included in the catalogue ${e.name} to save at`);return}const r=Br(t);if(t.endsWith(".json")){const s=as(e);await Pn(t,s)}else{const s=Ql(e),n=bi(r),o=Ci(t).replace(".gstz",".gst").replace(".catz",".cat"),l=n?await _o(o,s,"uint8array"):s;await Pn(t,l)}},saveCatalogue(e){const t=this.get_catalogue_state(e),r=ge(e);Ud(t),electron?this.saveCatalogueInFiles(r):this.saveCatalogueInDb(r),Qd(t)},async load_systems_from_folder(e,t){var l,a;if(!globalThis.electron)throw new Error("Not running in electron");const r=await $l(e);if(!(r!=null&&r.length))return;console.log("Loading",r.length,"files",r);const s=[],n=[],i=[],o=r.filter(c=>Gl(c.name));for(const c of o){t&&await t(n.length,o.length,c.path);const u=await Rl(c.data,c.name.endsWith("json")?"json":"xml"),d=(l=u==null?void 0:u.gameSystem)==null?void 0:l.id,f=(a=u==null?void 0:u.catalogue)==null?void 0:a.id,h=ge(u);if(h.fullFilePath=c.path.replaceAll("\\","/"),d){const m=this.get_system(d);m.setSystem(cn(u)),i.push(m),s.push(d)}if(f){const m=this.get_system(u.catalogue.gameSystemId);m.catalogueFiles[f]=cn(u)}n.push(u)}t&&await t(n.length,o.length);for(const c of i)t&&await t(0,0,"Checking for github integration"),await this.load_system(c);return s},async load_systems_from_db(e=!1){if(!this.gameSystemsLoaded&&!e){this.gameSystemsLoaded=!0;let t=await Ke.systems.offset(0).keys();for(let r of t)r in this.gameSystems||this.load_system_from_db(r)}},async load_system_from_db(e){const t=await Ke.systems.get(e),r=t==null?void 0:t.content;if(!r)throw new Error("System not found "+e);r.gameSystem.fullFilePath||(r.gameSystem.fullFilePath=t.path);const s=await Ke.catalogues.where({"content.catalogue.gameSystemId":e}),n=this.get_system(r.gameSystem.id);n.setSystem(r);for(let{content:i,path:o}of await s.toArray()){const l=i.catalogue.id;i.catalogue.fullFilePath||(i.catalogue.fullFilePath=o),n.catalogueFiles[l]=Io(i)}this.load_system(n,!0)},async load_system(e,t=!1){var r,s;if(e.gameSystem){const n=Bn();if(await e.unloadAll(),!t)for(const a of e.getAllCatalogueFiles()){const c=this.get_catalogue_state(a);c&&(c.changed=!1,c.unsaved=!1,c.isChangedOnDisk=!1),n.updateCatalogue(ge(a)),n.setEdited(ge(a).id,!1)}const i=e.gameSystem.gameSystem.publications,o=i==null?void 0:i.find(a=>{var c;return((c=a.name)==null?void 0:c.trim().toLowerCase())==="github"}),l=e.gameSystem.gameSystem.fullFilePath;if(l&&Kd)try{const a=await rc(xi(l));a&&a!=="origin"&&(console.log("remote:",a),e.github={...io(a),discovered:!0})}catch(a){console.error(a)}o&&o.publisherUrl&&(e.github={githubUrl:o.publisherUrl},o.shortName&&o.shortName.includes("/")&&(e.github.githubRepo=o.shortName,e.github.githubOwner=(r=o.shortName)==null?void 0:r.split("/")[0],e.github.githubName=(s=o.shortName)==null?void 0:s.split("/")[1]))}for(const n of e.getAllCatalogueFiles()){const i=ge(n);i.fullFilePath&&tc(i.fullFilePath,()=>{this.on_file_changed(n)})}},on_file_changed(e){console.log(ge(e).name,"changed"),Md(this.get_catalogue_state(e))},async get_or_load_system(e){return e in this.gameSystems||(this.gameSystems[e]=new jn,await this.load_system_from_db(e)),this.gameSystems[e]},get_system(e){if(!(e in this.gameSystems)){const t=new jn;t.settings=xt(),this.gameSystems[e]=t}return this.gameSystems[e]},delete_system(e){delete this.gameSystems[e]},get_catalogue_state(e){const t=un(e);return this.unsavedChanges[t]||(this.unsavedChanges[t]={changed:!1,unsaved:!1}),this.unsavedChanges[t]},set_catalogue_changed(e,t=!0){const r=this.get_catalogue_state(e);t?(r.changed=!0,r.unsaved||(this.unsavedCount+=1,r.unsaved=t)):r.unsaved=t},async save_catalogue(e,t,r){const s=this.get_catalogue_state(t),n=t.revision;r==="github"&&e.github&&(t.revision=await Rd(e.github,t)),r==="yes"&&!(s!=null&&s.incremented)&&(t.revision=t.revision?t.revision+1:1,s.incremented=!0),r==="no"&&(s.incremented=!0),this.saveCatalogue(t);const i=Bn(),o=un(t);return i.updateCatalogue(t),i.setEdited(o,!0),s!=null&&s.unsaved&&(this.unsavedCount--,s.unsaved=!1),t.revision!==n},async prompt_revision(e){const t=xt(),r=e instanceof br?e.manager:e;for(const s of e instanceof br?[e]:r.getAllLoadedCatalogues()){const n=this.get_catalogue_state(s);if(n!=null&&n.unsaved&&!n.incremented)return r.github&&t.githubAutoIncrement&&!navigator.onLine?await(globalThis.customPrompt&&globalThis.customPrompt({html:`<span>Would you like to increase the revision of this catalogue?<span><br/>
    <span class="gray">Note: This is shown because Github cannot be accessed as your are offline</span>`,cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no":r.github&&t.githubAutoIncrement?"github":r.github?await(globalThis.customPrompt&&globalThis.customPrompt({html:"<span>Would you like to increase the revision of this catalogue?<span><br/>",cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no":await(globalThis.customPrompt&&globalThis.customPrompt({html:`<span>Would you like to increase the revision of this catalogue?<span><br/>
    <span class="gray">Note: You can enable automatic revision increments by integrating with GitHub.<br/>This can be achieved by adding a publication in the GameSystem named "GitHub" with the repository's GitHub URL as the Publication URL.`,cancel:"No",accept:"Yes",id:"revision"}))?"yes":"no"}},async save_all(e){var s,n,i;let t=!1,r=0;xt();try{for(const o of Object.values(this.gameSystems)){if(e&&((n=(s=o.gameSystem)==null?void 0:s.gameSystem)==null?void 0:n.id)!==e)continue;const l=await this.prompt_revision(o);for(const a of o.getAllLoadedCatalogues())(i=this.get_catalogue_state(a))!=null&&i.unsaved&&await this.save_catalogue(o,a,l)&&(r+=1)}}catch(o){notify({text:`Failed to save: ${o.name}: ${o.message}`,type:"error"}),t=!0}return r&&notify(`Incremented ${r} catalogue's revision`),t},set_filter(e){this.$state.filter=e,this.filterRegex=rs(e)},init(e){this.catalogueComponent=e,globalThis.$store=this,globalThis.$search=t=>{var r;return this.system_search((r=this.catalogueComponent)==null?void 0:r.systemFiles,{filter:t})}},rerender_catalogue(){this.catalogueComponent&&(this.catalogueComponent.key+=1)},unselect(e){const t=[],r=[];for(const s of this.selections)e===void 0||Ge(s.obj)===Ge(e)?r.push(s):t.push(s);this.selections=t;for(const s of r)s.onunselected&&s.onunselected(),s.obj===this.selectedItem&&(this.selectedItem=null)},is_selected(e){return this.selections.find(t=>t.obj===e)!==void 0},select(e,t,r){this.is_selected(e)||this.selections.push({obj:e,onunselected:t,payload:r})},do_select(e,t,r){const s=Array.isArray(r)?r:[r],n=this.selectedElementGroup,i=this.selectedElement;if(this.selectedElement=t,this.selectedElementGroup=r,e!=null&&e.shiftKey&&Ge(r)===Ge(n)){const o=s.findIndex(u=>u===Ge(i)),l=s.findIndex(u=>u===Ge(this.selectedElement)),a=Math.min(o,l),c=Math.max(o,l);for(let u=a;u<=c;u++)s[u].select();return}!(e!=null&&e.ctrlKey)&&!(e!=null&&e.metaKey)&&this.unselect(),e!=null&&e.ctrlKey&&this.is_selected(t)?this.unselect(t):(t.select(),this.selectedItem=t,this.mode="edit")},do_rightclick_select(e,t,r){this.is_selected(t)||this.do_select(e,t,r)},get_selections(){return this.selections.map(e=>Ue(e.obj))},get_selections_with_payload(){return this.selections.map(e=>({obj:Ue(e.obj),payload:e.payload}))},get_selected(){return this.selectedItem&&Ue(this.selectedItem)},async do_action(e,t,r){let s;try{s=await r()}catch(n){console.error(n);return}if(this.undoStackPos<this.undoStack.length){const n=this.undoStack.length-this.undoStackPos-1;this.undoStack.splice(this.undoStackPos+1,n,{type:e,undo:t,redo:r})}else this.undoStack.push({type:e,undo:t,redo:r});return this.undoStackPos+=1,s},async set_clipboard(e,t){if(this.clipboardmode==="json"){const r=e.map(n=>({parentKey:n.parentKey,...n})),s=Go(r,new Set(["parentKey"]),{forceArray:!1,formatted:!0});t!=null&&t.clipboardData?t.clipboardData.setData("text/plain",s):await navigator.clipboard.writeText(s)}else this.clipboard=e},async get_clipboard(e){if(this.clipboardmode==="json")if(e!=null&&e.clipboardData){const t=e.clipboardData.getData("text/plain");return t?JSON.parse(t):[]}else{const t=await navigator.clipboard.readText();return JSON.parse(t)}return this.clipboard},can_undo(){return!!this.undoStack[this.undoStackPos]},async undo(){if(!this.can_undo())return;const e=this.undoStack[this.undoStackPos];e&&(await e.undo(),this.undoStackPos--)},can_redo(){return!!this.undoStack[this.undoStackPos+1]},async redo(){if(!this.can_redo())return;const e=this.undoStack[this.undoStackPos+1];e&&(await e.redo(),this.undoStackPos++)},async cut(e){await this.set_clipboard(this.get_selections(),e),this.remove()},async copy(e){await this.set_clipboard(this.get_selections(),e)},async paste(e){this.add(await this.get_clipboard(e))},async duplicate(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let s=[];const n=async()=>{s=[];for(const o of e){const l=JSON.parse(cr(o,es));if(!o.parent)continue;const a=o.parent[o.parentKey];if(!Array.isArray(a))throw new Error(`Couldn't duplicate: parent[${o.parentKey}] is not an array`);Et({[o.parentKey]:l}),On(t,l),a.push(l),await vt(l,t,o.parent,this.get_system(r)),s.push(l)}},i=()=>{for(const o of s)Yr(t,_e(o)),Jt(o)};await this.do_action("dupe",i,n),this.set_catalogue_changed(t,!0)},async remove(){const e=this.get_selections();if(!e.length)return;const t=e[0].getCatalogue(),r=t.getSystemId();let s=[];for(const a of e)a.catalogue===t&&s.push(a);let n=[],i=[];const o=async()=>{const a=s,c=this.get_system(r);i=[],n=[];for(const u of a){const d=_e(u),f=Yr(t,d);i.push(f),n.push(d),await Jt(f,c)}i.reverse(),n.reverse()},l=async()=>{for(const[a,c]of xo(n,i)){const u=Ln(t,a,c);await vt(c,t,u,this.get_system(r))}};await this.do_action("remove",l,o),this.set_catalogue_changed(t,!0),this.unselect()},async add(e,t,r){let s=[];if(r?(r=Array.isArray(r)?r:[r],s=r.map(d=>({obj:d}))):s=this.get_selections_with_payload(),!s.length){console.error("Couldn't add: no selection or parent(s) provided");return}const n=Array.isArray(e)?e:[e];if(!n.length){console.error("Couldn't add: no data provided");return}const i=s[0].obj.getCatalogue(),o=i.getSystemId();let l=[];const a=async()=>{var d;l=[];for(const f of s){const h=f.obj,m=f.payload;await this.open(h,!0);for(const g of n){const y=Zl(h,t||g.parentKey,m);if(!y){console.warn("Couldn't create",t||g.parentKey,"in",m);continue}h[y]||(h[y]=[]);const p=h[y];if(!Array.isArray(p))continue;if(!((d=ki(h,h.parentKey))!=null&&d.has(y))){console.warn("Couldn't add",y,"to a",h.parentKey,"because it is not allowed");continue}const A=g instanceof W?cr(g,es):JSON.stringify(g),w=JSON.parse(A);Ei(w,y),delete w.parentKey,Et({[y]:w}),On(i,w),this.filtered.push(w),w.showChildsInEditor=!0;let k=w;for(;k;)k.showInEditor=!0,k=k.parent;p.push(w),await vt(w,i,h,this.get_system(o)),l.push(w)}}return l[0]},c=()=>{for(const d of l)Yr(i,_e(d)),Jt(d)},u=await this.do_action("add",c,a);return this.set_catalogue_changed(i,!0),u},open_selected(){for(const e of this.selections)e.obj.open()},get_initial_object(e,t){switch(e){case"costTypes":return{name:`New ${Re(xe(e))}`,defaultCostLimit:-1};case"repeats":return{value:1,repeats:1,field:"selections",scope:"parent",childId:"any",shared:!0,roundUp:!1};case"constraints":{const n=(t==null?void 0:t.parentKey)==="associations",i={type:"min",value:1,field:t!=null&&t.isForce()?"forces":"selections",scope:"parent",shared:!0};return n&&(i.childId="any"),i}case"conditions":return{type:"atLeast",value:1,field:"selections",scope:"parent",childId:"any",shared:!0};case"modifiers":return{type:"set",value:!0,field:"hidden"};case"modifierGroups":case"conditionGroups":return{type:"and"};case"sharedSelectionEntries":case"selectionEntries":return{type:"upgrade",import:!0,name:`New ${Re(xe(e))}`,hidden:!1};case"entryLinks":return{import:!0,name:`New ${Re(xe(e))}`,hidden:!1};case"associations":return{min:1,max:1,scope:"roster",includeChildSelections:!1,of:"any",ids:[],label:"Association",labelMembers:"Unit",hidden:!1};case"sharedProfiles":case"profiles":const r=t==null?void 0:t.catalogue.iterateProfileTypes().next().value;return{name:(!t||t!=null&&t.isCatalogue()||t==null?void 0:t.getName())||"New Profile",typeId:r==null?void 0:r.id,typeName:r==null?void 0:r.name,hidden:!1};case"catalogueLinks":return{type:"catalogue",name:`New ${Re(xe(e))}`};case"categoryLinks":return{type:"category",name:`New ${Re(xe(e))}`,hidden:!1};default:return{name:`New ${Re(xe(e))}`,hidden:!1}}},async create(e,t){const r={...this.get_initial_object(e),select:!0,...t};["modifiers","conditions","modifierGroups","conditionGroups"].includes(e)||(r.id=It()),await this.add(r,e),this.open_selected()},async create_child(e,t,r){const s={...this.get_initial_object(e,t),id:It(),select:!0,...r};await this.add(s,e,t),this.open_selected()},can_move(e){return!e.isLink()},get_move_targets(e){const t=e.catalogue;if(!t||e.isLink())return;const r=[];if(!e.parentKey.startsWith("shared")&&this.move_to_key(e,"shared")?r.push({target:t,type:"shared"}):e.parentKey.startsWith("shared")&&this.move_to_key(e,"root")&&r.push({target:t,type:"root"}),this.move_to_key(e,"shared"))for(const s of t.imports)r.push({target:s,type:"shared"});if(this.move_to_key(e,"root"))for(const s of t.imports)r.push({target:s,type:"root"});return r},move_to_key(e,t){if(t==="shared")switch(e.editorTypeName){case"infoGroup":return"sharedInfoGroups";case"rule":return"sharedRules";case"profile":return"sharedProfiles";case"selectionEntry":return"sharedSelectionEntries";case"selectionEntryGroup":return"sharedSelectionEntryGroups";default:return""}switch(e.editorTypeName){case"infoGroup":return"infoGroups";case"rule":return"rules";case"profile":return"profiles";case"selectionEntry":return"selectionEntries";case"selectionEntryGroup":return"";default:return e.parentKey}},async move(e,t,r,s){await(async()=>{const i=this.move_to_key(e,s);if(!i){console.error("Could not find key for move",e.editorTypeName,s);return}const o=e.parent,l=_e(e);zl(e),Jt(e);const a=JSON.parse(cr(e,es));Et({[i]:a}),r[i]||(r[i]=[]),r[i].push(a),await vt(a,r,r,this.get_system(r.getSystemId()));const u=["rule","infoGroup","profile","selectionEntry","selectionEntryGroup"].includes(e.editorTypeName),d=!e.parentKey.startsWith("shared");if(u&&d){const f={targetId:a.id,id:t.generateNonConflictingId(),type:e.editorTypeName,name:e.getName(),hidden:e.hidden,select:!0};e.isEntry()&&(f.collective=e.collective);const h=e.isGroup()||e.isEntry()?"entryLinks":"infoLinks";Et({[h]:f}),l[l.length-1].key=h,Ln(t,l,f),await vt(f,t,o,this.get_system(t.getSystemId()))}})(),this.set_catalogue_changed(t,!0),this.set_catalogue_changed(r,!0)},async open(e,t,r){var c;let s=document.getElementById("editor-entries");if(!s)return;async function n(u){const d=ae(u);d.open(),await d.$nextTick()}async function i(u){const d=ae(u);d.close(),await d.$nextTick()}const o=_e(e);if(!(o!=null&&o.length))return;if(s=s.getElementsByClassName(`depth-0 ${o[0].key}`)[0],!s){r!==!0&&console.error("Couldn't find root element for",o[0].key,"in",e.catalogue.getName());return}await n(s);const l=[];ar(e,u=>{l.push(u)}),l.pop(),l.reverse(),l.push(e);const a=l[l.length-1];for(let u=0;u<l.length;u++){const d=l[u],h=[...s.getElementsByClassName(`depth-${u+1} ${d.parentKey}`)].find(m=>Ue(ae(m))===d);h||r!==!0&&console.error("Couldn't find path to",e.getName(),e,"parent:",(c=e.parent)==null?void 0:c.getName()),h&&(s=h),d!==a&&await n(s),d===a&&(t===!1?await i(s):t===!0&&await n(s))}return s},async goto_catalogue(e,t){var o,l,a;const r=this.$router;if(!r)throw new Error("Cannot follow link to another catalogue without $router set");const n=((o=r.currentRoute)==null?void 0:o.query)??((a=(l=r.currentRoute)==null?void 0:l.value)==null?void 0:a.query),i=(n==null?void 0:n.id)||(n==null?void 0:n.systemId);return e!==i?(r.push({name:"catalogue",query:{systemId:t||e,id:e}}),this.$nextTick=new Promise((c,u)=>{this.$nextTickResolve=c}),await this.$nextTick,!0):!1},async show(e,t=!0){this.filtered.includes(e)||this.filtered.push(e),e.showInEditor=!0,e.showChildsInEditor=!0,t&&(e.highlight=!0),ar(e,r=>{r.showInEditor=!0})},async goto(e){const t=e.getCatalogue();this.put_current_state_in_history();const r=Ot();r.get_data(t.id).selection=_e(e),await this.goto_catalogue(t.id,t.gameSystemId),this.show(e,!1),await this.scrollto(e)},async scrollto(e){const t=await this.open(e);if(t){const r=ae(t);this.do_select(null,r,r),t.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}else setTimeout(async()=>{const r=await this.open(e);if(r){const s=ae(r);this.do_select(null,s,s),r.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}},50)},can_goto(e){return e?typeof e=="object"&&e instanceof W:!1},can_follow(e){return!!(e!=null&&e.target)},async follow(e){e!=null&&e.target&&await this.goto(e.target)},async move_up(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>0){const s=t.splice(r,1)[0];t.splice(r-1,0,s)}}},async move_down(e){if(e.parent){const t=e.parent[e.parentKey],r=t.indexOf(e);if(r>=0&&r<t.length-1){const s=t.splice(r,1)[0];t.splice(r+1,0,s)}}},get_leftpanel_open_collapsible_boxes(){function e(r,s,n=0){const i=`depth-${n} collapsible-box opened`,o=r.getElementsByClassName(i);if(o!=null&&o.length)for(const l of o){const a=Ue(ae(l)),c=a.parentKey,u=a.parent;if(u){const d=u[c];if(!d||!Array.isArray(d))continue;const f=d.indexOf(a);c in s||(s[c]={}),f in s[c]||(s[c][f]={}),e(l,s[c][f],n+1)}else{const d=[...l.classList].filter(f=>ht.has(f));for(const f of d)s[f]={},s[f][0]={};e(l,s[d[0]][0],n+1)}}}const t={};return e(document.documentElement,t),t},get_leftpanel_state(){if(!this.catalogueComponent)return{};const e={},t=this.catalogueComponent.$refs.leftpanel;for(const r of Object.keys(Ni))e[r]=t[r];return e},get_current_state(){var r;const e=this.get_selected(),t=(r=this.catalogueComponent)==null?void 0:r.cat;return{...this.get_leftpanel_state(),mode:this.mode,open:this.get_leftpanel_open_collapsible_boxes(),selection:e?_e(e):void 0,catalogueId:t==null?void 0:t.id,systemId:t==null?void 0:t.gameSystemId}},save_state(){if(this.catalogueComponent&&this.catalogueComponent.cat){const e=this.catalogueComponent.cat.id,t=Ot(),r=this.get_current_state();t.set_state(e,r)}},async load_state(e){this.catalogueComponent&&(Ot().set_state(e.catalogueId,e),this.mode=e.mode||"edit",await this.goto_catalogue(e.catalogueId,e.systemId)||(this.catalogueComponent.load_state(e),this.rerender_catalogue()))},put_state_in_history(e){if(this.historyStackPos<this.historyStack.length){const t=this.historyStack.length-this.historyStackPos;this.historyStack.splice(this.historyStackPos,t,e)}else this.historyStack.push(e);this.historyStackPos=this.historyStack.length},put_current_state_in_history(){this.catalogueComponent&&this.catalogueComponent.cat&&this.put_state_in_history(this.get_current_state())},can_back(){return this.historyStackPos>0},async back(){this.can_back()&&(this.historyStack[this.historyStackPos]=this.get_current_state(),this.historyStackPos-=1,this.load_state(this.historyStack[this.historyStackPos]))},can_forward(){if(this.historyStack[this.historyStack.length-1])return this.historyStackPos<this.historyStack.length-1},async forward(){this.can_forward()&&(this.historyStackPos+=1,this.load_state(this.historyStack[this.historyStackPos]))},async update_catalogue_search(e,t){const{filter:r,ignoreProfilesRules:s}=t,n=this.filtered;for(const i of n)delete i.showInEditor,delete i.showChildsInEditor,delete i.highlight,ar(i,o=>{delete o.showInEditor,delete i.showChildsInEditor});if(this.filter.length<=1){this.set_filter(""),this.filtered=[];return}this.set_filter(r),this.filtered=e.findOptionsByText(r),s&&(this.filtered=this.filtered.filter(i=>!i.isProfile()&&!i.isRule()&&!i.isInfoGroup()));for(const i of this.filtered)this.show(i);if(await $n(),this.filtered.length<300){for(const i of this.filtered)if(i.parent)try{await this.open(i,!1,!0)}catch{continue}}},async system_search(e,t,r=1e3){const s=[],{filter:n}=t;if(!n)return null;const i=rs(n);let o=!1;await e.loadAll();for(const a of e.getAllLoadedCatalogues())if(a.forEachObjectWhitelist((c,u)=>{var g;if(s.length>=r||c.isLink()&&c.target&&c.isCategory()&&!(u!=null&&u.isForce()))return;const d=(g=c.getName)==null?void 0:g.call(c),f=c.$text,h=c.description,m=c.id;(m===n||d&&String(d).match(i)||m===n||f&&String(f).match(i)||h&&String(h).match(i))&&s.push(c)}),s.length>=r){o=!0;break}console.log("Search for",`"${n}"`,"found",s.length,"results");const l={};for(const a of s)rt(l,a.catalogue.name,a);return{grouped:l,all:s,more:o}}}});export{Ci as A,Hd as B,vc as C,xi as D,Ke as E,Jd as F,jd as G,tf as H,$l as I,Po as P,rf as _,fc as a,ot as b,Vc as c,Si as d,nt as e,Uc as f,Wl as g,ge as h,Wc as i,Xd as j,Bn as k,Ot as l,Rd as m,$d as n,ef as o,Gl as p,bi as q,Rl as r,fs as s,Br as t,Gr as u,sf as v,qd as w,un as x,Ql as y,Yd as z};
//# sourceMappingURL=editorStore.fc4f5a8b.js.map
